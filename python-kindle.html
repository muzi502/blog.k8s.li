<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.2.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="kindle 标注大学毕业之后不再像在校时那样能随便去图书馆看书，就从传统纸质书的阅转换到了 kindle 上来。这两年就一直习惯使用 kindle 来看书，读书过程中遇到一些不错的句子或段落往往会标注记录下来。这样时间一长，现在的 Kindle 上就积累了 共 189 本书和 3522 条笔记 😂。本人有个习惯就是会进行笔记整理，通过这些标注来回忆当时读书时的一些想法，整理一下读书笔记。Kin">
<meta property="og:type" content="blog">
<meta property="og:title" content="Python 处理 kindle 标注文本">
<meta property="og:url" content="https://blog.k8s.li/python-kindle.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="kindle 标注大学毕业之后不再像在校时那样能随便去图书馆看书，就从传统纸质书的阅转换到了 kindle 上来。这两年就一直习惯使用 kindle 来看书，读书过程中遇到一些不错的句子或段落往往会标注记录下来。这样时间一长，现在的 Kindle 上就积累了 共 189 本书和 3522 条笔记 😂。本人有个习惯就是会进行笔记整理，通过这些标注来回忆当时读书时的一些想法，整理一下读书笔记。Kin">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-11-29T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-25T00:24:48.292Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="CI&#x2F;CD">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Registry">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="PaaS toB">
<meta property="article:tag" content="IaaS toB">
<meta property="article:tag" content="超融合">
<meta property="article:tag" content="虚拟化">
<meta property="article:tag" content="裸金属服务器">
<meta property="article:tag" content="运维开发">
<meta property="article:tag" content="容器镜像">
<meta property="article:tag" content="发布流水线">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.k8s.li/python-kindle.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/python-kindle.html","path":"python-kindle.html","title":"Python 处理 kindle 标注文本"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Python 处理 kindle 标注文本 | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#kindle-%E6%A0%87%E6%B3%A8"><span class="nav-number">1.</span> <span class="nav-text">kindle 标注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%9A%94"><span class="nav-number">2.</span> <span class="nav-text">分隔</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#txt-to-json"><span class="nav-number">3.</span> <span class="nav-text">txt to json</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#json-to-html"><span class="nav-number">4.</span> <span class="nav-text">json to html</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#date-to-svg"><span class="nav-number">5.</span> <span class="nav-text">date to svg</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">115</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">147</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail → mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/python-kindle.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Python 处理 kindle 标注文本 | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python 处理 kindle 标注文本
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 2021-11-30T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2021-11-30T00:00:00+08:00">2021-11-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-25 2022-05-25T08:24:48+08:00" itemprop="dateModified" datetime="2022-05-25T08:24:48+08:00">2022-05-25</time>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/python-kindle.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python-kindle.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="kindle-标注"><a href="#kindle-标注" class="headerlink" title="kindle 标注"></a>kindle 标注</h2><p>大学毕业之后不再像在校时那样能随便去图书馆看书，就从传统纸质书的阅转换到了 kindle 上来。这两年就一直习惯使用 kindle 来看书，读书过程中遇到一些不错的句子或段落往往会标注记录下来。这样时间一长，现在的 Kindle 上就积累了 共 189 本书和 3522 条笔记 😂。本人有个习惯就是会进行笔记整理，通过这些标注来回忆当时读书时的一些想法，整理一下读书笔记。Kindle 标注的文本都是以 txt 格式方式存储在 Kindle 的 <code>/documents/My Clippings.txt</code> 文件中。由于 txt 格式的文本数据阅读起来实在是太费劲了，于是之前参考了 <a target="_blank" rel="noopener" href="https://github.com/cyang812/kindleNote">kindleNote</a> 和 <a target="_blank" rel="noopener" href="https://bookfere.com/tools#ClippingsFere">书伴网 Clippings Fere 工具</a> 缝合了一个工具 **<a target="_blank" rel="noopener" href="https://github.com/muzi502/kindle">muzi502&#x2F;kindle</a>**。用它来将 txt 格式的标注文本渲染成 html 的格式。这样每一本书就能有一个单独的 html 页面来展示标注的内容，阅读起来就十分方便。最近花了点时间重构了一下该工具，并新增了 svg 日历图的生成方式，本文就介绍一下这个工具的实现思路和方法。</p>
<h2 id="分隔"><a href="#分隔" class="headerlink" title="分隔"></a>分隔</h2><p>由于 Kindle 的标注文本有一定的规律可循，实现起来还是比较方便滴。大致思路就是先读取 Kindle 的标注文件 <code>My Clippings.txt</code>，然后根据分隔符 <code>==========</code> 分割每一个标注；每个标注包含着书名、标注时间、标注内容等信息，规律如下：</p>
<ul>
<li>第一行：书籍的名称以及作者，可以以半角括号来拆分出书名和作者；</li>
<li>第二行：标注的位置和时间，以 <code>|</code> 拆分出标注位置和标注时间；</li>
<li>第三行：空行，可以将这一行去除掉，即取出标注文件中所有的空行；</li>
<li>第四行：标注文本内容，Kindle 标注的正文是没有换行的，即便是连续标注了几段也都会压缩在一行里面；</li>
<li>第五行： 即分隔符 <code>==========</code> ，所有的标注都是以它来进行分隔；</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">娱乐至死 <span class="token punctuation">(</span><span class="token punctuation">[</span>美<span class="token punctuation">]</span>尼尔·波兹曼<span class="token punctuation">)</span>
- 您在位置 <span class="token comment">#109-110的标注 | 添加于 2019年10月27日星期日 下午11:09:01</span>

电视需要的内容和其他媒体截然不同。电视无法表现政治哲学，电视的形式注定了它同政治哲学是水火不相容的。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
娱乐至死 <span class="token punctuation">(</span><span class="token punctuation">[</span>美<span class="token punctuation">]</span>尼尔·波兹曼<span class="token punctuation">)</span>
- 您在位置 <span class="token comment">#110-112的标注 | 添加于 2019年10月27日星期日 下午11:09:19</span>

信息、内容，或者如果你愿意，可以称之为构成“今日新闻”的“素材”，在一个缺乏媒介的世界里是不存在的——是不能存在的。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
娱乐至死 <span class="token punctuation">(</span><span class="token punctuation">[</span>美<span class="token punctuation">]</span>尼尔·波兹曼<span class="token punctuation">)</span>
- 您在位置 <span class="token comment">#114-115的标注 | 添加于 2019年10月27日星期日 下午11:09:52</span>

电报使无背景的信息能够以难以置信的速度跨越广阔的空间。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
通往奴役之路 <span class="token punctuation">(</span>弗里德里希·奥古斯特·冯·哈耶克<span class="token punctuation">)</span>
- 您在位置 <span class="token comment">#259-261的标注 | 添加于 2019年11月8日星期五 下午12:50:33</span>

在安排我们的事务时，应该尽可能多地运用自发的社会力量，而尽可能少地借助于强制，这个基本原则能够作千变万化的应用。深思熟虑地创造一种使竞争能尽可能地有益进行的体制，和被动地接受既定的制度，二者之间的差别尤其悬殊。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
通往奴役之路 <span class="token punctuation">(</span>弗里德里希·奥古斯特·冯·哈耶克<span class="token punctuation">)</span>
- 您在位置 <span class="token comment">#312-318的标注 | 添加于 2019年11月8日星期五 下午12:54:46</span>

尽管绝大部分的新思想，尤其是社会主义，并非起源于德国，但正是在德国它们得到完善，并在19世纪的最后25年和20世纪的最初25年，得到最充分的发展。现在，人们常常忽略了，德国在这一时期社会主义的理论和实际的发展中起了多么巨大的领导作用；在社会主义成为这个国家的一个严重问题以前的那一代，德国国会中已有一个很大的社会主义政党；并且在不久以前，社会主义学说的发展，几乎完全是在德国和奥地利进行的，以致于今天俄国人的讨论，在很大程度上是从德国人中止的地方进行的；绝大部分英国的社会主义者尚未意识到，他们才开始发现的大多数问题，德国社会主义者很早以前已彻底讨论过了。
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
见识城邦·童年的消逝（媒介文化研究大师尼尔·波兹曼20年经典畅销作品） <span class="token punctuation">(</span>尼尔·波兹曼<span class="token punctuation">)</span>
- 您在位置 <span class="token comment">#536-539的标注 | 添加于 2019年11月21日星期四 上午6:47:26</span>

列奥·洛文塔尔（Leo Lowenthal）说道：“自从文艺复兴以来，关于人类本性的普遍哲学是建立在这样的构想之上的：每个个人都是离经叛道者。在很大程度上，个人的存在就在于坚持个性，反对社会的限制和规范要求。”
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>首先定义一个书籍列表，列表中的每个元素为一个字典，字典中记录的信息如下：</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> book_name<span class="token punctuation">,</span>
    <span class="token property">"author"</span><span class="token operator">:</span> book_author<span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> book_url<span class="token punctuation">,</span>
    <span class="token property">"nums"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"marks"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>每本书的标注列表</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"time"</span><span class="token operator">:</span> mark_time<span class="token punctuation">,</span>
    <span class="token property">"address"</span><span class="token operator">:</span> mark_address<span class="token punctuation">,</span>
    <span class="token property">"content"</span><span class="token operator">:</span> mark_content
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>转换后的 json 格式</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"娱乐至死 "</span><span class="token punctuation">,</span>
    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"尼尔·波兹曼"</span><span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"dd0875de349e84eb7e6a2402c64bd95a"</span><span class="token punctuation">,</span>
    <span class="token property">"nums"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"marks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">" 添加于 2019年10月27日星期日 下午11:09:01"</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"您在位置 #109-110的标注"</span><span class="token punctuation">,</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"电视需要的内容和其他媒体截然不同。电视无法表现政治哲学，电视的形式注定了它同政治哲学是水火不相容的。"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">" 添加于 2019年10月27日星期日 下午11:09:19"</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"您在位置 #110-112的标注"</span><span class="token punctuation">,</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"信息、内容，或者如果你愿意，可以称之为构成“今日新闻”的“素材”，在一个缺乏媒介的世界里是不存在的——是不能存在的。"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">" 添加于 2019年10月27日星期日 下午11:09:52"</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"您在位置 #114-115的标注"</span><span class="token punctuation">,</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"电报使无背景的信息能够以难以置信的速度跨越广阔的空间。"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"通往奴役之路 "</span><span class="token punctuation">,</span>
    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"弗里德里希·奥古斯特·冯·哈耶克"</span><span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"646a2a825b48c4c9df653a42aa72b702"</span><span class="token punctuation">,</span>
    <span class="token property">"nums"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"marks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">" 添加于 2019年11月8日星期五 下午12:50:33"</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"您在位置 #259-261的标注"</span><span class="token punctuation">,</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"在安排我们的事务时，应该尽可能多地运用自发的社会力量，而尽可能少地借助于强制，这个基本原则能够作千变万化的应用。深思熟虑地创造一种使竞争能尽可能地有益进行的体制，和被动地接受既定的制度，二者之间的差别尤其悬殊。"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">" 添加于 2019年11月8日星期五 下午12:54:46"</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"您在位置 #312-318的标注"</span><span class="token punctuation">,</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"尽管绝大部分的新思想，尤其是社会主义，并非起源于德国，但正是在德国它们得到完善，并在19世纪的最后25年和20世纪的最初25年，得到最充分的发展。现在，人们常常忽略了，德国在这一时期社会主义的理论和实际的发展中起了多么巨大的领导作用；在社会主义成为这个国家的一个严重问题以前的那一代，德国国会中已有一个很大的社会主义政党；并且在不久以前，社会主义学说的发展，几乎完全是在德国和奥地利进行的，以致于今天俄国人的讨论，在很大程度上是从德国人中止的地方进行的；绝大部分英国的社会主义者尚未意识到，他们才开始发现的大多数问题，德国社会主义者很早以前已彻底讨论过了。"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"见识城邦·童年的消逝"</span><span class="token punctuation">,</span>
    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"尼尔·波兹曼"</span><span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"1e1c307ca9d857c047d33df2a808e557"</span><span class="token punctuation">,</span>
    <span class="token property">"nums"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"marks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"time"</span><span class="token operator">:</span> <span class="token string">" 添加于 2019年11月21日星期四 上午6:47:26"</span><span class="token punctuation">,</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"您在位置 #536-539的标注"</span><span class="token punctuation">,</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"列奥·洛文塔尔（Leo Lowenthal）说道：“自从文艺复兴以来，关于人类本性的普遍哲学是建立在这样的构想之上的：每个个人都是离经叛道者。在很大程度上，个人的存在就在于坚持个性，反对社会的限制和规范要求。”"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="txt-to-json"><a href="#txt-to-json" class="headerlink" title="txt to json"></a>txt to json</h2><p>有了上面的思路之后，我们就可以对 Kindle 的标注文本进行处理。先将 txt 格式的文本转换成 json 结构化的数据。然后再使用这个结构化的 json 进行后续的处理操作。对于文本的处理，选择 Python 比较合适。因为在 Python 中字符串对象有很多操作方法，比如分割、匹配、替换等等，都要比其他语言方便一些；以下就是具体实现的代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> json
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5

<span class="token comment"># 定义分隔符</span>
DELIMITER <span class="token operator">=</span> <span class="token string">u"==========\n"</span>

<span class="token comment"># 按照分隔符对所有标注进行分割，并存放在该数组中</span>
all_marks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 按照书籍来对标注进行分组存放</span>
all_books <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


<span class="token comment"># 定义一个函数用于获取当前书籍在 all_books 列表中的索引</span>
<span class="token keyword">def</span> <span class="token function">get_book_index</span><span class="token punctuation">(</span>book_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""get book's index"""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_books<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> all_books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">==</span> book_name<span class="token punctuation">:</span>
            <span class="token keyword">return</span> i
    <span class="token comment"># 如果书籍并不存在，说明还没有插入该元素，就将该元素插入到最后一个元素</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>


<span class="token comment"># 定义渲染处理标注文本的函数</span>
<span class="token keyword">def</span> <span class="token function">render_clippings</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> all_marks
    <span class="token keyword">global</span> all_books

    <span class="token comment"># 以 utf-8 格式打开标注文件并并将内容读取到 content 变量中</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 对读入的内容去除空行，即将 '\n\n' 替换为 '\n'，方便后续处理</span>
    content <span class="token operator">=</span> content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>

    <span class="token comment"># 对去除空行的内容以分隔符进行分隔，得到的是一个列表，每个元素就是一个标注</span>
    all_marks <span class="token operator">=</span> content<span class="token punctuation">.</span>split<span class="token punctuation">(</span>DELIMITER<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_marks<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 以换行符进行分隔，将每个标注拆分成四个元素</span>
        mark <span class="token operator">=</span> all_marks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        <span class="token comment"># 如果该标注中元素的数量为 4 说明就是一个正确的标注，否则就是无效的</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>

          	<span class="token comment"># 对标注的第一个元素，即书名部分进行 md5 计算，用于将它设置为后续的 url 路径，以及 html 文件名</span>
            book_url <span class="token operator">=</span> md5<span class="token punctuation">(</span>mark<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 去除掉书名中一些特殊的字符，用来拆分出简短的书名</span>
            book_info <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r"[()&lt;>|\[\]（）《》【】｜]\s*"</span><span class="token punctuation">,</span> mark<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取书名，一般为第一个元素，目的是为了去除 kinlde 中文商店下载的又长又臭的书名</span>
            book_name <span class="token operator">=</span> book_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>book_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">else</span> <span class="token punctuation">(</span>mark<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment"># 获取该书的作者</span>
            book_author <span class="token operator">=</span> book_info<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>book_info<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">""</span>

            mark_info <span class="token operator">=</span> mark<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span>
  					<span class="token comment"># 获取该书的标记时间和标注位置</span>
            mark_time <span class="token operator">=</span> mark_info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            mark_address <span class="token operator">=</span> mark_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"- "</span><span class="token punctuation">)</span>

            <span class="token comment"># 获取该标注的正文内容</span>
            mark_content <span class="token operator">=</span> mark<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

            <span class="token comment"># 查询该书的列表索引，将该标记插入到该书的 marks 列表中</span>
            book_index <span class="token operator">=</span> get_book_index<span class="token punctuation">(</span>book_name<span class="token punctuation">)</span>
            <span class="token keyword">if</span> book_index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                all_books<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token string">"name"</span><span class="token punctuation">:</span> book_name<span class="token punctuation">,</span>
                        <span class="token string">"author"</span><span class="token punctuation">:</span> book_author<span class="token punctuation">,</span>
                        <span class="token string">"url"</span><span class="token punctuation">:</span> book_url<span class="token punctuation">,</span>
                        <span class="token string">"nums"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        <span class="token string">"marks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">)</span>
            all_books<span class="token punctuation">[</span>book_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"marks"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                <span class="token punctuation">&#123;</span><span class="token string">"time"</span><span class="token punctuation">:</span> mark_time<span class="token punctuation">,</span> <span class="token string">"address"</span><span class="token punctuation">:</span> mark_address<span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> mark_content<span class="token punctuation">&#125;</span>
            <span class="token punctuation">)</span>
            <span class="token comment"># 更新该书的标记数量</span>
            all_books<span class="token punctuation">[</span>book_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"nums"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token comment"># 使用 lambda 函数以标注数量为 key 对所有书籍进行倒序排序</span>
    all_books<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">"nums"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 以下就是将 all_books 列表以 json 格式写入到一个 json 文件中，或许会有一些其他的用途，比如前端展示</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>all_books<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"clippings.json"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>

 <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    file_path <span class="token operator">=</span> <span class="token string">"source.txt"</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    render_clippings<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="json-to-html"><a href="#json-to-html" class="headerlink" title="json to html"></a>json to html</h2><p>接下来再将上述得到的 json 内容写入到 html 文件中。渲染 html 的方式有两种，一种是通过 jinja2 的模版进行渲染，一种是通过字符串替换拼凑 html 内容。两种各有各的好处，jinjia2 实现起来比较优雅一些，但是会引入一个 jinjia2 的依赖；第二种方式就无任何依赖，适用性回好一些；下面就讲一下使用第二种方式的实现；</p>
<ul>
<li>将 html 内容按照元素的分布进行拆分，定义如下几个几个特殊的变量</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">HTML_HEAD <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!DOCTYPE html>
&lt;html>
	&lt;head>
	&lt;meta charset="utf-8" />
	&lt;title> Kindle 读书笔记 &lt;/title>
	&lt;meta name="viewport" content="width=device-width, initial-scale=1">
	&lt;link href="../style/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	&lt;link href="../style/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
	&lt;link href="../style/css/custom.css" rel="stylesheet" type="text/css" />
&lt;/head>
&lt;body>
"""</span>

INDEX_TITLE <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
	&lt;div class="container">
		&lt;header class="header col-md-12">
			&lt;div class="page-header">
                &lt;embed src="date.svg" type="image/svg+xml" />
				&lt;h1>&lt;small>&lt;span class="glyphicon glyphicon-book" aria-hidden="true">&lt;/span> Kindle 读书笔记 &lt;/small> &lt;span class="badge">更新于 UPDATE &lt;/span> &lt;span class="badge"> 共 BOOKS_SUM 本书，SENTENCE_SUM 条笔记&lt;/span>&lt;/h1>
			&lt;/div>
		&lt;/header>
	&lt;div class="col-md-12">
        &lt;div class="list-group">
"""</span>

BOOK_TITLE <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
	&lt;div class="container">
		&lt;header class="header col-md-12">
			&lt;div class="page-header">
				&lt;h1>&lt;small>&lt;span class="glyphicon glyphicon-book" aria-hidden="true">&lt;/span>BookName&lt;/small> &lt;span class="badge">&lt;/span>&lt;/h1>
			&lt;/div>
		&lt;/header>

        &lt;div class="col-md-2">
			&lt;ul class="nav nav-pills nav-stacked go-back">
				&lt;li role="presentation" class="active text-center">
					&lt;a href="../index.html" style="border-radius: 50%;">&lt;span class="glyphicon glyphicon-backward" aria-hidden="true">&lt;/span>&lt;/a>
				&lt;/li>
			&lt;/ul>
		&lt;/div>
"""</span>

MARK_CONTENT <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    	&lt;div class="col-md-12">
			&lt;article>
				&lt;div class="panel panel-default">
					&lt;div class="panel-body mk88">&lt;p>SENTENCE_TXT
                    &lt;/p>&lt;/div>
					&lt;div class="panel-footer text-right">
						&lt;span class="label label-primary">&lt;span class="glyphicon glyphicon-tag" aria-hidden="true">&lt;/span> 标注&lt;/span>
						&lt;span class="label label-default">&lt;span class="glyphicon glyphicon-bookmark" aria-hidden="true">&lt;/span>SENTENCE_ADDR&lt;/span>
						&lt;span class="label label-default">&lt;span class="glyphicon glyphicon-time" aria-hidden="true">&lt;/span>SENTENCE_TIME&lt;/span>
					&lt;/div>
				&lt;/div>
			&lt;/article>
        &lt;/div>
"""</span>

ITEM_CONTENT <span class="token operator">=</span> <span class="token triple-quoted-string string">"""          &lt;a href="HTML_URL" class="list-group-item">&lt;span class="glyphicon glyphicon-book" aria-hidden="true">&lt;/span>HTML_FILE_NAME&lt;span class="glyphicon glyphicon-tag" aria-hidden="true">SENTENCE_COUNT&lt;/span>&lt;/a>
"""</span>

FOOTER_CONTENT <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
        &lt;/div>
    &lt;/div>
&lt;/body>
&lt;/html>
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>渲染 index.html 文件</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">render_index_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>HTML_HEAD<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"../"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 替换书籍的总数量和标注的总数量</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
            INDEX_TITLE<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SENTENCE_SUM"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_marks<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"UPDATE"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"BOOKS_SUM"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_books<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># 根据预先定义的标识字符替换每本书籍的书籍名、作者、标注数量、URL</span>
        <span class="token keyword">for</span> book <span class="token keyword">in</span> all_books<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
                ITEM_CONTENT<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"HTML_URL"</span><span class="token punctuation">,</span> <span class="token string">"books/"</span> <span class="token operator">+</span> book<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".html"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"HTML_FILE_NAME"</span><span class="token punctuation">,</span> book<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" ["</span> <span class="token operator">+</span> book<span class="token punctuation">[</span><span class="token string">"author"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SENTENCE_COUNT"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>book<span class="token punctuation">[</span><span class="token string">"nums"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>FOOTER_CONTENT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>渲染 book 书籍页面</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">render_books_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_books<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        book_url <span class="token operator">=</span> all_books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span>
        book_name <span class="token operator">=</span> all_books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
        book_author <span class="token operator">=</span> all_books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"author"</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"books/"</span> <span class="token operator">+</span> book_url <span class="token operator">+</span> <span class="token string">".html"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>HTML_HEAD<span class="token punctuation">)</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
                BOOK_TITLE<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"BookName"</span><span class="token punctuation">,</span> book_name <span class="token operator">+</span> <span class="token string">" ["</span> <span class="token operator">+</span> book_author <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"marks"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                mark <span class="token operator">=</span> all_books<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"marks"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
                    MARK_CONTENT<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SENTENCE_TXT"</span><span class="token punctuation">,</span> mark<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SENTENCE_ADDR"</span><span class="token punctuation">,</span> mark<span class="token punctuation">[</span><span class="token string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SENTENCE_TIME"</span><span class="token punctuation">,</span> mark<span class="token punctuation">[</span><span class="token string">"time"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>FOOTER_CONTENT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="date-to-svg"><a href="#date-to-svg" class="headerlink" title="date to svg"></a>date to svg</h2><p>前段时间看到 yihong 大佬的 <strong><a target="_blank" rel="noopener" href="https://github.com/yihong0618/GitHubPoster">GitHubPoster</a></strong> 支持了 json 格式的数据，只要提供类似类似如下格式的数据，就可以生成相应的 svg 了。真的是一个很棒的特性，这样我们就可以根据每天标记的数量来生成一个对应的 svg 图了。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"2019-05-28"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"2019-06-10"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"2019-07-18"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"2019-07-23"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"2019-07-24"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"2019-07-29"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"2019-08-12"</span><span class="token operator">:</span> <span class="token number">1</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<blockquote class="twitter-tweet"><p lang="zh" dir="ltr">支持了自定义 json 的源数据，生成了某个 tg 现充群的群聊的 poster <a target="_blank" rel="noopener" href="https://t.co/nhSe3qlVe0">https://t.co/nhSe3qlVe0</a> <a target="_blank" rel="noopener" href="https://t.co/bkijsFDtzC">pic.twitter.com/bkijsFDtzC</a></p>&mdash; yihong0618 (@yihong0618) <a target="_blank" rel="noopener" href="https://twitter.com/yihong0618/status/1466275108952051716?ref_src=twsrc%5Etfw">December 2, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>



<ul>
<li>生成 <code>date.json</code> 数据文件</li>
</ul>
<p>生成一个{日期: 数量} 格式的字典其实挺简单，不过对于 kindle 标注的时间格式需要稍微处理一下，转换成一个标准的时间格式。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">render_date_json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    all_dates <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_marks<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        mark <span class="token operator">=</span> all_marks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        <span class="token comment"># 如果一个标注有 4 行说明它就是一个正确的标注</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
            <span class="token comment"># 第二行就是标注的时间，以年月日关键字进行分隔，第一个元素就是年，第二个就是月，第三个就是日</span>
            date <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r"[年月日]\s*"</span><span class="token punctuation">,</span>mark<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment"># 在 1-9 月前面补充一个 0</span>
            month <span class="token operator">=</span> date<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>date<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token string">"0"</span> <span class="token operator">+</span> date<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

            <span class="token comment"># 在 1-9 日前面补充一个 0</span>
            day <span class="token operator">=</span> date<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>date<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token string">"0"</span> <span class="token operator">+</span> date<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

            <span class="token comment"># 最后拼凑成 2021-12-05 这样的时间格式</span>
            date <span class="token operator">=</span> date<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> month <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> day

            <span class="token comment"># 如果当前日期没有在字典中，则将它添加到字典中</span>
            <span class="token keyword">if</span> date <span class="token keyword">not</span> <span class="token keyword">in</span> all_dates<span class="token punctuation">:</span>
                all_dates<span class="token punctuation">[</span>date<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

            <span class="token comment"># 对天数的 value 值进行自增 1</span>
            all_dates<span class="token punctuation">[</span>date<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token comment"># 将数据写入 json 文件当中</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>all_dates<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"date.json"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>生成好 json 格式的数据之后，接下来我们就使用 GitHubPoster 来生成相应的 svg 文件。由于 GitHubPoster 的依赖项太多，且还没有支持 docker 方式来运行，在本地安装也不是很方便，因此为了方便起见我们将它放在 GitHub action 中运行。这样只要每次更新标注文本的源文件就可以自动更新 html 页面并生成最新的 svg 图片了。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> Build kindle note website

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> gh<span class="token punctuation">-</span>pages
      <span class="token punctuation">-</span> master
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Python
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>python@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">python-version</span><span class="token punctuation">:</span> <span class="token number">3.6</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          # 安装 github_poster 及其依赖
          pip3 install -U github_poster</span>

			  <span class="token comment"># 生成 html 文件</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build .html file
        <span class="token key atrule">run</span><span class="token punctuation">:</span> python3 kindle.py

       <span class="token comment"># 生成 svg 文件</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build svg file
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          github_poster json --json_file date.json --year 2021 --me kindleReading --background-color '#ffffff'
          mv OUT_FOLDER/json.svg date.svg</span>

      <span class="token comment"># 设置 commit 信息为 GitHub action bot，并提交 commit 和 push 到 origin 上</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Config git user and user.email and push commit
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          git config user.name github-actions
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git add .
          git commit -am "Auto build by GitHub Actions $(date)"
          git push origin -f</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    
      


    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/apcupsd-on-openwrt-with-esxi.html" rel="prev" title="使用 apcupsd 完成 UPS 断电后 ESXi 稳妥关机方案">
                  <i class="fa fa-chevron-left"></i> 使用 apcupsd 完成 UPS 断电后 ESXi 稳妥关机方案
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/cfwctl.html" rel="next" title="Tencent Cloud lighthouse Firewall tool">
                  Tencent Cloud lighthouse Firewall tool <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">25:30</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
