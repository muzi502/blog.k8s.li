<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.k8s.li').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
  <meta name="description" content="目前gitlab官方给出的安装方式有很多种，普遍采用Omnibus包、Docker安装。官方说的😂我们强烈建议使用 Omnibus 包安装 GitLab ，因为它安装起来更快、更容易升级版本，而且包含了其他安装方式所没有的可靠性功能。 1.Omnibus包安装，也就是rpm包、deb包安装😂CentOS7123456789101112131415161718192021222324252627">
<meta property="og:type" content="article">
<meta property="og:title" content="部署 Gitlab 及 gitlab-runner">
<meta property="og:url" content="https://blog.k8s.li/gitlab-install.html">
<meta property="og:site_name" content="木子">
<meta property="og:description" content="目前gitlab官方给出的安装方式有很多种，普遍采用Omnibus包、Docker安装。官方说的😂我们强烈建议使用 Omnibus 包安装 GitLab ，因为它安装起来更快、更容易升级版本，而且包含了其他安装方式所没有的可靠性功能。 1.Omnibus包安装，也就是rpm包、deb包安装😂CentOS7123456789101112131415161718192021222324252627">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20200310202057916.png">
<meta property="article:published_time" content="2019-05-21T16:00:00.000Z">
<meta property="article:modified_time" content="2019-05-21T16:00:00.000Z">
<meta property="article:author" content="木子">
<meta property="article:tag" content="gitlab">
<meta property="article:tag" content="CI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20200310202057916.png">
<link rel="canonical" href="https://blog.k8s.li/gitlab-install.html">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
  <title>部署 Gitlab 及 gitlab-runner | 木子</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
<link rel="alternate" href="/atom.xml" title="木子" type="application/atom+xml">
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">
    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">木子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>
  </li>
        <li class="menu-item menu-item-books">
    <a href="/booklist.html" rel="section"><i class="fa fa-fw fa-book"></i>Books</a>
  </li>
        <li class="menu-item menu-item-kindle">
    <a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
  </li>
        <li class="menu-item menu-item-friend">
    <a href="/link/" rel="section"><i class="fa fa-fw fa-link"></i>Friend</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>
  </li>
  </ul>
</nav>
</div>
    </header>
  <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
  <div class="posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/gitlab-install.html">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.k8s.li/avatar.png">
      <meta itemprop="name" content="木子">
      <meta itemprop="description" content="">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          部署 Gitlab 及 gitlab-runner
        </h2>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="创建时间：2019-05-22 2019-05-22T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2019-05-22T00:00:00+08:00">2019-05-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>
            </span>
  <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    <a title="disqus" href="/gitlab-install.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="gitlab-install.html" itemprop="commentCount"></span>
    </a>
  </span>
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <p>目前gitlab官方给出的安装方式有很多种，普遍采用Omnibus包、Docker安装。官方说的😂<strong>我们强烈建议使用 Omnibus 包安装 GitLab ，因为它安装起来更快、更容易升级版本，而且包含了其他安装方式所没有的可靠性功能。</strong></p>
<h2 id="1-Omnibus包安装，也就是rpm包、deb包安装😂"><a href="#1-Omnibus包安装，也就是rpm包、deb包安装😂" class="headerlink" title="1.Omnibus包安装，也就是rpm包、deb包安装😂"></a>1.Omnibus包安装，也就是rpm包、deb包安装😂</h2><h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置防火墙</span></span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加官方的软件包源</span></span><br><span class="line"><span class="comment"># curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 国内用户添加清华大学镜像站的源，下载速度会快些。</span></span><br><span class="line">sudo cat &gt; /etc/yum.repos.d/gitlab-ce.repo &lt;&lt;EOF</span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">Ece</span><br><span class="line"></span><br><span class="line">sudo yum makecache</span><br><span class="line"><span class="comment"># 然后安装最新的版本</span></span><br><span class="line">yum install -y gitlab-ce</span><br><span class="line"><span class="comment"># 安装指定版本 12.3.5</span></span><br><span class="line">yum install gitlab-ce-12.3.5-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以使用 wget 的方式把 rpm 包下载下来安装</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br><span class="line">yum install gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<h3 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加清华大学的镜像站源 bionic是 Ubuntu18.04 xenial是16.04，根据自己的 Ubuntu 发行版本修改一下下</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu bionic main</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gitlab-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以考虑使用 wget 的方式把 deb 包下载下来</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br><span class="line"></span><br><span class="line">opkg -i gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2-打补丁，补充汉化的补丁"><a href="#2-打补丁，补充汉化的补丁" class="headerlink" title="2.打补丁，补充汉化的补丁"></a>2.打补丁，补充汉化的补丁</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line"><span class="built_in">cd</span> gitlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前安装的版本</span></span><br><span class="line">gitlab_version=$(cat /opt/gitlab/embedded/service/gitlab-rails/VERSION)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成对应版本补丁文件</span></span><br><span class="line">git diff v<span class="variable">$&#123;gitlab_version&#125;</span> v<span class="variable">$&#123;gitlab_version&#125;</span>-zh &gt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打补丁的时候会提示一些补丁文件不存在，一定要跳过这些文件，不然后面reconfig的时候会报错的。</span></span><br><span class="line">patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; <span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启gitlab</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br></pre></td></tr></table></figure>
<h3 id="reconfigure-失败"><a href="#reconfigure-失败" class="headerlink" title="reconfigure 失败"></a>reconfigure 失败</h3><h2 id="3-进行一些配置，gitlab的配置文件在-etc-gitlab-gitlab-rb"><a href="#3-进行一些配置，gitlab的配置文件在-etc-gitlab-gitlab-rb" class="headerlink" title="3.进行一些配置，gitlab的配置文件在/etc/gitlab/gitlab.rb"></a>3.进行一些配置，gitlab的配置文件在/etc/gitlab/gitlab.rb</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 修改为你自己的域名或者IP，是单引号，而且前面的 http 不要改</span><br><span class="line">external_url  'http://gitlab.domain'</span><br><span class="line"></span><br><span class="line"># 邮件配置，选用外部SMTP服务器</span><br><span class="line">gitlab_rails['smtp_enable'] = true</span><br><span class="line">gitlab_rails['smtp_address'] = "smtp.office365.com"</span><br><span class="line">gitlab_rails['smtp_port'] =  587</span><br><span class="line">gitlab_rails['smtp_user_name'] = "xxxx@outlook.com"</span><br><span class="line">gitlab_rails['smtp_password'] = "password"</span><br><span class="line">gitlab_rails['smtp_authentication'] = "login"</span><br><span class="line">gitlab_rails['smtp_enable_starttls_auto'] = true</span><br><span class="line">gitlab_rails['smtp_tls'] = true</span><br><span class="line">gitlab_rails['gitlab_email_from'] = 'xxxx@outlook.com'</span><br></pre></td></tr></table></figure>
<h2 id="安装-gitlab-runner"><a href="#安装-gitlab-runner" class="headerlink" title="安装 gitlab-runner"></a>安装 gitlab-runner</h2><h3 id="CentOS-RHEL"><a href="#CentOS-RHEL" class="headerlink" title="CentOS/RHEL"></a>CentOS/RHEL</h3><p>新建 <code>/etc/yum.repos.d/gitlab-runner.repo</code>，内容为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-runner]</span><br><span class="line">name=gitlab-runner</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br></pre></td></tr></table></figure>
<p>再执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum makecache</span><br><span class="line">sudo yum install gitlab-runner -y</span><br><span class="line"><span class="comment"># 安装指定版本 其中 12.3.5 即为指定的版本号</span></span><br><span class="line">yum install gitlab-runner-12.3.5-1.x86_64 -y</span><br></pre></td></tr></table></figure>
<h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h3><p>首先信任 GitLab 的 GPG 公钥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure>
<p>再选择你的 Debian/Ubuntu 版本，文本框中内容写进 <code>/etc/apt/sources.list.d/gitlab-runner.list</code></p>
<h4 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h4><p>根据自己的发行版代号修改一下 <code>stretch</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/debian stretch main</span><br></pre></td></tr></table></figure>
<h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><p>根据自己的发行版代号修改一下 <code>bionic</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/ubuntu bionic main</span><br></pre></td></tr></table></figure>
<p>配置好 deb 源之后再执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt uodate</span><br><span class="line">apt install gitlab-runner -y</span><br></pre></td></tr></table></figure>
<h2 id="注册-gitlab-runner"><a href="#注册-gitlab-runner" class="headerlink" title="注册 gitlab-runner"></a>注册 gitlab-runner</h2><p>使用 root 用户从 web 端登录到 gitlab 管理中心。在 <code>概览</code> –&gt; <code>Runner</code> 。在右上角会有以下，稍后会用到。</p>
<ul>
<li>在 Runner 设置时指定以下 URL</li>
<li>在安装过程中使用以下注册令牌：</li>
</ul>
<p><img src="https://p.k8s.li/20200310202057916.png" alt=""></p>
<p>安装好 gitlab-runner 之后如果直接向 gitlab 注册则会失败，提示 <code>ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">╭─root@gitlab ~</span><br><span class="line">╰─<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform                                    arch=amd64 os=linux pid=6818 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line"></span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">qRGh2M86iTasjBn1dU8L</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[gitlab]: runner-centos</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</span><br><span class="line">PANIC: Failed to register this runner. Perhaps you are having network problems</span><br></pre></td></tr></table></figure>
<h3 id="修改-gitlab-默认网络设置"><a href="#修改-gitlab-默认网络设置" class="headerlink" title="修改 gitlab 默认网络设置"></a>修改 gitlab 默认网络设置</h3><p>使用 root 用户从 web 端登录到 gitlab 管理中心 http://${ip}/admin 。管理中心 –&gt; 设置 –&gt; 网络 –&gt; 外发请求 –&gt; 允许来自钩子和服务的对本地网络的请求。以下选项全部允许，才能通过外部请求的方式注册 gitlab-runner。</p>
<ul>
<li>Allow requests to the local network from web hooks and services</li>
<li>Allow requests to the local network from system hooks</li>
</ul>
<p><strong>为了安全起见</strong>，也可以在 Whitelist to allow requests to the local network from hooks and services 下方的那个框框里添加上白名单，允许授权的 IP 。修改好之后不要忘记点击底部那个绿色按钮 <code>保存修改</code> 。</p>
<h4 id="500-错误"><a href="#500-错误" class="headerlink" title="500 错误"></a>500 错误</h4><p>如果点击 <code>保存修改</code> 之后就跳转到 Gitlab 500 错误的页面，这种情况比较僵硬😂。尝试在管理中心修改其他设置保存时，也会出现 500 的情况。在安装 gitlab 的机器上查看一下日志。运行 <code>gitlab-ctl tail</code> 查看实时的日志。此时等到日志输出减慢的时候我们多按几下回车，然后就立即去点击<code>保存修改</code>  按钮，这样就能捕捉到此刻的错误日志。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /<span class="keyword">var</span>/log/gitlab/gitlab-rails/production<span class="variable">.log</span> &lt;==</span><br><span class="line">Started PATCH <span class="string">"/admin/application_settings/network"</span> <span class="keyword">for</span> <span class="number">10</span><span class="variable">.0</span><span class="variable">.30</span><span class="variable">.2</span> at <span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> <span class="number">11</span>:<span class="number">08</span>:<span class="number">20</span> +<span class="number">0000</span></span><br><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"✓"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line"></span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br><span class="line"></span><br><span class="line">lib/gitlab/crypto_helper<span class="variable">.rb</span>:<span class="number">27</span>:in <span class="meta">`aes256_gcm_decrypt'</span></span><br><span class="line">app/models/concerns/token_authenticatable_strategies/encrypted<span class="variable">.rb</span>:<span class="number">45</span>:in <span class="meta">`get_token'</span></span><br><span class="line">app/models/concerns/token_authenticatable_strategies/base<span class="variable">.rb</span>:<span class="number">27</span>:in <span class="meta">`ensure_token'</span></span><br><span class="line">app/models/concerns/token_authenticatable_strategies/encrypted<span class="variable">.rb</span>:<span class="number">32</span>:in <span class="meta">`ensure_token'</span></span><br><span class="line">app/models/concerns/token_authenticatable<span class="variable">.rb</span>:<span class="number">38</span>:in <span class="meta">`block in add_authentication_token_field'</span></span><br><span class="line">app/services/application_settings/update_service<span class="variable">.rb</span>:<span class="number">36</span>:in <span class="meta">`execute'</span></span><br><span class="line">lib/gitlab/metrics/instrumentation<span class="variable">.rb</span>:<span class="number">161</span>:in <span class="meta">`block in execute'</span></span><br><span class="line">lib/gitlab/metrics/method_call<span class="variable">.rb</span>:<span class="number">36</span>:in <span class="meta">`measure'</span></span><br><span class="line">lib/gitlab/metrics/instrumentation<span class="variable">.rb</span>:<span class="number">161</span>:in <span class="meta">`execute'</span></span><br><span class="line">app/controllers/admin/application_settings_controller<span class="variable">.rb</span>:<span class="number">128</span>:in <span class="meta">`perform_update'</span></span><br><span class="line">app/controllers/admin/application_settings_controller<span class="variable">.rb</span>:<span class="number">14</span>:in <span class="meta">`block (2 levels) in &lt;class:ApplicationSettingsController&gt;'</span></span><br><span class="line">lib/gitlab/session<span class="variable">.rb</span>:<span class="number">11</span>:in <span class="meta">`with_session'</span></span><br><span class="line">app/controllers/application_controller<span class="variable">.rb</span>:<span class="number">450</span>:in <span class="meta">`set_session_storage'</span></span><br><span class="line">lib/gitlab/i18n<span class="variable">.rb</span>:<span class="number">55</span>:in <span class="meta">`with_locale'</span></span><br><span class="line">lib/gitlab/i18n<span class="variable">.rb</span>:<span class="number">61</span>:in <span class="meta">`with_user_locale'</span></span><br><span class="line">app/controllers/application_controller<span class="variable">.rb</span>:<span class="number">444</span>:in <span class="meta">`set_locale'</span></span><br><span class="line">lib/gitlab/middleware/rails_queue_duration<span class="variable">.rb</span>:<span class="number">27</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/metrics/rack_middleware<span class="variable">.rb</span>:<span class="number">17</span>:in <span class="meta">`block in call'</span></span><br><span class="line">lib/gitlab/metrics/transaction<span class="variable">.rb</span>:<span class="number">57</span>:in <span class="meta">`run'</span></span><br><span class="line">lib/gitlab/metrics/rack_middleware<span class="variable">.rb</span>:<span class="number">17</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/request_profiler/middleware<span class="variable">.rb</span>:<span class="number">17</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/go<span class="variable">.rb</span>:<span class="number">20</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/etag_caching/middleware<span class="variable">.rb</span>:<span class="number">13</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/correlation_id<span class="variable">.rb</span>:<span class="number">16</span>:in <span class="meta">`block in call'</span></span><br><span class="line">lib/gitlab/middleware/correlation_id<span class="variable">.rb</span>:<span class="number">15</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/multipart<span class="variable">.rb</span>:<span class="number">117</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/read_only/controller<span class="variable">.rb</span>:<span class="number">42</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/read_only<span class="variable">.rb</span>:<span class="number">18</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/basic_health_check<span class="variable">.rb</span>:<span class="number">25</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/request_context<span class="variable">.rb</span>:<span class="number">26</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/metrics/requests_rack_middleware<span class="variable">.rb</span>:<span class="number">29</span>:in <span class="meta">`call'</span></span><br><span class="line">lib/gitlab/middleware/release_env<span class="variable">.rb</span>:<span class="number">12</span>:in <span class="meta">`call'</span></span><br><span class="line"></span><br><span class="line">==&gt; /<span class="keyword">var</span>/log/gitlab/gitlab-rails/production_json<span class="variable">.log</span> &lt;==</span><br><span class="line">&#123;<span class="string">"method"</span>:<span class="string">"PATCH"</span>,<span class="string">"path"</span>:<span class="string">"/admin/application_settings/network"</span>,<span class="string">"format"</span>:<span class="string">"html"</span>,<span class="string">"controller"</span>:<span class="string">"Admin::ApplicationSettingsController"</span>,<span class="string">"action"</span>:<span class="string">"network"</span>,<span class="string">"status"</span>:<span class="number">500</span>,<span class="string">"error"</span>:<span class="string">"OpenSSL::Cipher::CipherError: "</span>,<span class="string">"duration"</span>:<span class="number">40</span><span class="variable">.08</span>,<span class="string">"view"</span>:<span class="number">0</span><span class="variable">.0</span>,<span class="string">"db"</span>:<span class="number">14</span><span class="variable">.47</span>,<span class="string">"time"</span>:<span class="string">"2020-03-10T11:08:20.061Z"</span>,<span class="string">"params"</span>:[&#123;<span class="string">"key"</span>:<span class="string">"utf8"</span>,<span class="string">"value"</span>:<span class="string">"✓"</span>&#125;,&#123;<span class="string">"key"</span>:<span class="string">"_method"</span>,<span class="string">"value"</span>:<span class="string">"patch"</span>&#125;,&#123;<span class="string">"key"</span>:<span class="string">"authenticity_token"</span>,<span class="string">"value"</span>:<span class="string">"[FILTERED]"</span>&#125;,&#123;<span class="string">"key"</span>:<span class="string">"application_setting"</span>,<span class="string">"value"</span>:&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>:<span class="string">"[FILTERED]"</span>,<span class="string">"allow_local_requests_from_system_hooks"</span>:<span class="string">"[FILTERED]"</span>,<span class="string">"outbound_local_requests_whitelist_raw"</span>:<span class="string">""</span>,<span class="string">"dns_rebinding_protection_enabled"</span>:<span class="string">"1"</span>&#125;&#125;],<span class="string">"remote_ip"</span>:<span class="string">"10.0.30.2"</span>,<span class="string">"user_id"</span>:<span class="number">1</span>,<span class="string">"username"</span>:<span class="string">"root"</span>,<span class="string">"ua"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36"</span>,<span class="string">"queue_duration"</span>:<span class="number">2</span><span class="variable">.55</span>,<span class="string">"correlation_id"</span>:<span class="string">"9rvflpksdj2"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>其中错误的只要输出是在 <code>OpenSSL::Cipher::CipherError ():</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"✓"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br></pre></td></tr></table></figure>
<blockquote>
<p>搜索了一下，发现网上说是由于迁移导入项目后，没有导入原来的加密信息<code>/etc/gitlab/gitlab-secrets.json</code>， 但是原来的加密信息文件我已经找不到了，后面发现可以直接重置就行了</p>
<p>参考 <a href="https://hihozhou.com/blog/2019/08/01/gitlab-500.html" target="_blank" rel="noopener">自搭gitlab报500错误</a></p>
</blockquote>
<p>命令行输入<code>gitlab-rails console</code>，然后输入</p>
<p><code>ApplicationSetting.current.reset_runners_registration_token!</code>即可，这样在保存修改的时候就不会再报 500 的问题了。应该是我重新安装 Gitlab 之后的加密信息不对所致🤔。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">╭─root@gitlab ~</span><br><span class="line">╰─<span class="comment"># gitlab-rails console</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> GitLab:       12.3.5 (2417d5becc7)</span><br><span class="line"> GitLab Shell: 10.0.0</span><br><span class="line"> PostgreSQL:   10.9</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 5.2.3)</span><br><span class="line">irb(main):001:0&gt; ApplicationSetting.current.reset_runners_registration_token!</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):002:0&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>以上已经安装好并修改默认的网络设置允许 runner 所在的 IP 向 gitlab 发起外部请求。运行 <code>gitlab-runner register</code> 根据相应的提示输入 <code>URL</code> 和 <code>token</code> 即可。最后根据机器的类型选择好 runner 的类型，这个也是跑 CI 任务时的环境，到时候可以在项目的设置中选择启动相应的 runner 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">╭─root@runner ~</span><br><span class="line">╰─<span class="comment"># gitlab-runner register                                                                                    128 ↵</span></span><br><span class="line">Runtime platform                                    arch=amd64 os=linux pid=7501 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line"></span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">4hjjA7meRGuxEm3LyMjq</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[runner]:</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">Registering runner... succeeded                     runner=4hjjA7me</span><br><span class="line">Please enter the executor: shell, ssh, virtualbox, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, docker+machine, custom:</span><br><span class="line">[shell]: shell</span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">'s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure>
<p>提示成功之后然后在 <code>管理中心</code>–&gt; <code>概览</code> –&gt; <code>Runner</code> 可以查看到相应的 runner</p>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/gitlab/" rel="tag"><i class="fa fa-tag"></i> gitlab</a>
              <a href="/tags/CI/" rel="tag"><i class="fa fa-tag"></i> CI</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/CentOS7-install-k8s.html" rel="prev" title="CentOS7 使用 kubeadm 部署 kubernetes">
      <i class="fa fa-chevron-left"></i> CentOS7 使用 kubeadm 部署 kubernetes
    </a></div>
      <div class="post-nav-item">
    <a href="/8964.html" rel="next" title="弱者的抵抗">
      弱者的抵抗 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
  </div>
          </div>
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Omnibus包安装，也就是rpm包、deb包安装😂"><span class="nav-number">1.</span> <span class="nav-text">1.Omnibus包安装，也就是rpm包、deb包安装😂</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CentOS7"><span class="nav-number">1.1.</span> <span class="nav-text">CentOS7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu-1804"><span class="nav-number">1.2.</span> <span class="nav-text">Ubuntu 1804</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-打补丁，补充汉化的补丁"><span class="nav-number">2.</span> <span class="nav-text">2.打补丁，补充汉化的补丁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reconfigure-失败"><span class="nav-number">2.1.</span> <span class="nav-text">reconfigure 失败</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-进行一些配置，gitlab的配置文件在-etc-gitlab-gitlab-rb"><span class="nav-number">3.</span> <span class="nav-text">3.进行一些配置，gitlab的配置文件在&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-gitlab-runner"><span class="nav-number">4.</span> <span class="nav-text">安装 gitlab-runner</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CentOS-RHEL"><span class="nav-number">4.1.</span> <span class="nav-text">CentOS&#x2F;RHEL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debian-Ubuntu"><span class="nav-number">4.2.</span> <span class="nav-text">Debian&#x2F;Ubuntu</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注册-gitlab-runner"><span class="nav-number">5.</span> <span class="nav-text">注册 gitlab-runner</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#修改-gitlab-默认网络设置"><span class="nav-number">5.1.</span> <span class="nav-text">修改 gitlab 默认网络设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册"><span class="nav-number">5.2.</span> <span class="nav-text">注册</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="木子"
      src="https://blog.k8s.li/avatar.png">
  <p class="site-author-name" itemprop="name">木子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail → mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://kindle.502.li/" title="Kindle → https:&#x2F;&#x2F;kindle.502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tg.k8s.li/" title="Channel → https:&#x2F;&#x2F;tg.k8s.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Channel</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">木子</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">39:50</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
      </div>
    </footer>
  </div>
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.k8s.li/gitlab-install.html",
            identifier: "gitlab-install.html",
            title: "部署 Gitlab 及 gitlab-runner"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://muzi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>
</body>
</html>
