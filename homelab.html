<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="捡垃圾来自 @awpak78 的图 👇  作为一名运维工程师，白天在工地上搬砖养家糊口，晚上下班回家后就开始折腾一堆破铜烂铁自娱自乐 😂。最近东拼西凑花了 2000 来块钱捡垃圾整了台 HomeLab 玩玩，折腾一些没用的东西 🙃 其实很早之前就想搞一台低功耗的 HomeLab 主机玩儿了，最早开始选择的是 Dell T1700 SFF + E3-1271V3 +32GB DDR3，但是呢，">
<meta property="og:type" content="blog">
<meta property="og:title" content="垃圾佬的 Homelab 折腾记录">
<meta property="og:url" content="https://blog.k8s.li/homelab.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="捡垃圾来自 @awpak78 的图 👇  作为一名运维工程师，白天在工地上搬砖养家糊口，晚上下班回家后就开始折腾一堆破铜烂铁自娱自乐 😂。最近东拼西凑花了 2000 来块钱捡垃圾整了台 HomeLab 玩玩，折腾一些没用的东西 🙃 其实很早之前就想搞一台低功耗的 HomeLab 主机玩儿了，最早开始选择的是 Dell T1700 SFF + E3-1271V3 +32GB DDR3，但是呢，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20200801_150112.jpg">
<meta property="og:image" content="https://p.k8s.li/HomeLab-1.jpg">
<meta property="og:image" content="https://p.k8s.li/OptiPlex_5040SFF_motherboard.jpg">
<meta property="og:image" content="https://p.k8s.li/HomeLab-5.jpg">
<meta property="og:image" content="https://p.k8s.li/HomeLab-3.jpg">
<meta property="og:image" content="https://p.k8s.li/HomeLab-4.jpg">
<meta property="og:image" content="https://p.k8s.li/HomeLab-6.jpg">
<meta property="og:image" content="https://p.k8s.li/20200822195450798.png">
<meta property="og:image" content="https://p.k8s.li/2021-06-21-09.jpg">
<meta property="og:image" content="https://p.k8s.li/2021-06-21-04.jpg">
<meta property="og:image" content="https://p.k8s.li/2021-06-21-06.jpg">
<meta property="og:image" content="https://p.k8s.li/2021-06-21-05.jpg">
<meta property="og:image" content="https://p.k8s.li/2021-06-21-02.jpg">
<meta property="article:published_time" content="2020-08-20T16:00:00.000Z">
<meta property="article:modified_time" content="2024-06-14T15:38:22.742Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="捡垃圾">
<meta property="article:tag" content="NAS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20200801_150112.jpg">


<link rel="canonical" href="https://blog.k8s.li/homelab.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/homelab.html","path":"homelab.html","title":"垃圾佬的 Homelab 折腾记录"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>垃圾佬的 Homelab 折腾记录 | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8D%A1%E5%9E%83%E5%9C%BE"><span class="nav-number">1.</span> <span class="nav-text">捡垃圾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU"><span class="nav-number">1.1.</span> <span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E6%9D%BF"><span class="nav-number">1.2.</span> <span class="nav-text">主板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98"><span class="nav-number">1.3.</span> <span class="nav-text">内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BA%E6%80%81"><span class="nav-number">1.4.</span> <span class="nav-text">固态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A3%85%E6%9C%BA"><span class="nav-number">2.</span> <span class="nav-text">装机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ESXi"><span class="nav-number">3.</span> <span class="nav-text">ESXi</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu-20-04"><span class="nav-number">3.1.</span> <span class="nav-text">Ubuntu 20.04</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PhotonOS"><span class="nav-number">3.2.</span> <span class="nav-text">PhotonOS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alpine-NFS"><span class="nav-number">3.3.</span> <span class="nav-text">Alpine NFS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debian"><span class="nav-number">3.4.</span> <span class="nav-text">Debian</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows"><span class="nav-number">3.5.</span> <span class="nav-text">Windows</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%9D%E5%A4%96%E7%A1%AC%E4%BB%B6"><span class="nav-number">4.</span> <span class="nav-text">额外硬件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UPS"><span class="nav-number">4.1.</span> <span class="nav-text">UPS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%AE%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="nav-number">4.2.</span> <span class="nav-text">网管交换机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E7%BD%91%E5%8F%A3%E7%BD%91%E5%8D%A1"><span class="nav-number">4.3.</span> <span class="nav-text">四网口网卡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B5%E5%88%97%E5%8D%A1"><span class="nav-number">4.4.</span> <span class="nav-text">阵列卡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">5.</span> <span class="nav-text">后记</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">120</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">155</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail → mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/homelab.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="垃圾佬的 Homelab 折腾记录 | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          垃圾佬的 Homelab 折腾记录
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-21 2020-08-21T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-08-21T00:00:00+08:00">2020-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-14 2024-06-14T23:38:22+08:00" itemprop="dateModified" datetime="2024-06-14T23:38:22+08:00">2024-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/homelab.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="homelab.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="捡垃圾"><a href="#捡垃圾" class="headerlink" title="捡垃圾"></a>捡垃圾</h2><p>来自 <a target="_blank" rel="noopener" href="https://space.bilibili.com/1292029">@awpak78 </a>的图 👇</p>
<p><img data-src="https://p.k8s.li/20200801_150112.jpg"></p>
<p>作为一名运维工程师，白天在工地上搬砖养家糊口，晚上下班回家后就开始折腾一堆破铜烂铁自娱自乐 😂。最近东拼西凑花了 2000 来块钱捡垃圾整了台 HomeLab 玩玩，折腾一些没用的东西 🙃</p>
<p>其实很早之前就想搞一台低功耗的 HomeLab 主机玩儿了，最早开始选择的是 Dell T1700 SFF + E3-1271V3 +32GB DDR3，但是呢，E3 V3 系列是 Intel 第四代  CPU ，1150 芯片组无法从 M.2 启动，磁盘速度只能达到 SATA III 也就是顶多 600 MB&#x2F;s 的读写速度，而目前随便一块支持  PCI-e M.2 NVMe 的主板普遍都能达到 3000MB&#x2F;s 了。所以这一点来讲 E3 V3 已经不值得捡了。而且我想把我台式机上 SN750 500GB 换到这台机器上，所以还是要选择一个支持 PCI-e M.2 NVMe 的主板。</p>
<table>
<thead>
<tr>
<th align="center">硬件</th>
<th>配置</th>
<th align="center">价格</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CPU</td>
<td>Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz 35w</td>
<td align="center">480</td>
</tr>
<tr>
<td align="center">主板</td>
<td>Dell OptiPlex 7040 准系统：Intel ®Q170</td>
<td align="center">400</td>
</tr>
<tr>
<td align="center">内存</td>
<td>镁光 DDR4 16GB 2666MHz</td>
<td align="center">310</td>
</tr>
<tr>
<td align="center">显卡</td>
<td>英特尔 ® 核芯显卡 530</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">机箱</td>
<td>Dell OptiPlex 7040 准系统</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">电源</td>
<td>Dell OptiPlex 7040 准系统：290W 开关电源</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">UPS</td>
<td>某杂牌 UPS 650VA360W</td>
<td align="center">160</td>
</tr>
<tr>
<td align="center">固态</td>
<td>三星 970PRO 512GB</td>
<td align="center">820</td>
</tr>
<tr>
<td align="center">总价</td>
<td></td>
<td align="center">2170</td>
</tr>
</tbody></table>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>至于 6600T 的性能，在 500 块钱的价位内 35W 低功耗的 6600T 还算可以能接受，为什么不买 7200U 这种低压 U 呢？，一是低压 U 的装机成本太高，而且性价比很低，我还要在上面跑一堆虚拟机，低压 U 恐怕扛不住，所以一开始就放弃了低压 U 的装机方案。</p>
<p><img data-src="https://p.k8s.li/HomeLab-1.jpg"></p>
<h3 id="主板"><a href="#主板" class="headerlink" title="主板"></a>主板</h3><p>由于 Dell SFF 系列的机箱是定制的，和普通的主板不太一样，也只有这样才能塞进这么小的空间，对于 MFF 系列的则更小一点。对于这种小机箱而言，拥有 2 个 PCI-e*4 和一个 PIC-e*16 是相当不错了，PCI-e*4 可以装一个阵列卡个一个四网口的网卡，PIC-e*16 又可以装一个低功耗的刀卡显卡。等到以后台式机升级的硬件的时候再把台式机上的 GT1030 亮机卡放上去。三个 SATA 一个 M.2 有点捉襟见肘，机箱空间就那么点，口子多了硬盘也塞不下呀 😂。</p>
<table>
<thead>
<tr>
<th>Model:</th>
<th><a target="_blank" rel="noopener" href="https://www.dell.com/support/manuals/us/en/04/optiplex-7040-desktop/opti7040_sff_om/specifications?guid=guid-f058d593-d332-479e-9d55-6c6031fa6cba&lang=en-us"><em>Dell OptiPlex 7040 SFF</em></a></th>
</tr>
</thead>
<tbody><tr>
<td>Form factor:</td>
<td>Small Form Factor</td>
</tr>
<tr>
<td>CPU options:</td>
<td>Intel Gen6 i3&#x2F;i5&#x2F;i7</td>
</tr>
<tr>
<td>Chipset:</td>
<td><a target="_blank" rel="noopener" href="https://ark.intel.com/content/www/us/en/ark/products/90587/intel-q170-chipset.html">Intel Q170</a></td>
</tr>
<tr>
<td>RAM slots:</td>
<td>(4x) DIMM DDR4-2133</td>
</tr>
<tr>
<td>Max RAM:</td>
<td>64 GB</td>
</tr>
<tr>
<td>USB Ports:</td>
<td>(6x) USB3.0; (4x) USB2.0;</td>
</tr>
<tr>
<td>Video Ports:</td>
<td>(2x) Display Port 1.2; HDMI 1.4;</td>
</tr>
<tr>
<td>Other Ports:</td>
<td>Serial; (2x) PS2; RJ45; Headset; Line-Out;</td>
</tr>
<tr>
<td>Optional Ports:</td>
<td>VGA; Media Card Reader;</td>
</tr>
<tr>
<td>SATA:</td>
<td>(3x) SATA 3.0*</td>
</tr>
<tr>
<td>PCIe:</td>
<td>PCIe 3.0 x16 (low profile); PCIe 3.0 x4 (low profile);</td>
</tr>
<tr>
<td>M.2 slots:</td>
<td>M.2 2280 M-key (PCIe 3.0 x4, SATA 3.0)</td>
</tr>
<tr>
<td>Drive bays:</td>
<td>3.5-inch&#x2F;(2x)2.5-inch; 5.25-inch (slim);</td>
</tr>
<tr>
<td>Hard Drive:</td>
<td>max 2TB; RAID 0 &amp; 1;</td>
</tr>
<tr>
<td>PSU:</td>
<td>180 W</td>
</tr>
<tr>
<td>Weight:</td>
<td>6.00 kg (13.22 lb)</td>
</tr>
</tbody></table>
<ul>
<li>从 <a target="_blank" rel="noopener" href="https://www.hardware-corner.net/guides/difference-optiplex-3040-vs-5040-vs-7040/">The difference between Dell OptiPlex 3040 vs. 5040 vs. 7040</a> 偷来的一张图片 👇</li>
</ul>
<p><img data-src="https://p.k8s.li/OptiPlex_5040SFF_motherboard.jpg"></p>
<h3 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h3><p>两条 8GB DDR4 内从从我台式机上拆下来的，又花了 300 块钱买了个镁光的 16GB DDR4 装了上去，迫于 我的台式机 B350M-K 的缩水板只有两个内存插槽而且支持到 32GB，暂时装一个 16GB 的吧，能以后再装一个上去。</p>
<h3 id="固态"><a href="#固态" class="headerlink" title="固态"></a>固态</h3><p>其实本来的预算三星 970PRO 512GB 没打算买，是我在找 Dell OptiPlex 7040 时意外碰到的一个老哥，而且这块固态是德亚的，还算靠谱一些，于是剁手买了这个块固态。970PRO 系列的都是 MLC 的颗粒的固态硬盘，通 SM961 一样是属于传家宝系列 😂，但是 SM961 淘宝上水太深，清零盘占据多数，所以不建议买。</p>
<p>正好把这块 970PRO 换到我的台式机上，把台式机上的 SN750 512GB 换到 HomeLab 机器上，给 ESXi 上的虚拟机用。在玩儿虚拟化的时候深有感触，宿主机的磁盘是机械硬盘的话，上面的虚拟机达到一定数量时，虚拟机会很卡，所以玩 ESXi 虚拟化，有块固态的体验是非常爽滴 😋。</p>
<h2 id="装机"><a href="#装机" class="headerlink" title="装机"></a>装机</h2><p>其实装机很快，由于是买的 Dell OptiPlex 7040 准系统，所以只需要把 CPU 、内存、硬盘装上去就完事儿了。</p>
<p>收到准系统后发现没有带 M.2 螺丝，只能临时拿胶带粘糊上去，勉强撑了两天，后来买了个螺丝和散热片完美地解决了。</p>
<p><img data-src="https://p.k8s.li/HomeLab-5.jpg"></p>
<p>从以前旧笔记本淘汰下来的 2TB 5400RPM 的石头盘，已经出现坏道了，临时当个下载盘吧，在它还没彻底崩盘之前再压榨一下它吧 😂。后面打算再添加一块 12TB 的氦气盘当仓库盘和备份数据使用，有了 UPS 和这台主机 7*24 小时开机也没啥问题了。</p>
<p><img data-src="https://p.k8s.li/HomeLab-3.jpg"></p>
<p>后面那台是我的台式机，也是去年这时候买的，两者比较起来 SFF 的型号确实小很多。Dell 的这种主机还有一种 MFF 型号的，那种更小一些，差不多比路由器大一些而已，不过扩展性不好，而且还需要外置电源，也就没考虑，不过现在想想有点后悔了，当初应该多加点钱买 SFF 的，不过还好也能接受，只不过体积大了些，搬家的时候不太方便。</p>
<p><img data-src="https://p.k8s.li/HomeLab-4.jpg"></p>
<h2 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h2><p>装完机器之后就开始装 ESXi ，对于虚拟化，ESXi 算是比较熟悉的了，听说 Proxmox VE 也不错 🤔，等到后面硬盘到了再折腾一下 Proxmox VE。看到隔壁 <a target="_blank" rel="noopener" href="https://wzyboy.im/post/1293.html">Proxmox VE：优秀的自建虚拟化方案</a> 愈发想玩玩了。</p>
<blockquote>
<p>贯彻「不重复造轮子」的原则，当前版本的 PVE 基于成熟稳定的 Debian 9 “Stretch” 构建。在熟悉和使用 PVE 的过程中，我越发喜欢它「不重复造轮子」的特性。相较之前用过的其他虚拟化方案，PVE 的内部构造和工作原理对我来说不再是一个黑盒，我可以清晰地观测到它在干什么——比如要迁移一台虚拟机到另一个节点，我就可以通过 <code>ps</code> 观察到它启动了一个 <code>dd</code> 进程，对接 <code>ssh</code> 管道，将磁盘数据通过网络复制到目标机器——这种仿佛透明手表一样能看到内部工作原理的感觉真是太棒了！</p>
</blockquote>
<p>从 VMware 家下载好 <code>VMware-VMvisor-Installer-7.0.0-15843807.x86_64.iso</code> 镜像，找了两个 U 盘，一个用于 ESXi 的安装盘，一个用于 ESXi 的系统盘，其中一个 U 盘还是我用读卡器 +16GB 内存卡拼凑而成的，目的是为了把 ESXi 装到 U 盘里方便迁移数据之类的，之后在网上找一个神 KEY 激活一下（🤫 小声</p>
<p><img data-src="https://p.k8s.li/HomeLab-6.jpg"></p>
<h3 id="Ubuntu-20-04"><a href="#Ubuntu-20-04" class="headerlink" title="Ubuntu 20.04"></a>Ubuntu 20.04</h3><p>当作网关机使用，和我所有的 云主机打通网络，使用 WireGuard 组成一个小内网，关于 WireGuard 的使用建议阅读大佬写得博客 <a target="_blank" rel="noopener" href="https://fuckcloudnative.io/posts/wireguard-docs-practice/">WireGuard 教程：WireGuard 的搭建使用与配置详解</a> 以及 <a target="_blank" rel="noopener" href="https://fuckcloudnative.io/posts/wireguard-docs-theory/">WireGuard 教程：WireGuard 的工作原理</a>。</p>
<p>顺带用 <a target="_blank" rel="noopener" href="https://github.com/Aniverse/ZBench">ZBench</a> 测了一下虚拟机的磁盘性能，还算勉强说的过去，实际上 SN750 512GB 只有 2GB 左右的缓存，写满换粗之后，写入的性能会直线下降到 800MB&#x2F;s，读的性能倒是可以达到 3200MB&#x2F;s 以上，或许是主板的限制，没能达到理想的读写性能。</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">--------------------------------------------------------------------------
CPU model            : Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz
Number of cores      : 4
CPU frequency        : 2712.000 MHz
Total size of Disk   : 33.3 GB (7.7 GB Used)
Total amount of Mem  : 3935 MB (306 MB Used)
Total amount of Swap : 3934 MB (0 MB Used)
System uptime        : 4 days, 19 hour 47 min
Load average         : 0.13, 0.08, 0.03
OS                   : Ubuntu 20.04 LTS
Arch                 : x86_64 (64 Bit)
Kernel               : 5.4.0-42-generic
Virt                 : vmware
--------------------------------------------------------------------------
I/O speed(1st run)   :1.3 GB/s
I/O speed(2nd run)   :1.3 GB/s
I/O speed(3rd run)   :1.3 GB/s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="PhotonOS"><a href="#PhotonOS" class="headerlink" title="PhotonOS"></a>PhotonOS</h3><p>这个是系统在我另一篇博客 <a href="https://blog.k8s.li/container-linux-os.html">Container Linux OS 从入坑到爬出来</a> 里提到过，Photon OS™ 是针对 VMware vSphere® 虚拟化平台进行内核优化的容器专用操作系统，就和 CoreOS 一样。十分适合专门用来运行容器，当作 Kubernetes 集群中的工作负载来使用。</p>
<ul>
<li>系统初始化启动之后内存仅仅使用了 45Mi</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># free -h</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:          <span class="token number">2</span>.0Gi        45Mi       <span class="token number">1</span>.8Gi       <span class="token number">0</span>.0Ki        93Mi       <span class="token number">1</span>.8Gi
Swap:            0B          0B          0B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>启动 docker 进程之后的占用情况，也仅仅 109Mi</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># free -h</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:          <span class="token number">2</span>.0Gi       109Mi       <span class="token number">1</span>.6Gi       <span class="token number">0</span>.0Ki       238Mi       <span class="token number">1</span>.8Gi
Swap:            0B          0B          0B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>使用 OVA 虚拟机模板启动后的虚拟机，磁盘仅仅占用了 515MB ，确实是相当轻量化，这还是包含了 docker。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        16G  515M   15G   <span class="token number">4</span>% /
devtmpfs        998M     <span class="token number">0</span>  998M   <span class="token number">0</span>% /dev
tmpfs          1000M     <span class="token number">0</span> 1000M   <span class="token number">0</span>% /dev/shm
tmpfs          1000M  532K  999M   <span class="token number">1</span>% /run
tmpfs          1000M     <span class="token number">0</span> 1000M   <span class="token number">0</span>% /sys/fs/cgroup
tmpfs          1000M     <span class="token number">0</span> 1000M   <span class="token number">0</span>% /tmp
/dev/sda2        10M  <span class="token number">2</span>.2M  <span class="token number">7</span>.9M  <span class="token number">22</span>% /boot/efi
tmpfs           200M     <span class="token number">0</span>  200M   <span class="token number">0</span>% /run/user/0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>总之，PhotonOS 是个很轻量的 OS ，适合专门用来运行一些容器化的服务，这正好符合我的需求。别问我为什么不用 CoreOS ，CoreOS 已经凉了。</p>
<h3 id="Alpine-NFS"><a href="#Alpine-NFS" class="headerlink" title="Alpine NFS"></a>Alpine NFS</h3><p>把我一块磁盘直通给这个虚拟机，主要用来给 k8s 集群中的 Pod 挂载 PVC 持久化存储使用。</p>
<h3 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h3><p>主要是用来运行 K8s 集群，目前只有一个  master 和一个 node 玩玩儿，跑了一些自用的服务。</p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>当下载机使用，外加运行一些不得不使用的国产毒瘤软件 😡</p>
<h2 id="额外硬件"><a href="#额外硬件" class="headerlink" title="额外硬件"></a>额外硬件</h2><p>捡垃圾的乐趣就在于越折腾越好玩，于是又开始打算折腾一些</p>
<h3 id="UPS"><a href="#UPS" class="headerlink" title="UPS"></a>UPS</h3><p>由于最近房东家里经常断电，有时一天断电八九次，每次断电我都担心着硬盘里的老婆们会不会挂掉，索性还是买了 UPS ，在马云家看了看，带给 NAS 自动断电的 UPS 普遍在 400 块钱以上，而且我这个还是个假的 NAS ，UPS 上的 USB 口不一定支持我的主机。最后为了节省一下预算花儿 160 块钱买了个不支持 USB 的 UPS ，但是又不能没有这个功能，因为家里的 220V 市电断电之后，UPS 的电量只能给主机续命 10~20min 左右，UPS 的电量用完之后就嗝屁了，照阳还是断电。所以在 UPS 用尽电量还是没有来电之前，一定要想办法把主机通过 poweroff 的方式安全优雅滴关机。</p>
<p>首先要考虑的是怎么知道 220V 市电断电了，起初想有没有个 220V 的传感器，我去，有点难度还是算了吧。最后一想，可以通过 ping 房东家光猫的方式。我的路由器和主机等设备连接 UPS ，房东家的光猫并没有连接 UPS ，我在路由器上设置一个定时任务，每分钟去 ping 房东家的光猫，没有 ping 通说明就是断电了，也有可能是网线被拔掉了，但概率很小。<code>! ping -c 8 A &amp;&amp; ssh B &quot;poweroff&quot;</code> 一行简单的命令就满足了我的需求，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">echo</span> <span class="token string">"start"</span> <span class="token operator">>></span> /tmp/power_status
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">32</span> <span class="token number">192.168</span>.1.1
<span class="token keyword">then</span>
    <span class="token function">sleep</span> <span class="token number">300</span>
    <span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">32</span> <span class="token number">192.168</span>.1.1 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
    sshpass <span class="token parameter variable">-p</span> <span class="token string">"pwd"</span> <span class="token function">ssh</span> root@192.168.0.210 <span class="token string">"net rpc shutdown -I 192.168.0.240 -U admin%poweroff"</span>
    sshpass <span class="token parameter variable">-p</span> <span class="token string">"pwd"</span> <span class="token function">ssh</span> root@192.168.0.200 <span class="token string">"sh -c /suspend_vm.sh"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"220v poweroff"</span> <span class="token operator">>></span> /tmp/power_status
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对于 ESXi 上的虚拟机，还是采用了挂起的方式，将虚拟机的内存状态保存在数据存储的磁盘里，这样重新开启虚拟机后就能恢复到之前的状态，这一点有点像 Windows 的休眠。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">vm</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span>/sbin/vmdumper <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> Alpine <span class="token operator">|</span>  <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/wid=//g'</span><span class="token variable">)</span></span>
<span class="token keyword">do</span>
     /sbin/vmdumper <span class="token variable">$&#123;vm&#125;</span> suspend_vm
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="网管交换机"><a href="#网管交换机" class="headerlink" title="网管交换机"></a>网管交换机</h3><p>当我从台式机向 ESXI 里的虚拟机传输文件的时候，发现网络速度最快只能达到 700Mbits&#x2F;sec ，看来应该是路由器的性能瓶颈，于是想着升级一下网络设备，把 R6300V2 路由器当作 AP 来用，将流量都汇聚到网管交换机上。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span> <span class="token builtin class-name">local</span> <span class="token number">192.168</span>.0.240 port <span class="token number">50718</span> connected to <span class="token number">192.168</span>.0.123 port <span class="token number">5201</span>
<span class="token punctuation">[</span> ID<span class="token punctuation">]</span> Interval           Transfer     Bandwidth
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">0.00</span>-1.00   sec  <span class="token number">83.8</span> MBytes   <span class="token number">702</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">1.00</span>-2.00   sec  <span class="token number">83.4</span> MBytes   <span class="token number">700</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">2.00</span>-3.00   sec  <span class="token number">83.6</span> MBytes   <span class="token number">701</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">3.00</span>-4.00   sec  <span class="token number">82.9</span> MBytes   <span class="token number">695</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">4.00</span>-5.00   sec  <span class="token number">83.8</span> MBytes   <span class="token number">702</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">5.00</span>-6.00   sec  <span class="token number">83.6</span> MBytes   <span class="token number">701</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">6.00</span>-7.00   sec  <span class="token number">83.5</span> MBytes   <span class="token number">701</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">7.00</span>-8.00   sec  <span class="token number">83.8</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">8.00</span>-9.00   sec  <span class="token number">83.8</span> MBytes   <span class="token number">702</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>   <span class="token number">9.00</span>-10.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">702</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">10.00</span>-11.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">11.00</span>-12.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">12.00</span>-13.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">13.00</span>-14.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">14.00</span>-15.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">15.00</span>-16.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">704</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">16.00</span>-17.00  sec  <span class="token number">83.4</span> MBytes   <span class="token number">699</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">17.00</span>-18.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">18.00</span>-19.00  sec  <span class="token number">83.6</span> MBytes   <span class="token number">702</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">19.00</span>-20.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">702</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">20.00</span>-21.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">704</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">21.00</span>-22.00  sec  <span class="token number">83.8</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">22.00</span>-23.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">704</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">23.00</span>-24.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">24.00</span>-25.00  sec  <span class="token number">83.9</span> MBytes   <span class="token number">703</span> Mbits/sec
<span class="token punctuation">[</span>  <span class="token number">4</span><span class="token punctuation">]</span>  <span class="token number">25.00</span>-25.20  sec  <span class="token number">16.6</span> MBytes   <span class="token number">698</span> Mbits/sec<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">╭─debian@debian ~
╰─$ qperf 192.168.0.123 -t 30 -vvu tcp_lat udp_lat tcp_bw udp_bw conf
tcp_lat:
    <span class="token key attr-name">latency</span>   <span class="token punctuation">=</span>  <span class="token value attr-value">98.7 us</span>
    <span class="token key attr-name">msg_size</span>  <span class="token punctuation">=</span>     <span class="token value attr-value">1 bytes</span>
    <span class="token key attr-name">time</span>      <span class="token punctuation">=</span>    <span class="token value attr-value">30 sec</span>
    <span class="token key attr-name">timeout</span>   <span class="token punctuation">=</span>     <span class="token value attr-value">5 sec</span>
udp_lat:
    <span class="token key attr-name">latency</span>   <span class="token punctuation">=</span>  <span class="token value attr-value">98 us</span>
    <span class="token key attr-name">msg_size</span>  <span class="token punctuation">=</span>   <span class="token value attr-value">1 bytes</span>
    <span class="token key attr-name">time</span>      <span class="token punctuation">=</span>  <span class="token value attr-value">30 sec</span>
    <span class="token key attr-name">timeout</span>   <span class="token punctuation">=</span>   <span class="token value attr-value">5 sec</span>
tcp_bw:
    <span class="token key attr-name">bw</span>        <span class="token punctuation">=</span>  <span class="token value attr-value">87.9 MB/sec</span>
    <span class="token key attr-name">msg_size</span>  <span class="token punctuation">=</span>    <span class="token value attr-value">64 KiB (65,536)</span>
    <span class="token key attr-name">time</span>      <span class="token punctuation">=</span>    <span class="token value attr-value">30 sec</span>
    <span class="token key attr-name">timeout</span>   <span class="token punctuation">=</span>     <span class="token value attr-value">5 sec</span>
udp_bw:
    <span class="token key attr-name">send_bw</span>   <span class="token punctuation">=</span>  <span class="token value attr-value">56.7 MB/sec</span>
    <span class="token key attr-name">recv_bw</span>   <span class="token punctuation">=</span>  <span class="token value attr-value">56.7 MB/sec</span>
    <span class="token key attr-name">msg_size</span>  <span class="token punctuation">=</span>    <span class="token value attr-value">32 KiB (32,768)</span>
    <span class="token key attr-name">time</span>      <span class="token punctuation">=</span>    <span class="token value attr-value">30 sec</span>
    <span class="token key attr-name">timeout</span>   <span class="token punctuation">=</span>     <span class="token value attr-value">5 sec</span>
conf:
    <span class="token key attr-name">loc_node</span>   <span class="token punctuation">=</span>  <span class="token value attr-value">debian</span>
    <span class="token key attr-name">loc_cpu</span>    <span class="token punctuation">=</span>  <span class="token value attr-value">16 Cores: AMD Ryzen 7 1700 Eight-Core   3.0GHz</span>
    <span class="token key attr-name">loc_os</span>     <span class="token punctuation">=</span>  <span class="token value attr-value">Linux 4.4.0-18362</span>
    <span class="token key attr-name">loc_qperf</span>  <span class="token punctuation">=</span>  <span class="token value attr-value">0.4.11</span>
    <span class="token key attr-name">rem_node</span>   <span class="token punctuation">=</span>  <span class="token value attr-value">gateway</span>
    <span class="token key attr-name">rem_cpu</span>    <span class="token punctuation">=</span>  <span class="token value attr-value">4 Cores: Intel Core i5-6600T @ 2.70GHz</span>
    <span class="token key attr-name">rem_os</span>     <span class="token punctuation">=</span>  <span class="token value attr-value">Linux 5.4.0-42-generic</span>
    <span class="token key attr-name">rem_qperf</span>  <span class="token punctuation">=</span>  <span class="token value attr-value">0.4.11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>准备买 GS108E V2 或者 GS105E V2，</p>
<h3 id="四网口网卡"><a href="#四网口网卡" class="headerlink" title="四网口网卡"></a>四网口网卡</h3><p>为了折腾一下网卡直通、端口汇聚、overlay 网络卸载等特性，后面还要添加一块 <a target="_blank" rel="noopener" href="https://www.intel.cn/content/www/cn/zh/products/docs/network-io/ethernet/10-25-40-gigabit-adapters/ethernet-i350-server-adapter-brief.html">intel I350 T4 V2</a> ，闲鱼上的价格也不是很贵。</p>
<p><img data-src="https://p.k8s.li/20200822195450798.png"></p>
<h3 id="阵列卡"><a href="#阵列卡" class="headerlink" title="阵列卡"></a>阵列卡</h3><p>由于主板的 SATA 接口最大只支持到 2TB ，为了扩展一下存储，只能额外添加一块阵列卡了，由于主板的 PCIe 有限，而且这么大点的机箱最多也就能塞下 1 块 3.5 寸硬盘和 3 块 2.5 寸硬盘，所以找一块入门级的阵列卡就够了，最终花了 50 块钱捡了一块 <a target="_blank" rel="noopener" href="https://lenovopress.com/tips0831-serveraid-h1110">ServeRAID H1110 SAS&#x2F;SATA Controller</a> 阵列卡，看来一下手册里的参数，大概也能暂时满足我的需求。</p>
<blockquote>
<ul>
<li>Four internal 6 Gbps SAS&#x2F;SATA ports</li>
<li>One x4 mini-SAS internal connector (SFF-8087)</li>
<li>6 Gbps throughput per port</li>
<li>Based on LSI SAS2004 6 Gbps RAID on Chip (ROC) controller</li>
<li>x4 PCI Express 2.0 host interface</li>
<li>Supports RAID 0, 1, 1E, and 10</li>
<li>Connects to up to four SAS or SATA drives</li>
<li>SAS and SATA drives are supported, but the mixing of SAS and SATA in the same integrated volume is not supported</li>
<li>Supports simple-swap SATA and hot-swap SAS and SATA drives</li>
<li>Supports up to two integrated volumes</li>
<li>Supports up to two global hot-spare drives</li>
<li>Supports drive sizes greater than 2 TB for RAID 0, 1E, and 10 (not RAID 1)</li>
<li>Fixed stripe size of 64 KB</li>
<li>Compliant with Disk Data Format (DDF)</li>
<li>S.M.A.R.T. support</li>
</ul>
</blockquote>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>2021 年 五一放假后入手了 M1 MacBook Pro ，使用了一段时间后感觉很满意，于是就准备当作主力机来使用。这样一来家里的一台 Ryzen 5 3600 台式机和一台 6600T 的 NAS 小主机就显得多余了。两个台式夹搬家的时候也不方便携带，于是干脆就把 NAS 小主机卖掉了。</p>
<p>然后又发现 M1 的 GPU 好强，众多评测的解决也展示了 M1 的 GPU 性能要比肩 GTX 1050 Ti。Ryzen 5 3600 台式机上的 GTX 1650 平时也不怎么使用，现在也没有太大的兴趣玩游戏，平时只用来看 4K 电影用。既然有了 M1，那 GTX 1650 不如也拆下来卖掉算了，现在显卡涨了很少，多少还能赚点钱 😂。</p>
<ul>
<li>GTX 1050 vs GTX 1050Ti vs GTX 1650</li>
</ul>
<p><img data-src="https://p.k8s.li/2021-06-21-09.jpg"></p>
<p>就这样最终把 NAS 小主机准系统 + 6600T CPU 以及 GTX 1650 显卡拆下来卖掉了，由于今年的显卡价格和 CPU 价格比之前都普遍涨了很多，卖出去这些捡来的洋垃圾之后出去之后稳赚 600¥。然后发现微星 B550M 主板在没有显卡和插显示器的情况下无法完成 BIOS 开机自检启动，导致无法进入 bootloader 启动 ESXi 😭。所以必须要一张亮机卡，于是又在闲鱼上花了 150¥ 买了一张 AMD R5 340x 的亮机卡。光有亮机卡还不行，还需要插上显示器（掀桌儿，无奈又花了十几块钱买了一个显卡欺骗器，用于模拟出一台显示器。</p>
<p>既然把 M1 当作主力机使用了，那么之前的 Ryzen 3600 就改装成 Homelab 机器使用，将之前 NAS 小主机上的一些服务和虚拟机迁移过来，顺带再开几台额外的虚拟机使用。将之前 NAS 小主机上的内存插到台式机上，这样就凑够了 32GB 的内存。当时感觉 32GB 还不够，于是又在闲鱼上花了 320¥ 买了一根 16GB 的 DDR4 内存，不料收到货后就翻车了，插上内存条之后主板 BIOS 里无法识别出内存的型号和序列号，并且进入 ESXi 之后就一直卡住了。尝试拔下该内存条后又恢复了，无奈只能联系卖家退货了。常年捡垃圾为数不多的一次翻车事故 🤣。</p>
<ul>
<li>虚拟机列表</li>
</ul>
<p><img data-src="https://p.k8s.li/2021-06-21-04.jpg"></p>
<ul>
<li>虚拟机磁盘性能测试</li>
</ul>
<p><img data-src="https://p.k8s.li/2021-06-21-06.jpg"></p>
<ul>
<li>Windows 直通用显卡</li>
</ul>
<p><img data-src="https://p.k8s.li/2021-06-21-05.jpg"></p>
<ul>
<li>直通成功之后，使用工具查看显卡状态</li>
</ul>
<p><img data-src="https://p.k8s.li/2021-06-21-02.jpg"></p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%8D%A1%E5%9E%83%E5%9C%BE/" rel="tag"># 捡垃圾</a>
              <a href="/tags/NAS/" rel="tag"># NAS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/registry-gc.html" rel="prev" title="docker registry GC 原理分析">
                  <i class="fa fa-chevron-left"></i> docker registry GC 原理分析
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/lsi-9211-4i-ir-to-it.html" rel="next" title="给阵列卡刷个机，IR 模式转 IT 模式">
                  给阵列卡刷个机，IR 模式转 IT 模式 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">26:45</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
