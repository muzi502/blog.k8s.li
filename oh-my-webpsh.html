<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆx å°å£°  åŠé€€ä¸‰è¿ ğŸ˜‚ éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰ å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰ éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰  ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ© ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æº">
<meta property="og:type" content="blog">
<meta property="og:title" content="è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼">
<meta property="og:url" content="https://blog.k8s.li/oh-my-webpsh.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆx å°å£°  åŠé€€ä¸‰è¿ ğŸ˜‚ éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰ å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰ éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰  ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ© ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æº">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20200306094307271.png">
<meta property="og:image" content="https://p.k8s.li/20200307102856702.png">
<meta property="og:image" content="https://p.k8s.li/20200304191400500.png">
<meta property="og:image" content="https://p.k8s.li/no-webp.png">
<meta property="og:image" content="https://p.k8s.li/with-webp.png">
<meta property="article:published_time" content="2020-03-04T16:00:00.000Z">
<meta property="article:modified_time" content="2020-03-05T16:00:00.000Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20200306094307271.png">


<link rel="canonical" href="https://blog.k8s.li/oh-my-webpsh.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/oh-my-webpsh.html","path":"oh-my-webpsh.html","title":"è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼ | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9D%E9%80%80%E4%B8%89%E8%BF%9E-%F0%9F%98%82"><span class="nav-number">1.</span> <span class="nav-text">åŠé€€ä¸‰è¿ ğŸ˜‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebP"><span class="nav-number">2.</span> <span class="nav-text">WebP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E6%83%85%E5%86%B5"><span class="nav-number">2.1.</span> <span class="nav-text">æ”¯æŒæƒ…å†µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webp-sh"><span class="nav-number">3.</span> <span class="nav-text">webp-sh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97"><span class="nav-number">4.</span> <span class="nav-text">é£Ÿç”¨æŒ‡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%8B%E8%BD%BD"><span class="nav-number">4.1.</span> <span class="nav-text">1. ä¸‹è½½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%85%8D%E7%BD%AE"><span class="nav-number">4.2.</span> <span class="nav-text">2. é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%90%AF%E5%8A%A8"><span class="nav-number">4.3.</span> <span class="nav-text">3.å¯åŠ¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E9%A2%84%E5%8A%A0%E8%BD%BD"><span class="nav-number">4.4.</span> <span class="nav-text">4.é¢„åŠ è½½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#benchmark"><span class="nav-number">5.</span> <span class="nav-text">benchmark</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="nav-number">5.1.</span> <span class="nav-text">æµ‹è¯•ç»“æœ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E5%89%8D%E5%90%8E%E5%A4%A7%E5%B0%8F%E5%AF%B9%E6%AF%94"><span class="nav-number">5.2.</span> <span class="nav-text">è½¬æ¢å‰åå¤§å°å¯¹æ¯”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E6%95%88%E6%9E%9C"><span class="nav-number">6.</span> <span class="nav-text">å®é™…æ•ˆæœ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#no-webps"><span class="nav-number">6.1.</span> <span class="nav-text">no webps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webps-yes"><span class="nav-number">6.2.</span> <span class="nav-text">webps yes!</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="nav-number">7.</span> <span class="nav-text">æ¨èé˜…è¯»</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">153</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail â†’ mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/oh-my-webpsh.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼ | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2020-03-05 2020-03-05T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-03-05T00:00:00+08:00">2020-03-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-03-06 2020-03-06T00:00:00+08:00" itemprop="dateModified" datetime="2020-03-06T00:00:00+08:00">2020-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/oh-my-webpsh.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="oh-my-webpsh.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆx å°å£°</p>
</blockquote>
<h2 id="åŠé€€ä¸‰è¿-ğŸ˜‚"><a href="#åŠé€€ä¸‰è¿-ğŸ˜‚" class="headerlink" title="åŠé€€ä¸‰è¿ ğŸ˜‚"></a>åŠé€€ä¸‰è¿ ğŸ˜‚</h2><ul>
<li>éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰</li>
<li>å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰</li>
<li>éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰</li>
</ul>
<p>ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ© ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚</p>
<h2 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h2><blockquote>
<p>WebP çš„æœ‰æŸå‹ç¼©ç®—æ³•æ˜¯åŸºäº VP8 è§†é¢‘æ ¼å¼çš„å¸§å†…ç¼–ç [17]ï¼Œå¹¶ä»¥ RIFF ä½œä¸ºå®¹å™¨æ ¼å¼ã€‚[2] å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å…«ä½è‰²å½©æ·±åº¦å’Œä»¥ 1:2 çš„æ¯”ä¾‹è¿›è¡Œè‰²åº¦å­é‡‡æ ·çš„äº®åº¦-è‰²åº¦æ¨¡å‹ï¼ˆYCbCr 4:2:0ï¼‰çš„åŸºäºå—çš„è½¬æ¢æ–¹æ¡ˆã€‚[18] ä¸å«å†…å®¹çš„æƒ…å†µä¸‹ï¼ŒRIFF å®¹å™¨è¦æ±‚åªéœ€ 20 å­—èŠ‚çš„å¼€é”€ï¼Œä¾ç„¶èƒ½ä¿å­˜é¢å¤–çš„ å…ƒæ•°æ®(metadata)ã€‚[2] WebP å›¾åƒçš„è¾¹é•¿é™åˆ¶ä¸º 16383 åƒç´ ã€‚</p>
</blockquote>
<p>WebP æ˜¯ä¸€ç§è¡ç”Ÿè‡ª Google VP8 çš„å›¾åƒæ ¼å¼ï¼ŒåŒæ—¶æ”¯æŒæœ‰æŸå’Œæ— æŸç¼–ç ã€‚å½“ä½¿ç”¨æœ‰æŸæ¨¡å¼ï¼Œå®ƒåœ¨ç›¸åŒä½“ç§¯æä¾›æ¯” JPG å›¾åƒæ›´å¥½çš„è´¨é‡ï¼›å½“ä½¿ç”¨æ— æŸæ¨¡å¼ï¼Œå®ƒæä¾›æ¯”æœ€ä½³å‹ç¼©çš„ PNG å›¾åƒæ›´å°çš„ä½“ç§¯ã€‚ç®€å•æ¥è¯´ï¼ŒWebP å›¾ç‰‡æ ¼å¼çš„å­˜åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ WebP ä¸Šå±•ç¤ºçš„å›¾ç‰‡ä½“ç§¯å¯ä»¥æœ‰è¾ƒå¤§å¹…åº¦çš„ç¼©å°ã€‚ç½‘ç«™ä¸Šçš„å›¾ç‰‡èµ„æºå¦‚æœä½¿ç”¨ WebPï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿä¼šå‡å°‘è¿™äº›å›¾ç‰‡æ–‡ä»¶çš„åŠ è½½æ—¶é—´ï¼Œä¹Ÿå°±å¸¦æ¥äº†ç½‘ç«™åŠ è½½æ€§èƒ½çš„æå‡ã€‚å…³äº webp å›¾åƒæ ¼å¼çš„å…·ä½“å®ç°ç»†èŠ‚å¯ä»¥å»ç»´åŸºç™¾ç§‘æˆ–è€…æ–‡æœ«æˆ‘æåˆ°çš„æ¨èé˜…è¯»çœ‹ä¸€ä¸‹ï¼Œæ€»ä¹‹ webp å¾ˆé¦™å°±æ˜¯å•¦ (â—â€™â—¡â€™â—)</p>
<h3 id="æ”¯æŒæƒ…å†µ"><a href="#æ”¯æŒæƒ…å†µ" class="headerlink" title="æ”¯æŒæƒ…å†µ"></a>æ”¯æŒæƒ…å†µ</h3><p>æ ¹æ® <a target="_blank" rel="noopener" href="https://caniuse.com/#search=webp">caniuse</a> çš„ç»Ÿè®¡æƒ…å†µï¼Œä¸»æµæµè§ˆå™¨ï¼ˆæ¥è¿‘ 80%ï¼‰éƒ½æ”¯æŒ webp äº†ï¼Œå¦‚æœé‡åˆ° Safari è¿™æ ·çš„å¥‡è‘©ï¼Œå’±ç›´æ¥è¿”å›åŸå›¾ã€‚IE æµè§ˆå™¨ï¼Ÿï¼Ÿ</p>
<p><img data-src="https://p.k8s.li/20200306094307271.png"></p>
<h2 id="webp-sh"><a href="#webp-sh" class="headerlink" title="webp-sh"></a>webp-sh</h2><ul>
<li>å®˜ç½‘ <a target="_blank" rel="noopener" href="https://webp.sh/">webp.sh</a></li>
<li>GitHub <a target="_blank" rel="noopener" href="https://github.com/webp-sh">webp-sh</a></li>
</ul>
<p>webp server é¡¾åæ€ä¹‰å°±æ˜¯ webp æœåŠ¡å™¨å•¦ï¼Œç”¨äºå°†ç½‘ç«™é‡Œçš„å›¾ç‰‡ï¼ˆjpgã€pngã€jpeg ç­‰ï¼‰è½¬æ¢æˆ webp å›¾åƒç¼–ç æ ¼å¼ï¼Œè€Œä¸”æ— é¡»ä¿®æ”¹åšå®¢ç«™ç‚¹å†…å›¾ç‰‡çš„ url ï¼Œå› æ­¤å¯¹äºè®¿é—®å›¾ç‰‡èµ„æºçš„å®¢æˆ·ç«¯æ¥è®²æ˜¯é€æ˜çš„ã€‚ä¸»æµçš„ CDN ä¹Ÿæ”¯æŒè¿™æ ·ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Cloudflare çš„ <a href="">Polish</a> ï¼Œå¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://support.cloudflare.com/hc/en-us/articles/360000607372-Using-Cloudflare-Polish-to-compress-images">Using Cloudflare Polish to compress images</a> ã€‚ä½†æ˜¯å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œå›¾ç‰‡è½¬ç ä¸ç¼–ç è¿™éƒ½æ˜¯è¦ç®—åŠ›çš„ï¼Œéƒ½æ˜¯è¦è®¡ç®—èµ„æºçš„ï¼Œéƒ½æ˜¯è¦ CPU çš„ï¼Œéƒ½æ˜¯è¦èŠ±é’±çš„ ğŸ˜‚ã€‚è¯´åˆ°åº•è¿˜æ˜¯ç©·å•Šï¼ˆå’± webp server æ˜¯å¼€æºå…è´¹çš„ã€‚</p>
<blockquote>
<p>æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯â€”â€”æˆ‘ä»¬è®¿é—®çš„ URL å¯ä»¥å®Œå…¨ä¸ç”¨æ”¹å˜ï¼Œè®¿å®¢è®¿é—®çš„ä¾ç„¶æ˜¯ <code>https://image.nova.moe/tsuki/tsuki.jpg</code> ï¼Œä½†æ˜¯å¾—åˆ°çš„å›¾ç‰‡æ ¼å¼ä¸ºï¼š<code>image/webp</code>ï¼Œè€Œä¸”ä½“ç§¯å‡å°‘äº†ä¸å°‘ã€‚</p>
</blockquote>
<p>å…¶å® webp server æœ‰å¤šç§è¯­è¨€éƒ½å®ç°äº†ï¼Œå¹¶ä¸”è¿™äº›ä»“åº“è¿˜éƒ½æ”¾åœ¨äº† <a target="_blank" rel="noopener" href="https://github.com/webp-sh">webp-sh</a> è¯¥ Organizations ä¸‹ã€‚ä¸è¿‡å’±æ¯”è¾ƒå–œæ¬¢ golang æ‰€ä»¥å°±æ¨è webp server go å•¦ ğŸ˜‚ï¼Œéš”å£çš„ webp server rust åˆ«æ‰“æˆ‘å•Šï¼ˆé€ƒ</p>
<blockquote>
<p>è¿™ä¸ªå·¥å…·å°±æ˜¯ç”± <a target="_blank" rel="noopener" href="https://nova.moe/">Nova ç«¥é‹</a>ã€ <a target="_blank" rel="noopener" href="https://www.bennythink.com/">Benny</a> ã€<a target="_blank" rel="noopener" href="https://blog.0xbbc.com/">cocoa</a> ä»¥åŠ <a href="https://blog.k8s.li/">muzi</a> å°ç›†å‹ä¸€èµ·é¼“æ£çš„ webp_server_go å•¦ï¼</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_go">webp_server_go</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_rs">webp_server_rs</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_node">webp_server_node</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_java">webp_server_java</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_python">webp_server_python</a></li>
</ul>
<h2 id="é£Ÿç”¨æŒ‡å—"><a href="#é£Ÿç”¨æŒ‡å—" class="headerlink" title="é£Ÿç”¨æŒ‡å—"></a>é£Ÿç”¨æŒ‡å—</h2><h3 id="1-ä¸‹è½½"><a href="#1-ä¸‹è½½" class="headerlink" title="1. ä¸‹è½½"></a>1. ä¸‹è½½</h3><p>é¦–å…ˆåˆ° <a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_go/releases">release</a> é¡µé¢ä¸‹è½½å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆé€‰æ‹©ä¸‹è½½ rpm æˆ– deb åŒ…ï¼Œåœ¨æ­¤è¦æ³¨æ„é€‰æ‹©ä¸‹è½½ç¬¦åˆè‡ªå·±çš„ arch å’Œ OSã€‚</p>
<p>è‡³äºå®‰è£…è·¯å¾„ï¼Œæˆ‘ä¸ªäººæ›´å€¾å‘äºæ”¾åœ¨ <code>/opt/</code> ç›®å½•ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªç›®å½•ä¸‹çš„ä¸œè¥¿éƒ½æ˜¯è‡ªå·±å®‰è£…çš„ï¼Œè€Œä¸”ä¹Ÿä¸ä¾èµ–äºç‰¹å®šçš„å‘è¡Œç‰ˆï¼Œæ–¹ä¾¿åšå®¢è¿ç§»ï¼ˆæ¬å®¶ï¼‰ï¼Œæ¬å®¶çš„æ—¶å€™ç›´æ¥æ‰“åŒ… <code>/opt</code> ç›®å½•ï¼Œç„¶å scp ä¸€ä¸‹å°±å·é“ºç›–èµ°äººï¼Œå¤šæ–¹ä¾¿å‘€ ğŸ˜‚ã€‚</p>
<h3 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2. é…ç½®"></a>2. é…ç½®</h3><p>é£Ÿç”¨ webp-server-go ä¹‹å‰é€‰å‡†å¤‡å¥½ä¸€ä¸ª <code>config.json</code> é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"HOST"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
  <span class="token property">"PORT"</span><span class="token operator">:</span> <span class="token string">"3333"</span><span class="token punctuation">,</span>
  <span class="token property">"QUALITY"</span><span class="token operator">:</span> <span class="token string">"80"</span><span class="token punctuation">,</span>
  <span class="token property">"IMG_PATH"</span><span class="token operator">:</span> <span class="token string">"/var/www/hexo"</span><span class="token punctuation">,</span>
  <span class="token property">"EXHAUST_PATH"</span><span class="token operator">:</span> <span class="token string">"./dist"</span><span class="token punctuation">,</span>
  <span class="token property">"ALLOWED_TYPES"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jpg"</span><span class="token punctuation">,</span><span class="token string">"png"</span><span class="token punctuation">,</span><span class="token string">"jpeg"</span><span class="token punctuation">,</span><span class="token string">"bmp"</span><span class="token punctuation">,</span><span class="token string">"gif"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>HOSTï¼šå¯¹äº webp server æœåŠ¡æ¥è®²åªéœ€è¦ç›‘å¬ 127.0.0.1 è¿™ä¸ªæœ¬æœºåœ°å€å°±å¯ä»¥äº†ï¼Œç¨åä½¿ç”¨ nginx åå‘ä»£ç†ä¸€ä¸‹ã€‚</li>
<li>PORTï¼šå°±æ˜¯ webp server æœåŠ¡ç›‘å¬çš„çš„ç«¯å£å·ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹</li>
<li>QUALITYï¼šç¼–ç çš„è´¨é‡ï¼Œä¸€èˆ¬æ¨è 75 ï¼Œä¸è¿‡ä½¿ç”¨ 80 ä¹Ÿæ˜¯ä¸é”™çš„ã€‚</li>
<li>IMG_PATHï¼šç½‘ç«™çš„æ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ï¼Œä¸€å®šè¦é…ç½®ä½ å›¾ç‰‡ url çš„æ ¹ç›®å½•ã€‚</li>
<li>EXHAUST_PATHï¼šè½¬æ¢åçš„ webp å›¾ç‰‡æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œæå‰åˆ›å»ºå¥½ã€‚</li>
<li>ALLOWED_TYPESï¼šå…è®¸è½¬ç çš„å›¾ç‰‡æ ¼å¼ï¼Œç›®å‰æ”¯æŒè¿™å‡ ç§ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥å†é…ç½®ä»¥ä¸‹ nginx ï¼Œä¸‹é¢ä»¥æˆ‘çš„ hexo åšå®¢ä¸ºä¾‹ï¼Œhugo ä¹ŸåŒæ ·å¦‚æ­¤ã€‚å†æ·»åŠ ä¸€å— localtion å­—æ®µå³å¯ï¼Œå¦‚æœä½ ä¿®æ”¹äº†é»˜è®¤ç«¯å£å·çš„è¯ä¸è¦å¿˜è®°ä¿®æ”¹ä¸ºä½ æ”¹ä¹‹åçš„ç«¯å£å·ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~* \.(png|jpg|jpeg)$</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3333</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>/etc/nginx/conf.d/blog.conf</code></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">listen</span> [::]:80</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>  blog.k8s.li</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$base</span> /var/www/hexo/public</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> <span class="token variable">$base</span>/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token directive"><span class="token keyword">location</span> ~* \.(png|jpg|jpeg)$</span> <span class="token punctuation">&#123;</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3333</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_hide_header</span> X-Powered-By</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> HOST <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸è¿‡åœ¨æ­¤éœ€è¦æ³¨æ„ï¼Œnginx çš„ location å­—æ®µçš„è·¯å¾„ä¸€å®šè¦å’Œ webp server <code>config.json</code> é‡Œçš„ <code>IMG_PATH</code> ç›¸å¯¹åº”ï¼Œä¸ç„¶ä¼šå¯¼è‡´è¯·æ±‚èµ„æºçš„ uri ä¸ webp server è½¬æ¢åçš„æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´è€Œå¯¼è‡´èµ„æº 404 ã€‚è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ location é‚£é‡Œä¸èƒ½ä»…ä»…æ·»åŠ  <code>proxy_pass http://127.0.0.1:3333;</code> ï¼Œè¿™æ ·æµè§ˆå™¨çš„ UA ä¼šè¢« nginx ç»™åƒæ‰ ğŸ˜„ï¼Œnginx å°†è¯·æ±‚ proxy ç»™ webp server åæ— æ³•ä» headers é‚£é‡Œè·å–åˆ° UA ï¼Œè€Œå¯¼è‡´ <code>Safari</code> æµè§ˆå™¨æ— æ³•æ­£å¸¸è¾“å‡ºåŸå›¾ã€‚æ‰€ä»¥ä»¥ä¸‹å‡ è¡Œæ·»åŠ åœ¨ <code>proxy_pass</code> ä¸‹é¢æ˜¯å¿…é¡»çš„ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">proxy_set_header</span> HOST <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>æ­¤å¤–æ„Ÿè°¢å¥½å¿ƒè¯»è€…çš„æé†’æ‰å‘ç°è¿™ä¸ª bug ğŸ˜˜</p>
<p><img data-src="https://p.k8s.li/20200307102856702.png"></p>
<h3 id="3-å¯åŠ¨"><a href="#3-å¯åŠ¨" class="headerlink" title="3.å¯åŠ¨"></a>3.å¯åŠ¨</h3><p>æ‰‹åŠ¨è¿è¡Œèµ·æ¥å¾ˆç®€å•ï¼Œ<code>./webp-server -config /path/to/config.json</code> ï¼Œå¦‚æœè¯¥æœåŠ¡æŒ‚æ‰äº†èµ„æºå°± gg äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰ç”¨ä¸€ç§ç¨³å®šæŒä¹…åŒ–çš„è¿è¡Œæ–¹å¼ã€‚å’±æ¨èä½¿ç”¨ systemd æ¥å¯åŠ¨ï¼Œè¿™æ · webp server æœåŠ¡æŒ‚æ‰äº†ä¹Ÿä¼šè‡ªåŠ¨æ‹‰èµ·é‡å¯ä¸€ä¸‹ã€‚é¦–å…ˆè¦åˆ›å»ºæˆ–ä¿®æ”¹ä¸€ä¸‹ <code>webps.service</code> é…ç½®æ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>WebP Server
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://github.com/webp-sh/webp_server_go
<span class="token assign-left variable">After</span><span class="token operator">=</span>nginx.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>simple
<span class="token assign-left variable">StandardError</span><span class="token operator">=</span>journal
<span class="token assign-left variable">AmbientCapabilities</span><span class="token operator">=</span>CAP_NET_BIND_SERVICE
<span class="token assign-left variable">WorkingDirectory</span><span class="token operator">=</span>/opt/webps
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/opt/webps/webp-server <span class="token parameter variable">--config</span> /opt/webps/config.json
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-HUP</span> <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>always
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span>3s

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¿®æ”¹ä¸€ä¸‹ <code>ExecStart=/opt/webps/webp-server --config /opt/webps/config.json</code> å’Œ <code>WorkingDirectory=/opt/webps</code> å¯¹åº”çš„è·¯å¾„ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> webps.service /lib/systemd/system/
systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> webps.service
systemctl start webps.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-é¢„åŠ è½½"><a href="#4-é¢„åŠ è½½" class="headerlink" title="4.é¢„åŠ è½½"></a>4.é¢„åŠ è½½</h3><p>webp-server-go æœ‰ä¸ªé¢„åŠ è½½çš„åŠŸèƒ½ï¼Œå°±æ˜¯æå‰å°†å…¨éƒ¨çš„å›¾ç‰‡èµ„æºè¿›è¡Œä¸€æ¬¡è½¬æ¢ï¼Œè¿™æ ·å†æ¬¡è®¿é—®å›¾ç‰‡èµ„æºçš„æ—¶å€™å°±ä¸å¿…å†è¿›è¡Œè½¬æ¢ï¼Œè€Œç›´æ¥ä½¿ç”¨å·²ç»è½¬æ¢åçš„ webp æ–‡ä»¶å³å¯ã€‚è¿™ç›¸å½“äºä¸€æ¬¡ â€œç¼“å­˜â€ ã€‚</p>
<p>ä½¿ç”¨ <code>./webp-server -jobs 1 -config config.json -prefetch</code> æ¥è¿›è¡Œä¸€æ¬¡é¢„åŠ è½½ï¼Œå…¶ä¸­ jobs åé¢çš„æ•°å­—ä¸ºä½  CPU çš„æ ¸å¿ƒæ•°ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨åŠ é»˜è®¤ä½¿ç”¨å…¨éƒ¨æ ¸å¿ƒã€‚</p>
<h2 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h2><p>è¯´åˆ°æ€§èƒ½ï¼Œå’±å¿…é¡»å¾—è¿›è¡Œä¸€æ¬¡å‹æµ‹æ‰èƒ½æ”¾å¿ƒå¤§èƒ†åœ°æ¨èå„ä½é£Ÿç”¨ webp server go å•¦ï¼Œä¸‹é¢å¾—å°±æ˜¯å’±çš„æµ‹è¯•æ•°æ®æ ·ä¾‹ã€‚å›¾ç‰‡çš„æµ‹è¯•æ ·æœ¬æ˜¯å’±ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/Tsuk1ko/pxder">pxder</a> çˆ¬ä¸‹æ¥çš„ï¼Œæ€»å…± 10600 å¼ å›¾ç‰‡ï¼Œæ€»å¤§å° 11.1 GBã€‚å¦‚æœä½ ä¹Ÿéœ€è¦è¿™äº›æµ‹è¯•æ ·æœ¬çš„è¯å¯ä»¥ç§èŠå’±å‘ç»™ä½ ã€‚ä¸‹é¢å°±æ˜¯çœŸå®çš„æµ‹è¯•æ•°æ®ã€‚æµ‹è¯•ç¯å¢ƒæ˜¯ 8 core Ã—3.4G Hzï¼Œæµ‹è¯•ç‰ˆæœ¬ä¸º <a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_go/releases/tag/0.1.0">v0.1.0</a> ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤å‚æ•°é…ç½®ã€‚</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"HOST"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
  <span class="token property">"PORT"</span><span class="token operator">:</span> <span class="token string">"3333"</span><span class="token punctuation">,</span>
  <span class="token property">"QUALITY"</span><span class="token operator">:</span> <span class="token string">"80"</span><span class="token punctuation">,</span>
  <span class="token property">"IMG_PATH"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span>
  <span class="token property">"EXHAUST_PATH"</span><span class="token operator">:</span> <span class="token string">"./dist"</span><span class="token punctuation">,</span>
  <span class="token property">"ALLOWED_TYPES"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jpg"</span><span class="token punctuation">,</span><span class="token string">"png"</span><span class="token punctuation">,</span><span class="token string">"jpeg"</span><span class="token punctuation">,</span><span class="token string">"bmp"</span><span class="token punctuation">,</span><span class="token string">"gif"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img data-src="https://p.k8s.li/20200304191400500.png"></p>
<h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><table>
<thead>
<tr>
<th align="center">file_size_range</th>
<th align="center">file_num</th>
<th align="center">src_size</th>
<th align="center">dist_size</th>
<th align="center">total</th>
<th align="center">user</th>
<th align="center">system</th>
<th align="center">cpu</th>
<th align="center">core</th>
</tr>
</thead>
<tbody><tr>
<td align="center">(10KB,500KB)</td>
<td align="center">4600</td>
<td align="center">1.3G</td>
<td align="center">310M</td>
<td align="center">1:44.49</td>
<td align="center">905.41s</td>
<td align="center">9.55s</td>
<td align="center">875%</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">(500KB,1MB)</td>
<td align="center">3500</td>
<td align="center">2.4G</td>
<td align="center">361M</td>
<td align="center">2:04.81</td>
<td align="center">1092.50s</td>
<td align="center">7.98s</td>
<td align="center">881%</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">(1MB,4MB)</td>
<td align="center">2000</td>
<td align="center">3.8G</td>
<td align="center">342M</td>
<td align="center">2:32.64</td>
<td align="center">1345.73s</td>
<td align="center">10.84s</td>
<td align="center">888%</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">(4MB,32MB)</td>
<td align="center">500</td>
<td align="center">3.6G</td>
<td align="center">246M</td>
<td align="center">1:44.53</td>
<td align="center">916.91s</td>
<td align="center">12.03s</td>
<td align="center">888%</td>
<td align="center">8</td>
</tr>
</tbody></table>
<h4 id="ä¸åŒæ ¸å¿ƒ-total-å¯¹æ¯”"><a href="#ä¸åŒæ ¸å¿ƒ-total-å¯¹æ¯”" class="headerlink" title="ä¸åŒæ ¸å¿ƒ total å¯¹æ¯”"></a>ä¸åŒæ ¸å¿ƒ total å¯¹æ¯”</h4><table>
<thead>
<tr>
<th align="center">file_size_range</th>
<th align="center">file_num</th>
<th align="center">src_size</th>
<th align="center">dist_size</th>
<th align="center">8</th>
<th align="center">4</th>
<th align="center">2</th>
<th align="center">1</th>
</tr>
</thead>
<tbody><tr>
<td align="center">(10KB,500KB)</td>
<td align="center">4600</td>
<td align="center">1.3G</td>
<td align="center">310M</td>
<td align="center">1:44.49</td>
<td align="center">2:18.49</td>
<td align="center">3:36.05</td>
<td align="center">5:20.88</td>
</tr>
<tr>
<td align="center">(500KB,1MB)</td>
<td align="center">3500</td>
<td align="center">2.4G</td>
<td align="center">361M</td>
<td align="center">2:04.81</td>
<td align="center">2:49.46</td>
<td align="center">4:16.41</td>
<td align="center">6:28.97</td>
</tr>
<tr>
<td align="center">(1MB,4MB)</td>
<td align="center">2000</td>
<td align="center">3.8G</td>
<td align="center">342M</td>
<td align="center">2:32.64</td>
<td align="center">3:26.18</td>
<td align="center">5:22.15</td>
<td align="center">7:53.45</td>
</tr>
<tr>
<td align="center">(4MB,32MB)</td>
<td align="center">500</td>
<td align="center">3.6G</td>
<td align="center">246M</td>
<td align="center">1:44.53</td>
<td align="center">2:21.22</td>
<td align="center">3:39.16</td>
<td align="center">5:28.65</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">### 10KB-500KB</span>
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">1</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">632</span>.77s user <span class="token number">11</span>.23s system <span class="token number">200</span>% cpu <span class="token number">5</span>:20.88 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">2</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">639</span>.31s user <span class="token number">8</span>.77s system <span class="token number">299</span>% cpu <span class="token number">3</span>:36.05 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">4</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">676</span>.17s user <span class="token number">8</span>.12s system <span class="token number">494</span>% cpu <span class="token number">2</span>:18.49 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">905</span>.41s user <span class="token number">9</span>.55s system <span class="token number">875</span>% cpu <span class="token number">1</span>:44.49 total

<span class="token comment">### 500KB-1MB</span>

./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">1</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">767</span>.45s user <span class="token number">10</span>.14s system <span class="token number">199</span>% cpu <span class="token number">6</span>:28.97 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">2</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">778</span>.00s user <span class="token number">8</span>.62s system <span class="token number">295</span>% cpu <span class="token number">4</span>:16.41 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">4</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">831</span>.38s user <span class="token number">7</span>.62s system <span class="token number">495</span>% cpu <span class="token number">2</span>:49.46 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">1092</span>.50s user <span class="token number">7</span>.98s system <span class="token number">881</span>% cpu <span class="token number">2</span>:04.81 total

<span class="token comment">### 1MB-4MB</span>

./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">1</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">934</span>.22s user <span class="token number">12</span>.45s system <span class="token number">199</span>% cpu <span class="token number">7</span>:53.45 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">2</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">958</span>.41s user <span class="token number">9</span>.41s system <span class="token number">300</span>% cpu <span class="token number">5</span>:22.15 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">4</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">1010</span>.56s user <span class="token number">8</span>.05s system <span class="token number">494</span>% cpu <span class="token number">3</span>:26.18 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">1345</span>.73s user <span class="token number">10</span>.84s system <span class="token number">888</span>% cpu <span class="token number">2</span>:32.64 total

<span class="token comment">### 4MB-32MB</span>

./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">1</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">641</span>.78s user <span class="token number">10</span>.77s system <span class="token number">187</span>% cpu <span class="token number">5</span>:28.65 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">2</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">643</span>.19s user <span class="token number">9</span>.73s system <span class="token number">297</span>% cpu <span class="token number">3</span>:39.16 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">4</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">688</span>.05s user <span class="token number">9</span>.91s system <span class="token number">494</span>% cpu <span class="token number">2</span>:21.22 total
./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>  <span class="token number">916</span>.91s user <span class="token number">12</span>.03s system <span class="token number">888</span>% cpu <span class="token number">1</span>:44.53 total<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è½¬æ¢å‰åå¤§å°å¯¹æ¯”"><a href="#è½¬æ¢å‰åå¤§å°å¯¹æ¯”" class="headerlink" title="è½¬æ¢å‰åå¤§å°å¯¹æ¯”"></a>è½¬æ¢å‰åå¤§å°å¯¹æ¯”</h3><p>ä»¥ä¸‹å’±å°±æˆªå–ä¸€å°éƒ¨åˆ†çš„æµ‹è¯•ç»“æœï¼Œå®Œæ•´çš„æ—¥å¿—æ”¾åœ¨äº†æˆ‘çš„ gist ä¸Š <strong><a target="_blank" rel="noopener" href="https://gist.github.com/muzi502/4f7c4128895ac3f438e7a183df219661">webp-server-go_test.log</a></strong> ã€‚å›¾ç‰‡éƒ½æ˜¯çœŸæ˜¯çš„æ•°æ®ï¼Œæ ¹æ®æ–‡ä»¶åçš„ ID å¯ä»¥åœ¨ pixiv.net ä¸Šæ‰¾åˆ°æºæ–‡ä»¶ï¼Œç›¸ä¿¡è€å¸æœºä»¬éƒ½æ‡‚å¾— ğŸ˜‚ã€‚</p>
<h4 id="10KB-500KB"><a href="#10KB-500KB" class="headerlink" title="(10KB,500KB)"></a>(10KB,500KB)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>
<span class="token number">905</span>.41s user <span class="token number">9</span>.55s system <span class="token number">875</span>% cpu <span class="token number">1</span>:44.49 total

src		    	dist		num
<span class="token number">1</span>.3G			310M		<span class="token number">4600</span>
<span class="token number">63304866</span>.png	495K		40K
<span class="token number">40881097</span>.jpg	495K		118K
<span class="token number">21045662</span>.jpg	495K		94K
<span class="token number">67888534</span>.png	495K		73K
<span class="token number">50136421</span>.jpg	495K		62K
<span class="token number">72636668</span>.png	495K		113K
<span class="token number">55156014</span>.jpg	495K		78K
<span class="token number">76671894</span>.png	495K		59K
<span class="token number">64709121</span>.png	495K		67K
<span class="token number">78336881</span>.jpg	495K		77K
<span class="token number">57090512</span>.png	494K		35K
<span class="token number">72153105</span>.jpg	494K		64K
<span class="token number">62457185</span>.png	494K		39K
<span class="token number">44892218</span>.png	494K		96K
<span class="token number">39599640</span>.jpg	494K		39K
<span class="token number">21428544</span>.jpg	493K		76K
<span class="token number">65293876</span>.jpg	493K		68K
<span class="token number">76098632</span>.png	493K		80K
<span class="token number">65418239</span>.jpg	493K		119K
<span class="token number">17900553</span>.jpg	493K		51K
<span class="token number">61511853</span>.jpg	493K		123K
<span class="token number">77984504</span>.png	493K		56K
<span class="token number">54667116</span>.jpg	493K		56K
<span class="token number">75357235</span>.jpg	493K		67K
<span class="token number">21085426</span>.jpg	492K		55K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="500KB-1MB"><a href="#500KB-1MB" class="headerlink" title="(500KB,1MB)"></a>(500KB,1MB)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>
<span class="token number">1092</span>.50s user <span class="token number">7</span>.98s system <span class="token number">881</span>% cpu <span class="token number">2</span>:04.81 total

src				dist		num
<span class="token number">2</span>.4G			361M		<span class="token number">3500</span>

<span class="token number">44937735</span>.png	974K		74K
<span class="token number">56343106</span>.png	974K		49K
<span class="token number">51320479</span>.png	974K		73K
<span class="token number">68346957</span>.jpg	974K		112K
<span class="token number">74882964</span>.png	974K		150K
<span class="token number">76640395</span>.jpg	974K		75K
<span class="token number">62034004</span>.jpg	974K		110K
<span class="token number">59897148</span>.jpg	974K		147K
<span class="token number">46287856</span>.jpg	973K		68K
<span class="token number">54674488</span>.jpg	973K		111K
<span class="token number">42265521</span>.png	973K		51K
<span class="token number">40261146</span>.jpg	973K		135K
<span class="token number">76815098</span>.png	973K		77K
<span class="token number">57095484</span>.png	973K		99K
<span class="token number">65354070</span>.jpg	973K		206K
<span class="token number">24130390</span>.jpg	973K		121K
<span class="token number">73753170</span>.jpg	972K		106K
<span class="token number">64066680</span>.jpg	972K		92K
<span class="token number">72175991</span>.png	972K		49K
<span class="token number">53402985</span>.png	972K		114K
<span class="token number">70710923</span>.png	971K		63K
<span class="token number">76242996</span>.png	971K		63K
<span class="token number">65736419</span>.jpg	971K		728K
<span class="token number">70095856</span>.png	971K		91K
<span class="token number">64284761</span>.png	971K		53K
<span class="token number">73907152</span>.jpg	971K		101K
<span class="token number">62120962</span>.png	970K		85K
<span class="token number">22003560</span>.png	970K		76K
<span class="token number">77293789</span>.jpg	970K		116K
<span class="token number">68647243</span>.png	970K		46K
<span class="token number">54618347</span>.png	970K		59K
<span class="token number">79602155</span>.jpg	969K		120K
<span class="token number">55491641</span>.jpg	968K		119K
<span class="token number">53473372</span>.png	968K		45K
<span class="token number">77569729</span>.jpg	968K		69K
<span class="token number">57420240</span>.png	968K		61K
<span class="token number">69798500</span>.png	968K		74K
<span class="token number">63487148</span>.png	968K		47K
<span class="token number">79687107</span>.jpg	967K		164K
<span class="token number">70081772</span>.jpg	966K		129K
<span class="token number">79623240</span>.jpg	966K		133K
<span class="token number">72535236</span>.jpg	966K		160K
<span class="token number">47680545</span>.png	966K		162K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="1MB-4MB"><a href="#1MB-4MB" class="headerlink" title="(1MB,4MB)"></a>(1MB,4MB)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>
<span class="token number">1345</span>.73s user <span class="token number">10</span>.84s system <span class="token number">888</span>% cpu <span class="token number">2</span>:32.64 total

src		  		dist		num
<span class="token number">3</span>.8G			342M		<span class="token number">2000</span>

<span class="token number">73839511</span>.png	<span class="token number">4</span>.1M		293K
<span class="token number">73839511</span>.png	<span class="token number">4</span>.1M		293K
<span class="token number">66504933</span>.png	<span class="token number">4</span>.1M		107K
<span class="token number">78316050</span>.png	<span class="token number">4</span>.1M		319K
<span class="token number">74264931</span>.png	<span class="token number">4</span>.1M		330K
<span class="token number">74412671</span>.png	<span class="token number">4</span>.1M		186K
<span class="token number">77414892</span>.png	<span class="token number">4</span>.1M		227K
<span class="token number">76442741</span>.png	<span class="token number">4</span>.0M		191K
<span class="token number">71330750</span>.png	<span class="token number">4</span>.0M		199K
<span class="token number">78361206</span>.png	<span class="token number">4</span>.0M		153K
<span class="token number">68763693</span>.png	<span class="token number">4</span>.0M		233K
<span class="token number">67222487</span>.png	<span class="token number">4</span>.0M		368K
<span class="token number">68560466</span>.png	<span class="token number">4</span>.0M		186K
<span class="token number">72437850</span>.png	<span class="token number">4</span>.0M		282K
<span class="token number">67767752</span>.png	<span class="token number">4</span>.0M		203K
<span class="token number">73597995</span>.png	<span class="token number">4</span>.0M		432K
<span class="token number">71506633</span>.png	<span class="token number">4</span>.0M		88K
<span class="token number">77601042</span>.png	<span class="token number">4</span>.0M		726K
<span class="token number">77033762</span>.png	<span class="token number">4</span>.0M		261K
<span class="token number">73436647</span>.jpg	<span class="token number">4</span>.0M		514K
<span class="token number">78099751</span>.png	<span class="token number">4</span>.0M		283K
<span class="token number">73165937</span>.png	<span class="token number">4</span>.0M		202K
<span class="token number">74379006</span>.png	<span class="token number">4</span>.0M		300K
<span class="token number">79274246</span>.png	<span class="token number">4</span>.0M		191K
<span class="token number">69701132</span>.png	<span class="token number">4</span>.0M		129K
<span class="token number">67455430</span>.jpg	<span class="token number">3</span>.9M		397K
<span class="token number">73651880</span>.png	<span class="token number">3</span>.9M		183K
<span class="token number">79152655</span>.png	<span class="token number">3</span>.9M		298K
<span class="token number">73117385</span>.png	<span class="token number">3</span>.9M		258K
<span class="token number">70281950</span>.png	<span class="token number">3</span>.9M		314K
<span class="token number">68501346</span>.png	<span class="token number">3</span>.9M		203K
<span class="token number">78895125</span>.png	<span class="token number">3</span>.9M		310K
<span class="token number">70159814</span>.png	<span class="token number">3</span>.9M		156K
<span class="token number">70764048</span>.jpg	<span class="token number">3</span>.9M		437K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4MB-32MB"><a href="#4MB-32MB" class="headerlink" title="(4MB,32MB)"></a>(4MB,32MB)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./webp-server <span class="token parameter variable">-jobs</span> <span class="token number">8</span> <span class="token parameter variable">-config</span> config.json <span class="token parameter variable">-prefetch</span>
<span class="token number">916</span>.91s user <span class="token number">12</span>.03s system <span class="token number">888</span>% cpu <span class="token number">1</span>:44.53 total

src				dist		num
<span class="token number">3</span>.8G			<span class="token number">3</span>.8G		<span class="token number">500</span>

<span class="token number">78467499</span>.png	32M		<span class="token number">2</span>.8M
<span class="token number">79620324</span>.png	32M
<span class="token number">74975502</span>.png	32M		<span class="token number">3</span>.0M
<span class="token number">74902740</span>.png	31M		<span class="token number">2</span>.6M
<span class="token number">77032574</span>.png	31M		<span class="token number">2</span>.5M
<span class="token number">77673519</span>.png	30M		<span class="token number">2</span>.3M
<span class="token number">77298781</span>.png	29M		<span class="token number">1</span>.4M
<span class="token number">77959551</span>.png	27M		<span class="token number">1</span>.5M
<span class="token number">69987155</span>.png	26M		649K
<span class="token number">74432253</span>.png	25M		<span class="token number">1</span>.6M
<span class="token number">78994948</span>.png	25M		923K
<span class="token number">77218195</span>.png	24M		<span class="token number">1</span>.6M
<span class="token number">72379562</span>.png	22M		251K
<span class="token number">77559996</span>.png	22M		<span class="token number">1</span>.9M
<span class="token number">71522636</span>.png	22M		<span class="token number">1</span>.3M
<span class="token number">78236671</span>.png	21M		<span class="token number">1</span>.7M
<span class="token number">78033540</span>.jpg	20M		<span class="token number">2</span>.7M
<span class="token number">70906047</span>.png	19M		677K
<span class="token number">72498744</span>.png	19M		882K
<span class="token number">73977640</span>.png	19M		523K
<span class="token number">78757823</span>.png	18M		<span class="token number">1</span>.5M
<span class="token number">71588979</span>.png	18M		<span class="token number">1</span>.2M
<span class="token number">75747535</span>.png	17M		<span class="token number">1</span>.2M
<span class="token number">71504158</span>.png	17M		<span class="token number">1</span>.2M
<span class="token number">76969768</span>.png	17M		<span class="token number">1</span>.4M
<span class="token number">77995994</span>.png	17M		568K
<span class="token number">75340699</span>.png	17M		<span class="token number">1</span>.4M
<span class="token number">69821163</span>.png	16M		<span class="token number">1</span>.1M
<span class="token number">70050613</span>.png	16M		<span class="token number">1</span>.1M
<span class="token number">76559411</span>.png	15M		<span class="token number">1</span>.7M
<span class="token number">76576885</span>.png	15M		853K
<span class="token number">75640746</span>.png	15M		<span class="token number">1</span>.4M
<span class="token number">78188732</span>.png	15M		<span class="token number">1</span>.4M
<span class="token number">73355141</span>.png	15M		589K
<span class="token number">75977096</span>.png	15M		<span class="token number">1</span>.4M
<span class="token number">72840608</span>.jpg	15M		<span class="token number">1</span>.8M
<span class="token number">75665779</span>.png	14M		<span class="token number">1</span>.5M
<span class="token number">77898275</span>.png	14M		<span class="token number">1</span>.2M
<span class="token number">79663534</span>.png	13M		<span class="token number">1</span>.2M
<span class="token number">76539246</span>.png	13M		<span class="token number">1</span>.2M
<span class="token number">70598104</span>.png	13M		840K
<span class="token number">78348611</span>.jpg	13M		<span class="token number">2</span>.7M<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å®é™…æ•ˆæœ"><a href="#å®é™…æ•ˆæœ" class="headerlink" title="å®é™…æ•ˆæœ"></a>å®é™…æ•ˆæœ</h2><p>ä¸ºäº†åšä¸ªå¯¹æ¯”ï¼Œå’±ä½¿ç”¨  <code>hexo.k8s.li</code> è¿™ä¸ªåŸŸåä¸ºå¯¹ç…§ç»„ï¼Œå³è¾“å‡ºæºæ–‡ä»¶ï¼Œä½¿ç”¨ <code>blog.k8s.li</code> è¿™ä¸ªåŸŸåä¸ºå®éªŒç»„åŠ ä¸Š webp server æ¥æµ‹è¯•ï¼Œå„ä½è¯»è€…ä¹Ÿå¯ä»¥åˆ†åˆ«è®¿é—®è¿™ä¸¤ä¸ªåŸŸåæ¥å®é™…ä½“éªŒä¹‹é—´çš„å·®åˆ«ï¼Œè‚‰çœ¼å¯è§ ğŸ˜‚ã€‚</p>
<h3 id="no-webps"><a href="#no-webps" class="headerlink" title="no webps"></a>no webps</h3><p>ä¼˜åŒ–å»ºè®®èƒ½èŠ‚çœ 138s ï¼Œä¹‹å‰ä¹Ÿæœ‰è¯»è€…æ™®éåæ˜ å›¾ç‰‡æ‰“å¼€ææ…¢</p>
<p><img data-src="https://p.k8s.li/no-webp.png"></p>
<h3 id="webps-yes"><a href="#webps-yes" class="headerlink" title="webps yes!"></a>webps yes!</h3><p>ä¼˜åŒ–å»ºè®®èƒ½èŠ‚çœ 19s ï¼Œæ¯”ä¸é€‚ç”¨ webp æ•´æ•´å‡å°‘äº†å°†è¿‘ 2 minğŸ˜‚ï¼Œçœ‹æ¥æ•ˆæœåŠå…¶æ˜æ˜¾å‘€ã€‚</p>
<p><img data-src="https://p.k8s.li/with-webp.png"></p>
<p>é€‰æ‹©ä¸¤ç¯‡å›¾ç‰‡æ¯”è¾ƒå¤šçš„åšå®¢ï¼Œæµ‹è¯•é“¾æ¥ä¸º ï¼š</p>
<ul>
<li><code>https://blog.k8s.li/2020-Lunar-New-Year.html</code></li>
<li><code>https://blog.k8s.li/wd-hc310-dc-hdd.html</code></li>
<li><code>https://hexo.k8s.li/2020-Lunar-New-Year.html</code></li>
<li><code>https://hexo.k8s.li/wd-hc310-dc-hdd.html</code></li>
</ul>
<h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul>
<li><a target="_blank" rel="noopener" href="https://nova.moe/re-introduce-webp-server/">è®©ç«™ç‚¹å›¾ç‰‡åŠ è½½é€Ÿåº¦æ›´å¿«â€”â€”å¼•å…¥ WebP Server æ— ç¼è½¬æ¢å›¾ç‰‡ä¸º WebP</a></li>
<li><a target="_blank" rel="noopener" href="https://await.moe/2020/02/note-about-encountered-memory-changes-for-no-reason-in-golang/">è®° Golang ä¸‹é‡åˆ°çš„ä¸€å›ã€Œæ¯«æ— ç”±å¤´ã€çš„å†…å­˜æ›´æ”¹</a></li>
<li><a target="_blank" rel="noopener" href="https://await.moe/2020/02/webp-server-in-rust/">WebP Server in Rust</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bennythink.com/flying-webp.html">ä¸ªäººç½‘ç«™æ— ç¼åˆ‡æ¢å›¾ç‰‡åˆ° webp</a></li>
<li><a target="_blank" rel="noopener" href="https://halo.run/archives/halo-and-webp">ä¼˜é›…çš„è®© Halo æ”¯æŒ webp å›¾ç‰‡è¾“å‡º</a></li>
<li><a target="_blank" rel="noopener" href="https://vince.xin/2018/09/12/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8webp%E6%9D%A5%E4%BC%98%E5%8C%96%E4%BD%A0%E7%9A%84%E5%9B%BE%E7%89%87/">å‰ç«¯æ€§èƒ½ä¼˜åŒ–â€”â€”ä½¿ç”¨ webp æ¥ä¼˜åŒ–ä½ çš„å›¾ç‰‡ xx</a></li>
<li><a target="_blank" rel="noopener" href="https://aotu.io/notes/2016/06/23/explore-something-of-webp/index.html">æ¢ç©¶ WebP ä¸€äº›äº‹å„¿</a></li>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/speed/webp">A new image format for the Web</a></li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag"># åšå®¢</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/linux-net-and-iptables.html" rel="prev" title="Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†">
                  <i class="fa fa-chevron-left"></i> Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/N1-openwrt.html" rel="next" title="N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s">
                  N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">26:36</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
