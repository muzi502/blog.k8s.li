<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.k8s.li').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
  <meta name="description" content="å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆxå°å£°  åŠé€€ä¸‰è¿ğŸ˜‚ éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰ å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰ éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰  ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ©ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼">
<meta property="og:url" content="https://blog.k8s.li/oh-my-webpsh.html">
<meta property="og:site_name" content="æœ¨å­">
<meta property="og:description" content="å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆxå°å£°  åŠé€€ä¸‰è¿ğŸ˜‚ éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰ å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰ éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰  ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ©ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20200306094307271.png">
<meta property="og:image" content="https://p.k8s.li/20200307102856702.png">
<meta property="og:image" content="https://p.k8s.li/20200304191400500.png">
<meta property="og:image" content="https://p.k8s.li/no-webp.png">
<meta property="og:image" content="https://p.k8s.li/with-webp.png">
<meta property="article:published_time" content="2020-03-04T16:00:00.000Z">
<meta property="article:modified_time" content="2020-03-05T16:00:00.000Z">
<meta property="article:author" content="æœ¨å­">
<meta property="article:tag" content="åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20200306094307271.png">
<link rel="canonical" href="https://blog.k8s.li/oh-my-webpsh.html">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
  <title>è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼ | æœ¨å­</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
<link rel="alternate" href="/atom.xml" title="æœ¨å­" type="application/atom+xml">
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">
    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æœ¨å­</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>
  </li>
        <li class="menu-item menu-item-books">
    <a href="/booklist.html" rel="section"><i class="fa fa-fw fa-book"></i>Books</a>
  </li>
        <li class="menu-item menu-item-kindle">
    <a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
  </li>
        <li class="menu-item menu-item-friend">
    <a href="/link/" rel="section"><i class="fa fa-fw fa-link"></i>Friend</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>
  </li>
  </ul>
</nav>
</div>
    </header>
  <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
  <div class="posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/oh-my-webpsh.html">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.k8s.li/avatar.png">
      <meta itemprop="name" content="æœ¨å­">
      <meta itemprop="description" content="">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æœ¨å­">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼
        </h2>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-03-05 2020-03-05T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-03-05T00:00:00+08:00">2020-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-03-06 2020-03-06T00:00:00+08:00" itemprop="dateModified" datetime="2020-03-06T00:00:00+08:00">2020-03-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">æŠ€æœ¯</span>
                  </a>
                </span>
            </span>
  <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    <a title="disqus" href="/oh-my-webpsh.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="oh-my-webpsh.html" itemprop="commentCount"></span>
    </a>
  </span>
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>18 åˆ†é’Ÿ</span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>å’±æ¥æ¨é”€ webp server go å•¦ ï¼ˆxå°å£°</p>
</blockquote>
<h2 id="åŠé€€ä¸‰è¿ğŸ˜‚"><a href="#åŠé€€ä¸‰è¿ğŸ˜‚" class="headerlink" title="åŠé€€ä¸‰è¿ğŸ˜‚"></a>åŠé€€ä¸‰è¿ğŸ˜‚</h2><ul>
<li>éœ€è¦é…ç½® nginx åå‘ä»£ç†ï¼ˆï¼ï¹ï¼œï¼‰</li>
<li>å›¾ç‰‡å¿…é¡»æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå›¾åºŠä¸å¾—è¡Œ (ï¾‰*ï½¥Ï‰ï½¥)ï¾‰</li>
<li>éœ€è¦ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ŒGitHub page ä¹‹ç±»çš„ä¸å¾—è¡Œï¼ˆâ•¯ï¸¿â•°ï¼‰</li>
</ul>
<p>ä¸è¿‡ï¼Œå¯¹äºå·²ç»ä¼šè‡ªç”±è®¿é—®äº’è”ç½‘çš„äººæ¥è¯´è¿™éƒ½ä¸éš¾ (â—Ë‡âˆ€Ë‡â—) ï¼Œé£Ÿç”¨è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆç–‘é—®çš„è¯ä¹Ÿå¯ä»¥è”ç³»å’±ï¼Œå’±ä¼šå°½è‡ªå·±æ‰€èƒ½æä¾›ä¸€äº›å¸®åŠ©ğŸ˜˜ï¼Œä¸€èµ·æ¥å®Œå–„è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚</p>
<h2 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h2><blockquote>
<p>WebPçš„æœ‰æŸå‹ç¼©ç®—æ³•æ˜¯åŸºäºVP8è§†é¢‘æ ¼å¼çš„å¸§å†…ç¼–ç [17]ï¼Œå¹¶ä»¥RIFFä½œä¸ºå®¹å™¨æ ¼å¼ã€‚[2] å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å…«ä½è‰²å½©æ·±åº¦å’Œä»¥1:2çš„æ¯”ä¾‹è¿›è¡Œè‰²åº¦å­é‡‡æ ·çš„äº®åº¦-è‰²åº¦æ¨¡å‹ï¼ˆYCbCr 4:2:0ï¼‰çš„åŸºäºå—çš„è½¬æ¢æ–¹æ¡ˆã€‚[18] ä¸å«å†…å®¹çš„æƒ…å†µä¸‹ï¼ŒRIFFå®¹å™¨è¦æ±‚åªéœ€20å­—èŠ‚çš„å¼€é”€ï¼Œä¾ç„¶èƒ½ä¿å­˜é¢å¤–çš„ å…ƒæ•°æ®(metadata)ã€‚[2] WebPå›¾åƒçš„è¾¹é•¿é™åˆ¶ä¸º16383åƒç´ ã€‚</p>
</blockquote>
<p>WebP æ˜¯ä¸€ç§è¡ç”Ÿè‡ª Google VP8 çš„å›¾åƒæ ¼å¼ï¼ŒåŒæ—¶æ”¯æŒæœ‰æŸå’Œæ— æŸç¼–ç ã€‚å½“ä½¿ç”¨æœ‰æŸæ¨¡å¼ï¼Œå®ƒåœ¨ç›¸åŒä½“ç§¯æä¾›æ¯” JPG å›¾åƒæ›´å¥½çš„è´¨é‡ï¼›å½“ä½¿ç”¨æ— æŸæ¨¡å¼ï¼Œå®ƒæä¾›æ¯”æœ€ä½³å‹ç¼©çš„ PNG å›¾åƒæ›´å°çš„ä½“ç§¯ã€‚ç®€å•æ¥è¯´ï¼ŒWebP å›¾ç‰‡æ ¼å¼çš„å­˜åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ WebP ä¸Šå±•ç¤ºçš„å›¾ç‰‡ä½“ç§¯å¯ä»¥æœ‰è¾ƒå¤§å¹…åº¦çš„ç¼©å°ã€‚ç½‘ç«™ä¸Šçš„å›¾ç‰‡èµ„æºå¦‚æœä½¿ç”¨ WebPï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿä¼šå‡å°‘è¿™äº›å›¾ç‰‡æ–‡ä»¶çš„åŠ è½½æ—¶é—´ï¼Œä¹Ÿå°±å¸¦æ¥äº†ç½‘ç«™åŠ è½½æ€§èƒ½çš„æå‡ã€‚å…³äº webp å›¾åƒæ ¼å¼çš„å…·ä½“å®ç°ç»†èŠ‚å¯ä»¥å»ç»´åŸºç™¾ç§‘æˆ–è€…æ–‡æœ«æˆ‘æåˆ°çš„æ¨èé˜…è¯»çœ‹ä¸€ä¸‹ï¼Œæ€»ä¹‹ webp å¾ˆé¦™å°±æ˜¯å•¦ (â—â€™â—¡â€™â—)</p>
<h3 id="æ”¯æŒæƒ…å†µ"><a href="#æ”¯æŒæƒ…å†µ" class="headerlink" title="æ”¯æŒæƒ…å†µ"></a>æ”¯æŒæƒ…å†µ</h3><p>æ ¹æ® <a href="https://caniuse.com/#search=webp" target="_blank" rel="noopener">caniuse</a> çš„ç»Ÿè®¡æƒ…å†µï¼Œä¸»æµæµè§ˆå™¨ï¼ˆæ¥è¿‘80%ï¼‰éƒ½æ”¯æŒ webp äº†ï¼Œå¦‚æœé‡åˆ° Safari è¿™æ ·çš„å¥‡è‘©ï¼Œå’±ç›´æ¥è¿”å›åŸå›¾ã€‚IE æµè§ˆå™¨ï¼Ÿï¼Ÿ</p>
<p><img src="https://p.k8s.li/20200306094307271.png" alt=""></p>
<h2 id="webp-sh"><a href="#webp-sh" class="headerlink" title="webp-sh"></a>webp-sh</h2><ul>
<li>å®˜ç½‘ <a href="https://webp.sh" target="_blank" rel="noopener">webp.sh</a></li>
<li>GitHub <a href="https://github.com/webp-sh" target="_blank" rel="noopener">webp-sh</a></li>
</ul>
<p>webp server é¡¾åæ€ä¹‰å°±æ˜¯ webp æœåŠ¡å™¨å•¦ï¼Œç”¨äºå°†ç½‘ç«™é‡Œçš„å›¾ç‰‡ï¼ˆjpgã€pngã€jpegç­‰ï¼‰è½¬æ¢æˆ webp å›¾åƒç¼–ç æ ¼å¼ï¼Œè€Œä¸”æ— é¡»ä¿®æ”¹åšå®¢ç«™ç‚¹å†…å›¾ç‰‡çš„ url ï¼Œå› æ­¤å¯¹äºè®¿é—®å›¾ç‰‡èµ„æºçš„å®¢æˆ·ç«¯æ¥è®²æ˜¯é€æ˜çš„ã€‚ä¸»æµçš„ CDN ä¹Ÿæ”¯æŒè¿™æ ·ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Cloudflare çš„ <a href="">Polish</a> ï¼Œå¯ä»¥å‚è€ƒ <a href="https://support.cloudflare.com/hc/en-us/articles/360000607372-Using-Cloudflare-Polish-to-compress-images">Using Cloudflare Polish to compress images</a> ã€‚ä½†æ˜¯å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œå›¾ç‰‡è½¬ç ä¸ç¼–ç è¿™éƒ½æ˜¯è¦ç®—åŠ›çš„ï¼Œéƒ½æ˜¯è¦è®¡ç®—èµ„æºçš„ï¼Œéƒ½æ˜¯è¦ CPU çš„ï¼Œéƒ½æ˜¯è¦èŠ±é’±çš„ğŸ˜‚ã€‚è¯´åˆ°åº•è¿˜æ˜¯ç©·å•Šï¼ˆå’± webp server æ˜¯å¼€æºå…è´¹çš„ã€‚</p>
<blockquote>
<p>æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯â€”â€”æˆ‘ä»¬è®¿é—®çš„ URL å¯ä»¥å®Œå…¨ä¸ç”¨æ”¹å˜ï¼Œè®¿å®¢è®¿é—®çš„ä¾ç„¶æ˜¯ <code>https://image.nova.moe/tsuki/tsuki.jpg</code> ï¼Œä½†æ˜¯å¾—åˆ°çš„å›¾ç‰‡æ ¼å¼ä¸ºï¼š<code>image/webp</code>ï¼Œè€Œä¸”ä½“ç§¯å‡å°‘äº†ä¸å°‘ã€‚</p>
</blockquote>
<p>å…¶å® webp server æœ‰å¤šç§è¯­è¨€éƒ½å®ç°äº†ï¼Œå¹¶ä¸”è¿™äº›ä»“åº“è¿˜éƒ½æ”¾åœ¨äº† <a href="https://github.com/webp-sh" target="_blank" rel="noopener">webp-sh</a> è¯¥ Organizations ä¸‹ã€‚ä¸è¿‡å’±æ¯”è¾ƒå–œæ¬¢ golang æ‰€ä»¥å°±æ¨è webp server go å•¦ğŸ˜‚ï¼Œéš”å£çš„ webp server rust åˆ«æ‰“æˆ‘å•Šï¼ˆé€ƒ</p>
<blockquote>
<p>è¿™ä¸ªå·¥å…·å°±æ˜¯ç”± <a href="https://nova.moe/" target="_blank" rel="noopener">Nova ç«¥é‹</a>ã€ <a href="https://www.bennythink.com" target="_blank" rel="noopener">Benny</a> ã€<a href="https://blog.0xbbc.com/" target="_blank" rel="noopener">cocoa</a> ä»¥åŠ <a href="https://blog.k8s.li/">muzi</a> å°ç›†å‹ä¸€èµ·é¼“æ£çš„ webp_server_go å•¦ï¼</p>
</blockquote>
<ul>
<li><a href="https://github.com/webp-sh/webp_server_go" target="_blank" rel="noopener">webp_server_go</a></li>
<li><a href="https://github.com/webp-sh/webp_server_rs" target="_blank" rel="noopener">webp_server_rs</a></li>
<li><a href="https://github.com/webp-sh/webp_server_node" target="_blank" rel="noopener">webp_server_node</a></li>
<li><a href="https://github.com/webp-sh/webp_server_java" target="_blank" rel="noopener">webp_server_java</a></li>
<li><a href="https://github.com/webp-sh/webp_server_python" target="_blank" rel="noopener">webp_server_python</a></li>
</ul>
<h2 id="é£Ÿç”¨æŒ‡å—"><a href="#é£Ÿç”¨æŒ‡å—" class="headerlink" title="é£Ÿç”¨æŒ‡å—"></a>é£Ÿç”¨æŒ‡å—</h2><h3 id="1-ä¸‹è½½"><a href="#1-ä¸‹è½½" class="headerlink" title="1. ä¸‹è½½"></a>1. ä¸‹è½½</h3><p>é¦–å…ˆåˆ° <a href="https://github.com/webp-sh/webp_server_go/releases" target="_blank" rel="noopener">release</a> é¡µé¢ä¸‹è½½å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆé€‰æ‹©ä¸‹è½½ rpm æˆ– deb åŒ…ï¼Œåœ¨æ­¤è¦æ³¨æ„é€‰æ‹©ä¸‹è½½ç¬¦åˆè‡ªå·±çš„ arch å’Œ OSã€‚</p>
<p>è‡³äºå®‰è£…è·¯å¾„ï¼Œæˆ‘ä¸ªäººæ›´å€¾å‘äºæ”¾åœ¨ <code>/opt/</code> ç›®å½•ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªç›®å½•ä¸‹çš„ä¸œè¥¿éƒ½æ˜¯è‡ªå·±å®‰è£…çš„ï¼Œè€Œä¸”ä¹Ÿä¸ä¾èµ–äºç‰¹å®šçš„å‘è¡Œç‰ˆï¼Œæ–¹ä¾¿åšå®¢è¿ç§»ï¼ˆæ¬å®¶ï¼‰ï¼Œæ¬å®¶çš„æ—¶å€™ç›´æ¥æ‰“åŒ… <code>/opt</code> ç›®å½•ï¼Œç„¶å scp ä¸€ä¸‹å°±å·é“ºç›–èµ°äººï¼Œå¤šæ–¹ä¾¿å‘€ğŸ˜‚ã€‚</p>
<h3 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2. é…ç½®"></a>2. é…ç½®</h3><p>é£Ÿç”¨ webp-server-go ä¹‹å‰é€‰å‡†å¤‡å¥½ä¸€ä¸ª <code>config.json</code> é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"HOST"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  <span class="attr">"PORT"</span>: <span class="string">"3333"</span>,</span><br><span class="line">  <span class="attr">"QUALITY"</span>: <span class="string">"80"</span>,</span><br><span class="line">  <span class="attr">"IMG_PATH"</span>: <span class="string">"/var/www/hexo"</span>,</span><br><span class="line">  <span class="attr">"EXHAUST_PATH"</span>: <span class="string">"./dist"</span>,</span><br><span class="line">  <span class="attr">"ALLOWED_TYPES"</span>: [<span class="string">"jpg"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>,<span class="string">"bmp"</span>,<span class="string">"gif"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>HOSTï¼šå¯¹äº webp server æœåŠ¡æ¥è®²åªéœ€è¦ç›‘å¬ 127.0.0.1 è¿™ä¸ªæœ¬æœºåœ°å€å°±å¯ä»¥äº†ï¼Œç¨åä½¿ç”¨ nginx åå‘ä»£ç†ä¸€ä¸‹ã€‚</li>
<li>PORTï¼šå°±æ˜¯ webp server æœåŠ¡ç›‘å¬çš„çš„ç«¯å£å·ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹</li>
<li>QUALITYï¼šç¼–ç çš„è´¨é‡ï¼Œä¸€èˆ¬æ¨è 75 ï¼Œä¸è¿‡ä½¿ç”¨ 80 ä¹Ÿæ˜¯ä¸é”™çš„ã€‚</li>
<li>IMG_PATHï¼šç½‘ç«™çš„æ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ï¼Œä¸€å®šè¦é…ç½®ä½ å›¾ç‰‡ url çš„æ ¹ç›®å½•ã€‚</li>
<li>EXHAUST_PATHï¼šè½¬æ¢åçš„ webp å›¾ç‰‡æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œæå‰åˆ›å»ºå¥½ã€‚</li>
<li>ALLOWED_TYPESï¼šå…è®¸è½¬ç çš„å›¾ç‰‡æ ¼å¼ï¼Œç›®å‰æ”¯æŒè¿™å‡ ç§ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥å†é…ç½®ä»¥ä¸‹ nginx ï¼Œä¸‹é¢ä»¥æˆ‘çš„ hexo åšå®¢ä¸ºä¾‹ï¼Œhugo ä¹ŸåŒæ ·å¦‚æ­¤ã€‚å†æ·»åŠ ä¸€å— localtion å­—æ®µå³å¯ï¼Œå¦‚æœä½ ä¿®æ”¹äº†é»˜è®¤ç«¯å£å·çš„è¯ä¸è¦å¿˜è®°ä¿®æ”¹ä¸ºä½ æ”¹ä¹‹åçš„ç«¯å£å·ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>/etc/nginx/conf.d/blog.conf</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  blog.<span class="number">502</span>.li;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$base</span> /var/www/hexo/public;</span><br><span class="line">        <span class="attribute">root</span> <span class="variable">$base</span>/;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">index</span>  index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~* \.(png|jpg|jpeg)$</span> &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_hide_header</span> X-Powered-By;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line">            <span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡åœ¨æ­¤éœ€è¦æ³¨æ„ï¼Œnginx çš„ location å­—æ®µçš„è·¯å¾„ä¸€å®šè¦å’Œ webp server <code>config.json</code> é‡Œçš„ <code>IMG_PATH</code> ç›¸å¯¹åº”ï¼Œä¸ç„¶ä¼šå¯¼è‡´è¯·æ±‚èµ„æºçš„ uri ä¸ webp server è½¬æ¢åçš„æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´è€Œå¯¼è‡´èµ„æº 404 ã€‚è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ location é‚£é‡Œä¸èƒ½ä»…ä»…æ·»åŠ  <code>proxy_pass http://127.0.0.1:3333;</code> ï¼Œè¿™æ ·æµè§ˆå™¨çš„ UA ä¼šè¢« nginx ç»™åƒæ‰ğŸ˜„ï¼Œnginx å°†è¯·æ±‚ proxy ç»™ webp server åæ— æ³•ä» headers é‚£é‡Œè·å–åˆ° UA ï¼Œè€Œå¯¼è‡´ <code>Safari</code> æµè§ˆå™¨æ— æ³•æ­£å¸¸è¾“å‡ºåŸå›¾ã€‚æ‰€ä»¥ä»¥ä¸‹å‡ è¡Œæ·»åŠ åœ¨ <code>proxy_pass</code> ä¸‹é¢æ˜¯å¿…é¡»çš„ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_set_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line"><span class="attribute">add_header</span> Cache-Control <span class="string">'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'</span>;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–æ„Ÿè°¢å¥½å¿ƒè¯»è€…çš„æé†’æ‰å‘ç°è¿™ä¸ª bug ğŸ˜˜</p>
<p><img src="https://p.k8s.li/20200307102856702.png" alt=""></p>
<h3 id="3-å¯åŠ¨"><a href="#3-å¯åŠ¨" class="headerlink" title="3.å¯åŠ¨"></a>3.å¯åŠ¨</h3><p>æ‰‹åŠ¨è¿è¡Œèµ·æ¥å¾ˆç®€å•ï¼Œ<code>./webp-server -config /path/to/config.json</code> ï¼Œå¦‚æœè¯¥æœåŠ¡æŒ‚æ‰äº†èµ„æºå°± gg äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰ç”¨ä¸€ç§ç¨³å®šæŒä¹…åŒ–çš„è¿è¡Œæ–¹å¼ã€‚å’±æ¨èä½¿ç”¨ systemd æ¥å¯åŠ¨ï¼Œè¿™æ · webp server æœåŠ¡æŒ‚æ‰äº†ä¹Ÿä¼šè‡ªåŠ¨æ‹‰èµ·é‡å¯ä¸€ä¸‹ã€‚é¦–å…ˆè¦åˆ›å»ºæˆ–ä¿®æ”¹ä¸€ä¸‹ <code>webps.service</code> é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=WebP Server</span><br><span class="line">Documentation=https://github.com/webp-sh/webp_server_go</span><br><span class="line">After=nginx.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">AmbientCapabilities=CAP_NET_BIND_SERVICE</span><br><span class="line">WorkingDirectory=/opt/webps</span><br><span class="line">ExecStart=/opt/webps/webp-server --config /opt/webps/config.json</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -HUP <span class="variable">$MAINPID</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ä¸€ä¸‹ <code>ExecStart=/opt/webps/webp-server --config /opt/webps/config.json</code> å’Œ <code>WorkingDirectory=/opt/webps</code> å¯¹åº”çš„è·¯å¾„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp webps.service /lib/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> webps.service</span><br><span class="line">systemctl start webps.service</span><br></pre></td></tr></table></figure>
<h3 id="4-é¢„åŠ è½½"><a href="#4-é¢„åŠ è½½" class="headerlink" title="4.é¢„åŠ è½½"></a>4.é¢„åŠ è½½</h3><p>webp-server-go æœ‰ä¸ªé¢„åŠ è½½çš„åŠŸèƒ½ï¼Œå°±æ˜¯æå‰å°†å…¨éƒ¨çš„å›¾ç‰‡èµ„æºè¿›è¡Œä¸€æ¬¡è½¬æ¢ï¼Œè¿™æ ·å†æ¬¡è®¿é—®å›¾ç‰‡èµ„æºçš„æ—¶å€™å°±ä¸å¿…å†è¿›è¡Œè½¬æ¢ï¼Œè€Œç›´æ¥ä½¿ç”¨å·²ç»è½¬æ¢åçš„ webp æ–‡ä»¶å³å¯ã€‚è¿™ç›¸å½“äºä¸€æ¬¡ â€œç¼“å­˜â€ ã€‚</p>
<p>ä½¿ç”¨ <code>./webp-server -jobs 1 -config config.json -prefetch</code> æ¥è¿›è¡Œä¸€æ¬¡é¢„åŠ è½½ï¼Œå…¶ä¸­ jobs åé¢çš„æ•°å­—ä¸ºä½  CPU çš„æ ¸å¿ƒæ•°ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨åŠ é»˜è®¤ä½¿ç”¨å…¨éƒ¨æ ¸å¿ƒã€‚</p>
<h2 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h2><p>è¯´åˆ°æ€§èƒ½ï¼Œå’±å¿…é¡»å¾—è¿›è¡Œä¸€æ¬¡å‹æµ‹æ‰èƒ½æ”¾å¿ƒå¤§èƒ†åœ°æ¨èå„ä½é£Ÿç”¨ webp server go å•¦ï¼Œä¸‹é¢å¾—å°±æ˜¯å’±çš„æµ‹è¯•æ•°æ®æ ·ä¾‹ã€‚å›¾ç‰‡çš„æµ‹è¯•æ ·æœ¬æ˜¯å’±ä½¿ç”¨ <a href="https://github.com/Tsuk1ko/pxder" target="_blank" rel="noopener">pxder</a> çˆ¬ä¸‹æ¥çš„ï¼Œæ€»å…± 10600 å¼ å›¾ç‰‡ï¼Œæ€»å¤§å° 11.1 GBã€‚å¦‚æœä½ ä¹Ÿéœ€è¦è¿™äº›æµ‹è¯•æ ·æœ¬çš„è¯å¯ä»¥ç§èŠå’±å‘ç»™ä½ ã€‚ä¸‹é¢å°±æ˜¯çœŸå®çš„æµ‹è¯•æ•°æ®ã€‚æµ‹è¯•ç¯å¢ƒæ˜¯ 8 core Ã—3.4G Hzï¼Œæµ‹è¯•ç‰ˆæœ¬ä¸º <a href="https://github.com/webp-sh/webp_server_go/releases/tag/0.1.0" target="_blank" rel="noopener">v0.1.0</a> ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤å‚æ•°é…ç½®ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"HOST"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  <span class="attr">"PORT"</span>: <span class="string">"3333"</span>,</span><br><span class="line">  <span class="attr">"QUALITY"</span>: <span class="string">"80"</span>,</span><br><span class="line">  <span class="attr">"IMG_PATH"</span>: <span class="string">"./src"</span>,</span><br><span class="line">  <span class="attr">"EXHAUST_PATH"</span>: <span class="string">"./dist"</span>,</span><br><span class="line">  <span class="attr">"ALLOWED_TYPES"</span>: [<span class="string">"jpg"</span>,<span class="string">"png"</span>,<span class="string">"jpeg"</span>,<span class="string">"bmp"</span>,<span class="string">"gif"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p.k8s.li/20200304191400500.png" alt=""></p>
<h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><table>
<thead>
<tr>
<th align="center">file_size_range</th>
<th align="center">file_num</th>
<th align="center">src_size</th>
<th align="center">dist_size</th>
<th align="center">total</th>
<th align="center">user</th>
<th align="center">system</th>
<th align="center">cpu</th>
<th align="center">core</th>
</tr>
</thead>
<tbody><tr>
<td align="center">(10KB,500KB)</td>
<td align="center">4600</td>
<td align="center">1.3G</td>
<td align="center">310M</td>
<td align="center">1:44.49</td>
<td align="center">905.41s</td>
<td align="center">9.55s</td>
<td align="center">875%</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">(500KB,1MB)</td>
<td align="center">3500</td>
<td align="center">2.4G</td>
<td align="center">361M</td>
<td align="center">2:04.81</td>
<td align="center">1092.50s</td>
<td align="center">7.98s</td>
<td align="center">881%</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">(1MB,4MB)</td>
<td align="center">2000</td>
<td align="center">3.8G</td>
<td align="center">342M</td>
<td align="center">2:32.64</td>
<td align="center">1345.73s</td>
<td align="center">10.84s</td>
<td align="center">888%</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">(4MB,32MB)</td>
<td align="center">500</td>
<td align="center">3.6G</td>
<td align="center">246M</td>
<td align="center">1:44.53</td>
<td align="center">916.91s</td>
<td align="center">12.03s</td>
<td align="center">888%</td>
<td align="center">8</td>
</tr>
</tbody></table>
<h4 id="ä¸åŒæ ¸å¿ƒ-total-å¯¹æ¯”"><a href="#ä¸åŒæ ¸å¿ƒ-total-å¯¹æ¯”" class="headerlink" title="ä¸åŒæ ¸å¿ƒ total å¯¹æ¯”"></a>ä¸åŒæ ¸å¿ƒ total å¯¹æ¯”</h4><table>
<thead>
<tr>
<th align="center">file_size_range</th>
<th align="center">file_num</th>
<th align="center">src_size</th>
<th align="center">dist_size</th>
<th align="center">8</th>
<th align="center">4</th>
<th align="center">2</th>
<th align="center">1</th>
</tr>
</thead>
<tbody><tr>
<td align="center">(10KB,500KB)</td>
<td align="center">4600</td>
<td align="center">1.3G</td>
<td align="center">310M</td>
<td align="center">1:44.49</td>
<td align="center">2:18.49</td>
<td align="center">3:36.05</td>
<td align="center">5:20.88</td>
</tr>
<tr>
<td align="center">(500KB,1MB)</td>
<td align="center">3500</td>
<td align="center">2.4G</td>
<td align="center">361M</td>
<td align="center">2:04.81</td>
<td align="center">2:49.46</td>
<td align="center">4:16.41</td>
<td align="center">6:28.97</td>
</tr>
<tr>
<td align="center">(1MB,4MB)</td>
<td align="center">2000</td>
<td align="center">3.8G</td>
<td align="center">342M</td>
<td align="center">2:32.64</td>
<td align="center">3:26.18</td>
<td align="center">5:22.15</td>
<td align="center">7:53.45</td>
</tr>
<tr>
<td align="center">(4MB,32MB)</td>
<td align="center">500</td>
<td align="center">3.6G</td>
<td align="center">246M</td>
<td align="center">1:44.53</td>
<td align="center">2:21.22</td>
<td align="center">3:39.16</td>
<td align="center">5:28.65</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 10KB-500KB</span></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  632.77s user 11.23s system 200% cpu 5:20.88 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  639.31s user 8.77s system 299% cpu 3:36.05 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  676.17s user 8.12s system 494% cpu 2:18.49 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  905.41s user 9.55s system 875% cpu 1:44.49 total</span><br><span class="line"></span><br><span class="line"><span class="comment">### 500KB-1MB</span></span><br><span class="line"></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  767.45s user 10.14s system 199% cpu 6:28.97 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  778.00s user 8.62s system 295% cpu 4:16.41 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  831.38s user 7.62s system 495% cpu 2:49.46 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  1092.50s user 7.98s system 881% cpu 2:04.81 total</span><br><span class="line"></span><br><span class="line"><span class="comment">### 1MB-4MB</span></span><br><span class="line"></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  934.22s user 12.45s system 199% cpu 7:53.45 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  958.41s user 9.41s system 300% cpu 5:22.15 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  1010.56s user 8.05s system 494% cpu 3:26.18 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  1345.73s user 10.84s system 888% cpu 2:32.64 total</span><br><span class="line"></span><br><span class="line"><span class="comment">### 4MB-32MB</span></span><br><span class="line"></span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 1 -config config.json -prefetch  641.78s user 10.77s system 187% cpu 5:28.65 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 2 -config config.json -prefetch  643.19s user 9.73s system 297% cpu 3:39.16 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 4 -config config.json -prefetch  688.05s user 9.91s system 494% cpu 2:21.22 total</span><br><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch  916.91s user 12.03s system 888% cpu 1:44.53 total</span><br></pre></td></tr></table></figure>
<h3 id="è½¬æ¢å‰åå¤§å°å¯¹æ¯”"><a href="#è½¬æ¢å‰åå¤§å°å¯¹æ¯”" class="headerlink" title="è½¬æ¢å‰åå¤§å°å¯¹æ¯”"></a>è½¬æ¢å‰åå¤§å°å¯¹æ¯”</h3><p>ä»¥ä¸‹å’±å°±æˆªå–ä¸€å°éƒ¨åˆ†çš„æµ‹è¯•ç»“æœï¼Œå®Œæ•´çš„æ—¥å¿—æ”¾åœ¨äº†æˆ‘çš„ gist ä¸Š <strong><a href="https://gist.github.com/muzi502/4f7c4128895ac3f438e7a183df219661" target="_blank" rel="noopener">webp-server-go_test.log</a></strong> ã€‚å›¾ç‰‡éƒ½æ˜¯çœŸæ˜¯çš„æ•°æ®ï¼Œæ ¹æ®æ–‡ä»¶åçš„ ID å¯ä»¥åœ¨ pixiv.net ä¸Šæ‰¾åˆ°æºæ–‡ä»¶ï¼Œç›¸ä¿¡è€å¸æœºä»¬éƒ½æ‡‚å¾—ğŸ˜‚ã€‚</p>
<h4 id="10KB-500KB"><a href="#10KB-500KB" class="headerlink" title="(10KB,500KB)"></a>(10KB,500KB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">905.41s user 9.55s system 875% cpu 1:44.49 total</span><br><span class="line"></span><br><span class="line">src		    	dist		num</span><br><span class="line">1.3G			310M		4600</span><br><span class="line">63304866.png	495K		40K</span><br><span class="line">40881097.jpg	495K		118K</span><br><span class="line">21045662.jpg	495K		94K</span><br><span class="line">67888534.png	495K		73K</span><br><span class="line">50136421.jpg	495K		62K</span><br><span class="line">72636668.png	495K		113K</span><br><span class="line">55156014.jpg	495K		78K</span><br><span class="line">76671894.png	495K		59K</span><br><span class="line">64709121.png	495K		67K</span><br><span class="line">78336881.jpg	495K		77K</span><br><span class="line">57090512.png	494K		35K</span><br><span class="line">72153105.jpg	494K		64K</span><br><span class="line">62457185.png	494K		39K</span><br><span class="line">44892218.png	494K		96K</span><br><span class="line">39599640.jpg	494K		39K</span><br><span class="line">21428544.jpg	493K		76K</span><br><span class="line">65293876.jpg	493K		68K</span><br><span class="line">76098632.png	493K		80K</span><br><span class="line">65418239.jpg	493K		119K</span><br><span class="line">17900553.jpg	493K		51K</span><br><span class="line">61511853.jpg	493K		123K</span><br><span class="line">77984504.png	493K		56K</span><br><span class="line">54667116.jpg	493K		56K</span><br><span class="line">75357235.jpg	493K		67K</span><br><span class="line">21085426.jpg	492K		55K</span><br></pre></td></tr></table></figure>
<h4 id="500KB-1MB"><a href="#500KB-1MB" class="headerlink" title="(500KB,1MB)"></a>(500KB,1MB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">1092.50s user 7.98s system 881% cpu 2:04.81 total</span><br><span class="line"></span><br><span class="line">src				dist		num</span><br><span class="line">2.4G			361M		3500</span><br><span class="line"></span><br><span class="line">44937735.png	974K		74K</span><br><span class="line">56343106.png	974K		49K</span><br><span class="line">51320479.png	974K		73K</span><br><span class="line">68346957.jpg	974K		112K</span><br><span class="line">74882964.png	974K		150K</span><br><span class="line">76640395.jpg	974K		75K</span><br><span class="line">62034004.jpg	974K		110K</span><br><span class="line">59897148.jpg	974K		147K</span><br><span class="line">46287856.jpg	973K		68K</span><br><span class="line">54674488.jpg	973K		111K</span><br><span class="line">42265521.png	973K		51K</span><br><span class="line">40261146.jpg	973K		135K</span><br><span class="line">76815098.png	973K		77K</span><br><span class="line">57095484.png	973K		99K</span><br><span class="line">65354070.jpg	973K		206K</span><br><span class="line">24130390.jpg	973K		121K</span><br><span class="line">73753170.jpg	972K		106K</span><br><span class="line">64066680.jpg	972K		92K</span><br><span class="line">72175991.png	972K		49K</span><br><span class="line">53402985.png	972K		114K</span><br><span class="line">70710923.png	971K		63K</span><br><span class="line">76242996.png	971K		63K</span><br><span class="line">65736419.jpg	971K		728K</span><br><span class="line">70095856.png	971K		91K</span><br><span class="line">64284761.png	971K		53K</span><br><span class="line">73907152.jpg	971K		101K</span><br><span class="line">62120962.png	970K		85K</span><br><span class="line">22003560.png	970K		76K</span><br><span class="line">77293789.jpg	970K		116K</span><br><span class="line">68647243.png	970K		46K</span><br><span class="line">54618347.png	970K		59K</span><br><span class="line">79602155.jpg	969K		120K</span><br><span class="line">55491641.jpg	968K		119K</span><br><span class="line">53473372.png	968K		45K</span><br><span class="line">77569729.jpg	968K		69K</span><br><span class="line">57420240.png	968K		61K</span><br><span class="line">69798500.png	968K		74K</span><br><span class="line">63487148.png	968K		47K</span><br><span class="line">79687107.jpg	967K		164K</span><br><span class="line">70081772.jpg	966K		129K</span><br><span class="line">79623240.jpg	966K		133K</span><br><span class="line">72535236.jpg	966K		160K</span><br><span class="line">47680545.png	966K		162K</span><br></pre></td></tr></table></figure>
<h4 id="1MB-4MB"><a href="#1MB-4MB" class="headerlink" title="(1MB,4MB)"></a>(1MB,4MB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">1345.73s user 10.84s system 888% cpu 2:32.64 total</span><br><span class="line"></span><br><span class="line">src		  		dist		num</span><br><span class="line">3.8G			342M		2000</span><br><span class="line"></span><br><span class="line">73839511.png	4.1M		293K</span><br><span class="line">73839511.png	4.1M		293K</span><br><span class="line">66504933.png	4.1M		107K</span><br><span class="line">78316050.png	4.1M		319K</span><br><span class="line">74264931.png	4.1M		330K</span><br><span class="line">74412671.png	4.1M		186K</span><br><span class="line">77414892.png	4.1M		227K</span><br><span class="line">76442741.png	4.0M		191K</span><br><span class="line">71330750.png	4.0M		199K</span><br><span class="line">78361206.png	4.0M		153K</span><br><span class="line">68763693.png	4.0M		233K</span><br><span class="line">67222487.png	4.0M		368K</span><br><span class="line">68560466.png	4.0M		186K</span><br><span class="line">72437850.png	4.0M		282K</span><br><span class="line">67767752.png	4.0M		203K</span><br><span class="line">73597995.png	4.0M		432K</span><br><span class="line">71506633.png	4.0M		88K</span><br><span class="line">77601042.png	4.0M		726K</span><br><span class="line">77033762.png	4.0M		261K</span><br><span class="line">73436647.jpg	4.0M		514K</span><br><span class="line">78099751.png	4.0M		283K</span><br><span class="line">73165937.png	4.0M		202K</span><br><span class="line">74379006.png	4.0M		300K</span><br><span class="line">79274246.png	4.0M		191K</span><br><span class="line">69701132.png	4.0M		129K</span><br><span class="line">67455430.jpg	3.9M		397K</span><br><span class="line">73651880.png	3.9M		183K</span><br><span class="line">79152655.png	3.9M		298K</span><br><span class="line">73117385.png	3.9M		258K</span><br><span class="line">70281950.png	3.9M		314K</span><br><span class="line">68501346.png	3.9M		203K</span><br><span class="line">78895125.png	3.9M		310K</span><br><span class="line">70159814.png	3.9M		156K</span><br><span class="line">70764048.jpg	3.9M		437K</span><br></pre></td></tr></table></figure>
<h4 id="4MB-32MB"><a href="#4MB-32MB" class="headerlink" title="(4MB,32MB)"></a>(4MB,32MB)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">./webp-server -<span class="built_in">jobs</span> 8 -config config.json -prefetch</span><br><span class="line">916.91s user 12.03s system 888% cpu 1:44.53 total</span><br><span class="line"></span><br><span class="line">src				dist		num</span><br><span class="line">3.8G			3.8G		500</span><br><span class="line"></span><br><span class="line">78467499.png	32M		2.8M</span><br><span class="line">79620324.png	32M</span><br><span class="line">74975502.png	32M		3.0M</span><br><span class="line">74902740.png	31M		2.6M</span><br><span class="line">77032574.png	31M		2.5M</span><br><span class="line">77673519.png	30M		2.3M</span><br><span class="line">77298781.png	29M		1.4M</span><br><span class="line">77959551.png	27M		1.5M</span><br><span class="line">69987155.png	26M		649K</span><br><span class="line">74432253.png	25M		1.6M</span><br><span class="line">78994948.png	25M		923K</span><br><span class="line">77218195.png	24M		1.6M</span><br><span class="line">72379562.png	22M		251K</span><br><span class="line">77559996.png	22M		1.9M</span><br><span class="line">71522636.png	22M		1.3M</span><br><span class="line">78236671.png	21M		1.7M</span><br><span class="line">78033540.jpg	20M		2.7M</span><br><span class="line">70906047.png	19M		677K</span><br><span class="line">72498744.png	19M		882K</span><br><span class="line">73977640.png	19M		523K</span><br><span class="line">78757823.png	18M		1.5M</span><br><span class="line">71588979.png	18M		1.2M</span><br><span class="line">75747535.png	17M		1.2M</span><br><span class="line">71504158.png	17M		1.2M</span><br><span class="line">76969768.png	17M		1.4M</span><br><span class="line">77995994.png	17M		568K</span><br><span class="line">75340699.png	17M		1.4M</span><br><span class="line">69821163.png	16M		1.1M</span><br><span class="line">70050613.png	16M		1.1M</span><br><span class="line">76559411.png	15M		1.7M</span><br><span class="line">76576885.png	15M		853K</span><br><span class="line">75640746.png	15M		1.4M</span><br><span class="line">78188732.png	15M		1.4M</span><br><span class="line">73355141.png	15M		589K</span><br><span class="line">75977096.png	15M		1.4M</span><br><span class="line">72840608.jpg	15M		1.8M</span><br><span class="line">75665779.png	14M		1.5M</span><br><span class="line">77898275.png	14M		1.2M</span><br><span class="line">79663534.png	13M		1.2M</span><br><span class="line">76539246.png	13M		1.2M</span><br><span class="line">70598104.png	13M		840K</span><br><span class="line">78348611.jpg	13M		2.7M</span><br></pre></td></tr></table></figure>
<h2 id="å®é™…æ•ˆæœ"><a href="#å®é™…æ•ˆæœ" class="headerlink" title="å®é™…æ•ˆæœ"></a>å®é™…æ•ˆæœ</h2><p>ä¸ºäº†åšä¸ªå¯¹æ¯”ï¼Œå’±ä½¿ç”¨  <code>hexo.502.li</code> è¿™ä¸ªåŸŸåä¸ºå¯¹ç…§ç»„ï¼Œå³è¾“å‡ºæºæ–‡ä»¶ï¼Œä½¿ç”¨ <code>blog.502.li</code> è¿™ä¸ªåŸŸåä¸ºå®éªŒç»„åŠ ä¸Š webp server æ¥æµ‹è¯•ï¼Œå„ä½è¯»è€…ä¹Ÿå¯ä»¥åˆ†åˆ«è®¿é—®è¿™ä¸¤ä¸ªåŸŸåæ¥å®é™…ä½“éªŒä¹‹é—´çš„å·®åˆ«ï¼Œè‚‰çœ¼å¯è§ğŸ˜‚ã€‚</p>
<h3 id="no-webps"><a href="#no-webps" class="headerlink" title="no webps"></a>no webps</h3><p>ä¼˜åŒ–å»ºè®®èƒ½èŠ‚çœ 138s ï¼Œä¹‹å‰ä¹Ÿæœ‰è¯»è€…æ™®éåæ˜ å›¾ç‰‡æ‰“å¼€ææ…¢</p>
<p><img src="https://p.k8s.li/no-webp.png" alt=""></p>
<h3 id="webps-yes"><a href="#webps-yes" class="headerlink" title="webps yes!"></a>webps yes!</h3><p>ä¼˜åŒ–å»ºè®®èƒ½èŠ‚çœ 19s ï¼Œæ¯”ä¸é€‚ç”¨ webp æ•´æ•´å‡å°‘äº†å°†è¿‘ 2 minğŸ˜‚ï¼Œçœ‹æ¥æ•ˆæœåŠå…¶æ˜æ˜¾å‘€ã€‚</p>
<p><img src="https://p.k8s.li/with-webp.png" alt=""></p>
<p>é€‰æ‹©ä¸¤ç¯‡å›¾ç‰‡æ¯”è¾ƒå¤šçš„åšå®¢ï¼Œæµ‹è¯•é“¾æ¥ä¸º ï¼š</p>
<ul>
<li><code>https://blog.k8s.li/2020-Lunar-New-Year.html</code></li>
<li><code>https://blog.k8s.li/wd-hc310-dc-hdd.html</code></li>
<li><code>https://hexo.502.li/2020-Lunar-New-Year.html</code></li>
<li><code>https://hexo.502.li/wd-hc310-dc-hdd.html</code></li>
</ul>
<h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul>
<li><a href="https://nova.moe/re-introduce-webp-server/" target="_blank" rel="noopener">è®©ç«™ç‚¹å›¾ç‰‡åŠ è½½é€Ÿåº¦æ›´å¿«â€”â€”å¼•å…¥ WebP Server æ— ç¼è½¬æ¢å›¾ç‰‡ä¸º WebP</a></li>
<li><a href="https://await.moe/2020/02/note-about-encountered-memory-changes-for-no-reason-in-golang/" target="_blank" rel="noopener">è®° Golang ä¸‹é‡åˆ°çš„ä¸€å›ã€Œæ¯«æ— ç”±å¤´ã€çš„å†…å­˜æ›´æ”¹</a></li>
<li><a href="https://await.moe/2020/02/webp-server-in-rust/" target="_blank" rel="noopener">WebP Server in Rust</a></li>
<li><a href="https://www.bennythink.com/flying-webp.html" target="_blank" rel="noopener">ä¸ªäººç½‘ç«™æ— ç¼åˆ‡æ¢å›¾ç‰‡åˆ° webp</a></li>
<li><a href="https://halo.run/archives/halo-and-webp" target="_blank" rel="noopener">ä¼˜é›…çš„è®© Halo æ”¯æŒ webp å›¾ç‰‡è¾“å‡º</a></li>
<li><a href="https://vince.xin/2018/09/12/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8webp%E6%9D%A5%E4%BC%98%E5%8C%96%E4%BD%A0%E7%9A%84%E5%9B%BE%E7%89%87/" target="_blank" rel="noopener">å‰ç«¯æ€§èƒ½ä¼˜åŒ–â€”â€”ä½¿ç”¨webpæ¥ä¼˜åŒ–ä½ çš„å›¾ç‰‡xx</a></li>
<li><a href="https://aotu.io/notes/2016/06/23/explore-something-of-webp/index.html" target="_blank" rel="noopener">æ¢ç©¶WebPä¸€äº›äº‹å„¿</a></li>
<li><a href="https://developers.google.com/speed/webp" target="_blank" rel="noopener">A new image format for the Web</a></li>
</ul>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag"><i class="fa fa-tag"></i> åšå®¢</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/linux-net-and-iptables.html" rel="prev" title="Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†">
      <i class="fa fa-chevron-left"></i> Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†
    </a></div>
      <div class="post-nav-item">
    <a href="/N1-openwrt.html" rel="next" title="N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s">
      N1 ç›’å­åˆ·å…¥ OpenWrt å¹¶éƒ¨ç½² K3s <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
  </div>
          </div>
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#åŠé€€ä¸‰è¿ğŸ˜‚"><span class="nav-number">1.</span> <span class="nav-text">åŠé€€ä¸‰è¿ğŸ˜‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebP"><span class="nav-number">2.</span> <span class="nav-text">WebP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ”¯æŒæƒ…å†µ"><span class="nav-number">2.1.</span> <span class="nav-text">æ”¯æŒæƒ…å†µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webp-sh"><span class="nav-number">3.</span> <span class="nav-text">webp-sh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é£Ÿç”¨æŒ‡å—"><span class="nav-number">4.</span> <span class="nav-text">é£Ÿç”¨æŒ‡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ä¸‹è½½"><span class="nav-number">4.1.</span> <span class="nav-text">1. ä¸‹è½½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-é…ç½®"><span class="nav-number">4.2.</span> <span class="nav-text">2. é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-å¯åŠ¨"><span class="nav-number">4.3.</span> <span class="nav-text">3.å¯åŠ¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-é¢„åŠ è½½"><span class="nav-number">4.4.</span> <span class="nav-text">4.é¢„åŠ è½½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#benchmark"><span class="nav-number">5.</span> <span class="nav-text">benchmark</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æµ‹è¯•ç»“æœ"><span class="nav-number">5.1.</span> <span class="nav-text">æµ‹è¯•ç»“æœ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è½¬æ¢å‰åå¤§å°å¯¹æ¯”"><span class="nav-number">5.2.</span> <span class="nav-text">è½¬æ¢å‰åå¤§å°å¯¹æ¯”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®é™…æ•ˆæœ"><span class="nav-number">6.</span> <span class="nav-text">å®é™…æ•ˆæœ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#no-webps"><span class="nav-number">6.1.</span> <span class="nav-text">no webps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webps-yes"><span class="nav-number">6.2.</span> <span class="nav-text">webps yes!</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¨èé˜…è¯»"><span class="nav-number">7.</span> <span class="nav-text">æ¨èé˜…è¯»</span></a></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="æœ¨å­"
      src="https://blog.k8s.li/avatar.png">
  <p class="site-author-name" itemprop="name">æœ¨å­</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail â†’ mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://kindle.502.li/" title="Kindle â†’ https:&#x2F;&#x2F;kindle.502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tg.k8s.li/" title="Channel â†’ https:&#x2F;&#x2F;tg.k8s.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Channel</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æœ¨å­</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">39:50</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
      </div>
    </footer>
  </div>
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.k8s.li/oh-my-webpsh.html",
            identifier: "oh-my-webpsh.html",
            title: "è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://muzi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>
</body>
</html>
