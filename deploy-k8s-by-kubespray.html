<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.2.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å…¬å¸ PaaS å¹³å°åº•å±‚çš„ kubernetes é›†ç¾¤éƒ¨ç½²é‡‡ç”¨çš„å¼€æºçš„ kubesprayï¼Œæ­£å¥½æˆ‘åœ¨å‚ä¸ kubespray äºŒå¼€å·¥ä½œã€‚åœ¨è¿™æ®µæ—¶ä¸»è¦å®Œæˆäº† kubespray è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ã€ç§æœ‰åŒ–éƒ¨ç½²ã€å¢åŠ è‡ªç ” CNI éƒ¨ç½²ã€ä»¥åŠä¸€äº› bugfix ç­‰ã€‚æœ€è¿‘æŠ½ç©ºæ•´ç†å¹¶æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ kubespray åœ¨æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤è¸©çš„ä¸€äº›å‘ã€‚ å‡†å¤‡åŠé€€ä¸‰è¿ ğŸ˜‚ï¼š  éœ€è¦ä¸€">
<meta property="og:type" content="blog">
<meta property="og:title" content="ä½¿ç”¨ Kubespray æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤">
<meta property="og:url" content="https://blog.k8s.li/deploy-k8s-by-kubespray.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="å…¬å¸ PaaS å¹³å°åº•å±‚çš„ kubernetes é›†ç¾¤éƒ¨ç½²é‡‡ç”¨çš„å¼€æºçš„ kubesprayï¼Œæ­£å¥½æˆ‘åœ¨å‚ä¸ kubespray äºŒå¼€å·¥ä½œã€‚åœ¨è¿™æ®µæ—¶ä¸»è¦å®Œæˆäº† kubespray è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ã€ç§æœ‰åŒ–éƒ¨ç½²ã€å¢åŠ è‡ªç ” CNI éƒ¨ç½²ã€ä»¥åŠä¸€äº› bugfix ç­‰ã€‚æœ€è¿‘æŠ½ç©ºæ•´ç†å¹¶æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ kubespray åœ¨æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤è¸©çš„ä¸€äº›å‘ã€‚ å‡†å¤‡åŠé€€ä¸‰è¿ ğŸ˜‚ï¼š  éœ€è¦ä¸€">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-04-28T16:00:00.000Z">
<meta property="article:modified_time" content="2021-04-28T16:00:00.000Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="kubespray">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.k8s.li/deploy-k8s-by-kubespray.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/deploy-k8s-by-kubespray.html","path":"deploy-k8s-by-kubespray.html","title":"ä½¿ç”¨ Kubespray æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä½¿ç”¨ Kubespray æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤ | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">å‡†å¤‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%9F%E5%90%8D-SSL-%E8%AF%81%E4%B9%A6%E5%88%B6%E4%BD%9C"><span class="nav-number">1.1.</span> <span class="nav-text">åŸŸå SSL è¯ä¹¦åˆ¶ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="nav-number">1.2.</span> <span class="nav-text">æ­å»ºé•œåƒä»“åº“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.3.</span> <span class="nav-text">æ–‡ä»¶æœåŠ¡å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-skopeo"><span class="nav-number">1.4.</span> <span class="nav-text">ç¼–è¯‘å®‰è£… skopeo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%83%A8%E7%BD%B2%E9%9C%80%E8%A6%81%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="nav-number">1.5.</span> <span class="nav-text">è·å–éƒ¨ç½²éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%83%A8%E7%BD%B2%E9%9C%80%E8%A6%81%E7%9A%84%E9%95%9C%E5%83%8F"><span class="nav-number">1.6.</span> <span class="nav-text">è·å–éƒ¨ç½²éœ€è¦çš„é•œåƒ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#inventory"><span class="nav-number">2.1.</span> <span class="nav-text">inventory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vars"><span class="nav-number">2.2.</span> <span class="nav-text">vars</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-ce-mirrors"><span class="nav-number">2.3.</span> <span class="nav-text">docker-ce mirrors</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">3.</span> <span class="nav-text">éƒ¨ç½²</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%90%E6%A7%BD"><span class="nav-number">4.</span> <span class="nav-text">åæ§½</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">115</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">147</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail â†’ mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/deploy-k8s-by-kubespray.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ä½¿ç”¨ Kubespray æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤ | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä½¿ç”¨ Kubespray æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-29 2021-04-29T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2021-04-29T00:00:00+08:00">2021-04-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/deploy-k8s-by-kubespray.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="deploy-k8s-by-kubespray.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>23k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>21 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>å…¬å¸ PaaS å¹³å°åº•å±‚çš„ kubernetes é›†ç¾¤éƒ¨ç½²é‡‡ç”¨çš„å¼€æºçš„ kubesprayï¼Œæ­£å¥½æˆ‘åœ¨å‚ä¸ kubespray äºŒå¼€å·¥ä½œã€‚åœ¨è¿™æ®µæ—¶ä¸»è¦å®Œæˆäº† kubespray è‡ªåŠ¨åŒ–æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ã€ç§æœ‰åŒ–éƒ¨ç½²ã€å¢åŠ è‡ªç ” CNI éƒ¨ç½²ã€ä»¥åŠä¸€äº› bugfix ç­‰ã€‚æœ€è¿‘æŠ½ç©ºæ•´ç†å¹¶æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ kubespray åœ¨æœ¬åœ°å¼€å‘æµ‹è¯•éƒ¨ç½² kubernetes é›†ç¾¤è¸©çš„ä¸€äº›å‘ã€‚</p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>åŠé€€ä¸‰è¿ ğŸ˜‚ï¼š</p>
<ul>
<li>éœ€è¦ä¸€ä¸ªéƒ¨ç½²é•œåƒä»“åº“å’Œ nginx</li>
<li>éœ€è¦ä¸€ä¸ªåŸŸåï¼Œæœ€å¥½å·²ç»è®¾ç½®å¥½ DNS è§£æå’Œ SSL è¯ä¹¦</li>
<li>é›†ç¾¤èŠ‚ç‚¹éœ€è¦è‡³å°‘ä¸¤å°æœºå™¨ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®å¤–ç½‘</li>
</ul>
<p>è™½ç„¶æ‰‹å¤´é‡Œæœ‰ä¸€å¤§æ‰¹å¼€å‘æœºå™¨ï¼Œä½†ç”±äºæˆ‘çš„åŸŸå <code>k8s.li</code> æ¯”è¾ƒç‰¹æ®Šï¼Œå›½å†…å¾ˆéš¾è¿›è¡Œå¤‡æ¡ˆï¼ˆä¹Ÿä¸æƒ³å¤‡æ¡ˆï¼‰ï¼Œæ‰€ä»¥æ— æ³•å°† DNS è§£æåˆ°è¿™äº›å›½å†…çš„æœåŠ¡å™¨ä¸Šã€‚å› æ­¤æˆ‘æ‰“ç®—å°†åŸŸåè§£æåˆ°ä¸€å°å›½å¤–çš„æœåŠ¡å™¨ä¸Šï¼Œç„¶åå†ä½¿ç”¨ nginx rewrite é‡å†™å°†è¯·æ±‚è½¬å‘åˆ°é˜¿é‡Œäº‘çš„ OSS ï¼›å¦å¤– docker registry çš„åç«¯å­˜å‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨é˜¿é‡Œäº‘ OSSï¼Œè¿™æ ·å®¢æˆ·ç«¯åœ¨æ‹‰å–é•œåƒçš„æ—¶å€™ï¼Œåªä¼šé€šè¿‡æˆ‘çš„åŸŸåè·å–é•œåƒçš„ manifest æ–‡ä»¶ï¼Œé•œåƒçš„ blobs æ•°æ®å°†ä¼šè½¬å‘åˆ°é˜¿é‡Œäº‘ OSSã€‚åœ¨é›†ç¾¤éƒ¨ç½²çš„æ—¶å€™ï¼Œä¸‹è½½æ–‡ä»¶å’Œé•œåƒæœ€ä¸»è¦çš„æµé‡éƒ½ä¼šé€šè¿‡é˜¿é‡Œäº‘ OSSï¼Œè¿™æ ·å¯ä»¥èŠ‚çœé›†ç¾¤éƒ¨ç½²è€—æ—¶ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡ï¼ŒåŒæ—¶åˆèƒ½å‰©ä¸‹ä¸€ç¬”æœåŠ¡å™¨çš„æµé‡è´¹ç”¨ã€‚</p>
<h3 id="åŸŸå-SSL-è¯ä¹¦åˆ¶ä½œ"><a href="#åŸŸå-SSL-è¯ä¹¦åˆ¶ä½œ" class="headerlink" title="åŸŸå SSL è¯ä¹¦åˆ¶ä½œ"></a>åŸŸå SSL è¯ä¹¦åˆ¶ä½œ</h3><p>åŸŸå SSL è¯ä¹¦ä¸»è¦æ˜¯ç»™é•œåƒä»“åº“ä½¿ç”¨çš„ï¼Œå‡å¦‚è¯ä¹¦æ˜¯è‡ªç­¾çš„æˆ–è€…é•œåƒä»“åº“ä½¿ç”¨çš„æ˜¯ HTTP åè®®ï¼Œè¿™æ ·ä¼šå¯¼è‡´ docker æˆ–è€… containerd æ— æ³•æ‹‰å–é•œåƒï¼Œéœ€è¦ä¸ºé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹é…ç½® <code>insecure-registries</code>  è¿™ä¸ªå‚æ•°ã€‚æèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤è¿˜æ˜¯æ¨èç»™é•œåƒä»“åº“åŠ ä¸€ä¸ªéè‡ªç­¾çš„ SSL è¯ä¹¦ï¼Œè¿™æ ·èƒ½å‡å°‘ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ã€‚å¦‚æœæœ‰ç°æˆçš„é•œåƒä»“åº“å¹¶ä¸”é…ç½®å¥½äº† SSL è¯ä¹¦ï¼Œå¯ä»¥ç•¥è¿‡æ­¤æ­¥ã€‚</p>
<p>åˆ¶ä½œåŸŸåè¯ä¹¦çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¸ªäººæ¯”è¾ƒæ¨èä½¿ç”¨ acme.sh ã€‚å®ƒå®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ï¼Œå¹¶ä¸”æ”¯æŒæ”¯æŒæ•°åç§åŸŸåè§£æå•†ã€‚ç”±äºæˆ‘çš„åŸŸåæ˜¯æ‰˜ç®¡åœ¨ cloudflare ä¸Šçš„ï¼Œä½¿ç”¨ acme.sh æ¥ç­¾å‘è¯ä¹¦ç‰¹åˆ«æ–¹ä¾¿ï¼Œåªéœ€è¦é…ç½®ä¸¤ä¸ªå‚æ•°å³å¯ã€‚ä¸‹é¢å°±ç»™ k8s.li è¿™ä¸ªåŸŸåç­¾å‘ä¸€ä¸ªæ³›åŸŸåè¯ä¹¦ã€‚</p>
<ul>
<li>å®‰è£…  acme.sh</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span class="token function">sh</span>
~/.acme.sh/acme.sh --help<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>ç­¾å‘è¯ä¹¦</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">CF_Email</span><span class="token operator">=</span><span class="token string">"muzi502.li@gmail.com"</span> <span class="token comment"># cloudflare è´¦æˆ·çš„é‚®ç®±</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CF_Key</span><span class="token operator">=</span><span class="token string">"xxxxxx"</span> <span class="token comment"># "cloudflareä¸­æŸ¥çœ‹ä½ çš„key"</span>

~/.acme.sh/acme.sh --issue --dns dns_cf -d k8s.li -d *.k8s.li

<span class="token punctuation">[</span>Tue Apr <span class="token number">27</span> 07:32:52 UTC <span class="token number">2021</span><span class="token punctuation">]</span> Cert success.
<span class="token punctuation">[</span>Tue Apr <span class="token number">27</span> 07:32:52 UTC <span class="token number">2021</span><span class="token punctuation">]</span> Your cert is <span class="token keyword">in</span>  /root/.acme.sh/k8s.li/k8s.li.cer
<span class="token punctuation">[</span>Tue Apr <span class="token number">27</span> 07:32:52 UTC <span class="token number">2021</span><span class="token punctuation">]</span> Your cert key is <span class="token keyword">in</span>  /root/.acme.sh/k8s.li/k8s.li.key
<span class="token punctuation">[</span>Tue Apr <span class="token number">27</span> 07:32:52 UTC <span class="token number">2021</span><span class="token punctuation">]</span> The intermediate CA cert is <span class="token keyword">in</span>  /root/.acme.sh/k8s.li/ca.cer
<span class="token punctuation">[</span>Tue Apr <span class="token number">27</span> 07:32:52 UTC <span class="token number">2021</span><span class="token punctuation">]</span> And the full chain certs is there:  /root/.acme.sh/k8s.li/fullchain.cer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>å‰é¢è¯ä¹¦ç”Ÿæˆä»¥åï¼Œæ¥ä¸‹æ¥éœ€è¦æŠŠè¯ä¹¦ copy åˆ°çœŸæ­£éœ€è¦ç”¨å®ƒçš„åœ°æ–¹ã€‚</p>
<p>æ³¨æ„ï¼Œé»˜è®¤ç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨å®‰è£…ç›®å½•ä¸‹ <code>~/.acme.sh/</code>ï¼Œ è¯·ä¸è¦ç›´æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚: ä¸è¦ç›´æ¥è®© <code>nginx/apache</code> çš„é…ç½®æ–‡ä»¶ä½¿ç”¨è¿™ä¸‹é¢çš„æ–‡ä»¶ã€‚è¿™é‡Œé¢çš„æ–‡ä»¶éƒ½æ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œè€Œä¸”ç›®å½•ç»“æ„å¯èƒ½ä¼šå˜åŒ–ã€‚</p>
<p>æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨ <code>--installcert</code> å‘½ä»¤ï¼Œå¹¶æŒ‡å®šç›®æ ‡ä½ç½®ï¼Œç„¶åè¯ä¹¦æ–‡ä»¶ä¼šè¢« copy åˆ°ç›¸åº”çš„ä½ç½®</p>
</blockquote>
<ul>
<li>å®‰è£…è¯ä¹¦</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">acme.sh --install-cert -d k8s.li <span class="token punctuation">\</span>
--cert-file      /etc/nginx/ssl/k8s.li.cer  <span class="token punctuation">\</span>
--key-file       /etc/nginx/ssl/k8s.li.key  <span class="token punctuation">\</span>
--fullchain-file /etc/nginx/ssl/fullchain.cer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æ­å»ºé•œåƒä»“åº“"><a href="#æ­å»ºé•œåƒä»“åº“" class="headerlink" title="æ­å»ºé•œåƒä»“åº“"></a>æ­å»ºé•œåƒä»“åº“</h3><ul>
<li>config.yml</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">0.1</span>
<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">fields</span><span class="token punctuation">:</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span> registry
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">blobdescriptor</span><span class="token punctuation">:</span> inmemory
  <span class="token key atrule">oss</span><span class="token punctuation">:</span>
    <span class="token key atrule">accesskeyid</span><span class="token punctuation">:</span> xxxx <span class="token comment"># è¿™é‡Œé…ç½®é˜¿é‡Œäº‘ OSS çš„ accesskeyid</span>
    <span class="token key atrule">accesskeysecret</span><span class="token punctuation">:</span> xxxx <span class="token comment"># è¿™é‡Œé…ç½®é˜¿é‡Œäº‘ OSS çš„ accesskeysecret</span>
    <span class="token key atrule">region</span><span class="token punctuation">:</span> oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>beijing <span class="token comment"># é…ç½® OSS bucket çš„åŒºåŸŸï¼Œæ¯”å¦‚ oss-cn-beijing</span>
    <span class="token key atrule">internal</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">bucket</span><span class="token punctuation">:</span> fileserver <span class="token comment"># é…ç½®å­˜å‚¨ bucket çš„åç§°</span>
    <span class="token key atrule">rootdirectory</span><span class="token punctuation">:</span> /kubespray/registry <span class="token comment"># é…ç½®è·¯å¾„</span>
  <span class="token key atrule">delete</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http</span><span class="token punctuation">:</span>
  <span class="token key atrule">addr</span><span class="token punctuation">:</span> 0.0.0.0<span class="token punctuation">:</span><span class="token number">5000</span>
  <span class="token key atrule">headers</span><span class="token punctuation">:</span>
    <span class="token key atrule">X-Content-Type-Options</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>nosniff<span class="token punctuation">]</span>
<span class="token key atrule">health</span><span class="token punctuation">:</span>
  <span class="token key atrule">storagedriver</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">interval</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>docker-compose</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">hub-registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry<span class="token punctuation">:</span>2.7.1
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> hub<span class="token punctuation">-</span>registry
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config.yml<span class="token punctuation">:</span>/etc/docker/registry/config.yml
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span>5000<span class="token punctuation">:</span><span class="token number">5000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>nginx.conf</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">listen</span>       [::]:443</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  hub.k8s.li</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/ssl/fullchain.cer</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/ssl/k8s.li.key</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_static</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">4096m</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_method</span> !~* GET)</span> <span class="token punctuation">&#123;</span>
         <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span>   http://localhost:5000</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æ–‡ä»¶æœåŠ¡å™¨"><a href="#æ–‡ä»¶æœåŠ¡å™¨" class="headerlink" title="æ–‡ä»¶æœåŠ¡å™¨"></a>æ–‡ä»¶æœåŠ¡å™¨</h3><p>æ–‡ä»¶æœåŠ¡å™¨ç”¨äºå­˜æ”¾ä¸€äº› kubeadmã€kubectlã€kubelet ç­‰äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œkubespray é»˜è®¤çš„ä¸‹è½½åœ°å€åœ¨å›½å†…è®¿é—®ç‰¹åˆ«æ…¢ï¼Œå› æ­¤éœ€è¦æ­å»ºä¸€ä¸ª http&#x2F;https æœåŠ¡å™¨ï¼Œç”¨äºç»™é›†ç¾¤éƒ¨ç½²ä¸‹è½½è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ã€‚</p>
<ul>
<li>nginx.conf</li>
</ul>
<p>éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œçš„ nginx é…ç½®ä½¿ç”¨çš„æ˜¯ rewrite è€Œä¸æ˜¯ proxy_passï¼Œè¿™æ ·å®¢æˆ·ç«¯åœ¨æƒ³æˆ‘çš„æœåŠ¡å™¨è¯·æ±‚æ–‡ä»¶æ—¶ï¼Œä¼šé‡å†™å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè®©å®¢æˆ·ç«¯å»è¯·æ±‚é˜¿é‡Œäº‘ OSS çš„åœ°å€ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">listen</span> [::]:443</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>   dl.k8s.li</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/ssl/fullchain.cer</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/ssl/k8s.li.key</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ https://fileserver.oss-cn-beijing.aliyuncs.com/kubespray/files/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> Content-Disposition</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> x-oss-request-id</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> x-oss-object-type</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> x-oss-hash-crc64ecma</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> x-oss-storage-class</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> x-oss-force-download</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_hide_header</span> x-oss-server-time</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ç¼–è¯‘å®‰è£…-skopeo"><a href="#ç¼–è¯‘å®‰è£…-skopeo" class="headerlink" title="ç¼–è¯‘å®‰è£… skopeo"></a>ç¼–è¯‘å®‰è£… skopeo</h3><p>å®‰è£… skopeo ç”¨æ¥åŒæ­¥ä¸€äº›ä½¿ç”¨çš„é•œåƒåˆ°ç§æœ‰é•œåƒä»“åº“ï¼Œæ€§èƒ½ä¸Šæ¯” docker å¿«å¾ˆå¤šï¼Œå¼ºçƒˆæ¨èã€‚skopeo çš„å®‰è£…æ–¹å¼å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://github.com/containers/skopeo/blob/master/install.md">Installing from packages</a> ã€‚ä¸è¿‡ä¸ªäººè¿˜æ˜¯ä½¿ç”¨ go buid ç¼–è¯‘ä¸€ä¸ªé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™æ ·åœ¨ Linux å‘è¡Œç‰ˆéƒ½å¯ä»¥ä½¿ç”¨ã€‚ä¸ç„¶åœ¨ Debian ä¸Šç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶æ— æ³•æ‹¿åˆ° CentOS ä¸Šä½¿ç”¨ï¼Œå› ä¸ºäºŒè€…ä½¿ç”¨çš„åŠ¨æ€é“¾æ¥åº“ä¸ä¸€æ ·ï¼</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/root/skopeo git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># git clone https://github.com/containers/skopeo &amp;&amp; cd skopeo</span>

<span class="token comment"># æœ¬åœ°å¼€å‘æœºå™¨å·²ç»å®‰è£…å¹¶é…ç½®å¥½äº† golang ç¼–è¯‘ç¯å¢ƒ</span>
root@debian:/root/skopeo git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># CGO_ENABLE=0 GO111MODULE=on go build -mod=vendor "-buildmode=pie" -ldflags '-extldflags "-static"' -gcflags "" -tags "exclude_graphdriver_devicemapper exclude_graphdriver_btrfs containers_image_openpgp" -o bin/skopeo ./cmd/skopeo</span>

root@debian:/root/skopeo git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># ldd bin/skopeo</span>
not a dynamic executable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è·å–éƒ¨ç½²éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#è·å–éƒ¨ç½²éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="è·å–éƒ¨ç½²éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶"></a>è·å–éƒ¨ç½²éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶</h3><p>kubespray éƒ¨ç½²çš„æ—¶å€™éœ€è¦åˆ° github.com æˆ– storage.googleapis.com ä¸‹è½½ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™äº›åœ°å€åœ¨å›½å†…éƒ½éƒ½è¢«é˜»æ–­äº†ï¼Œå› æ­¤éœ€è¦å°†éƒ¨ç½²æ—¶ä¾èµ–çš„æ–‡ä»¶ä¸Šä¼ åˆ°è‡ªå·±çš„æ–‡ä»¶æœåŠ¡å™¨ä¸Šã€‚è‡ªå·±å†™äº†ä¸ªè„šæœ¬ç”¨äºè·å– kubespray éƒ¨ç½²éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨ kubespray repo çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ,ä¸‹è½½çš„æ–‡ä»¶é»˜è®¤ä¼šå­˜æ”¾åœ¨ <code>temp/files</code> ç›®å½•ä¸‹ã€‚ä¸‹è½½å®Œæˆä¹‹åå°†è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ä¸Šä¼ åˆ°è‡ªå·±çš„æ–‡ä»¶æœåŠ¡å™¨ä¸Šã€‚åé¢é…ç½®ä¸€äº›å‚æ•°åœ¨è¿™ä¸ªåœ°å€çš„å‚æ•°å‰é¢åŠ ä¸Šè‡ªå·±æ–‡ä»¶æœåŠ¡å™¨çš„ URL å³å¯ã€‚</p>
<ul>
<li>é¦–å…ˆ clone repo åˆ°æœ¬åœ°</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/root<span class="token comment"># git clone https://github.com/kubernetes-sigs/kubespray &amp;&amp; cd kubespray</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>å°†è¯¥è„šæœ¬ <code>generate_list.sh</code> ä¿å­˜åˆ° repo æ ¹ç›®å½•ä¸‹ï¼Œå¹¶æ‰§è¡Œè¯¥è„šä¸‹è½½éœ€è¦çš„æ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>ps: ç”¨ shell è„šæœ¬å»å¤„ç† Jinja2 çš„ yamlï¼Œ å†™ sed å†™å¾—æˆ‘æƒ³å ğŸ¤®</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> -eo pipefail

<span class="token assign-left variable">CURRENT_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> <span class="token punctuation">$(</span>dirname $0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
<span class="token assign-left variable">TEMP_DIR</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;CURRENT_DIR&#125;</span>/temp"</span>
<span class="token assign-left variable">REPO_ROOT_DIR</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;CURRENT_DIR&#125;</span>"</span>

<span class="token builtin class-name">:</span> <span class="token variable">$&#123;IMAGE_ARCH<span class="token operator">:=</span>"amd64"&#125;</span>
<span class="token builtin class-name">:</span> <span class="token variable">$&#123;ANSIBLE_SYSTEM<span class="token operator">:=</span>"linux"&#125;</span>
<span class="token builtin class-name">:</span> <span class="token variable">$&#123;ANSIBLE_ARCHITECTURE<span class="token operator">:=</span>"x86_64"&#125;</span>
<span class="token builtin class-name">:</span> <span class="token variable">$&#123;DOWNLOAD_YML<span class="token operator">:=</span>"roles<span class="token operator">/</span>download<span class="token operator">/</span>defaults<span class="token operator">/</span>main.yml"&#125;</span>
<span class="token builtin class-name">:</span> <span class="token variable">$&#123;KUBE_VERSION_YAML<span class="token operator">:=</span>"roles<span class="token operator">/</span>kubespray-defaults<span class="token operator">/</span>defaults<span class="token operator">/</span>main.yaml"&#125;</span>

<span class="token function">mkdir</span> -p <span class="token variable">$&#123;TEMP_DIR&#125;</span>
<span class="token function-name function">generate_versions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># ARCH used in convert &#123;%- if image_arch != 'amd64' -%&#125;-&#123;&#123; image_arch &#125;&#125;&#123;%- endif -%&#125; to &#123;&#123;arch&#125;&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$&#123;IMAGE_ARCH&#125;</span>"</span> <span class="token operator">!=</span> <span class="token string">"amd64"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;IMAGE_ARCH&#125;</span>"</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>

    <span class="token function">cat</span> <span class="token operator">></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
arch=<span class="token variable">$&#123;ARCH&#125;</span>
image_arch=<span class="token variable">$&#123;IMAGE_ARCH&#125;</span>
ansible_system=<span class="token variable">$&#123;ANSIBLE_SYSTEM&#125;</span>
ansible_architecture=<span class="token variable">$&#123;ANSIBLE_ARCHITECTURE&#125;</span>
EOF</span>
    <span class="token function">grep</span> <span class="token string">'kube_version:'</span> <span class="token variable">$&#123;REPO_ROOT_DIR&#125;</span>/<span class="token variable">$&#123;KUBE_VERSION_YAML&#125;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/: /=/g'</span> <span class="token operator">>></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh
    <span class="token function">grep</span> <span class="token string">'_version:'</span> <span class="token variable">$&#123;REPO_ROOT_DIR&#125;</span>/<span class="token variable">$&#123;DOWNLOAD_YML&#125;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/: /=/g;s/&#123;&#123;/$&#123;/g;s/&#125;&#125;/&#125;/g'</span> <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">' '</span> <span class="token operator">>></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh
    <span class="token function">sed</span> -i <span class="token string">'s/kube_major_version=.*/kube_major_version=$&#123;kube_version%.*&#125;/g'</span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh
    <span class="token function">sed</span> -i <span class="token string">'s/crictl_version=.*/crictl_version=$&#123;kube_version%.*&#125;.0/g'</span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh
<span class="token punctuation">&#125;</span>

<span class="token function-name function">generate_files_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"source <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh"</span> <span class="token operator">></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/files.sh
    <span class="token function">grep</span> <span class="token string">'download_url:'</span> <span class="token variable">$&#123;REPO_ROOT_DIR&#125;</span>/<span class="token variable">$&#123;DOWNLOAD_YML&#125;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/: /=/g;s/ //g;s/&#123;&#123;/$&#123;/g;s/&#125;&#125;/&#125;/g;s/|lower//g;s/^.*_url=/echo /g'</span> <span class="token operator">>></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/files.sh
    <span class="token function">bash</span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/files.sh <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/files.list
<span class="token punctuation">&#125;</span>

<span class="token function-name function">generate_images_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token assign-left variable">KUBE_IMAGES</span><span class="token operator">=</span><span class="token string">"kube-apiserver kube-controller-manager kube-scheduler kube-proxy"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"source <span class="token variable">$&#123;TEMP_DIR&#125;</span>/version.sh"</span> <span class="token operator">></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/images.sh
    <span class="token function">grep</span> -E <span class="token string">'_repo:|_tag:'</span> <span class="token variable">$&#123;REPO_ROOT_DIR&#125;</span>/<span class="token variable">$&#123;DOWNLOAD_YML&#125;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">"s#&#123;%- if image_arch != 'amd64' -%&#125;-&#123;&#123; image_arch &#125;&#125;&#123;%- endif -%&#125;#&#123;&#123;arch&#125;&#125;#g"</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/: /=/g;s/&#123;&#123;/$&#123;/g;s/&#125;&#125;/&#125;/g'</span> <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">' '</span> <span class="token operator">>></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/images.sh
    <span class="token function">sed</span> -n <span class="token string">'/^downloads:/,/download_defaults:/p'</span> <span class="token variable">$&#123;REPO_ROOT_DIR&#125;</span>/<span class="token variable">$&#123;DOWNLOAD_YML&#125;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">"s/repo: //p;s/tag: //p"</span> <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">' '</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/&#123;&#123;/$&#123;/g;s/&#125;&#125;/&#125;/g'</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'N;s#\n# #g'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">' '</span> <span class="token string">':'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/^/echo /g'</span> <span class="token operator">>></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/images.sh
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$&#123;KUBE_IMAGES&#125;</span>"</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">' '</span> <span class="token string">'\n'</span> <span class="token operator">|</span> <span class="token function">xargs</span> -L1 -I <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'echo $&#123;kube_image_repo&#125;/&#123;&#125;:$&#123;kube_version&#125;'</span> <span class="token operator">>></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/images.sh
    <span class="token function">bash</span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/images.sh <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">></span> <span class="token variable">$&#123;TEMP_DIR&#125;</span>/images.list
<span class="token punctuation">&#125;</span>

generate_versions
generate_files_list
generate_images_list
<span class="token function">wget</span> -x -P <span class="token variable">$&#123;TEMP_DIR&#125;</span>/files -i <span class="token variable">$&#123;TEMP_DIR&#125;</span>/files.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€ç»ˆä¸‹è½½çš„ç»“æœå¦‚ä¸‹ï¼ŒåŸºæœ¬ä¸Šä¿æŒäº†åŸæœ‰çš„ URL è·¯å¾„ï¼Œä¹Ÿæ–¹ä¾¿åç»­çš„æ›´æ–°å’Œç‰ˆæœ¬è¿­ä»£ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">temp/files
â”œâ”€â”€ get.helm.sh
â”‚   â””â”€â”€ helm-v3.5.4-linux-amd64.tar.gz
â”œâ”€â”€ github.com
â”‚   â”œâ”€â”€ containerd
â”‚   â”‚   â””â”€â”€ nerdctl
â”‚   â”‚       â””â”€â”€ releases
â”‚   â”‚           â””â”€â”€ download
â”‚   â”‚               â””â”€â”€ v0.8.0
â”‚   â”‚                   â””â”€â”€ nerdctl-0.8.0-linux-amd64.tar.gz
â”‚   â”œâ”€â”€ containernetworking
â”‚   â”‚   â””â”€â”€ plugins
â”‚   â”‚       â””â”€â”€ releases
â”‚   â”‚           â””â”€â”€ download
â”‚   â”‚               â””â”€â”€ v0.9.1
â”‚   â”‚                   â””â”€â”€ cni-plugins-linux-amd64-v0.9.1.tgz
â”‚   â”œâ”€â”€ containers
â”‚   â”‚   â””â”€â”€ crun
â”‚   â”‚       â””â”€â”€ releases
â”‚   â”‚           â””â”€â”€ download
â”‚   â”‚               â””â”€â”€ <span class="token number">0.19</span>
â”‚   â”‚                   â””â”€â”€ crun-0.19-linux-amd64
â”‚   â”œâ”€â”€ coreos
â”‚   â”‚   â””â”€â”€ etcd
â”‚   â”‚       â””â”€â”€ releases
â”‚   â”‚           â””â”€â”€ download
â”‚   â”‚               â””â”€â”€ v3.4.13
â”‚   â”‚                   â””â”€â”€ etcd-v3.4.13-linux-amd64.tar.gz
â”‚   â”œâ”€â”€ kata-containers
â”‚   â”‚   â””â”€â”€ runtime
â”‚   â”‚       â””â”€â”€ releases
â”‚   â”‚           â””â”€â”€ download
â”‚   â”‚               â””â”€â”€ <span class="token number">1.12</span>.1
â”‚   â”‚                   â””â”€â”€ kata-static-1.12.1-x86_64.tar.xz
â”‚   â”œâ”€â”€ kubernetes-sigs
â”‚   â”‚   â””â”€â”€ cri-tools
â”‚   â”‚       â””â”€â”€ releases
â”‚   â”‚           â””â”€â”€ download
â”‚   â”‚               â””â”€â”€ v1.20.0
â”‚   â”‚                   â””â”€â”€ crictl-v1.20.0-linux-amd64.tar.gz
â”‚   â””â”€â”€ projectcalico
â”‚       â”œâ”€â”€ calico
â”‚       â”‚   â””â”€â”€ archive
â”‚       â”‚       â””â”€â”€ v3.17.3.tar.gz
â”‚       â””â”€â”€ calicoctl
â”‚           â””â”€â”€ releases
â”‚               â””â”€â”€ download
â”‚                   â””â”€â”€ v3.17.3
â”‚                       â””â”€â”€ calicoctl-linux-amd64
â””â”€â”€ storage.googleapis.com
    â””â”€â”€ kubernetes-release
        â””â”€â”€ release
            â””â”€â”€ v1.20.6
                â””â”€â”€ bin
                    â””â”€â”€ linux
                        â””â”€â”€ amd64
                            â”œâ”€â”€ kubeadm
                            â”œâ”€â”€ kubectl
                            â””â”€â”€ kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è·å–éƒ¨ç½²éœ€è¦çš„é•œåƒ"><a href="#è·å–éƒ¨ç½²éœ€è¦çš„é•œåƒ" class="headerlink" title="è·å–éƒ¨ç½²éœ€è¦çš„é•œåƒ"></a>è·å–éƒ¨ç½²éœ€è¦çš„é•œåƒ</h3><p>å¯¹äºç¦»çº¿éƒ¨ç½²ï¼Œkubespray æ”¯æŒçš„å¹¶ä¸æ˜¯å¾ˆå‹å¥½ã€‚æ¯”å¦‚è·å–éƒ¨ç½²éœ€è¦çš„é•œåƒåˆ—è¡¨ï¼Œç›®å‰çš„æ–¹æ¡ˆæ˜¯éœ€è¦å…ˆéƒ¨ç½²ä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åé€šè¿‡ kubectl get ä¸€äº›èµ„æºæ¥è·å– pod ä½¿ç”¨åˆ°çš„é•œåƒã€‚ä¸ªäººè§‰å¾—è¿™ä¸ªæ–¹å¼å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ï¼Œæ¯”å¦‚é€šè¿‡ kubespray æºç æ¥ç”Ÿæˆä¸€ä¸ªé•œåƒåˆ—è¡¨ã€‚ä¸‹é¢åªæ˜¯ç®€å•ç”Ÿæˆä¸€ä¸ªé•œåƒåˆ—è¡¨ï¼Œå†…å®¹å¦‚ä¸‹</p>
<ul>
<li>images.list</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker.io/nginx:1.19.0
docker.io/calico/cni:v3.17.3
docker.io/calico/node:v3.17.3
docker.io/calico/kube-controllers:v3.17.3
quay.io/coreos/flannel:v0.13.0
quay.io/coreos/flannel:v0.13.0-amd64
k8s.gcr.io/pause:3.2
k8s.gcr.io/coredns:1.7.0
k8s.gcr.io/kube-apiserver:v1.20.6
k8s.gcr.io/kube-controller-manager:v1.20.6
k8s.gcr.io/kube-proxy:v1.20.6
k8s.gcr.io/kube-scheduler:v1.20.6
k8s.gcr.io/dns/k8s-dns-node-cache:1.17.1
k8s.gcr.io/cpa/cluster-proportional-autoscaler-amd64:1.8.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç”±äº master åˆ†æ”¯çš„ä»£ç ä¸€ç›´åœ¨æ›´æ–°ï¼Œå½“å‰çš„ master åˆ†æ”¯çš„ç‰ˆæœ¬å¯èƒ½å’Œè¿™é‡Œçš„ä¸å¤ªä¸€æ ·ï¼Œéœ€è¦ä¿®æ”¹ä¸ºè‡ªå·±éœ€è¦çš„ç‰ˆæœ¬ã€‚</p>
<ul>
<li>æ ¹æ®ä¸Šé¢çš„é•œåƒåˆ—è¡¨ï¼Œä½¿ç”¨ skopeo å°†é•œåƒåŒæ­¥åˆ°è‡ªå·±çš„é•œåƒä»“åº“ä¸­ï¼Œå¦‚æˆ‘çš„ <code>hub.k8s.li</code></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">image</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> images.list<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> skopeo copy docker://<span class="token variable">$&#123;image&#125;</span> docker://hub.k8s.li/<span class="token variable">$&#123;image<span class="token operator">#</span>*<span class="token operator">/</span>&#125;</span><span class="token punctuation">;</span> <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åŒæ­¥åˆ°æˆ‘çš„é•œåƒä»“åº“ä¸­ï¼Œå†…å®¹å°±å¦‚ä¸‹ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™é€šè¿‡ä¿®æ”¹ä¸€äº›é•œåƒä»“åº“çš„åœ°å€å³å¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hub.k8s.li/nginx:1.19.0
hub.k8s.li/calico/cni:v3.17.3
hub.k8s.li/calico/node:v3.17.3
hub.k8s.li/calico/kube-controllers:v3.17.3
hub.k8s.li/coreos/flannel:v0.13.0
hub.k8s.li/coreos/flannel:v0.13.0-amd64
hub.k8s.li/pause:3.2
hub.k8s.li/coredns:1.7.0
hub.k8s.li/kube-apiserver:v1.20.6
hub.k8s.li/kube-controller-manager:v1.20.6
hub.k8s.li/kube-proxy:v1.20.6
hub.k8s.li/kube-scheduler:v1.20.6
hub.k8s.li/dns/k8s-dns-node-cache:1.17.1
hub.k8s.li/cpa/cluster-proportional-autoscaler-amd64:1.8.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è‡³æ­¤å‡†å¤‡å·¥ä½œå¤§è‡´éƒ½å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å¼€å§‹é…ç½® kubespray çš„ä¸€äº›å‚æ•°å’Œ inventory æ–‡ä»¶</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æŒ‰ç…§ kubespray æ–‡æ¡£è¯´æ˜ï¼Œå°† <code>inventory/sample</code> ç›®å½•å¤åˆ¶ä¸€ä»½ï¼Œç„¶åé€šè¿‡ä¿®æ”¹é‡Œé¢çš„å‚æ•°æ¥æ§åˆ¶éƒ¨ç½²ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/root/kubespray git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># cp -rf inventory/sample deploy</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="inventory"><a href="#inventory" class="headerlink" title="inventory"></a>inventory</h3><ul>
<li><code>deploy/inventory</code></li>
</ul>
<p>åˆ›å»ºä¸»æœº inventory æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">all:vars</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">ansible_port</span><span class="token punctuation">=</span><span class="token value attr-value">22</span>
<span class="token key attr-name">ansible_user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>

<span class="token key attr-name">ansible_ssh_private_key_file</span><span class="token punctuation">=</span><span class="token value attr-value">/kubespray/.ssh/id_rsa</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">all</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">kube-control-1 ansible_host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.4.11</span>
<span class="token key attr-name">kube-control-2 ansible_host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.4.12</span>
<span class="token key attr-name">kube-control-3 ansible_host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.4.13</span>
<span class="token key attr-name">kube-node-1 ansible_host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.4.4</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">kube_control_plane</span><span class="token punctuation">]</span></span>
kube-control-1
kube-control-2
kube-control-3

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">etcd</span><span class="token punctuation">]</span></span>
kube-control-1
kube-control-2
kube-control-3

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">kube-node</span><span class="token punctuation">]</span></span>
kube-control-1
kube-control-2
kube-control-3
kube-node-1

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">calico-rr</span><span class="token punctuation">]</span></span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">k8s-cluster:children</span><span class="token punctuation">]</span></span>
kube_control_plane
kube-node
calico-rr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ssh äº’ä¿¡</li>
</ul>
<p>Kubespray ç”¨åˆ°äº† ansible çš„ <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/synchronize_module.html">synchronize</a> æ¨¡å—æ¥åˆ†å‘æ–‡ä»¶ï¼ŒåŸºäº rsync åè®®æ‰€ä»¥å¿…é¡»è¦ä½¿ç”¨ ssh å¯†é’¥å¯¹æ¥è¿æ¥é›†ç¾¤èŠ‚ç‚¹ã€‚inventory é…ç½®çš„æ˜¯ kubespray å®¹å™¨å†…çš„è·¯å¾„ï¼Œå› æ­¤éœ€è¦å°† ssh å…¬é’¥å’Œç§é’¥å¤åˆ¶åˆ° repo çš„ .ssh ç›®å½•ä¸‹ã€‚å¦‚æœèŠ‚ç‚¹å°±æ²¡æœ‰è¿›è¡Œ ssh å…å¯†ç™»å½•ï¼Œå¯ä»¥ç”¨ ansible çš„ authorized_key æ¨¡å—å°† ssh å…¬é’¥æ·»åŠ åˆ°ä¸»æœºçš„ authorized_key ä¸­ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/root/kubespray git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># mkdir -p .ssh</span>

<span class="token comment"># ç”Ÿæˆ ssh å¯†é’¥å¯¹</span>
root@debian:/root/kubespray git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># ssh-keygen -t rsa -f .ssh/id_rsa -P ""</span>

<span class="token comment"># å°† ssh å…¬é’¥æ·»åŠ åˆ°æ‰€æœ‰ä¸»æœº</span>
root@debian:/root/kubespray git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># ansible -i deploy/inventory all -m authorized_key -a "user=&#123;&#123; ansible_user &#125;&#125; key='&#123;&#123; lookup('file', '&#123;&#123; ssh_cert_path &#125;&#125;') &#125;&#125;'" -e ssh_cert_path=./.ssh/id_rsa.pub -e ansible_ssh_pass=passwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="vars"><a href="#vars" class="headerlink" title="vars"></a>vars</h3><p>åˆ›å»ºå¹¶ä¿®æ”¹ä»¥ä¸‹é…ç½®æ–‡ä»¶</p>
<ul>
<li><code>deploy/env.yml</code></li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token comment"># å®šä¹‰ä¸€äº›ç»„ä»¶çš„ç‰ˆæœ¬</span>
<span class="token key atrule">kube_version</span><span class="token punctuation">:</span> v1.20.6
<span class="token key atrule">calico_version</span><span class="token punctuation">:</span> <span class="token string">"v3.17.3"</span>
<span class="token key atrule">pod_infra_version</span><span class="token punctuation">:</span> <span class="token string">"3.2"</span>
<span class="token key atrule">nginx_image_version</span><span class="token punctuation">:</span> <span class="token string">"1.19"</span>
<span class="token key atrule">coredns_version</span><span class="token punctuation">:</span> <span class="token string">"1.7.0"</span>
<span class="token key atrule">image_arch</span><span class="token punctuation">:</span> <span class="token string">"amd64"</span>

<span class="token comment"># docker registry domain</span>
<span class="token key atrule">registry_domain</span><span class="token punctuation">:</span> <span class="token string">"hub.k8s.li"</span>

<span class="token comment"># file download server url</span>
<span class="token key atrule">download_url</span><span class="token punctuation">:</span> <span class="token string">"https://dl.k8s.li"</span>

<span class="token comment"># docker-ce-repo mirrors</span>
<span class="token key atrule">docker_mirrors_url</span><span class="token punctuation">:</span> <span class="token string">"https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux"</span>

<span class="token key atrule">container_manager</span><span class="token punctuation">:</span> <span class="token string">"containerd"</span>

<span class="token comment"># ç”±äºä½¿ç”¨çš„æ˜¯ containerd ä½œä¸º CRIï¼Œç›®å‰ etcd ä¸æ”¯æŒ containerd å®¹å™¨åŒ–éƒ¨ç½²å› æ­¤éœ€è¦å°†è¯¥å‚æ•°ä¿®æ”¹ä¸º host ï¼Œä½¿ç”¨ systemd æ¥éƒ¨ç½²</span>
<span class="token key atrule">etcd_deployment_type</span><span class="token punctuation">:</span> host
<span class="token key atrule">etcd_cluster_setup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">etcd_events_cluster_setup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">etcd_events_cluster_enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># kubernetes CNI type é…ç½®é›†ç¾¤ CNI ä½¿ç”¨çš„ç±»å‹</span>
<span class="token key atrule">kube_network_plugin</span><span class="token punctuation">:</span> canal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>deploy/group_vars/all/download.yml</code></li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">## Container registry define</span>
<span class="token key atrule">gcr_image_repo</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; registry_domain &#125;&#125;"</span>
<span class="token key atrule">kube_image_repo</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; registry_domain &#125;&#125;"</span>
<span class="token key atrule">docker_image_repo</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; registry_domain &#125;&#125;"</span>
<span class="token key atrule">quay_image_repo</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; registry_domain &#125;&#125;"</span>

<span class="token comment"># Download URLs</span>
<span class="token key atrule">kubelet_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/storage.googleapis.com/kubernetes-release/release/&#123;&#123; kube_version &#125;&#125;/bin/linux/&#123;&#123; image_arch &#125;&#125;/kubelet"</span>
<span class="token key atrule">kubectl_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/storage.googleapis.com/kubernetes-release/release/&#123;&#123; kube_version &#125;&#125;/bin/linux/&#123;&#123; image_arch &#125;&#125;/kubectl"</span>
<span class="token key atrule">kubeadm_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/storage.googleapis.com/kubernetes-release/release/&#123;&#123; kubeadm_version &#125;&#125;/bin/linux/&#123;&#123; image_arch &#125;&#125;/kubeadm"</span>
<span class="token key atrule">etcd_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/coreos/etcd/releases/download/&#123;&#123; etcd_version &#125;&#125;/etcd-&#123;&#123; etcd_version &#125;&#125;-linux-&#123;&#123; image_arch &#125;&#125;.tar.gz"</span>
<span class="token key atrule">cni_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/containernetworking/plugins/releases/download/&#123;&#123; cni_version &#125;&#125;/cni-plugins-linux-&#123;&#123; image_arch &#125;&#125;-&#123;&#123; cni_version &#125;&#125;.tgz"</span>
<span class="token key atrule">calicoctl_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/projectcalico/calicoctl/releases/download/&#123;&#123; calico_ctl_version &#125;&#125;/calicoctl-linux-&#123;&#123; image_arch &#125;&#125;"</span>
<span class="token key atrule">calico_crds_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/projectcalico/calico/archive/&#123;&#123; calico_version &#125;&#125;.tar.gz"</span>
<span class="token key atrule">crictl_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/kubernetes-sigs/cri-tools/releases/download/&#123;&#123; crictl_version &#125;&#125;/crictl-&#123;&#123; crictl_version &#125;&#125;-&#123;&#123; ansible_system | lower &#125;&#125;-&#123;&#123; image_arch &#125;&#125;.tar.gz"</span>
<span class="token key atrule">helm_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/get.helm.sh/helm-&#123;&#123; helm_version &#125;&#125;-linux-&#123;&#123; image_arch &#125;&#125;.tar.gz"</span>
<span class="token key atrule">crun_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/containers/crun/releases/download/&#123;&#123; crun_version &#125;&#125;/crun-&#123;&#123; crun_version &#125;&#125;-linux-&#123;&#123; image_arch &#125;&#125;"</span>
<span class="token key atrule">kata_containers_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/kata-containers/runtime/releases/download/&#123;&#123; kata_containers_version &#125;&#125;/kata-static-&#123;&#123; kata_containers_version &#125;&#125;-&#123;&#123; ansible_architecture &#125;&#125;.tar.xz"</span>
<span class="token key atrule">nerdctl_download_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; download_url &#125;&#125;/github.com/containerd/nerdctl/releases/download/v&#123;&#123; nerdctl_version &#125;&#125;/nerdctl-&#123;&#123; nerdctl_version &#125;&#125;-&#123;&#123; ansible_system | lower &#125;&#125;-&#123;&#123; image_arch &#125;&#125;.tar.gz"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker-ce-mirrors"><a href="#docker-ce-mirrors" class="headerlink" title="docker-ce mirrors"></a>docker-ce mirrors</h3><p>kubespray å®‰è£… docker æˆ–è€… containerd å®¹å™¨è¿è¡Œæ—¶ï¼Œéœ€è¦ä½¿ç”¨ docker-ce çš„æºï¼Œå›½å†…å¯ä»¥ä½¿ç”¨æ¸…åçš„é•œåƒæºã€‚æ ¹æ®ä¸åŒçš„ Linux å‘è¡Œç‰ˆï¼Œåœ¨ <code>deploy/group_vars/all/offline.yml</code> æ–‡ä»¶ä¸­æ·»åŠ è¿™äº›å‚æ•°å³å¯ã€‚å…¶ä¸­ <code>docker_mirrors_url</code> è¿™ä¸ªå‚æ•°å°±æ˜¯åœ¨ <code>env.yml</code> é‡Œè®¾ç½®çš„å‚æ•°ã€‚</p>
<ul>
<li>CentOS&#x2F;Redhat</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## CentOS/Redhat</span>
<span class="token comment">### For EL7, base and extras repo must be available, for EL8, baseos and appstream</span>
<span class="token comment">### By default we enable those repo automatically</span>
<span class="token comment"># rhel_enable_repos: false</span>
<span class="token comment">### Docker / Containerd</span>
docker_rh_repo_base_url: <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/centos/&#123;&#123; ansible_distribution_major_version &#125;&#125;/&#123;&#123; ansible_architecture &#125;&#125;/stable"</span>
docker_rh_repo_gpgkey: <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/centos/gpg"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>Fedora</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">## Fedora</span>
<span class="token comment">### Docker</span>
<span class="token key atrule">docker_fedora_repo_base_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/fedora/&#123;&#123; ansible_distribution_major_version &#125;&#125;/&#123;&#123; ansible_architecture &#125;&#125;/stable"</span>
<span class="token key atrule">docker_fedora_repo_gpgkey</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/fedora/gpg"</span>
<span class="token comment">### Containerd</span>
<span class="token key atrule">containerd_fedora_repo_base_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/fedora/&#123;&#123; ansible_distribution_major_version &#125;&#125;/&#123;&#123; ansible_architecture &#125;&#125;/stable"</span>
<span class="token key atrule">containerd_fedora_repo_gpgkey</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/fedora/gpg"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>debian</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">## Debian</span>
<span class="token comment">### Docker</span>
<span class="token key atrule">docker_debian_repo_base_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/debian"</span>
<span class="token key atrule">docker_debian_repo_gpgkey</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/debian/gpg"</span>
<span class="token comment">### Containerd</span>
<span class="token key atrule">containerd_debian_repo_base_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/debian"</span>
<span class="token key atrule">containerd_debian_repo_gpgkey</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/debian/gpg"</span>
<span class="token comment"># containerd_debian_repo_repokey: 'YOURREPOKEY'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ubuntu</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">## Ubuntu</span>
<span class="token comment">### Docker</span>
<span class="token key atrule">docker_ubuntu_repo_base_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/ubuntu"</span>
<span class="token key atrule">docker_ubuntu_repo_gpgkey</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/ubuntu/gpg"</span>
<span class="token comment">### Containerd</span>
<span class="token key atrule">containerd_ubuntu_repo_base_url</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/ubuntu"</span>
<span class="token key atrule">containerd_ubuntu_repo_gpgkey</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; docker_mirrors_url &#125;&#125;/ubuntu/gpg"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>ç»è¿‡ä»¥ä¸Šå‡†å¤‡å¥½é…ç½®å·¥ä½œä¹‹åï¼Œæ¥ä¸‹æ¥å¯ä»¥å¼€å§‹æ­£å¼éƒ¨ç½²äº†ã€‚åœ¨ä½¿ç”¨ ansible è¿›è¡Œéƒ¨ç½²çš„æ—¶å€™ï¼Œä¸ªäººå€¾å‘äºåœ¨ kubespray å®¹å™¨é‡Œè¿›è¡Œæ“ä½œï¼Œè€Œéåœ¨æœ¬åœ°å¼€å‘æœºå™¨ä¸Šå®‰è£… python3 ç­‰ç¯å¢ƒã€‚å¯¹äºç¦»çº¿éƒ¨ç½²è€Œè¨€ï¼Œæå‰æ„å»ºå¥½é•œåƒï¼Œä½¿ç”¨ docker å®¹å™¨æ›´ä¸ºæ–¹ä¾¿ä¸€äº›ã€‚</p>
<ul>
<li>æ„å»ºé•œåƒ</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/root/kubespray git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># docker build -t kubespray:v2.15.1-kube-v1.20.6 .</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>è¿è¡Œ kubespray å®¹å™¨</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/root/kubespray git:<span class="token punctuation">(</span>master*<span class="token punctuation">)</span> <span class="token comment"># docker run --rm -it --net=host -v $PWD:/kubespray kubespray:v2.15.1-kube-v1.20.6 bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æµ‹è¯•ä¸»æœºæ˜¯å¦è¿æ¥æ­£å¸¸</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/kubespray<span class="token comment"># ansible -i cluster/inventory all -m ping</span>
kube-control-3 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token string">"ansible_facts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"discovered_interpreter_python"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/bin/python"</span>
    <span class="token punctuation">&#125;</span>,
    <span class="token string">"changed"</span><span class="token builtin class-name">:</span> false,
    <span class="token string">"ping"</span><span class="token builtin class-name">:</span> <span class="token string">"pong"</span>
<span class="token punctuation">&#125;</span>
kube-control-1 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token string">"ansible_facts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"discovered_interpreter_python"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/bin/python"</span>
    <span class="token punctuation">&#125;</span>,
    <span class="token string">"changed"</span><span class="token builtin class-name">:</span> false,
    <span class="token string">"ping"</span><span class="token builtin class-name">:</span> <span class="token string">"pong"</span>
<span class="token punctuation">&#125;</span>
kube-node-1 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token string">"ansible_facts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"discovered_interpreter_python"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/bin/python"</span>
    <span class="token punctuation">&#125;</span>,
    <span class="token string">"changed"</span><span class="token builtin class-name">:</span> false,
    <span class="token string">"ping"</span><span class="token builtin class-name">:</span> <span class="token string">"pong"</span>
<span class="token punctuation">&#125;</span>
kube-control-2 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token string">"ansible_facts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"discovered_interpreter_python"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/bin/python"</span>
    <span class="token punctuation">&#125;</span>,
    <span class="token string">"changed"</span><span class="token builtin class-name">:</span> false,
    <span class="token string">"ping"</span><span class="token builtin class-name">:</span> <span class="token string">"pong"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>å¼€å§‹éƒ¨ç½²é›†ç¾¤</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@debian:/kubespray<span class="token comment"># ansible-playbook -i deploy/inventory -e "@deploy/env.yml" cluster.yml</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>éƒ¨ç½²å®Œæˆæ—¥å¿—å¦‚ä¸‹ï¼Œå½“ failed éƒ½ä¸º 0 æ—¶è¯´æ˜ tasks éƒ½å·²ç»æˆåŠŸè·‘å®Œäº†</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PLAY RECAP ******************************************************************
kube-control-1             <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">526</span>  <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">67</span>   <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">978</span>  <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>
kube-control-2             <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">524</span>  <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">66</span>   <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">980</span>  <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>
kube-control-3             <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">593</span>  <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">76</span>   <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">1125</span> <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">1</span>
kube-node-1                <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">366</span>  <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">34</span>   <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">628</span>  <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>
localhost                  <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">3</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>

Wednesday <span class="token number">28</span> April <span class="token number">2021</span>  <span class="token number">10</span>:57:57 +0000 <span class="token punctuation">(</span><span class="token number">0</span>:00:00.115<span class="token punctuation">)</span>       <span class="token number">0</span>:15:21.190 *******
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
kubernetes/control-plane <span class="token builtin class-name">:</span> kubeadm <span class="token operator">|</span> Initialize first master -------------- <span class="token number">65</span>.88s
kubernetes/control-plane <span class="token builtin class-name">:</span> Joining control plane <span class="token function">node</span> to the cluster. ----- <span class="token number">50</span>.05s
kubernetes/kubeadm <span class="token builtin class-name">:</span> Join to cluster -------------------------------------- <span class="token number">31</span>.54s
download_container <span class="token operator">|</span> Download image <span class="token keyword">if</span> required --------------------------- <span class="token number">24</span>.38s
reload etcd --------------------------------------------------------------- <span class="token number">20</span>.56s
Gen_certs <span class="token operator">|</span> Write etcd member and admin certs to other etcd nodes --------- <span class="token number">19</span>.32s
Gen_certs <span class="token operator">|</span> Write <span class="token function">node</span> certs to other etcd nodes -------------------------- <span class="token number">19</span>.14s
Gen_certs <span class="token operator">|</span> Write etcd member and admin certs to other etcd nodes --------- <span class="token number">17</span>.45s
network_plugin/canal <span class="token builtin class-name">:</span> Canal <span class="token operator">|</span> Create canal <span class="token function">node</span> manifests ---------------- <span class="token number">15</span>.41s
kubernetes-apps/ansible <span class="token builtin class-name">:</span> Kubernetes Apps <span class="token operator">|</span> Lay Down CoreDNS Template ----- <span class="token number">13</span>.27s
kubernetes/control-plane <span class="token builtin class-name">:</span> Master <span class="token operator">|</span> <span class="token function">wait</span> <span class="token keyword">for</span> kube-scheduler --------------- <span class="token number">11</span>.97s
download_container <span class="token operator">|</span> Download image <span class="token keyword">if</span> required --------------------------- <span class="token number">11</span>.76s
Gen_certs <span class="token operator">|</span> Write <span class="token function">node</span> certs to other etcd nodes -------------------------- <span class="token number">10</span>.50s
kubernetes-apps/ansible <span class="token builtin class-name">:</span> Kubernetes Apps <span class="token operator">|</span> Start Resources ---------------- <span class="token number">8</span>.28s
policy_controller/calico <span class="token builtin class-name">:</span> Create calico-kube-controllers manifests -------- <span class="token number">7</span>.61s
kubernetes/control-plane <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> kubeadm certificate key --------------------- <span class="token number">6</span>.32s
download <span class="token builtin class-name">:</span> extract_file <span class="token operator">|</span> Unpacking archive -------------------------------- <span class="token number">5</span>.51s
Configure <span class="token operator">|</span> Check <span class="token keyword">if</span> etcd cluster is healthy ------------------------------- <span class="token number">5</span>.41s
Configure <span class="token operator">|</span> Check <span class="token keyword">if</span> etcd-events cluster is healthy ------------------------ <span class="token number">5</span>.41s
kubernetes-apps/network_plugin/canal <span class="token builtin class-name">:</span> Canal <span class="token operator">|</span> Start Resources ------------- <span class="token number">4</span>.85s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>é›†ç¾¤çŠ¶æ€</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@kube-control-1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node -o wide</span>
NAME             STATUS   ROLES                  AGE     VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION           CONTAINER-RUNTIME
kube-control-1   Ready    control-plane,master   5m24s   v1.20.6   <span class="token number">192.168</span>.4.11   <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.4.4
kube-control-2   Ready    control-plane,master   5m40s   v1.20.6   <span class="token number">192.168</span>.4.12   <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.4.4
kube-control-3   Ready    control-plane,master   6m28s   v1.20.6   <span class="token number">192.168</span>.4.13   <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.4.4
kube-node-1      Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>                 3m53s   v1.20.6   <span class="token number">192.168</span>.4.14   <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-1160.el7.x86_64   containerd://1.4.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>é›†ç¾¤ç»„ä»¶çŠ¶æ€</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@kube-control-1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all -n kube-system</span>
NAME                                           READY   STATUS             RESTARTS   AGE
pod/calico-kube-controllers-67d6cdb559-cwf62   <span class="token number">0</span>/1     CrashLoopBackOff   <span class="token number">5</span>          4m10s
pod/canal-node-46x2b                           <span class="token number">2</span>/2     Running            <span class="token number">0</span>          4m25s
pod/canal-node-5rkhq                           <span class="token number">2</span>/2     Running            <span class="token number">0</span>          4m25s
pod/canal-node-fcsgn                           <span class="token number">2</span>/2     Running            <span class="token number">0</span>          4m25s
pod/canal-node-nhkp8                           <span class="token number">2</span>/2     Running            <span class="token number">0</span>          4m25s
pod/coredns-5d578c6f84-5nnp8                   <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m33s
pod/coredns-5d578c6f84-w2kvf                   <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m39s
pod/dns-autoscaler-6b675c8995-vp282            <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m34s
pod/kube-apiserver-kube-control-1              <span class="token number">1</span>/1     Running            <span class="token number">0</span>          6m51s
pod/kube-apiserver-kube-control-2              <span class="token number">1</span>/1     Running            <span class="token number">0</span>          7m7s
pod/kube-apiserver-kube-control-3              <span class="token number">1</span>/1     Running            <span class="token number">0</span>          7m41s
pod/kube-controller-manager-kube-control-1     <span class="token number">1</span>/1     Running            <span class="token number">0</span>          6m52s
pod/kube-controller-manager-kube-control-2     <span class="token number">1</span>/1     Running            <span class="token number">0</span>          7m7s
pod/kube-controller-manager-kube-control-3     <span class="token number">1</span>/1     Running            <span class="token number">0</span>          7m41s
pod/kube-proxy-5dfx8                           <span class="token number">1</span>/1     Running            <span class="token number">0</span>          5m17s
pod/kube-proxy-fvrqk                           <span class="token number">1</span>/1     Running            <span class="token number">0</span>          5m17s
pod/kube-proxy-jd84p                           <span class="token number">1</span>/1     Running            <span class="token number">0</span>          5m17s
pod/kube-proxy-l2mjk                           <span class="token number">1</span>/1     Running            <span class="token number">0</span>          5m17s
pod/kube-scheduler-kube-control-1              <span class="token number">1</span>/1     Running            <span class="token number">0</span>          6m51s
pod/kube-scheduler-kube-control-2              <span class="token number">1</span>/1     Running            <span class="token number">0</span>          7m7s
pod/kube-scheduler-kube-control-3              <span class="token number">1</span>/1     Running            <span class="token number">0</span>          7m41s
pod/nginx-proxy-kube-node-1                    <span class="token number">1</span>/1     Running            <span class="token number">0</span>          5m20s
pod/nodelocaldns-77kq9                         <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m32s
pod/nodelocaldns-fn5pd                         <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m32s
pod/nodelocaldns-lfjzb                         <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m32s
pod/nodelocaldns-xnc6n                         <span class="token number">1</span>/1     Running            <span class="token number">0</span>          3m32s

NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                  AGE
service/coredns   ClusterIP   <span class="token number">10.233</span>.0.3   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">53</span>/UDP,53/TCP,9153/TCP   3m38s

NAME                          DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
daemonset.apps/canal-node     <span class="token number">4</span>         <span class="token number">4</span>         <span class="token number">4</span>       <span class="token number">4</span>            <span class="token number">4</span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>                   4m25s
daemonset.apps/kube-proxy     <span class="token number">4</span>         <span class="token number">4</span>         <span class="token number">4</span>       <span class="token number">4</span>            <span class="token number">4</span>           kubernetes.io/os<span class="token operator">=</span>linux   7m53s
daemonset.apps/nodelocaldns   <span class="token number">4</span>         <span class="token number">4</span>         <span class="token number">4</span>       <span class="token number">4</span>            <span class="token number">4</span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>                   3m32s

NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/calico-kube-controllers   <span class="token number">0</span>/1     <span class="token number">1</span>            <span class="token number">0</span>           4m12s
deployment.apps/coredns                   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           3m39s
deployment.apps/dns-autoscaler            <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           3m34s

NAME                                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/calico-kube-controllers-67d6cdb559   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">0</span>       4m12s
replicaset.apps/coredns-5d578c6f84                   <span class="token number">2</span>         <span class="token number">2</span>         <span class="token number">2</span>       3m39s
replicaset.apps/dns-autoscaler-6b675c8995            <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       3m34s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h2><p>åœ¨å›½å†…è¿™ç§ååˆ†ç³Ÿç³•çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œå¯¹äºæ™®é€šçš„å¼€å‘è€…æˆ–è€…å­¦ç”Ÿæ¥è®²ï¼Œéƒ¨ç½²ä¸€ä¸ª kubernetes é›†ç¾¤æ˜¯ååˆ†ç—›è‹¦çš„äº‹æƒ…ï¼Œè¿™ä¹Ÿè¿›ä¸€æ­¥é˜»ç¢äº†è¿™é—¨æŠ€æœ¯çš„æ™®åŠå’Œä½¿ç”¨ã€‚ä¹Ÿæƒ³èµ·äº†å‡ å¹´å‰åœ¨ä¸€æ¬¡ docker æŠ€æœ¯åˆ†äº«æ—¶çš„ QA é—®ç­”ï¼š</p>
<blockquote>
<p>Qï¼šå¦‚ä½•æ‘†è„±ç½‘ç»œçš„ä¾èµ–æ¥åˆ›å»ºä¸ª Docker çš„ image å‘¢ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯ Docker ç”¨æˆ·è‡ªå·±çš„åŸºæœ¬æƒåˆ©ï¼Ÿ</p>
</blockquote>
<p><strong>Aï¼šè¿™ä¸ªåŸºæœ¬æƒåˆ©æˆ‘è§‰å¾—è¿˜æ˜¯è¦é—® GFW ï¼Œå›½å¤–çš„å¼€å‘äººå‘˜æ˜¯éå¸¸éš¾ç†è§£æœ‰äº›ä»–ä»¬è®¤ä¸ºè·Ÿæ°´ç”µä¸€æ ·æ™®åŠçš„åŸºç¡€è®¾æ–½åœ¨æŸäº›åœ°æ–¹è¿˜æ˜¯å¾ˆå›°éš¾çš„ã€‚</strong></p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kubernetes/" rel="tag"># kubernetes</a>
              <a href="/tags/k8s/" rel="tag"># k8s</a>
              <a href="/tags/kubespray/" rel="tag"># kubespray</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/select-registry-images.html" rel="prev" title="ä»€ä¹ˆï¼Ÿå‘å¸ƒæµæ°´çº¿ä¸­é•œåƒâ€œåŒæ­¥â€é€Ÿåº¦åˆæå‡äº† 15 å€ ï¼">
                  <i class="fa fa-chevron-left"></i> ä»€ä¹ˆï¼Ÿå‘å¸ƒæµæ°´çº¿ä¸­é•œåƒâ€œåŒæ­¥â€é€Ÿåº¦åˆæå‡äº† 15 å€ ï¼
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/kubespray-tips.html" rel="next" title="kubespray éƒ¨ç½²å¸¸è§é—®é¢˜å’Œä¼˜åŒ–æ±‡æ€»">
                  kubespray éƒ¨ç½²å¸¸è§é—®é¢˜å’Œä¼˜åŒ–æ±‡æ€» <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">25:30</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
