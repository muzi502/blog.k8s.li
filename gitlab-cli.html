<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.k8s.li').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
  <meta name="description" content="å¼€å€’è½¦ ğŸš— ï¼Ÿå¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº†ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸ºğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼ å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab ç½‘ç»œ">
<meta property="og:type" content="article">
<meta property="og:title" content="python-gitlab CLI ä½¿ç”¨è®°å½•">
<meta property="og:url" content="https://blog.k8s.li/gitlab-cli.html">
<meta property="og:site_name" content="æœ¨å­">
<meta property="og:description" content="å¼€å€’è½¦ ğŸš— ï¼Ÿå¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº†ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸ºğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼ å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab ç½‘ç»œ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/image-20210319085926423.png">
<meta property="article:published_time" content="2021-03-22T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-19T16:00:00.000Z">
<meta property="article:author" content="æœ¨å­">
<meta property="article:tag" content="ci">
<meta property="article:tag" content="gitlab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/image-20210319085926423.png">
<link rel="canonical" href="https://blog.k8s.li/gitlab-cli.html">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
  <title>python-gitlab CLI ä½¿ç”¨è®°å½• | æœ¨å­</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
<link rel="alternate" href="/atom.xml" title="æœ¨å­" type="application/atom+xml">
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">
    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æœ¨å­</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>
  </li>
        <li class="menu-item menu-item-books">
    <a href="/booklist.html" rel="section"><i class="fa fa-fw fa-book"></i>Books</a>
  </li>
        <li class="menu-item menu-item-kindle">
    <a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
  </li>
        <li class="menu-item menu-item-friend">
    <a href="/link/" rel="section"><i class="fa fa-fw fa-link"></i>Friend</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>
  </li>
  </ul>
</nav>
</div>
    </header>
  <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
  <div class="posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/gitlab-cli.html">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.k8s.li/avatar.png">
      <meta itemprop="name" content="æœ¨å­">
      <meta itemprop="description" content="">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æœ¨å­">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          python-gitlab CLI ä½¿ç”¨è®°å½•
        </h2>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-23 2021-03-23T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2021-03-23T00:00:00+08:00">2021-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-20 2021-03-20T00:00:00+08:00" itemprop="dateModified" datetime="2021-03-20T00:00:00+08:00">2021-03-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">æŠ€æœ¯</span>
                  </a>
                </span>
            </span>
  <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    <a title="disqus" href="/gitlab-cli.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="gitlab-cli.html" itemprop="commentCount"></span>
    </a>
  </span>
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>27 åˆ†é’Ÿ</span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <h2 id="å¼€å€’è½¦-ğŸš—-ï¼Ÿ"><a href="#å¼€å€’è½¦-ğŸš—-ï¼Ÿ" class="headerlink" title="å¼€å€’è½¦ ğŸš— ï¼Ÿ"></a>å¼€å€’è½¦ ğŸš— ï¼Ÿ</h2><p>å¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº†ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸ºğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼</p>
<p>å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab ç½‘ç»œçŠ¶å†µåå€ç™¾å€ä¸ GitHub ä¸æ­¢ã€‚ä¼—æ‰€å‘¨çŸ¥åœ¨å­¦ä¹ <strong>å¢™å›½</strong>ï¼ŒGitHub ç›´è¿çš„é€Ÿåº¦å’Œç¨³å®šæ€§å·®çš„ä¸€æ‰¹ã€‚ä¹Ÿæ­£å› æ­¤ä¹‹å‰åœ¨ GitHub ä¸Šçš„æµæ°´çº¿ç»å¸¸ä¼šè¢«ç½‘ç»œæŠ–åŠ¨æ‰€å¹²æ‰°ï¼Œæœ‰æ—¶ä¾¯ fetch ä¸€ä¸ª repo åå‡ äºŒååˆ†é’Ÿï¼è¿ç§»åˆ°å†…ç½‘ Gitlab ä¹‹åï¼Œé‚£é€Ÿåº¦ç®€ç›´é£èµ·ï¼ä»¥å¾€æœ€å°‘åå‡ åˆ†é’Ÿçš„æµæ°´çº¿ç°åœ¨åªéœ€è¦ä¸åˆ°äº”åˆ†é’Ÿå°±èƒ½å®ŒæˆğŸ˜‚ã€‚</p>
<p>äºæ˜¯ä»Šå¤©å°±å†™ç¯‡åšå®¢è®°å½•ä¸€ä¸‹å½“æ—¶æŠ˜è…¾ Gitlab æ—¶æ”¶è·çš„ä¸€ç‚¹äººç”Ÿç»éªŒğŸ‘“</p>
<blockquote>
<p>æˆ‘ä»Šå¤©æ˜¯ä½œä¸ºä¸€ä¸ªé•¿è€…ç»™ä½ ä»¬è®²çš„ï¼Œæˆ‘ä¸æ˜¯æ–°é—»å·¥ä½œè€…ï¼Œä½†æ˜¯æˆ‘è§å¾—å¤ªå¤šäº†ï¼Œæˆ‘æœ‰è¿™ä¸ªå¿…è¦å‘Šè¯‰ä½ ä»¬ä¸€ç‚¹äººç”Ÿçš„ç»éªŒ</p>
</blockquote>
<h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><p>åœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„æœ‰å…³ Gitlab çš„æ–‡æ¡£å’Œå·¥å…·ï¼š</p>
<ul>
<li><a href="https://about.gitlab.com/topics/version-control/what-is-gitlab-workflow/" target="_blank" rel="noopener">Gitlab workflow</a>ï¼šäº†è§£ä¸€ä¸‹ Gitlab çš„å·¥ä½œæµï¼Œä¸åŒäº GitHub çš„ PRï¼Œåœ¨ Gitlab ä¸­ä½¿ç”¨çš„æ˜¯ MR çš„æ–¹å¼ï¼›</li>
<li><a href="https://docs.gitlab.com/ee/api/README.html" target="_blank" rel="noopener">Gitlab API</a>ï¼šGitlab API çš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å®ƒåœ¨ä½¿ç”¨ä¸‹ä¸‹é¢è¿™äº›å·¥å…·æ—¶å€™ä¼šå¾—å¿ƒåº”æ‰‹ã€‚</li>
<li><a href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html" target="_blank" rel="noopener">python-gitlab</a> API clientï¼šä½¿ç”¨ Python å®ç°çš„ Gitlab API clientï¼Œç”¨å®ƒæ¥å®Œæˆä¸€äº›ç‰¹å®šéœ€æ±‚å·¥å…·çš„å¼€å‘ï¼Œæ¯”å¦‚æ ¹æ® tag æˆ–è€… branchè·å– repo ä¸­æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼›</li>
<li><a href="https://python-gitlab.readthedocs.io/" target="_blank" rel="noopener">python-gitlab</a> CLIï¼šåŸºäº <a href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html" target="_blank" rel="noopener">python-gitlab</a> API client å°è£…æˆçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå› ä¸ºæ˜¯ CLI å·¥å…·æ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆåœ¨ä¸€äº›æµæ°´çº¿çš„è„šæœ¬ä¸­ï¼›</li>
<li><a href="https://github.com/xanzy/go-gitlab" target="_blank" rel="noopener">go-gitlab</a> API clientï¼šä½¿ç”¨ Golang å®ç°çš„ Gitlab API clientã€‚ç”±äºå‘å¸ƒæµæ°´çº¿ä¸­çš„ä¸€ä¸ªé˜¶æ®µå°±æ˜¯æ ¹æ®ä¸€ä¸ª list æ¥æ”¶é›†å…¶ä»– repo ä¸­çš„ç‰¹å®šæ–‡ä»¶å’Œç›®å½•ï¼Œä½¿ç”¨çš„å·¥å…·æ˜¯ golang å†™çš„ï¼Œä¸ºäº†å‡å°‘ä»£ç ä¿®æ”¹é‡å°±ä½¿ç”¨äº† go-gitlab è€Œä¸æ˜¯ python-gitlabã€‚</li>
</ul>
<h2 id="Gitlab-workflow"><a href="#Gitlab-workflow" class="headerlink" title="Gitlab workflow"></a><a href="https://about.gitlab.com/topics/version-control/what-is-gitlab-workflow/" target="_blank" rel="noopener">Gitlab workflow</a></h2><h3 id="PR"><a href="#PR" class="headerlink" title="PR"></a>PR</h3><p>åœ¨ GitHub ä¸Šæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ PR çš„æ–¹å¼æ¥å®Œæˆä»£ç åˆå¹¶å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æˆå‘˜ Fork åŸå§‹ä»“åº“ï¼Œå°† Fork å‡ºæ¥çš„ä»“åº“ clone åˆ°æœ¬åœ°</li>
<li>åœ¨æœ¬åœ°åˆ›å»ºæ–°åˆ†æ”¯ï¼Œå¹¶åŸºäºæ–°åˆ†æ”¯è¿›è¡Œä¿®æ”¹å’Œæäº¤ï¼Œæ¨é€æ–°åˆ†æ”¯åˆ° Fork çš„ä»“åº“</li>
<li>åŸºäº Fork ä»“åº“ä¸­çš„æ–°åˆ†æ”¯å‘åŸå§‹ä»“åº“çš„ç›®æ ‡åˆ†æ”¯å‘èµ· Pull Request</li>
<li>åœ¨ PR çš„è¯„è®ºä¸­ @ å®¡æŸ¥è€…ï¼Œè¯·æ±‚ review ä¿®æ”¹</li>
<li>å®¡æŸ¥è€…æ”¶åˆ°è¯·æ±‚é‚®ä»¶ï¼Œå®¡æŸ¥ä»£ç ï¼Œå¹¶åœ¨å»ºè®®å¤„ç›´æ¥åšå‡ºè¯„è®º</li>
<li>æäº¤è€…æ ¹æ®å»ºè®®ï¼Œç»§ç»­æäº¤æ”¹åŠ¨ï¼Œå¹¶å¯¹æ„è§ä½œå‡ºå›åº”</li>
<li>å®¡æŸ¥è€…æ— å¼‚è®®åï¼Œåœ¨ PR çš„è¯„è®ºä¸­ @ ç®¡ç†å‘˜ï¼Œè¯·æ±‚åˆå…¥ä»£ç ï¼Œç®¡ç†å‘˜æ¥å— PRï¼Œä»£ç åˆå…¥ä¸»åˆ†æ”¯</li>
</ul>
<h3 id="MR"><a href="#MR" class="headerlink" title="MR"></a>MR</h3><p>ä½†æ˜¯åˆ°äº† Gitlab ä¹‹åæˆ‘ä»¬å°±ä½¿ç”¨ MR çš„æ–¹å¼æ¥å®Œæˆä»£ç åˆå¹¶å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æˆå‘˜ Clone åŸå§‹ä»“åº“åˆ°æœ¬åœ°ï¼ŒåŸºäºè¦ä¿®æ”¹çš„åˆ†æ”¯ï¼Œåˆ›å»ºæ–°çš„åˆ†æ”¯</li>
<li>æœ¬åœ°ä¿®æ”¹å’Œæäº¤ï¼Œæ¨é€æ–°åˆ†æ”¯åˆ°åŸå§‹ä»“åº“</li>
<li>åœ¨åŸå§‹ä»“åº“ä¸­åŸºäºæ–°åˆ†æ”¯å‘ç›®æ ‡ä¿æŠ¤åˆ†æ”¯å‘èµ· Merge Request</li>
<li>å®¡æ ¸è€… review ä»£ç ï¼Œç®¡ç†å‘˜ Merge ä»£ç </li>
</ul>
<p>ç›¸æ¯”æ¥è®² MR å’Œæ–¹å¼æ›´é€‚åˆå›¢é˜Ÿå†…éƒ¨çš„åä½œå¼€å‘ï¼ŒPR çš„æ–¹å¼é€‚åˆå¼€æºé¡¹ç›®çš„åä½œå¼€å‘ã€‚</p>
<h2 id="Gitlab-API"><a href="#Gitlab-API" class="headerlink" title="Gitlab API"></a><a href="https://docs.gitlab.com/ee/api/README.html" target="_blank" rel="noopener">Gitlab</a> API</h2><blockquote>
<p>The main GitLab API is a <a href="http://spec.openapis.org/oas/v3.0.3" target="_blank" rel="noopener">REST</a> API. Because of this, the documentation in this section assumes that youâ€™re familiar with REST concepts.</p>
</blockquote>
<p>å‚ç…§å®˜æ–¹æ–‡æ¡£ <a href="https://docs.gitlab.com/ee/api/api_resources.html" target="_blank" rel="noopener">API resources</a> å¯çŸ¥ï¼Œå…±æœ‰ Projects ã€Groupsã€Standalone è¿™ä¸‰ç§ API åˆ†ç»„ã€‚</p>
<ul>
<li>Projectsï¼š å¯¹åº”çš„å°±æ˜¯ä¸ repo ç›¸å…³çš„ API ï¼Œæ¯”å¦‚ tagã€commitã€branch ã€MRã€Issue è¿™ä¸€ç±»å‹ï¼›</li>
<li>Groupsï¼š å¯¹åº”ç±»ä¼¼äº GitHub ä¸Šçš„ Organizationsï¼Œä¸€èˆ¬æ¥è®²å…¬å¸é‡Œçš„ repo éƒ½ä¼šæŒ‰ç…§å›¢é˜Ÿæ¥åˆ’åˆ†ç»„ç»‡ï¼ŒåŒä¸€å›¢é˜Ÿé‡Œçš„ repo ä¼šæ”¾åœ¨ gitlab åŒä¸€ä¸ª Groups  ä¸‹ï¼Œè€Œä¸æ˜¯ä»¥ä¸ªäººä¸ºå•ä½å­˜æ”¾ repoï¼›</li>
<li>Standaloneï¼šåˆ™æ˜¯é™¤äº† Projects å’Œ Groups ä¹‹å¤–çš„ API èµ„æºï¼Œå¦‚ user</li>
</ul>
<p>è€Œæˆ‘ä»¬å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ Projects ç›¸å…³çš„ APIï¼Œé€šè¿‡å®ƒæ¥å¯¹ repo è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚ç®€å•ä»‹ç»å®Œ Gitlab API ç±»å‹ä¹‹åï¼Œæœ¬æ–‡ä¼šä»‹ç»å‡ ç§ä½¿ç”¨ Gitlab API çš„å·¥å…·ã€‚åœ¨ä½¿ç”¨è¿™äº›å·¥å…·çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ä¸€äº›é”™è¯¯å¯ä»¥é€šè¿‡ <a href="https://docs.gitlab.com/ee/api/README.html#status-codes" target="_blank" rel="noopener">Status codes</a> API è¿”å›çŠ¶æ€ç æ¥æ’æŸ¥é—®é¢˜ã€‚</p>
<h2 id="python-gitlab-CLI"><a href="#python-gitlab-CLI" class="headerlink" title="python-gitlab CLI"></a><a href="https://python-gitlab.readthedocs.io/" target="_blank" rel="noopener">python-gitlab</a> CLI</h2><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ <a href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html" target="_blank" rel="noopener">python-gitlab</a> API client å°è£…å¥½çš„ gitlab å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å®Œæˆç»å¤§å¤šæ•° Gitlab API æ‰€æ”¯æŒçš„æ“ä½œã€‚å› ä¸ºä¹‹å‰çš„æµæ°´çº¿ä¸­æœ‰å¾ˆå¤šæ“ä½œæ˜¯è®¿é—®çš„ GitHubï¼Œæ¯”å¦‚æäº¤ PRã€è·å– repo tagã€æŸ¥çœ‹ PR labels ç­‰ï¼Œéƒ½æ˜¯å†™åœ¨ Jenkinsfile è°ƒç”¨å„ç§è„šæœ¬å’Œå·¥å…·æ¥å®Œæˆçš„ã€‚ åˆ‡æ¢åˆ°äº† Gitlabï¼Œè‡ªç„¶ä¹Ÿéœ€è¦ä¸€ä¸ªå·¥å…·æ¥å®Œæˆä¸Šè¿°æ“ä½œäº†ã€‚é‚£ä¹ˆ python-gitlab CLI è¿™ä¸ªå·¥å…·æ— ç–‘æ˜¯ä¸äºŒä¹‹é€‰ï¼Œç”šè‡³æ¯”ä¹‹å‰çš„å·¥å…·æ›´æ–¹ä¾¿ã€‚å› ä¸ºè¿„ä»Šä¸ºæ­¢è¿˜æ²¡æœ‰è§åˆ°è¿‡ GitHub èƒ½æœ‰åƒ python-gitlab è¿™æ ·çš„å·¥å…·ã€‚æ€»ä¹‹ï¼Œå¯¹äºä½¿ç”¨ Gitlab çš„äººæ¥è®²ï¼Œè¦å¯¹ repo å®Œæˆä¸€äº›è‡ªåŠ¨åŒ–å¤„ç†çš„å·¥ä½œï¼Œå¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸ª CLI å·¥å…·ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆåœ¨æµæ°´çº¿ä¸­ã€‚</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>python-gitlab CLI ä¾èµ– Python 2.7 æˆ–è€… 3.4+ï¼Œ2021 å¹´å•¦ï¼Œå°±ä¸è¦ä½¿ç”¨ Python2.7 å•¦ğŸ˜Šã€‚æœ¬åœ°å®‰è£…å¥½ python3 å’Œ pip3 åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨è¿™é‡Œä½¿ç”¨æ¸…åçš„ pypi æºæ¥åŠ é€Ÿå®‰è£…ï¼Œæ¯•ç«Ÿæ˜¯å¢™ğŸ§±å›½</span></span><br><span class="line">$ sudo pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple requests PyYAML python-gitlab</span><br></pre></td></tr></table></figure>
<p>ç”±äºä½¿ç”¨è¿™ä¸ªå·¥å…·çš„åœºæ™¯å¤§å¤šæ•°æ˜¯åœ¨ Jenkins æ‰€åˆ›å»ºçš„ slave pod ä¸­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥æ„å»ºä¸€ä¸ª docker é•œåƒï¼Œ <code>Dockerfile</code> å¦‚ä¸‹</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:buster</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt install -y --no-install-recommends \</span></span><br><span class="line"><span class="bash">        git \</span></span><br><span class="line"><span class="bash">        python3 \</span></span><br><span class="line"><span class="bash">        python3-pip \</span></span><br><span class="line"><span class="bash">        jq \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple requests PyYAML python-gitlab</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> python-gitlab.cfg /etc/python-gitlab.cfg</span></span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>Gitlab CLI å·¥å…·éœ€è¦ä½¿ç”¨ä¸€ä¸ª <code>python-gitlab.cfg</code> é…ç½®æ–‡ä»¶ç”¨äºè¿æ¥ Gitlab æœåŠ¡å™¨ä»¥åŠå®Œæˆä¸€äº›é‰´æƒè®¤è¯ï¼Œé…ç½®æ–‡ä»¶æ ¼å¼ä¸º <code>ini</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">default</span> = gitlab.com</span><br><span class="line"><span class="attr">ssl_verify</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">timeout</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">per_page</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">api_version</span> = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="section">[gitlab.com]</span></span><br><span class="line"><span class="attr">url</span> = https://gitlab.com</span><br><span class="line"><span class="attr">private_token</span> = xxxxxxxxx</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¨å±€çš„è¿æ¥å‚æ•°</li>
</ul>
<table>
<thead>
<tr>
<th>Option</th>
<th>Possible values</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ssl_verify</code></td>
<td><code>True</code> æˆ– <code>False</code></td>
<td>æ˜¯å¦å¼€å¯ SSL åŠ å¯†éªŒè¯</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>è¯ä¹¦</td>
<td>è¿æ¥è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td><code>api_version</code></td>
<td><code>4</code></td>
<td>API çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 4 å³å¯ï¼Œå‚è€ƒ <a href="https://docs.gitlab.com/ee/api/v3_to_v4.html" target="_blank" rel="noopener">API V3 to API V4</a></td>
</tr>
<tr>
<td><code>per_page</code></td>
<td>1 ï½ 100</td>
<td>æ¯æ¬¡è¿”å›çš„å…ƒç´ æ•°é‡ï¼ŒGitlab çš„æœ€å¤§é™åˆ¶ä¸º 100ã€‚å¯ä»¥é€šè¿‡ <code>--all</code> å‚æ•°è·å–æ‰€æœ‰çš„å…ƒç´ </td>
</tr>
</tbody></table>
<ul>
<li>è‡ªå®šä¹‰ GitLab server å‚æ•°</li>
</ul>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>url</code></td>
<td>GitLab server çš„ URL</td>
</tr>
<tr>
<td><code>private_token</code></td>
<td>é€šè¿‡è®¿é—® gitlab æœåŠ¡å™¨çš„ <a href="https://gitlab.com/-/profile/personal_access_tokens" target="_blank" rel="noopener">-/profile/personal_access_tokens</a> æ¥ç”Ÿæˆ token</td>
</tr>
<tr>
<td><code>oauth_token</code></td>
<td></td>
</tr>
<tr>
<td><code>job_token</code></td>
<td></td>
</tr>
<tr>
<td><code>api_version</code></td>
<td>API çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 4 å³å¯ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å®šä¹‰ï¼Œä½¿ç”¨å…¨å±€å‚æ•°</td>
</tr>
<tr>
<td><code>http_username</code></td>
<td>Gitlab ç”¨æˆ·åï¼Œä¸æ¨èä½¿ç”¨å®ƒæ¥è¿æ¥ Gitlab æœåŠ¡å™¨</td>
</tr>
<tr>
<td><code>http_password</code></td>
<td>Gitlab å¯†ç ï¼Œä¸æ¨èä½¿ç”¨å®ƒæ¥è¿æ¥ Gitlab æœåŠ¡å™¨</td>
</tr>
</tbody></table>
<p>å°†æ–‡ä»¶ä¿å­˜åœ¨ <code>~/.python-gitlab.cfg</code> æˆ–è€… <code>/etc/python-gitlab.cfg</code> ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ <code>PYTHON_GITLAB_CFG</code> æˆ–è€… <code>--config-file</code> æ‰§è¡Œé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸ºäº†çœäº‹å„¿è¿˜æ˜¯å°†å®ƒæ”¾åˆ° <code>~/.python-gitlab.cfg</code> ä¸‹ã€‚</p>
<p>é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ <code>gitlab current-user get</code> å‘½ä»¤æµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœæœ‰è¿”å›å€¼ä¸”æ­£ç¡®çš„ç”¨æˆ·åè¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab current-user get</span><br><span class="line">username: muzi502</span><br></pre></td></tr></table></figure>
<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>gitlab å‘½ä»¤è¡Œå·¥å…·ä¸»è¦æ˜¯å¯¹ Gitlab æœåŠ¡å™¨ä¸Šçš„å„ç§å¯¹è±¡å¦‚ï¼šuser, project, file, repo, mr, tag, commit ç­‰è¿›è¡Œå¢åˆ æ”¹æŸ¥(getã€listã€createã€deleteã€update)ã€‚ä½¿ç”¨çš„å‘½ä»¤è¡Œæ ¼å¼æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab &lt;option&gt; [object] [action] &lt;option&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æ¥è®²åªéœ€è¦ 4 ç§å‚æ•°ï¼š</p>
<ul>
<li><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç´§æ¥ç€ gitlab å‘½ä»¤åé¢çš„å‚æ•°ï¼Œå®ƒæ˜¯ gitlab å‘½ä»¤è¡Œçš„è¾“å‡ºå‚æ•°å’Œé…ç½®å‚æ•°ï¼Œå¦‚ <code>-o</code>å‚æ•°æŒ‡å®šè¾“å‡ºç»“æœçš„æ ¼å¼ï¼›<code>-f</code> å‚æ•°å°†è¾“å‡ºç»“æœå­˜æ”¾åˆ°æ–‡ä»¶ä¸­; <code>-g</code> å‚æ•°æ‰§è¡Œè¿æ¥å“ªä¸ª Gitlab æœåŠ¡å™¨ã€‚</p>
</li>
<li><p>ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ç”¨æ¥æŒ‡å®šæ‰€è¦æ“ä½œçš„å¯¹è±¡ï¼Œæ¯”å¦‚ project-merge-requestï¼Œproject-tag ç­‰ï¼Œæ‰€æ”¯æŒçš„å¯¹è±¡æœ‰å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šæ¶µç›–äº†æ‰€æœ‰ Gitlab API æ‰€æ”¯æŒçš„æ“ä½œå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -h</span><br><span class="line">usage: gitlab [-h] [--version] [-v] [-d] [-c CONFIG_FILE] [-g GITLAB] [-o &#123;json,legacy,yaml&#125;] [-f FIELDS]</span><br><span class="line">&#123;application,application-appearance,application-settings,audit-event,broadcast-message,current-user,current-user-email,current-user-gp-gkey,current-user-key,current-user-status,deploy-key,deploy-token,dockerfile,event,feature,geo-node,gitignore,gitlabciyml,group,group-access-request,group-badge,group-board,group-board-list,group-cluster,group-custom-attribute,group-deploy-token,group-epic,group-epic-issue,group-epic-resource-label-event,group-export,group-import,group-issue,group-label,group-member,group-merge-request,group-milestone,group-notification-settings,group-package,group-project,group-runner,group-subgroup,group-variable,hook,issue,l-da-pgroup,license,merge-request,namespace,notification-settings,pages-domain,project,project-access-request,project-additional-statistics,project-approval,project-approval-rule,project-badge,project-board,project-board-list,project-branch,project-cluster,project-commit,project-commit-comment,project-commit-discussion,project-commit-discussion-note,project-commit-status,project-custom-attribute,project-deploy-token,project-deployment,project-environment,project-event,project-export,project-file,project-fork,project-hook,project-import,project-issue,project-issue-award-emoji,project-issue-discussion,project-issue-discussion-note,project-issue-link,project-issue-note,project-issue-note-award-emoji,project-issue-resource-label-event,project-issue-resource-milestone-event,project-issues-statistics,project-job,project-key,project-label,project-member,project-merge-request,project-merge-request-approval,project-merge-request-approval-rule,project-merge-request-award-emoji,project-merge-request-diff,project-merge-request-discussion,project-merge-request-discussion-note,project-merge-request-note,project-merge-request-note-award-emoji,project-merge-request-resource-label-event,project-merge-request-resource-milestone-event,project-milestone,project-note,project-notification-settings,project-package,project-pages-domain,project-pipeline,project-pipeline-bridge,project-pipeline-job,project-pipeline-schedule,project-pipeline-schedule-variable,project-pipeline-variable,project-protected-branch,project-protected-tag,project-push-rules,project-registry-repository,project-registry-tag,project-release,project-remote-mirror,project-runner,project-service,project-snippet,project-snippet-award-emoji,project-snippet-discussion,project-snippet-discussion-note,project-snippet-note,project-snippet-note-award-emoji,project-tag,project-trigger,project-user,project-variable,project-wiki,runner,runner-job,snippet,todo,user,user-activities,user-custom-attribute,user-email,user-event,user-gp-gkey,user-impersonation-token,user-key,user-membership,user-project,user-status,variable&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ action å‚æ•°ï¼Œå³ç”¨äºæŒ‡å®šå¯¹æ‰€æ“ä½œçš„å¯¹è±¡è¿›è¡Œä½•ç§æ“ä½œï¼Œä¸€èˆ¬æ¥è®²éƒ½ä¼šæ”¯æŒå¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆget, list, create, update, deleteï¼‰</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag</span><br><span class="line">usage: gitlab project-tag [-h] &#123;list,get,create,delete,<span class="built_in">set</span>-release-description&#125; ...</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ object + action æ‰€ä¾èµ–çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®š project id</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag list</span><br><span class="line">usage: gitlab project-tag list --project-id PROJECT_ID [--page PAGE] [--per-page PER_PAGE] [--all]</span><br><span class="line">gitlab project-tag list: error: the following arguments are required: --project-id</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Project-IDï¼šæ˜¯ gitlab ä¸Šå”¯ä¸€è¡¨ç¤ºè¯¥ repo çš„ IDï¼Œå¯åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ <code>group/project</code> çš„å½¢å¼ï¼Œå…¶ä¸­ <code>/</code> è¦è½¬è¯‘æˆ <code>%2F</code> å¦‚ï¼š<code>muzi502%2Fkubespray</code>ï¼›å¦ä¸€ç§åˆ™æ˜¯æ•°å­—çš„å½¢å¼ï¼Œåœ¨è¯¥ repo çš„ web é¡µé¢ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§ã€‚</p>
<p><img src="https://p.k8s.li/image-20210319085926423.png" alt="image-20210319085926423"></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨gitlab å‘½ä»¤è·å– repo çš„ id</span></span><br><span class="line">$ gitlab project get --id muzi502%2Fkubespray</span><br><span class="line">id: 25099880</span><br><span class="line">path: kubespray</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨æµæ°´çº¿ä¸­å¯ä»¥æ ¹æ® token è·å–ç”¨æˆ·çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼Œç”¨äºé…ç½®æµæ°´çº¿ä¸­çš„ repo git ä¿¡æ¯ï¼Œé¿å…å› ä¸º CLA æ— æ³•é€šè¿‡ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gitlab -o json current-user get | jq '.id'</span><br><span class="line">git config --global user.email $(gitlab -o json current-user get | jq -r '.email')</span><br><span class="line">git config --global user.name $(gitlab -o json current-user get | jq -r '.username')</span><br></pre></td></tr></table></figure>
<h3 id="project"><a href="#project" class="headerlink" title="project"></a>project</h3><ul>
<li>è·å– repo ssh url  åœ°å€</li>
</ul>
<p>ç”±äº Jenkins æµæ°´çº¿ä¸­ clone çš„ repo url æ˜¯ä½¿ç”¨ token+ https çš„æ–¹å¼ï¼Œåœ¨æµæ°´çº¿ä¸­å¦‚æœè¦ push ä»£ç åˆ° repo éœ€è¦ä¿®æ”¹ä¸º ssh çš„æ–¹å¼ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ ¹æ® project id æ¥è·å–è¯¥ repo çš„ ssh urlã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json  project get --id <span class="variable">$&#123;PROJECT_ID&#125;</span> | jq -r <span class="string">'.ssh_url_to_repo'</span></span><br><span class="line">$ git remote remove origin</span><br><span class="line">$ git remote add origin $(gitlab -o json  project get --id <span class="variable">$&#123;PROJECT_ID&#125;</span> | jq -r <span class="string">'.ssh_url_to_repo'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>å¯¹äº repo ä¸­æ–‡ä»¶çš„æ“ä½œä½¿ç”¨ project-file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-file</span><br><span class="line">usage: gitlab project-file [-h] &#123;get,create,update,delete,raw,blame&#125; ...</span><br></pre></td></tr></table></figure>
<ul>
<li>è·å–æ–‡ä»¶ï¼Œé€šè¿‡ <code>project-file</code> å¯¹è±¡çš„ get æ“ä½œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-file get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore --ref master  | jq <span class="string">'.'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"file_name"</span>: <span class="string">".gitignore"</span>,</span><br><span class="line">  <span class="string">"file_path"</span>: <span class="string">".gitignore"</span>,</span><br><span class="line">  <span class="string">"size"</span>: 1208,</span><br><span class="line">  <span class="string">"encoding"</span>: <span class="string">"base64"</span>,</span><br><span class="line">  <span class="string">"content_sha256"</span>: <span class="string">"91f1d50ba3a4f79f96d9371afc70b389f75dfb2ac5190b8fb01051aa8679fd04"</span>,</span><br><span class="line">  <span class="string">"ref"</span>: <span class="string">"master"</span>,</span><br><span class="line">  <span class="string">"blob_id"</span>: <span class="string">"b09ca9d3b101034c7e34430177c1d64738df5fbb"</span>,</span><br><span class="line">  <span class="string">"commit_id"</span>: <span class="string">"a9c97e5253c455546c2c7fdd794147eeb9b8ab7a"</span>,</span><br><span class="line">  <span class="string">"last_commit_id"</span>: <span class="string">"4ffc106c58fc5865b6d72a52365e25b8c268d4d8"</span>,</span><br><span class="line">  <span class="string">"content"</span>: <span class="string">"LnZhZ3JhbnQKKi5yZXRyeQoqKi92YWdyYW50X2Fuc2libGVfaW52ZW50b3J5CiouaW1sCnRlbXAKLmlkZWEKLnRveAouY2FjaGUKKi5iYWsKKi50ZnN0YXRlCioudGZzdGF0ZS5iYWNrdXAKLnRlcnJhZm9ybS8KY29udHJpYi90ZXJyYWZvcm0vYXdzL2NyZWRlbnRpYWxzLnRmdmFycwovc3NoLWJhc3Rpb24uY29uZgoqKi8qLnN3W3Bvbl0KKn4KdmFncmFudC8KcGx1Z2lucy9taXRvZ2VuCgojIEFuc2libGUgaW52ZW50b3J5CmludmVudG9yeS8qCiFpbnZlbnRvcnkvbG9jYWwKIWludmVudG9yeS9zYW1wbGUKaW52ZW50b3J5LyovYXJ0aWZhY3RzLwoKIyBCeXRlLWNvbXBpbGVkIC8gb3B0aW1pemVkIC8gRExMIGZpbGVzCl9fcHljYWNoZV9fLwoqLnB5W2NvZF0KKiRweS5jbGFzcwoKIyBEaXN0cmlidXRpb24gLyBwYWNrYWdpbmcKLlB5dGhvbgplbnYvCmJ1aWxkLwpjcmVkZW50aWFscy8KZGV2ZWxvcC1lZ2dzLwpkaXN0Lwpkb3dubG9hZHMvCmVnZ3MvCi5lZ2dzLwpwYXJ0cy8Kc2Rpc3QvCnZhci8KKi5lZ2ctaW5mby8KLmluc3RhbGxlZC5jZmcKKi5lZ2cKCiMgUHlJbnN0YWxsZXIKIyAgVXN1YWxseSB0aGVzZSBmaWxlcyBhcmUgd3JpdHRlbiBieSBhIHB5dGhvbiBzY3JpcHQgZnJvbSBhIHRlbXBsYXRlCiMgIGJlZm9yZSBQeUluc3RhbGxlciBidWlsZHMgdGhlIGV4ZSwgc28gYXMgdG8gaW5qZWN0IGRhdGUvb3RoZXIgaW5mb3MgaW50byBpdC4KKi5tYW5pZmVzdAoqLnNwZWMKCiMgSW5zdGFsbGVyIGxvZ3MKcGlwLWxvZy50eHQKcGlwLWRlbGV0ZS10aGlzLWRpcmVjdG9yeS50eHQKCiMgVW5pdCB0ZXN0IC8gY292ZXJhZ2UgcmVwb3J0cwpodG1sY292LwoudG94LwouY292ZXJhZ2UKLmNvdmVyYWdlLioKLmNhY2hlCm5vc2V0ZXN0cy54bWwKY292ZXJhZ2UueG1sCiosY292ZXIKLmh5cG90aGVzaXMvCgojIFRyYW5zbGF0aW9ucwoqLm1vCioucG90CgojIERqYW5nbyBzdHVmZjoKKi5sb2cKbG9jYWxfc2V0dGluZ3MucHkKCiMgRmxhc2sgc3R1ZmY6Cmluc3RhbmNlLwoud2ViYXNzZXRzLWNhY2hlCgojIFNjcmFweSBzdHVmZjoKLnNjcmFweQoKIyBTcGhpbnggZG9jdW1lbnRhdGlvbgpkb2NzL19idWlsZC8KCiMgUHlCdWlsZGVyCnRhcmdldC8KCiMgSVB5dGhvbiBOb3RlYm9vawouaXB5bmJfY2hlY2twb2ludHMKCiMgcHllbnYKLnB5dGhvbi12ZXJzaW9uCgojIGRvdGVudgouZW52CgojIHZpcnR1YWxlbnYKdmVudi8KRU5WLwo="</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶å†…å®¹æ˜¯ base64 ç¼–ç çš„ï¼Œéœ€è¦ä½¿ç”¨ base64 è§£ç æ‰èƒ½è·å–åŸå§‹çš„å†…å®¹ã€‚</span></span><br><span class="line">$ gitlab -g gitlab -o json project-file get --project-id 25099880 --file-path .gitignore --ref master  | jq -r <span class="string">'.content'</span> | base64 -d</span><br><span class="line">.vagrant</span><br><span class="line">*.retry</span><br><span class="line">**/vagrant_ansible_inventory</span><br><span class="line">*.iml</span><br><span class="line">temp</span><br><span class="line">.idea</span><br><span class="line">.tox</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ project-file çš„ raw æ–¹æ³•å¯ä»¥è·å–æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œæ— é¡» base64 è§£ç </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-file get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore --ref master</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ›å»ºæ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶çš„å¢åˆ æ”¹éƒ½æ˜¯é€šè¿‡æäº¤ commit æ¥å®Œæˆçš„ï¼Œå› æ­¤éœ€è¦æŒ‡å®šæ‰€è¦æ“ä½œçš„åˆ†æ”¯ä»¥åŠ commit-message çš„ä¿¡æ¯ã€‚å¦å¤–å¦‚æœæ“ä½œçš„æ–‡ä»¶æ˜¯ master åˆ†æ”¯è·å–å…¶ä»–ä¿æŠ¤åˆ†æ”¯ï¼Œè¦ç¡®ä¿å½“å‰ç”¨æˆ·æœ‰å†™å…¥çš„æƒé™ï¼Œä¸ç„¶ä¼šæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab project-file update</span><br><span class="line">Impossible to update object (400: You are not allowed to push into this branch)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä¹‹å‰åœ¨ GitHub ä¸Šæœ‰ä¸€å¥— CI å¹¶ä¸èƒ½é€‚ç”¨äº Gitlabï¼Œå› æ­¤éœ€è¦ä¸ºæ‰€æœ‰çš„åˆ†æ”¯åˆ›å»º CI æµæ°´çº¿ï¼Œç”¨äºæ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æ‰¹é‡é‡åœ°å‘æ‰€æœ‰åˆ†æ”¯åˆ›å»ºæ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ID=123456</span><br><span class="line">BRANCHS=$(gitlab -o json project-branch list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">".[].name"</span>)</span><br><span class="line"><span class="keyword">for</span> branch <span class="keyword">in</span> <span class="variable">$&#123;BRANCHS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">	gitlab project-file create --project-id <span class="variable">$&#123;ID&#125;</span> --file-path .gitlab-ci.yml --branch <span class="variable">$&#123;branch&#125;</span> --content @.gitlab-ci.yml --commit-message <span class="string">"feat(gitlab-ci): add gitlab-ci.yml for ci"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ›´æ–°æ–‡ä»¶</li>
</ul>
<p>æ¯”å¦‚æ‰¹é‡æ›´æ–°æ‰€æœ‰åˆ†æ”¯çš„ <code>Makefile</code> ä¸­ <code>github.com</code> ä¸º <code>gitlab.com</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ID=123456</span><br><span class="line">BRANCHS=$(gitlab -o json project-branch list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">".[].name"</span>)</span><br><span class="line"><span class="keyword">for</span> branch <span class="keyword">in</span> <span class="variable">$&#123;BRANCHS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">    rm -f Makefile Makefile-</span><br><span class="line">    gitlab project-file raw --project-id <span class="variable">$&#123;ID&#125;</span> --file-path Makefile --ref <span class="variable">$&#123;branch&#125;</span> &gt; Makefile</span><br><span class="line">    sed -i- <span class="string">"s|github.com/muzi502|gitlab.com/muzi502"</span> Makefile</span><br><span class="line">    gitlab project-file update --project-id <span class="variable">$&#123;ID&#125;</span> --file-path Makefile --branch <span class="variable">$&#123;branch&#125;</span> --content @Makefile \</span><br><span class="line">    --commit-message <span class="string">"chore(Makefile): update repo url in Makefile for migrate gitlab"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ é™¤æ–‡ä»¶</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-file delete --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore --ref master \</span><br><span class="line">--commit-message <span class="string">"test delete file"</span></span><br></pre></td></tr></table></figure>
<h3 id="MR-1"><a href="#MR-1" class="headerlink" title="MR"></a>MR</h3><ul>
<li>åˆ›å»º MRï¼ŒæŒ‡å®š source branch å’Œ target branch ä»¥åŠ mr çš„ title è¿™ä¸‰ä¸ªå‚æ•°ã€‚å‰é¢æœ€å¥½åŠ ä¸Š -o json å‚æ•°ç”¨æˆ·è·å– mr çš„ iidï¼Œå¯é€šè¿‡æ­¤ iid æ¥å¯¹è¿™ä¸ª mr è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-merge-request create --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --<span class="built_in">source</span>-branch --target-branch <span class="variable">$&#123;BASE_BRANCH&#125;</span> --title <span class="string">"<span class="variable">$&#123;MR_TITLE&#125;</span>"</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ -o json å‚æ•°ä¼šè¿”å›æ­¤ mr çš„ä¿¡æ¯ï¼Œå…¶ä¸­ <code>iid</code> å°±æ˜¯è¯¥ mr åœ¨æ­¤ repo ä¸­çš„å”¯ä¸€æ ‡ç¤º</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -g gitlab -o json project-merge-request create --project-id 25099880 --source-branch release-2.14 --target-branch  master --title "mr create test"</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">92872102</span>,</span><br><span class="line">  <span class="attr">"iid"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"project_id"</span>: <span class="number">25099880</span>,</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"mr create test"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"opened"</span>,</span><br><span class="line">  <span class="attr">"created_at"</span>: <span class="string">"2021-03-21T12:42:52.893Z"</span>,</span><br><span class="line">  <span class="attr">"updated_at"</span>: <span class="string">"2021-03-21T12:42:52.893Z"</span>,</span><br><span class="line">  <span class="attr">"merged_by"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"merged_at"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"closed_by"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"closed_at"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"target_branch"</span>: <span class="string">"master"</span>,</span><br><span class="line">  <span class="attr">"source_branch"</span>: <span class="string">"release-2.14"</span>,</span><br><span class="line">  <span class="attr">"user_notes_count"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"upvotes"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"downvotes"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"author"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">5599205</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"muzi502"</span>,</span><br><span class="line">    <span class="attr">"username"</span>: <span class="string">"muzi502"</span>,</span><br><span class="line">    <span class="attr">"state"</span>: <span class="string">"active"</span>,</span><br><span class="line">    <span class="attr">"avatar_url"</span>: <span class="string">"https://secure.gravatar.com/avatar/f91578ffea9a538eedd8fbaf3007289b?s=80&amp;d=identicon"</span>,</span><br><span class="line">    <span class="attr">"web_url"</span>: <span class="string">"https://gitlab.com/muzi502"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆå¹¶ MR</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-merge-request merge --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹ MR çŠ¶æ€</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-merge-request get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid | jq -r <span class="string">".state"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é›†æˆåœ¨ Jenkinsfile  ä¸­å®Œæˆåˆ›å»º MRã€åˆå¹¶ MRã€æ£€æŸ¥ MR </li>
</ul>
<p>è°ƒç”¨ç”¨å®ƒçš„æ—¶å€™åªéœ€è¦ä¼ å…¥ SOURCE_BRANCH, TARGET_BRANCH, MR_TITLE è¿™ä¸‰ä¸ªå‚æ•°å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def makeMR(SOURCE_BRANCH, TARGET_BRANCH, MR_TITLE) &#123;</span><br><span class="line">    container(<span class="string">"debian"</span>) &#123;</span><br><span class="line">        sh <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        gitlab -o json project-merge-request create --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span>  --title \"<span class="variable">$&#123;MR_TITLE&#125;</span>\" \</span></span><br><span class="line"><span class="string">        --source-branch <span class="variable">$&#123;SOURCE_BRANCH&#125;</span> --target-branch <span class="variable">$&#123;TARGET_BRANCH&#125;</span> &gt; mr_info.json</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        jq -r '.iid' mr_info.json &gt; mr_iid</span></span><br><span class="line"><span class="string">        jq -r '.web_url' mr_info.json &gt; mr_url</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def <span class="function"><span class="title">checkMR</span></span>() &#123;</span><br><span class="line">    container(<span class="string">"debian"</span>) &#123;</span><br><span class="line">        retry(120) &#123;</span><br><span class="line">        sh <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        if [ ! -s mr_iid ]; then exit 0; else sleep 60s; fi</span></span><br><span class="line"><span class="string">        gitlab -o json project-merge-request get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid | jq -r "</span>.labels[]<span class="string">" | grep 'approve'</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def <span class="function"><span class="title">mergeMR</span></span>()&#123;</span><br><span class="line">    container(<span class="string">"debian"</span>) &#123;</span><br><span class="line">        retry(10)&#123;</span><br><span class="line">        sh <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        if [ ! -s mr_iid ]; then exit 0; else sleep 60s; fi</span></span><br><span class="line"><span class="string">        if gitlab project-merge-request merge --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid; then sleep 10s; fi</span></span><br><span class="line"><span class="string">        gitlab -o json project-merge-request get --project-id <span class="variable">$&#123;PROJECT_ID&#125;</span> --iid @mr_iid | jq -r "</span>.state<span class="string">" | grep 'merged'</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><ul>
<li>åˆ—å‡º repo tag</li>
</ul>
<p>åœ¨è¿™é‡Œè¿˜æ˜¯æ¨èä½¿ç”¨ git tag çš„æ–¹å¼è·å– repo tag ï¼Œå› ä¸º Gitlab API çš„é™åˆ¶ï¼Œæ¯æ¬¡è¯·æ±‚æœ€å¤šåªèƒ½è¿”å› 100 ä¸ªå€¼ï¼Œå¯ä»¥åŠ ä¸Š <code>--all</code> å‚æ•°æ¥è¿”å›æ‰€æœ‰çš„å€¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab -o json project-tag list --project-id <span class="variable">$&#123;ID&#125;</span> | jq -r <span class="string">'.[].name'</span></span><br><span class="line">$ gitlab -o json project-tag list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">'.[].name'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»º tag</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag create --project-id <span class="variable">$&#123;ID&#125;</span> --tag-name v1.0.0-rc.2 --ref master</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ é™¤ tag</li>
</ul>
<p>upstream ä¸Šçš„ repo tag åªèƒ½é€šè¿‡åœ¨ Gitlab ä¸Šåˆ é™¤ï¼Œåœ¨æœ¬åœ° repo ä¸‹æ˜¯æ— æ³•åˆ é™¤çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ é™¤  Gitlab repo tagï¼Œæ³¨æ„ï¼šå—ä¿æŠ¤çš„ repo tag å¦‚æœæ²¡æœ‰æƒé™çš„è¯æ˜¯æ— æ³•åˆ é™¤çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab project-tag delete --project-id <span class="variable">$&#123;ID&#125;</span> --tag-name v1.0.0-rc.2</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºå—ä¿æŠ¤çš„ repo tag</li>
</ul>
<p>ç”±äºæˆ‘ä»¬æµæ°´çº¿ä»»åŠ¡ä¾èµ–äº repo tag æ¥åšç‰ˆæœ¬çš„å¯¹äºï¼Œå› æ­¤éœ€è¦ä¿æŠ¤æ¯ä¸€ä¸ª repo tagï¼Œä½†æœ‰ç‰¹æ®Šæƒ…å†µä¸‹åˆè¦è¦†ç›– repo tagï¼Œæ‰€ä»¥å—ä¿æŠ¤çš„ repo tag ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåªèƒ½å…ˆæ‰‹åŠ¨åˆ›å»ºäº†ï¼Œç­‰åˆ°éœ€è¦åˆ é™¤çš„æ—¶å€™å†åˆ é™¤å®ƒã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰¹é‡åˆ›å»ºå—ä¿æŠ¤çš„ repo tagã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag | xargs -L1 -I &#123;&#125; gitlab project-protected-tag create --project-id <span class="variable">$&#123;ID&#125;</span> --name &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Lint-æµæ°´çº¿"><a href="#Lint-æµæ°´çº¿" class="headerlink" title="Lint æµæ°´çº¿"></a>Lint æµæ°´çº¿</h2><p>è¿ç§»åˆ°äº† Gitlab ä¹‹ååŸæœ‰çš„æµæ°´çº¿åœ¨å†…ç½‘çš„ Gitlab ä¸Šä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†ï¼Œä¸ºäº†å‡å°‘ç»´æŠ¤æˆæœ¬å°±ä½¿ç”¨äº† Gitlab è‡ªå¸¦çš„ CI ã€‚æˆ‘æ‰€ç»´æŠ¤çš„ repo ä½¿ç”¨ Gitlab CI åªæ˜¯åšä¸€äº› lint çš„æ£€æŸ¥å†…å®¹ï¼Œå› æ­¤ CI é…ç½®èµ·æ¥ä¹Ÿç‰¹åˆ«ç®€å•ã€‚å¦‚ kubespray çš„ CI é…ç½®ï¼š</p>
<ul>
<li><code>.gitlab-ci.yml</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">lint:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">'quay.io/kubespray/kubespray:v2.15.0'</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chmod</span> <span class="string">-R</span> <span class="string">o-w</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">make</span> <span class="string">lint</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">shared</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ gitlab CLI å·¥å…·ç»™æ‰€æœ‰åˆ†æ”¯æ·»åŠ  <code>.gitlab-ci.yml</code> æ–‡ä»¶</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ID=123456</span><br><span class="line">BRANCHS=$(gitlab -o json project-branch list --project-id <span class="variable">$&#123;ID&#125;</span> --all | jq -r <span class="string">".[].name"</span>)</span><br><span class="line"><span class="keyword">for</span> branch <span class="keyword">in</span> <span class="variable">$&#123;BRANCHS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">	gitlab project-file create --project-id <span class="variable">$&#123;ID&#125;</span> --file-path .gitlab-ci.yml --branch <span class="variable">$&#123;branch&#125;</span> --content @.gitlab-ci.yml --commit-message <span class="string">"feat(gitlab-ci): add gitlab-ci.yml for ci"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li>repo è¿ç§»</li>
</ul>
<p>ç”±äºå†…éƒ¨çš„ Gitlab ä¸æ”¯æŒå¯¼å…¥ git url çš„æ–¹å¼ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨åœ°å°† GitHub ä¸Šçš„ repo clone åˆ°æœ¬åœ°å† push åˆ° Gitlab ä¸Šã€‚ä½¿ç”¨ git clone çš„æ–¹å¼æœ¬åœ°åªä¼šæœ‰ä¸€ä¸ª master åˆ†æ”¯ï¼Œè¦æŠŠ GitHub ä¸Š repo çš„æ‰€æœ‰åˆ†æ”¯éƒ½ track ä¸€éï¼Œç„¶åå† push åˆ° Gitlab ä¸Šã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ git clone ä¸‹æ¥çš„ repo é»˜è®¤ä¸º master åˆ†æ”¯</span></span><br><span class="line">$ git <span class="built_in">clone</span> git@gitlab.com/muzi502/kubespray.git</span><br><span class="line"><span class="comment"># track å‡º origin ä¸Šçš„æ‰€æœ‰åˆ†æ”¯</span></span><br><span class="line">$ git branch -r | grep -v <span class="string">'\-&gt;'</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">"<span class="variable">$&#123;remote#origin/&#125;</span>"</span> <span class="string">"<span class="variable">$remote</span>"</span>; <span class="keyword">done</span></span><br><span class="line">$ git fetch --all</span><br><span class="line">$ git pull --all</span><br><span class="line">$ git remote remove origin</span><br><span class="line">$ git remote add origin git@gitlab/gitlab502/kubespray.git</span><br><span class="line">$ git push origin --all</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://stackoverflow.com/questions/10312521/how-to-fetch-all-git-branches" target="_blank" rel="noopener">How to fetch all Git branches</a></li>
<li><a href="https://yixinglu.gitlab.io/gitlab-workflow.html" target="_blank" rel="noopener">GitLab å·¥ä½œæµ</a></li>
<li><a href="https://python-gitlab.readthedocs.io/" target="_blank" rel="noopener">python-gitlab</a></li>
<li><a href="https://docs.gitlab.com/ee/api/README.html" target="_blank" rel="noopener">Gitlab API Docs</a></li>
<li><a href="https://github.com/xanzy/go-gitlab" target="_blank" rel="noopener">go-gitlab</a></li>
<li><a href="https://mp.weixin.qq.com/s/x5PHNn87OYCSpYE_hb8I2A" target="_blank" rel="noopener">è°ˆè°ˆ Git å­˜å‚¨åŸç†åŠç›¸å…³å®ç°</a></li>
<li><a href="https://morningspace.github.io/tech/inside-git-3/" target="_blank" rel="noopener">Gitè§£å¯†â€”â€”è®¤è¯†Gitå¼•ç”¨</a></li>
<li><a href="https://blinkfox.github.io/2018/11/22/ruan-jian-gong-ju/devops/gitlab-ci-jie-shao-he-shi-yong/" target="_blank" rel="noopener">GitLab CI/CD ä»‹ç»å’Œä½¿ç”¨</a></li>
</ul>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ci/" rel="tag"><i class="fa fa-tag"></i> ci</a>
              <a href="/tags/gitlab/" rel="tag"><i class="fa fa-tag"></i> gitlab</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/jenkins-with-kubernetes.html" rel="prev" title="Jenkins å¤§å”ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ ğŸ§‘â€ğŸ¤â€ğŸ§‘">
      <i class="fa fa-chevron-left"></i> Jenkins å¤§å”ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ ğŸ§‘â€ğŸ¤â€ğŸ§‘
    </a></div>
      <div class="post-nav-item">
    <a href="/skopeo-to-registry.html" rel="next" title="å¦‚ä½•ä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§">
      å¦‚ä½•ä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
  </div>
          </div>
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¼€å€’è½¦-ğŸš—-ï¼Ÿ"><span class="nav-number">1.</span> <span class="nav-text">å¼€å€’è½¦ ğŸš— ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab"><span class="nav-number">2.</span> <span class="nav-text">Gitlab</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab-workflow"><span class="nav-number">3.</span> <span class="nav-text">Gitlab workflow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PR"><span class="nav-number">3.1.</span> <span class="nav-text">PR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MR"><span class="nav-number">3.2.</span> <span class="nav-text">MR</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab-API"><span class="nav-number">4.</span> <span class="nav-text">Gitlab API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-gitlab-CLI"><span class="nav-number">5.</span> <span class="nav-text">python-gitlab CLI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…"><span class="nav-number">5.1.</span> <span class="nav-text">å®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é…ç½®"><span class="nav-number">5.2.</span> <span class="nav-text">é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŸºæœ¬ä½¿ç”¨"><span class="nav-number">5.3.</span> <span class="nav-text">åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#project"><span class="nav-number">5.4.</span> <span class="nav-text">project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file"><span class="nav-number">5.5.</span> <span class="nav-text">file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MR-1"><span class="nav-number">5.6.</span> <span class="nav-text">MR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tag"><span class="nav-number">5.7.</span> <span class="nav-text">Tag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lint-æµæ°´çº¿"><span class="nav-number">6.</span> <span class="nav-text">Lint æµæ°´çº¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å…¶ä»–"><span class="nav-number">7.</span> <span class="nav-text">å…¶ä»–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">8.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="æœ¨å­"
      src="https://blog.k8s.li/avatar.png">
  <p class="site-author-name" itemprop="name">æœ¨å­</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail â†’ mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://kindle.502.li/" title="Kindle â†’ https:&#x2F;&#x2F;kindle.502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tg.k8s.li/" title="Channel â†’ https:&#x2F;&#x2F;tg.k8s.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Channel</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æœ¨å­</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">39:50</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
      </div>
    </footer>
  </div>
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.k8s.li/gitlab-cli.html",
            identifier: "gitlab-cli.html",
            title: "python-gitlab CLI ä½¿ç”¨è®°å½•"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://muzi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>
</body>
</html>
