<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å¼€å€’è½¦ ğŸš— ï¼Ÿå¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº† ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸º ğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼ å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab">
<meta property="og:type" content="blog">
<meta property="og:title" content="python-gitlab CLI ä½¿ç”¨è®°å½•">
<meta property="og:url" content="https://blog.k8s.li/gitlab-cli.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="å¼€å€’è½¦ ğŸš— ï¼Ÿå¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº† ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸º ğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼ å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/image-20210319085926423.png">
<meta property="article:published_time" content="2021-03-22T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-19T16:00:00.000Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="gitlab">
<meta property="article:tag" content="ci">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/image-20210319085926423.png">


<link rel="canonical" href="https://blog.k8s.li/gitlab-cli.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/gitlab-cli.html","path":"gitlab-cli.html","title":"python-gitlab CLI ä½¿ç”¨è®°å½•"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>python-gitlab CLI ä½¿ç”¨è®°å½• | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%80%92%E8%BD%A6-%F0%9F%9A%97-%EF%BC%9F"><span class="nav-number">1.</span> <span class="nav-text">å¼€å€’è½¦ ğŸš— ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab"><span class="nav-number">2.</span> <span class="nav-text">Gitlab</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab-workflow"><span class="nav-number">3.</span> <span class="nav-text">Gitlab workflow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PR"><span class="nav-number">3.1.</span> <span class="nav-text">PR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MR"><span class="nav-number">3.2.</span> <span class="nav-text">MR</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab-API"><span class="nav-number">4.</span> <span class="nav-text">Gitlab API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-gitlab-CLI"><span class="nav-number">5.</span> <span class="nav-text">python-gitlab CLI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">5.1.</span> <span class="nav-text">å®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">5.2.</span> <span class="nav-text">é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">5.3.</span> <span class="nav-text">åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#project"><span class="nav-number">5.4.</span> <span class="nav-text">project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file"><span class="nav-number">5.5.</span> <span class="nav-text">file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MR-1"><span class="nav-number">5.6.</span> <span class="nav-text">MR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tag"><span class="nav-number">5.7.</span> <span class="nav-text">Tag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lint-%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-number">6.</span> <span class="nav-text">Lint æµæ°´çº¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">7.</span> <span class="nav-text">å…¶ä»–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">8.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">153</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail â†’ mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/gitlab-cli.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="python-gitlab CLI ä½¿ç”¨è®°å½• | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          python-gitlab CLI ä½¿ç”¨è®°å½•
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-23 2021-03-23T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2021-03-23T00:00:00+08:00">2021-03-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-20 2021-03-20T00:00:00+08:00" itemprop="dateModified" datetime="2021-03-20T00:00:00+08:00">2021-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/gitlab-cli.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="gitlab-cli.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>15 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="å¼€å€’è½¦-ğŸš—-ï¼Ÿ"><a href="#å¼€å€’è½¦-ğŸš—-ï¼Ÿ" class="headerlink" title="å¼€å€’è½¦ ğŸš— ï¼Ÿ"></a>å¼€å€’è½¦ ğŸš— ï¼Ÿ</h2><p>å¹´åè¿™å‡ å‘¨èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å°†æˆ‘å¸çš„ GitHub ä»£ç è¿ç§»åˆ°å†…éƒ¨çš„ Gitlabã€‚å½±å“æœ€å¤§çš„å°±æ˜¯æˆ‘ä»¬äº§å“çš„å‘å¸ƒæµæ°´çº¿ï¼Œéœ€è¦é€‚é… Gitlab å’Œå†…ç½‘ç¯å¢ƒçš„ä¸€äº›æœåŠ¡ã€‚åŸºæœ¬ä¸Šæ•´ä¸ªäº§å“æ‰“åŒ…å‘å¸ƒçš„æµæ°´çº¿ä»£ç å…¨éƒ¨é‡å†™äº†ä¸€éï¼Œå¯ç´¯åå’±äº† ğŸ¥ºã€‚å½“æ—¶å¿ƒé‡Œè¿˜è®¤ä¸ºä»£ç è¿ç§»è‡³ Gitlab çº¯å±å€’è½¦è¡Œä¸º ğŸ˜…ï¼Œä¸è¿‡ç­‰åˆ°æ‰€æœ‰çš„é€‚é…ä¿®æ”¹å®Œæ¯•åå¿½ç„¶å‘ç° Gitlab çœŸé¦™ï¼</p>
<p>å½’æ ¹ç»“åº•å†…ç½‘çš„ Gitlab ç½‘ç»œçŠ¶å†µåå€ç™¾å€ä¸ GitHub ä¸æ­¢ã€‚ä¼—æ‰€å‘¨çŸ¥åœ¨å­¦ä¹ <strong>å¢™å›½</strong>ï¼ŒGitHub ç›´è¿çš„é€Ÿåº¦å’Œç¨³å®šæ€§å·®çš„ä¸€æ‰¹ã€‚ä¹Ÿæ­£å› æ­¤ä¹‹å‰åœ¨ GitHub ä¸Šçš„æµæ°´çº¿ç»å¸¸ä¼šè¢«ç½‘ç»œæŠ–åŠ¨æ‰€å¹²æ‰°ï¼Œæœ‰æ—¶ä¾¯ fetch ä¸€ä¸ª repo åå‡ äºŒååˆ†é’Ÿï¼è¿ç§»åˆ°å†…ç½‘ Gitlab ä¹‹åï¼Œé‚£é€Ÿåº¦ç®€ç›´é£èµ·ï¼ä»¥å¾€æœ€å°‘åå‡ åˆ†é’Ÿçš„æµæ°´çº¿ç°åœ¨åªéœ€è¦ä¸åˆ°äº”åˆ†é’Ÿå°±èƒ½å®Œæˆ ğŸ˜‚ã€‚</p>
<p>äºæ˜¯ä»Šå¤©å°±å†™ç¯‡åšå®¢è®°å½•ä¸€ä¸‹å½“æ—¶æŠ˜è…¾ Gitlab æ—¶æ”¶è·çš„ä¸€ç‚¹äººç”Ÿç»éªŒ ğŸ‘“</p>
<blockquote>
<p>æˆ‘ä»Šå¤©æ˜¯ä½œä¸ºä¸€ä¸ªé•¿è€…ç»™ä½ ä»¬è®²çš„ï¼Œæˆ‘ä¸æ˜¯æ–°é—»å·¥ä½œè€…ï¼Œä½†æ˜¯æˆ‘è§å¾—å¤ªå¤šäº†ï¼Œæˆ‘æœ‰è¿™ä¸ªå¿…è¦å‘Šè¯‰ä½ ä»¬ä¸€ç‚¹äººç”Ÿçš„ç»éªŒ</p>
</blockquote>
<h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><p>åœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„æœ‰å…³ Gitlab çš„æ–‡æ¡£å’Œå·¥å…·ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://about.gitlab.com/topics/version-control/what-is-gitlab-workflow/">Gitlab workflow</a>ï¼šäº†è§£ä¸€ä¸‹ Gitlab çš„å·¥ä½œæµï¼Œä¸åŒäº GitHub çš„ PRï¼Œåœ¨ Gitlab ä¸­ä½¿ç”¨çš„æ˜¯ MR çš„æ–¹å¼ï¼›</li>
<li><a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/api/README.html">Gitlab API</a>ï¼šGitlab API çš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å®ƒåœ¨ä½¿ç”¨ä¸‹ä¸‹é¢è¿™äº›å·¥å…·æ—¶å€™ä¼šå¾—å¿ƒåº”æ‰‹ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html">python-gitlab</a> API clientï¼šä½¿ç”¨ Python å®ç°çš„ Gitlab API clientï¼Œç”¨å®ƒæ¥å®Œæˆä¸€äº›ç‰¹å®šéœ€æ±‚å·¥å…·çš„å¼€å‘ï¼Œæ¯”å¦‚æ ¹æ® tag æˆ–è€… branch è·å– repo ä¸­æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼›</li>
<li><a target="_blank" rel="noopener" href="https://python-gitlab.readthedocs.io/">python-gitlab</a> CLIï¼šåŸºäº <a target="_blank" rel="noopener" href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html">python-gitlab</a> API client å°è£…æˆçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå› ä¸ºæ˜¯ CLI å·¥å…·æ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆåœ¨ä¸€äº›æµæ°´çº¿çš„è„šæœ¬ä¸­ï¼›</li>
<li><a target="_blank" rel="noopener" href="https://github.com/xanzy/go-gitlab">go-gitlab</a> API clientï¼šä½¿ç”¨ Golang å®ç°çš„ Gitlab API clientã€‚ç”±äºå‘å¸ƒæµæ°´çº¿ä¸­çš„ä¸€ä¸ªé˜¶æ®µå°±æ˜¯æ ¹æ®ä¸€ä¸ª list æ¥æ”¶é›†å…¶ä»– repo ä¸­çš„ç‰¹å®šæ–‡ä»¶å’Œç›®å½•ï¼Œä½¿ç”¨çš„å·¥å…·æ˜¯ golang å†™çš„ï¼Œä¸ºäº†å‡å°‘ä»£ç ä¿®æ”¹é‡å°±ä½¿ç”¨äº† go-gitlab è€Œä¸æ˜¯ python-gitlabã€‚</li>
</ul>
<h2 id="Gitlab-workflow"><a href="#Gitlab-workflow" class="headerlink" title="Gitlab workflow"></a><a target="_blank" rel="noopener" href="https://about.gitlab.com/topics/version-control/what-is-gitlab-workflow/">Gitlab workflow</a></h2><h3 id="PR"><a href="#PR" class="headerlink" title="PR"></a>PR</h3><p>åœ¨ GitHub ä¸Šæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ PR çš„æ–¹å¼æ¥å®Œæˆä»£ç åˆå¹¶å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æˆå‘˜ Fork åŸå§‹ä»“åº“ï¼Œå°† Fork å‡ºæ¥çš„ä»“åº“ clone åˆ°æœ¬åœ°</li>
<li>åœ¨æœ¬åœ°åˆ›å»ºæ–°åˆ†æ”¯ï¼Œå¹¶åŸºäºæ–°åˆ†æ”¯è¿›è¡Œä¿®æ”¹å’Œæäº¤ï¼Œæ¨é€æ–°åˆ†æ”¯åˆ° Fork çš„ä»“åº“</li>
<li>åŸºäº Fork ä»“åº“ä¸­çš„æ–°åˆ†æ”¯å‘åŸå§‹ä»“åº“çš„ç›®æ ‡åˆ†æ”¯å‘èµ· Pull Request</li>
<li>åœ¨ PR çš„è¯„è®ºä¸­ @ å®¡æŸ¥è€…ï¼Œè¯·æ±‚ review ä¿®æ”¹</li>
<li>å®¡æŸ¥è€…æ”¶åˆ°è¯·æ±‚é‚®ä»¶ï¼Œå®¡æŸ¥ä»£ç ï¼Œå¹¶åœ¨å»ºè®®å¤„ç›´æ¥åšå‡ºè¯„è®º</li>
<li>æäº¤è€…æ ¹æ®å»ºè®®ï¼Œç»§ç»­æäº¤æ”¹åŠ¨ï¼Œå¹¶å¯¹æ„è§ä½œå‡ºå›åº”</li>
<li>å®¡æŸ¥è€…æ— å¼‚è®®åï¼Œåœ¨ PR çš„è¯„è®ºä¸­ @ ç®¡ç†å‘˜ï¼Œè¯·æ±‚åˆå…¥ä»£ç ï¼Œç®¡ç†å‘˜æ¥å— PRï¼Œä»£ç åˆå…¥ä¸»åˆ†æ”¯</li>
</ul>
<h3 id="MR"><a href="#MR" class="headerlink" title="MR"></a>MR</h3><p>ä½†æ˜¯åˆ°äº† Gitlab ä¹‹åæˆ‘ä»¬å°±ä½¿ç”¨ MR çš„æ–¹å¼æ¥å®Œæˆä»£ç åˆå¹¶å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æˆå‘˜ Clone åŸå§‹ä»“åº“åˆ°æœ¬åœ°ï¼ŒåŸºäºè¦ä¿®æ”¹çš„åˆ†æ”¯ï¼Œåˆ›å»ºæ–°çš„åˆ†æ”¯</li>
<li>æœ¬åœ°ä¿®æ”¹å’Œæäº¤ï¼Œæ¨é€æ–°åˆ†æ”¯åˆ°åŸå§‹ä»“åº“</li>
<li>åœ¨åŸå§‹ä»“åº“ä¸­åŸºäºæ–°åˆ†æ”¯å‘ç›®æ ‡ä¿æŠ¤åˆ†æ”¯å‘èµ· Merge Request</li>
<li>å®¡æ ¸è€… review ä»£ç ï¼Œç®¡ç†å‘˜ Merge ä»£ç </li>
</ul>
<p>ç›¸æ¯”æ¥è®² MR å’Œæ–¹å¼æ›´é€‚åˆå›¢é˜Ÿå†…éƒ¨çš„åä½œå¼€å‘ï¼ŒPR çš„æ–¹å¼é€‚åˆå¼€æºé¡¹ç›®çš„åä½œå¼€å‘ã€‚</p>
<h2 id="Gitlab-API"><a href="#Gitlab-API" class="headerlink" title="Gitlab API"></a><a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/api/README.html">Gitlab</a> API</h2><blockquote>
<p>The main GitLab API is a <a target="_blank" rel="noopener" href="http://spec.openapis.org/oas/v3.0.3">REST</a> API. Because of this, the documentation in this section assumes that youâ€™re familiar with REST concepts.</p>
</blockquote>
<p>å‚ç…§å®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/api/api_resources.html">API resources</a> å¯çŸ¥ï¼Œå…±æœ‰ Projects ã€Groupsã€Standalone è¿™ä¸‰ç§ API åˆ†ç»„ã€‚</p>
<ul>
<li>Projectsï¼š å¯¹åº”çš„å°±æ˜¯ä¸ repo ç›¸å…³çš„ API ï¼Œæ¯”å¦‚ tagã€commitã€branch ã€MRã€Issue è¿™ä¸€ç±»å‹ï¼›</li>
<li>Groupsï¼š å¯¹åº”ç±»ä¼¼äº GitHub ä¸Šçš„ Organizationsï¼Œä¸€èˆ¬æ¥è®²å…¬å¸é‡Œçš„ repo éƒ½ä¼šæŒ‰ç…§å›¢é˜Ÿæ¥åˆ’åˆ†ç»„ç»‡ï¼ŒåŒä¸€å›¢é˜Ÿé‡Œçš„ repo ä¼šæ”¾åœ¨ gitlab åŒä¸€ä¸ª Groups  ä¸‹ï¼Œè€Œä¸æ˜¯ä»¥ä¸ªäººä¸ºå•ä½å­˜æ”¾ repoï¼›</li>
<li>Standaloneï¼šåˆ™æ˜¯é™¤äº† Projects å’Œ Groups ä¹‹å¤–çš„ API èµ„æºï¼Œå¦‚ user</li>
</ul>
<p>è€Œæˆ‘ä»¬å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ Projects ç›¸å…³çš„ APIï¼Œé€šè¿‡å®ƒæ¥å¯¹ repo è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚ç®€å•ä»‹ç»å®Œ Gitlab API ç±»å‹ä¹‹åï¼Œæœ¬æ–‡ä¼šä»‹ç»å‡ ç§ä½¿ç”¨ Gitlab API çš„å·¥å…·ã€‚åœ¨ä½¿ç”¨è¿™äº›å·¥å…·çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°ä¸€äº›é”™è¯¯å¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/api/README.html#status-codes">Status codes</a> API è¿”å›çŠ¶æ€ç æ¥æ’æŸ¥é—®é¢˜ã€‚</p>
<h2 id="python-gitlab-CLI"><a href="#python-gitlab-CLI" class="headerlink" title="python-gitlab CLI"></a><a target="_blank" rel="noopener" href="https://python-gitlab.readthedocs.io/">python-gitlab</a> CLI</h2><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ <a target="_blank" rel="noopener" href="https://python-gitlab.readthedocs.io/en/stable/api-objects.html">python-gitlab</a> API client å°è£…å¥½çš„ gitlab å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å®Œæˆç»å¤§å¤šæ•° Gitlab API æ‰€æ”¯æŒçš„æ“ä½œã€‚å› ä¸ºä¹‹å‰çš„æµæ°´çº¿ä¸­æœ‰å¾ˆå¤šæ“ä½œæ˜¯è®¿é—®çš„ GitHubï¼Œæ¯”å¦‚æäº¤ PRã€è·å– repo tagã€æŸ¥çœ‹ PR labels ç­‰ï¼Œéƒ½æ˜¯å†™åœ¨ Jenkinsfile è°ƒç”¨å„ç§è„šæœ¬å’Œå·¥å…·æ¥å®Œæˆçš„ã€‚ åˆ‡æ¢åˆ°äº† Gitlabï¼Œè‡ªç„¶ä¹Ÿéœ€è¦ä¸€ä¸ªå·¥å…·æ¥å®Œæˆä¸Šè¿°æ“ä½œäº†ã€‚é‚£ä¹ˆ python-gitlab CLI è¿™ä¸ªå·¥å…·æ— ç–‘æ˜¯ä¸äºŒä¹‹é€‰ï¼Œç”šè‡³æ¯”ä¹‹å‰çš„å·¥å…·æ›´æ–¹ä¾¿ã€‚å› ä¸ºè¿„ä»Šä¸ºæ­¢è¿˜æ²¡æœ‰è§åˆ°è¿‡ GitHub èƒ½æœ‰åƒ python-gitlab è¿™æ ·çš„å·¥å…·ã€‚æ€»ä¹‹ï¼Œå¯¹äºä½¿ç”¨ Gitlab çš„äººæ¥è®²ï¼Œè¦å¯¹ repo å®Œæˆä¸€äº›è‡ªåŠ¨åŒ–å¤„ç†çš„å·¥ä½œï¼Œå¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸ª CLI å·¥å…·ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆåœ¨æµæ°´çº¿ä¸­ã€‚</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>python-gitlab CLI ä¾èµ– Python 2.7 æˆ–è€… 3.4+ï¼Œ2021 å¹´å•¦ï¼Œå°±ä¸è¦ä½¿ç”¨ Python2.7 å•¦ ğŸ˜Šã€‚æœ¬åœ°å®‰è£…å¥½ python3 å’Œ pip3 åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…å³å¯ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨è¿™é‡Œä½¿ç”¨æ¸…åçš„ pypi æºæ¥åŠ é€Ÿå®‰è£…ï¼Œæ¯•ç«Ÿæ˜¯å¢™ğŸ§±å›½</span>
$ <span class="token function">sudo</span> pip3 <span class="token function">install</span> <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple requests PyYAML python-gitlab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ç”±äºä½¿ç”¨è¿™ä¸ªå·¥å…·çš„åœºæ™¯å¤§å¤šæ•°æ˜¯åœ¨ Jenkins æ‰€åˆ›å»ºçš„ slave pod ä¸­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥æ„å»ºä¸€ä¸ª docker é•œåƒï¼Œ <code>Dockerfile</code> å¦‚ä¸‹</p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> debian:buster</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt update <span class="token operator">\</span>
    &amp;&amp; apt install -y --no-install-recommends <span class="token operator">\</span>
        git <span class="token operator">\</span>
        python3 <span class="token operator">\</span>
        python3-pip <span class="token operator">\</span>
        jq <span class="token operator">\</span>
    &amp;&amp; rm -rf /var/lib/apt/lists/* <span class="token operator">\</span>
    &amp;&amp; pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple requests PyYAML python-gitlab</span>

<span class="token instruction"><span class="token keyword">COPY</span> python-gitlab.cfg /etc/python-gitlab.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>Gitlab CLI å·¥å…·éœ€è¦ä½¿ç”¨ä¸€ä¸ª <code>python-gitlab.cfg</code> é…ç½®æ–‡ä»¶ç”¨äºè¿æ¥ Gitlab æœåŠ¡å™¨ä»¥åŠå®Œæˆä¸€äº›é‰´æƒè®¤è¯ï¼Œé…ç½®æ–‡ä»¶æ ¼å¼ä¸º <code>ini</code> å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">global</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">default</span> <span class="token punctuation">=</span> <span class="token value attr-value">gitlab.com</span>
<span class="token key attr-name">ssl_verify</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">5</span>
<span class="token key attr-name">per_page</span> <span class="token punctuation">=</span> <span class="token value attr-value">100</span>
<span class="token key attr-name">api_version</span> <span class="token punctuation">=</span> <span class="token value attr-value">4</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">gitlab.com</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://gitlab.com</span>
<span class="token key attr-name">private_token</span> <span class="token punctuation">=</span> <span class="token value attr-value">xxxxxxxxx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>å…¨å±€çš„è¿æ¥å‚æ•°</li>
</ul>
<table>
<thead>
<tr>
<th>Option</th>
<th>Possible values</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ssl_verify</code></td>
<td><code>True</code> æˆ– <code>False</code></td>
<td>æ˜¯å¦å¼€å¯ SSL åŠ å¯†éªŒè¯</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>è¯ä¹¦</td>
<td>è¿æ¥è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td><code>api_version</code></td>
<td><code>4</code></td>
<td>API çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 4 å³å¯ï¼Œå‚è€ƒ <a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/api/v3_to_v4.html">API V3 to API V4</a></td>
</tr>
<tr>
<td><code>per_page</code></td>
<td>1 ï½ 100</td>
<td>æ¯æ¬¡è¿”å›çš„å…ƒç´ æ•°é‡ï¼ŒGitlab çš„æœ€å¤§é™åˆ¶ä¸º 100ã€‚å¯ä»¥é€šè¿‡ <code>--all</code> å‚æ•°è·å–æ‰€æœ‰çš„å…ƒç´ </td>
</tr>
</tbody></table>
<ul>
<li>è‡ªå®šä¹‰ GitLab server å‚æ•°</li>
</ul>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>url</code></td>
<td>GitLab server çš„ URL</td>
</tr>
<tr>
<td><code>private_token</code></td>
<td>é€šè¿‡è®¿é—® gitlab æœåŠ¡å™¨çš„ <a target="_blank" rel="noopener" href="https://gitlab.com/-/profile/personal_access_tokens">-&#x2F;profile&#x2F;personal_access_tokens</a> æ¥ç”Ÿæˆ token</td>
</tr>
<tr>
<td><code>oauth_token</code></td>
<td></td>
</tr>
<tr>
<td><code>job_token</code></td>
<td></td>
</tr>
<tr>
<td><code>api_version</code></td>
<td>API çš„ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 4 å³å¯ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å®šä¹‰ï¼Œä½¿ç”¨å…¨å±€å‚æ•°</td>
</tr>
<tr>
<td><code>http_username</code></td>
<td>Gitlab ç”¨æˆ·åï¼Œä¸æ¨èä½¿ç”¨å®ƒæ¥è¿æ¥ Gitlab æœåŠ¡å™¨</td>
</tr>
<tr>
<td><code>http_password</code></td>
<td>Gitlab å¯†ç ï¼Œä¸æ¨èä½¿ç”¨å®ƒæ¥è¿æ¥ Gitlab æœåŠ¡å™¨</td>
</tr>
</tbody></table>
<p>å°†æ–‡ä»¶ä¿å­˜åœ¨ <code>~/.python-gitlab.cfg</code> æˆ–è€… <code>/etc/python-gitlab.cfg</code> ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ <code>PYTHON_GITLAB_CFG</code> æˆ–è€… <code>--config-file</code> æ‰§è¡Œé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸ºäº†çœäº‹å„¿è¿˜æ˜¯å°†å®ƒæ”¾åˆ° <code>~/.python-gitlab.cfg</code> ä¸‹ã€‚</p>
<p>é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ <code>gitlab current-user get</code> å‘½ä»¤æµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœæœ‰è¿”å›å€¼ä¸”æ­£ç¡®çš„ç”¨æˆ·åè¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab current-user get
username: muzi502<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>gitlab å‘½ä»¤è¡Œå·¥å…·ä¸»è¦æ˜¯å¯¹ Gitlab æœåŠ¡å™¨ä¸Šçš„å„ç§å¯¹è±¡å¦‚ï¼šuser, project, file, repo, mr, tag, commit ç­‰è¿›è¡Œå¢åˆ æ”¹æŸ¥(getã€listã€createã€deleteã€update)ã€‚ä½¿ç”¨çš„å‘½ä»¤è¡Œæ ¼å¼æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab <span class="token operator">&lt;</span>option<span class="token operator">></span> <span class="token punctuation">[</span>object<span class="token punctuation">]</span> <span class="token punctuation">[</span>action<span class="token punctuation">]</span> <span class="token operator">&lt;</span>option<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¸€èˆ¬æ¥è®²åªéœ€è¦ 4 ç§å‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç´§æ¥ç€ gitlab å‘½ä»¤åé¢çš„å‚æ•°ï¼Œå®ƒæ˜¯ gitlab å‘½ä»¤è¡Œçš„è¾“å‡ºå‚æ•°å’Œé…ç½®å‚æ•°ï¼Œå¦‚ <code>-o </code> å‚æ•°æŒ‡å®šè¾“å‡ºç»“æœçš„æ ¼å¼ï¼›<code>-f</code> å‚æ•°å°†è¾“å‡ºç»“æœå­˜æ”¾åˆ°æ–‡ä»¶ä¸­; <code>-g</code> å‚æ•°æ‰§è¡Œè¿æ¥å“ªä¸ª Gitlab æœåŠ¡å™¨ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ç”¨æ¥æŒ‡å®šæ‰€è¦æ“ä½œçš„å¯¹è±¡ï¼Œæ¯”å¦‚ project-merge-requestï¼Œproject-tag ç­‰ï¼Œæ‰€æ”¯æŒçš„å¯¹è±¡æœ‰å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šæ¶µç›–äº†æ‰€æœ‰ Gitlab API æ‰€æ”¯æŒçš„æ“ä½œå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">$ gitlab -h
usage<span class="token operator">:</span> gitlab <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>--version<span class="token punctuation">]</span> <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> <span class="token punctuation">[</span>-d<span class="token punctuation">]</span> <span class="token punctuation">[</span>-c CONFIG_FILE<span class="token punctuation">]</span> <span class="token punctuation">[</span>-g GITLAB<span class="token punctuation">]</span> <span class="token punctuation">[</span>-o <span class="token punctuation">&#123;</span>json<span class="token punctuation">,</span>legacy<span class="token punctuation">,</span>yaml<span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-f FIELDS<span class="token punctuation">]</span>
<span class="token punctuation">&#123;</span>application<span class="token punctuation">,</span>application-appearance<span class="token punctuation">,</span>application-settings<span class="token punctuation">,</span>audit-event<span class="token punctuation">,</span>broadcast-message<span class="token punctuation">,</span>current-user<span class="token punctuation">,</span>current-user-email<span class="token punctuation">,</span>current-user-gp-gkey<span class="token punctuation">,</span>current-user-key<span class="token punctuation">,</span>current-user-status<span class="token punctuation">,</span>deploy-key<span class="token punctuation">,</span>deploy-token<span class="token punctuation">,</span>dockerfile<span class="token punctuation">,</span>event<span class="token punctuation">,</span>feature<span class="token punctuation">,</span>geo-node<span class="token punctuation">,</span>gitignore<span class="token punctuation">,</span>gitlabciyml<span class="token punctuation">,</span>group<span class="token punctuation">,</span>group-access-request<span class="token punctuation">,</span>group-badge<span class="token punctuation">,</span>group-board<span class="token punctuation">,</span>group-board-list<span class="token punctuation">,</span>group-cluster<span class="token punctuation">,</span>group-custom-attribute<span class="token punctuation">,</span>group-deploy-token<span class="token punctuation">,</span>group-epic<span class="token punctuation">,</span>group-epic-issue<span class="token punctuation">,</span>group-epic-resource-label-event<span class="token punctuation">,</span>group-export<span class="token punctuation">,</span>group-import<span class="token punctuation">,</span>group-issue<span class="token punctuation">,</span>group-label<span class="token punctuation">,</span>group-member<span class="token punctuation">,</span>group-merge-request<span class="token punctuation">,</span>group-milestone<span class="token punctuation">,</span>group-notification-settings<span class="token punctuation">,</span>group-package<span class="token punctuation">,</span>group-project<span class="token punctuation">,</span>group-runner<span class="token punctuation">,</span>group-subgroup<span class="token punctuation">,</span>group-variable<span class="token punctuation">,</span>hook<span class="token punctuation">,</span>issue<span class="token punctuation">,</span>l-da-pgroup<span class="token punctuation">,</span>license<span class="token punctuation">,</span>merge-request<span class="token punctuation">,</span>namespace<span class="token punctuation">,</span>notification-settings<span class="token punctuation">,</span>pages-domain<span class="token punctuation">,</span>project<span class="token punctuation">,</span>project-access-request<span class="token punctuation">,</span>project-additional-statistics<span class="token punctuation">,</span>project-approval<span class="token punctuation">,</span>project-approval-rule<span class="token punctuation">,</span>project-badge<span class="token punctuation">,</span>project-board<span class="token punctuation">,</span>project-board-list<span class="token punctuation">,</span>project-branch<span class="token punctuation">,</span>project-cluster<span class="token punctuation">,</span>project-commit<span class="token punctuation">,</span>project-commit-comment<span class="token punctuation">,</span>project-commit-discussion<span class="token punctuation">,</span>project-commit-discussion-note<span class="token punctuation">,</span>project-commit-status<span class="token punctuation">,</span>project-custom-attribute<span class="token punctuation">,</span>project-deploy-token<span class="token punctuation">,</span>project-deployment<span class="token punctuation">,</span>project-environment<span class="token punctuation">,</span>project-event<span class="token punctuation">,</span>project-export<span class="token punctuation">,</span>project-file<span class="token punctuation">,</span>project-fork<span class="token punctuation">,</span>project-hook<span class="token punctuation">,</span>project-import<span class="token punctuation">,</span>project-issue<span class="token punctuation">,</span>project-issue-award-emoji<span class="token punctuation">,</span>project-issue-discussion<span class="token punctuation">,</span>project-issue-discussion-note<span class="token punctuation">,</span>project-issue-link<span class="token punctuation">,</span>project-issue-note<span class="token punctuation">,</span>project-issue-note-award-emoji<span class="token punctuation">,</span>project-issue-resource-label-event<span class="token punctuation">,</span>project-issue-resource-milestone-event<span class="token punctuation">,</span>project-issues-statistics<span class="token punctuation">,</span>project-job<span class="token punctuation">,</span>project-key<span class="token punctuation">,</span>project-label<span class="token punctuation">,</span>project-member<span class="token punctuation">,</span>project-merge-request<span class="token punctuation">,</span>project-merge-request-approval<span class="token punctuation">,</span>project-merge-request-approval-rule<span class="token punctuation">,</span>project-merge-request-award-emoji<span class="token punctuation">,</span>project-merge-request-diff<span class="token punctuation">,</span>project-merge-request-discussion<span class="token punctuation">,</span>project-merge-request-discussion-note<span class="token punctuation">,</span>project-merge-request-note<span class="token punctuation">,</span>project-merge-request-note-award-emoji<span class="token punctuation">,</span>project-merge-request-resource-label-event<span class="token punctuation">,</span>project-merge-request-resource-milestone-event<span class="token punctuation">,</span>project-milestone<span class="token punctuation">,</span>project-note<span class="token punctuation">,</span>project-notification-settings<span class="token punctuation">,</span>project-package<span class="token punctuation">,</span>project-pages-domain<span class="token punctuation">,</span>project-pipeline<span class="token punctuation">,</span>project-pipeline-bridge<span class="token punctuation">,</span>project-pipeline-job<span class="token punctuation">,</span>project-pipeline-schedule<span class="token punctuation">,</span>project-pipeline-schedule-variable<span class="token punctuation">,</span>project-pipeline-variable<span class="token punctuation">,</span>project-protected-branch<span class="token punctuation">,</span>project-protected-tag<span class="token punctuation">,</span>project-push-rules<span class="token punctuation">,</span>project-registry-repository<span class="token punctuation">,</span>project-registry-tag<span class="token punctuation">,</span>project-release<span class="token punctuation">,</span>project-remote-mirror<span class="token punctuation">,</span>project-runner<span class="token punctuation">,</span>project-service<span class="token punctuation">,</span>project-snippet<span class="token punctuation">,</span>project-snippet-award-emoji<span class="token punctuation">,</span>project-snippet-discussion<span class="token punctuation">,</span>project-snippet-discussion-note<span class="token punctuation">,</span>project-snippet-note<span class="token punctuation">,</span>project-snippet-note-award-emoji<span class="token punctuation">,</span>project-tag<span class="token punctuation">,</span>project-trigger<span class="token punctuation">,</span>project-user<span class="token punctuation">,</span>project-variable<span class="token punctuation">,</span>project-wiki<span class="token punctuation">,</span>runner<span class="token punctuation">,</span>runner-job<span class="token punctuation">,</span>snippet<span class="token punctuation">,</span>todo<span class="token punctuation">,</span>user<span class="token punctuation">,</span>user-activities<span class="token punctuation">,</span>user-custom-attribute<span class="token punctuation">,</span>user-email<span class="token punctuation">,</span>user-event<span class="token punctuation">,</span>user-gp-gkey<span class="token punctuation">,</span>user-impersonation-token<span class="token punctuation">,</span>user-key<span class="token punctuation">,</span>user-membership<span class="token punctuation">,</span>user-project<span class="token punctuation">,</span>user-status<span class="token punctuation">,</span>variable<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ action å‚æ•°ï¼Œå³ç”¨äºæŒ‡å®šå¯¹æ‰€æ“ä½œçš„å¯¹è±¡è¿›è¡Œä½•ç§æ“ä½œï¼Œä¸€èˆ¬æ¥è®²éƒ½ä¼šæ”¯æŒå¢åˆ æ”¹æŸ¥æ“ä½œï¼ˆget, list, create, update, deleteï¼‰</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-tag
usage: gitlab project-tag <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>list,get,create,delete,set-release-description<span class="token punctuation">&#125;</span> <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ object + action æ‰€ä¾èµ–çš„å‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®š project id</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-tag list
usage: gitlab project-tag list --project-id PROJECT_ID <span class="token punctuation">[</span>--page PAGE<span class="token punctuation">]</span> <span class="token punctuation">[</span>--per-page PER_PAGE<span class="token punctuation">]</span> <span class="token punctuation">[</span>--all<span class="token punctuation">]</span>
gitlab project-tag list: error: the following arguments are required: --project-id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>Project-IDï¼šæ˜¯ gitlab ä¸Šå”¯ä¸€è¡¨ç¤ºè¯¥ repo çš„ IDï¼Œå¯åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ <code>group/project</code> çš„å½¢å¼ï¼Œå…¶ä¸­ <code>/</code> è¦è½¬è¯‘æˆ <code>%2F</code> å¦‚ï¼š<code>muzi502%2Fkubespray</code>ï¼›å¦ä¸€ç§åˆ™æ˜¯æ•°å­—çš„å½¢å¼ï¼Œåœ¨è¯¥ repo çš„ web é¡µé¢ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§ã€‚</p>
<p><img data-src="https://p.k8s.li/image-20210319085926423.png" alt="image-20210319085926423"></p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨gitlab å‘½ä»¤è·å– repo çš„ id</span>
$ gitlab project get <span class="token parameter variable">--id</span> muzi502%2Fkubespray
id: <span class="token number">25099880</span>
path: kubespray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>åœ¨æµæ°´çº¿ä¸­å¯ä»¥æ ¹æ® token è·å–ç”¨æˆ·çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼Œç”¨äºé…ç½®æµæ°´çº¿ä¸­çš„ repo git ä¿¡æ¯ï¼Œé¿å…å› ä¸º CLA æ— æ³•é€šè¿‡ã€‚</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitlab <span class="token parameter variable">-o</span> json current-user get <span class="token operator">|</span> jq <span class="token string">'.id'</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token variable"><span class="token variable">$(</span>gitlab <span class="token parameter variable">-o</span> json current-user get <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.email'</span><span class="token variable">)</span></span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token variable"><span class="token variable">$(</span>gitlab <span class="token parameter variable">-o</span> json current-user get <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.username'</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="project"><a href="#project" class="headerlink" title="project"></a>project</h3><ul>
<li>è·å– repo ssh url  åœ°å€</li>
</ul>
<p>ç”±äº Jenkins æµæ°´çº¿ä¸­ clone çš„ repo url æ˜¯ä½¿ç”¨ token+ https çš„æ–¹å¼ï¼Œåœ¨æµæ°´çº¿ä¸­å¦‚æœè¦ push ä»£ç åˆ° repo éœ€è¦ä¿®æ”¹ä¸º ssh çš„æ–¹å¼ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ ¹æ® project id æ¥è·å–è¯¥ repo çš„ ssh urlã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab <span class="token parameter variable">-o</span> json  project get <span class="token parameter variable">--id</span> <span class="token variable">$&#123;PROJECT_ID&#125;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.ssh_url_to_repo'</span>
$ <span class="token function">git</span> remote remove origin
$ <span class="token function">git</span> remote <span class="token function">add</span> origin <span class="token variable"><span class="token variable">$(</span>gitlab <span class="token parameter variable">-o</span> json  project get <span class="token parameter variable">--id</span> $<span class="token punctuation">&#123;</span>PROJECT_ID<span class="token punctuation">&#125;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.ssh_url_to_repo'</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>å¯¹äº repo ä¸­æ–‡ä»¶çš„æ“ä½œä½¿ç”¨ project-file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-file
usage: gitlab project-file <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>get,create,update,delete,raw,blame<span class="token punctuation">&#125;</span> <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>è·å–æ–‡ä»¶ï¼Œé€šè¿‡ <code>project-file</code> å¯¹è±¡çš„ get æ“ä½œ</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab <span class="token parameter variable">-o</span> json project-file get --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore <span class="token parameter variable">--ref</span> master  <span class="token operator">|</span> jq <span class="token string">'.'</span>
<span class="token punctuation">&#123;</span>
  <span class="token string">"file_name"</span><span class="token builtin class-name">:</span> <span class="token string">".gitignore"</span>,
  <span class="token string">"file_path"</span><span class="token builtin class-name">:</span> <span class="token string">".gitignore"</span>,
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">1208</span>,
  <span class="token string">"encoding"</span><span class="token builtin class-name">:</span> <span class="token string">"base64"</span>,
  <span class="token string">"content_sha256"</span><span class="token builtin class-name">:</span> <span class="token string">"91f1d50ba3a4f79f96d9371afc70b389f75dfb2ac5190b8fb01051aa8679fd04"</span>,
  <span class="token string">"ref"</span><span class="token builtin class-name">:</span> <span class="token string">"master"</span>,
  <span class="token string">"blob_id"</span><span class="token builtin class-name">:</span> <span class="token string">"b09ca9d3b101034c7e34430177c1d64738df5fbb"</span>,
  <span class="token string">"commit_id"</span><span class="token builtin class-name">:</span> <span class="token string">"a9c97e5253c455546c2c7fdd794147eeb9b8ab7a"</span>,
  <span class="token string">"last_commit_id"</span><span class="token builtin class-name">:</span> <span class="token string">"4ffc106c58fc5865b6d72a52365e25b8c268d4d8"</span>,
  <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"LnZhZ3JhbnQKKi5yZXRyeQoqKi92YWdyYW50X2Fuc2libGVfaW52ZW50b3J5CiouaW1sCnRlbXAKLmlkZWEKLnRveAouY2FjaGUKKi5iYWsKKi50ZnN0YXRlCioudGZzdGF0ZS5iYWNrdXAKLnRlcnJhZm9ybS8KY29udHJpYi90ZXJyYWZvcm0vYXdzL2NyZWRlbnRpYWxzLnRmdmFycwovc3NoLWJhc3Rpb24uY29uZgoqKi8qLnN3W3Bvbl0KKn4KdmFncmFudC8KcGx1Z2lucy9taXRvZ2VuCgojIEFuc2libGUgaW52ZW50b3J5CmludmVudG9yeS8qCiFpbnZlbnRvcnkvbG9jYWwKIWludmVudG9yeS9zYW1wbGUKaW52ZW50b3J5LyovYXJ0aWZhY3RzLwoKIyBCeXRlLWNvbXBpbGVkIC8gb3B0aW1pemVkIC8gRExMIGZpbGVzCl9fcHljYWNoZV9fLwoqLnB5W2NvZF0KKiRweS5jbGFzcwoKIyBEaXN0cmlidXRpb24gLyBwYWNrYWdpbmcKLlB5dGhvbgplbnYvCmJ1aWxkLwpjcmVkZW50aWFscy8KZGV2ZWxvcC1lZ2dzLwpkaXN0Lwpkb3dubG9hZHMvCmVnZ3MvCi5lZ2dzLwpwYXJ0cy8Kc2Rpc3QvCnZhci8KKi5lZ2ctaW5mby8KLmluc3RhbGxlZC5jZmcKKi5lZ2cKCiMgUHlJbnN0YWxsZXIKIyAgVXN1YWxseSB0aGVzZSBmaWxlcyBhcmUgd3JpdHRlbiBieSBhIHB5dGhvbiBzY3JpcHQgZnJvbSBhIHRlbXBsYXRlCiMgIGJlZm9yZSBQeUluc3RhbGxlciBidWlsZHMgdGhlIGV4ZSwgc28gYXMgdG8gaW5qZWN0IGRhdGUvb3RoZXIgaW5mb3MgaW50byBpdC4KKi5tYW5pZmVzdAoqLnNwZWMKCiMgSW5zdGFsbGVyIGxvZ3MKcGlwLWxvZy50eHQKcGlwLWRlbGV0ZS10aGlzLWRpcmVjdG9yeS50eHQKCiMgVW5pdCB0ZXN0IC8gY292ZXJhZ2UgcmVwb3J0cwpodG1sY292LwoudG94LwouY292ZXJhZ2UKLmNvdmVyYWdlLioKLmNhY2hlCm5vc2V0ZXN0cy54bWwKY292ZXJhZ2UueG1sCiosY292ZXIKLmh5cG90aGVzaXMvCgojIFRyYW5zbGF0aW9ucwoqLm1vCioucG90CgojIERqYW5nbyBzdHVmZjoKKi5sb2cKbG9jYWxfc2V0dGluZ3MucHkKCiMgRmxhc2sgc3R1ZmY6Cmluc3RhbmNlLwoud2ViYXNzZXRzLWNhY2hlCgojIFNjcmFweSBzdHVmZjoKLnNjcmFweQoKIyBTcGhpbnggZG9jdW1lbnRhdGlvbgpkb2NzL19idWlsZC8KCiMgUHlCdWlsZGVyCnRhcmdldC8KCiMgSVB5dGhvbiBOb3RlYm9vawouaXB5bmJfY2hlY2twb2ludHMKCiMgcHllbnYKLnB5dGhvbi12ZXJzaW9uCgojIGRvdGVudgouZW52CgojIHZpcnR1YWxlbnYKdmVudi8KRU5WLwo="</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># æ–‡ä»¶å†…å®¹æ˜¯ base64 ç¼–ç çš„ï¼Œéœ€è¦ä½¿ç”¨ base64 è§£ç æ‰èƒ½è·å–åŸå§‹çš„å†…å®¹ã€‚</span>
$ gitlab <span class="token parameter variable">-g</span> gitlab <span class="token parameter variable">-o</span> json project-file get --project-id <span class="token number">25099880</span> --file-path .gitignore <span class="token parameter variable">--ref</span> master  <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.content'</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>
.vagrant
*.retry
**/vagrant_ansible_inventory
*.iml
temp
.idea
.tox
â€¦â€¦â€¦â€¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>é€šè¿‡ project-file çš„ raw æ–¹æ³•å¯ä»¥è·å–æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œæ— é¡» base64 è§£ç </li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-file get --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore <span class="token parameter variable">--ref</span> master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>åˆ›å»ºæ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶çš„å¢åˆ æ”¹éƒ½æ˜¯é€šè¿‡æäº¤ commit æ¥å®Œæˆçš„ï¼Œå› æ­¤éœ€è¦æŒ‡å®šæ‰€è¦æ“ä½œçš„åˆ†æ”¯ä»¥åŠ commit-message çš„ä¿¡æ¯ã€‚å¦å¤–å¦‚æœæ“ä½œçš„æ–‡ä»¶æ˜¯ master åˆ†æ”¯è·å–å…¶ä»–ä¿æŠ¤åˆ†æ”¯ï¼Œè¦ç¡®ä¿å½“å‰ç”¨æˆ·æœ‰å†™å…¥çš„æƒé™ï¼Œä¸ç„¶ä¼šæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gitlab project-file update
Impossible to update object <span class="token punctuation">(</span><span class="token number">400</span>: You are not allowed to push into this branch<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p>ä¹‹å‰åœ¨ GitHub ä¸Šæœ‰ä¸€å¥— CI å¹¶ä¸èƒ½é€‚ç”¨äº Gitlabï¼Œå› æ­¤éœ€è¦ä¸ºæ‰€æœ‰çš„åˆ†æ”¯åˆ›å»º CI æµæ°´çº¿ï¼Œç”¨äºæ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æ‰¹é‡é‡åœ°å‘æ‰€æœ‰åˆ†æ”¯åˆ›å»ºæ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">123456</span>
<span class="token assign-left variable">BRANCHS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>gitlab <span class="token parameter variable">-o</span> json project-branch list --project-id $<span class="token punctuation">&#123;</span>ID<span class="token punctuation">&#125;</span> <span class="token parameter variable">--all</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">".[].name"</span><span class="token variable">)</span></span>
<span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">$&#123;BRANCHS&#125;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	gitlab project-file create --project-id <span class="token variable">$&#123;ID&#125;</span> --file-path .gitlab-ci.yml <span class="token parameter variable">--branch</span> <span class="token variable">$&#123;branch&#125;</span> <span class="token parameter variable">--content</span> @.gitlab-ci.yml --commit-message <span class="token string">"feat(gitlab-ci): add gitlab-ci.yml for ci"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>æ›´æ–°æ–‡ä»¶</li>
</ul>
<p>æ¯”å¦‚æ‰¹é‡æ›´æ–°æ‰€æœ‰åˆ†æ”¯çš„ <code>Makefile</code> ä¸­ <code>github.com</code> ä¸º <code>gitlab.com</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">123456</span>
<span class="token assign-left variable">BRANCHS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>gitlab <span class="token parameter variable">-o</span> json project-branch list --project-id $<span class="token punctuation">&#123;</span>ID<span class="token punctuation">&#125;</span> <span class="token parameter variable">--all</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">".[].name"</span><span class="token variable">)</span></span>
<span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">$&#123;BRANCHS&#125;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token function">rm</span> <span class="token parameter variable">-f</span> Makefile Makefile-
    gitlab project-file raw --project-id <span class="token variable">$&#123;ID&#125;</span> --file-path Makefile <span class="token parameter variable">--ref</span> <span class="token variable">$&#123;branch&#125;</span> <span class="token operator">></span> Makefile
    <span class="token function">sed</span> -i- <span class="token string">"s|github.com/muzi502|gitlab.com/muzi502"</span> Makefile
    gitlab project-file update --project-id <span class="token variable">$&#123;ID&#125;</span> --file-path Makefile <span class="token parameter variable">--branch</span> <span class="token variable">$&#123;branch&#125;</span> <span class="token parameter variable">--content</span> @Makefile <span class="token punctuation">\</span>
    --commit-message <span class="token string">"chore(Makefile): update repo url in Makefile for migrate gitlab"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>åˆ é™¤æ–‡ä»¶</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-file delete --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> --file-path .gitignore <span class="token parameter variable">--ref</span> master <span class="token punctuation">\</span>
--commit-message <span class="token string">"test delete file"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="MR-1"><a href="#MR-1" class="headerlink" title="MR"></a>MR</h3><ul>
<li>åˆ›å»º MRï¼ŒæŒ‡å®š source branch å’Œ target branch ä»¥åŠ mr çš„ title è¿™ä¸‰ä¸ªå‚æ•°ã€‚å‰é¢æœ€å¥½åŠ ä¸Š -o json å‚æ•°ç”¨æˆ·è·å– mr çš„ iidï¼Œå¯é€šè¿‡æ­¤ iid æ¥å¯¹è¿™ä¸ª mr è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab <span class="token parameter variable">-o</span> json project-merge-request create --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> --source-branch --target-branch <span class="token variable">$&#123;BASE_BRANCH&#125;</span> <span class="token parameter variable">--title</span> <span class="token string">"<span class="token variable">$&#123;MR_TITLE&#125;</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>é€šè¿‡ -o json å‚æ•°ä¼šè¿”å›æ­¤ mr çš„ä¿¡æ¯ï¼Œå…¶ä¸­ <code>iid</code> å°±æ˜¯è¯¥ mr åœ¨æ­¤ repo ä¸­çš„å”¯ä¸€æ ‡ç¤º</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">$ gitlab -g gitlab -o json project-merge-request create --project-id <span class="token number">25099880</span> --source-branch release<span class="token number">-2.14</span> --target-branch  master --title <span class="token string">"mr create test"</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">92872102</span><span class="token punctuation">,</span>
  <span class="token property">"iid"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"project_id"</span><span class="token operator">:</span> <span class="token number">25099880</span><span class="token punctuation">,</span>
  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"mr create test"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"opened"</span><span class="token punctuation">,</span>
  <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2021-03-21T12:42:52.893Z"</span><span class="token punctuation">,</span>
  <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2021-03-21T12:42:52.893Z"</span><span class="token punctuation">,</span>
  <span class="token property">"merged_by"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">"merged_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">"closed_by"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">"closed_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">"target_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>
  <span class="token property">"source_branch"</span><span class="token operator">:</span> <span class="token string">"release-2.14"</span><span class="token punctuation">,</span>
  <span class="token property">"user_notes_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"upvotes"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"downvotes"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">5599205</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"muzi502"</span><span class="token punctuation">,</span>
    <span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">"muzi502"</span><span class="token punctuation">,</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"active"</span><span class="token punctuation">,</span>
    <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token string">"https://secure.gravatar.com/avatar/f91578ffea9a538eedd8fbaf3007289b?s=80&amp;d=identicon"</span><span class="token punctuation">,</span>
    <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"https://gitlab.com/muzi502"</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>åˆå¹¶ MR</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-merge-request merge --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> <span class="token parameter variable">--iid</span> @mr_iid<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹ MR çŠ¶æ€</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab <span class="token parameter variable">-o</span> json project-merge-request get --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> <span class="token parameter variable">--iid</span> @mr_iid <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">".state"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>é›†æˆåœ¨ Jenkinsfile  ä¸­å®Œæˆåˆ›å»º MRã€åˆå¹¶ MRã€æ£€æŸ¥ MR</li>
</ul>
<p>è°ƒç”¨ç”¨å®ƒçš„æ—¶å€™åªéœ€è¦ä¼ å…¥ SOURCE_BRANCH, TARGET_BRANCH, MR_TITLE è¿™ä¸‰ä¸ªå‚æ•°å³å¯ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">def makeMR<span class="token punctuation">(</span>SOURCE_BRANCH, TARGET_BRANCH, MR_TITLE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    container<span class="token punctuation">(</span><span class="token string">"debian"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">sh</span> <span class="token string">""</span>"
        gitlab <span class="token parameter variable">-o</span> json project-merge-request create --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span>  <span class="token parameter variable">--title</span> <span class="token punctuation">\</span>"<span class="token variable">$&#123;MR_TITLE&#125;</span><span class="token punctuation">\</span>" <span class="token punctuation">\</span>
        --source-branch <span class="token variable">$&#123;SOURCE_BRANCH&#125;</span> --target-branch <span class="token variable">$&#123;TARGET_BRANCH&#125;</span> <span class="token operator">></span> mr_info.json

        jq <span class="token parameter variable">-r</span> <span class="token string">'.iid'</span> mr_info.json <span class="token operator">></span> mr_iid
        jq <span class="token parameter variable">-r</span> <span class="token string">'.web_url'</span> mr_info.json <span class="token operator">></span> mr_url
        <span class="token string">""</span>"
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

def <span class="token function-name function">checkMR</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    container<span class="token punctuation">(</span><span class="token string">"debian"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        retry<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">sh</span> <span class="token string">""</span>"
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-s</span> mr_iid <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token function">sleep</span> 60s<span class="token punctuation">;</span> <span class="token keyword">fi</span>
        gitlab <span class="token parameter variable">-o</span> json project-merge-request get --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> <span class="token parameter variable">--iid</span> @mr_iid <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">".labels[]"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'approve'</span>
        <span class="token string">""</span>"
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

def <span class="token function-name function">mergeMR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    container<span class="token punctuation">(</span><span class="token string">"debian"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        retry<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">sh</span> <span class="token string">""</span>"
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-s</span> mr_iid <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token function">sleep</span> 60s<span class="token punctuation">;</span> <span class="token keyword">fi</span>
        <span class="token keyword">if</span> gitlab project-merge-request merge --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> <span class="token parameter variable">--iid</span> @mr_iid<span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token function">sleep</span> 10s<span class="token punctuation">;</span> <span class="token keyword">fi</span>
        gitlab <span class="token parameter variable">-o</span> json project-merge-request get --project-id <span class="token variable">$&#123;PROJECT_ID&#125;</span> <span class="token parameter variable">--iid</span> @mr_iid <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">".state"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'merged'</span>
        <span class="token string">""</span>"
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><ul>
<li>åˆ—å‡º repo tag</li>
</ul>
<p>åœ¨è¿™é‡Œè¿˜æ˜¯æ¨èä½¿ç”¨ git tag çš„æ–¹å¼è·å– repo tag ï¼Œå› ä¸º Gitlab API çš„é™åˆ¶ï¼Œæ¯æ¬¡è¯·æ±‚æœ€å¤šåªèƒ½è¿”å› 100 ä¸ªå€¼ï¼Œå¯ä»¥åŠ ä¸Š <code>--all</code> å‚æ•°æ¥è¿”å›æ‰€æœ‰çš„å€¼ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab <span class="token parameter variable">-o</span> json project-tag list --project-id <span class="token variable">$&#123;ID&#125;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.[].name'</span>
$ gitlab <span class="token parameter variable">-o</span> json project-tag list --project-id <span class="token variable">$&#123;ID&#125;</span> <span class="token parameter variable">--all</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.[].name'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>åˆ›å»º tag</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-tag create --project-id <span class="token variable">$&#123;ID&#125;</span> --tag-name v1.0.0-rc.2 <span class="token parameter variable">--ref</span> master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>åˆ é™¤ tag</li>
</ul>
<p>upstream ä¸Šçš„ repo tag åªèƒ½é€šè¿‡åœ¨ Gitlab ä¸Šåˆ é™¤ï¼Œåœ¨æœ¬åœ° repo ä¸‹æ˜¯æ— æ³•åˆ é™¤çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ é™¤  Gitlab repo tagï¼Œæ³¨æ„ï¼šå—ä¿æŠ¤çš„ repo tag å¦‚æœæ²¡æœ‰æƒé™çš„è¯æ˜¯æ— æ³•åˆ é™¤çš„ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gitlab project-tag delete --project-id <span class="token variable">$&#123;ID&#125;</span> --tag-name v1.0.0-rc.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>åˆ›å»ºå—ä¿æŠ¤çš„ repo tag</li>
</ul>
<p>ç”±äºæˆ‘ä»¬æµæ°´çº¿ä»»åŠ¡ä¾èµ–äº repo tag æ¥åšç‰ˆæœ¬çš„å¯¹äºï¼Œå› æ­¤éœ€è¦ä¿æŠ¤æ¯ä¸€ä¸ª repo tagï¼Œä½†æœ‰ç‰¹æ®Šæƒ…å†µä¸‹åˆè¦è¦†ç›– repo tagï¼Œæ‰€ä»¥å—ä¿æŠ¤çš„ repo tag ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåªèƒ½å…ˆæ‰‹åŠ¨åˆ›å»ºäº†ï¼Œç­‰åˆ°éœ€è¦åˆ é™¤çš„æ—¶å€™å†åˆ é™¤å®ƒã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰¹é‡åˆ›å»ºå—ä¿æŠ¤çš„ repo tagã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> tag <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-L1</span> <span class="token parameter variable">-I</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> gitlab project-protected-tag create --project-id <span class="token variable">$&#123;ID&#125;</span> <span class="token parameter variable">--name</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Lint-æµæ°´çº¿"><a href="#Lint-æµæ°´çº¿" class="headerlink" title="Lint æµæ°´çº¿"></a>Lint æµæ°´çº¿</h2><p>è¿ç§»åˆ°äº† Gitlab ä¹‹ååŸæœ‰çš„æµæ°´çº¿åœ¨å†…ç½‘çš„ Gitlab ä¸Šä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†ï¼Œä¸ºäº†å‡å°‘ç»´æŠ¤æˆæœ¬å°±ä½¿ç”¨äº† Gitlab è‡ªå¸¦çš„ CI ã€‚æˆ‘æ‰€ç»´æŠ¤çš„ repo ä½¿ç”¨ Gitlab CI åªæ˜¯åšä¸€äº› lint çš„æ£€æŸ¥å†…å®¹ï¼Œå› æ­¤ CI é…ç½®èµ·æ¥ä¹Ÿç‰¹åˆ«ç®€å•ã€‚å¦‚ kubespray çš„ CI é…ç½®ï¼š</p>
<ul>
<li><code>.gitlab-ci.yml</code></li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">lint</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'quay.io/kubespray/kubespray:v2.15.0'</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> chmod <span class="token punctuation">-</span>R o<span class="token punctuation">-</span>w .
    <span class="token punctuation">-</span> make lint
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> shared<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ä½¿ç”¨ gitlab CLI å·¥å…·ç»™æ‰€æœ‰åˆ†æ”¯æ·»åŠ  <code>.gitlab-ci.yml</code> æ–‡ä»¶</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">123456</span>
<span class="token assign-left variable">BRANCHS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>gitlab <span class="token parameter variable">-o</span> json project-branch list --project-id $<span class="token punctuation">&#123;</span>ID<span class="token punctuation">&#125;</span> <span class="token parameter variable">--all</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">".[].name"</span><span class="token variable">)</span></span>
<span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">$&#123;BRANCHS&#125;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	gitlab project-file create --project-id <span class="token variable">$&#123;ID&#125;</span> --file-path .gitlab-ci.yml <span class="token parameter variable">--branch</span> <span class="token variable">$&#123;branch&#125;</span> <span class="token parameter variable">--content</span> @.gitlab-ci.yml --commit-message <span class="token string">"feat(gitlab-ci): add gitlab-ci.yml for ci"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li>repo è¿ç§»</li>
</ul>
<p>ç”±äºå†…éƒ¨çš„ Gitlab ä¸æ”¯æŒå¯¼å…¥ git url çš„æ–¹å¼ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨åœ°å°† GitHub ä¸Šçš„ repo clone åˆ°æœ¬åœ°å† push åˆ° Gitlab ä¸Šã€‚ä½¿ç”¨ git clone çš„æ–¹å¼æœ¬åœ°åªä¼šæœ‰ä¸€ä¸ª master åˆ†æ”¯ï¼Œè¦æŠŠ GitHub ä¸Š repo çš„æ‰€æœ‰åˆ†æ”¯éƒ½ track ä¸€éï¼Œç„¶åå† push åˆ° Gitlab ä¸Šã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ git clone ä¸‹æ¥çš„ repo é»˜è®¤ä¸º master åˆ†æ”¯</span>
$ <span class="token function">git</span> clone git@gitlab.com/muzi502/kubespray.git
<span class="token comment"># track å‡º origin ä¸Šçš„æ‰€æœ‰åˆ†æ”¯</span>
$ <span class="token function">git</span> branch <span class="token parameter variable">-r</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'\->'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> remote<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">git</span> branch <span class="token parameter variable">--track</span> <span class="token string">"<span class="token variable">$&#123;remote<span class="token operator">#</span>origin<span class="token operator">/</span>&#125;</span>"</span> <span class="token string">"<span class="token variable">$remote</span>"</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
$ <span class="token function">git</span> fetch <span class="token parameter variable">--all</span>
$ <span class="token function">git</span> pull <span class="token parameter variable">--all</span>
$ <span class="token function">git</span> remote remove origin
$ <span class="token function">git</span> remote <span class="token function">add</span> origin git@gitlab/gitlab502/kubespray.git
$ <span class="token function">git</span> push origin <span class="token parameter variable">--all</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10312521/how-to-fetch-all-git-branches">How to fetch all Git branches</a></li>
<li><a target="_blank" rel="noopener" href="https://yixinglu.gitlab.io/gitlab-workflow.html">GitLab å·¥ä½œæµ</a></li>
<li><a target="_blank" rel="noopener" href="https://python-gitlab.readthedocs.io/">python-gitlab</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/api/README.html">Gitlab API Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xanzy/go-gitlab">go-gitlab</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/x5PHNn87OYCSpYE_hb8I2A">è°ˆè°ˆ Git å­˜å‚¨åŸç†åŠç›¸å…³å®ç°</a></li>
<li><a target="_blank" rel="noopener" href="https://morningspace.github.io/tech/inside-git-3/">Git è§£å¯†â€”â€”è®¤è¯† Git å¼•ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://blinkfox.github.io/2018/11/22/ruan-jian-gong-ju/devops/gitlab-ci-jie-shao-he-shi-yong/">GitLab CI&#x2F;CD ä»‹ç»å’Œä½¿ç”¨</a></li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/gitlab/" rel="tag"># gitlab</a>
              <a href="/tags/ci/" rel="tag"># ci</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/jenkins-with-kubernetes.html" rel="prev" title="Jenkins å¤§å”ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ ğŸ§‘â€ğŸ¤â€ğŸ§‘">
                  <i class="fa fa-chevron-left"></i> Jenkins å¤§å”ä¸ kubernetes èˆ¹é•¿æ‰‹ç‰µæ‰‹ ğŸ§‘â€ğŸ¤â€ğŸ§‘
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/skopeo-to-registry.html" rel="next" title="å¦‚ä½•ä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§">
                  å¦‚ä½•ä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">26:36</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
