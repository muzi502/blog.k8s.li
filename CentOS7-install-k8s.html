<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="0.å‡†å¤‡1.ä¸´æ—¶å…³é—­ swapã€SELinuxã€é˜²ç«å¢™ã€‚å®˜æ–¹å»ºè®®è¿™ä¹ˆåšã€‚ swapoff -a setenforce 0 sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing$&#x2F;SELINUX&#x3D; disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config systemctl disable iptables-services firewalld systemctl stop iptables">
<meta property="og:type" content="blog">
<meta property="og:title" content="CentOS7 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes">
<meta property="og:url" content="https://blog.k8s.li/CentOS7-install-k8s.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="0.å‡†å¤‡1.ä¸´æ—¶å…³é—­ swapã€SELinuxã€é˜²ç«å¢™ã€‚å®˜æ–¹å»ºè®®è¿™ä¹ˆåšã€‚ swapoff -a setenforce 0 sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing$&#x2F;SELINUX&#x3D; disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config systemctl disable iptables-services firewalld systemctl stop iptables">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-05-15T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-17T14:37:11.995Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="kubeadm">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.k8s.li/CentOS7-install-k8s.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/CentOS7-install-k8s.html","path":"CentOS7-install-k8s.html","title":"CentOS7 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>CentOS7 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">0.å‡†å¤‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85-docker"><span class="nav-number">2.</span> <span class="nav-text">1.å®‰è£… docker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9C%A8%E5%9B%BD%E5%A4%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E9%95%9C%E5%83%8F%E5%B9%B6%E4%BC%A0%E8%BE%93%E5%9B%9E%E5%9B%BD%E5%86%85%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A"><span class="nav-number">3.</span> <span class="nav-text">2.åœ¨å›½å¤–æœåŠ¡å™¨ä¸‹è½½æ‰€éœ€è¦çš„é•œåƒå¹¶ä¼ è¾“å›å›½å†…æœåŠ¡å™¨ä¸Š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%89%E8%A3%85-kubelet-kubeadm-kubectl"><span class="nav-number">4.</span> <span class="nav-text">3.å®‰è£… kubelet kubeadm kubectl</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4"><span class="nav-number">5.</span> <span class="nav-text">4.åˆå§‹åŒ–é›†ç¾¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%B0%86-node-%E5%8A%A0%E5%85%A5%E5%88%B0-master-%E7%AE%A1%E7%90%86%E5%BD%93%E4%B8%AD%E6%9D%A5"><span class="nav-number">6.</span> <span class="nav-text">5.å°† node åŠ å…¥åˆ° master ç®¡ç†å½“ä¸­æ¥</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">117</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">152</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail â†’ mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/CentOS7-install-k8s.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="CentOS7 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CentOS7 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-05-16 2019-05-16T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2019-05-16T00:00:00+08:00">2019-05-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-17 2023-04-17T22:37:11+08:00" itemprop="dateModified" datetime="2023-04-17T22:37:11+08:00">2023-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/CentOS7-install-k8s.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="CentOS7-install-k8s.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>6.8k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>6 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="0-å‡†å¤‡"><a href="#0-å‡†å¤‡" class="headerlink" title="0.å‡†å¤‡"></a>0.å‡†å¤‡</h2><p>1.ä¸´æ—¶å…³é—­ swapã€SELinuxã€é˜²ç«å¢™ã€‚å®˜æ–¹å»ºè®®è¿™ä¹ˆåšã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">swapoff <span class="token parameter variable">-a</span>
setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^SELINUX=enforcing$/SELINUX= disabled/'</span> /etc/selinux/config
systemctl disable iptables-services firewalld
systemctl stop iptables-services firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.æ‰“å¼€ bridge-nf-call-iptables</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/99-kubernetes-cri.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
net.bridge.bridge-nf-call-iptables  = 1
enet.ipv4.ip_forward                = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF</span>
<span class="token function">sysctl</span> <span class="token parameter variable">--system</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3.åŠ è½½ br_netfilter å†…æ ¸æ¨¡å—ï¼Œå®‰è£… docker åä¹Ÿä¼šé»˜è®¤å¼€å¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">modprobe br_netfilter
lsmod <span class="token operator">|</span> <span class="token function">grep</span> br_netfilter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="1-å®‰è£…-docker"><a href="#1-å®‰è£…-docker" class="headerlink" title="1.å®‰è£… docker"></a>1.å®‰è£… docker</h2><p>1.å®‰è£… yum-utils æä¾› yum-config-manager å·¥å…·<br>devicemapper å­˜å‚¨é©±åŠ¨ä¾èµ– device-mapper-persistent-data å’Œ lvm2</p>
<p><code>sudo yum install -y yum-utils device-mapper-persistent-data lvm2</code></p>
<p>2.æ·»åŠ  aliyun è½¯ä»¶åŒ…æº<br><code>sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></p>
<p>3.å®‰è£… docker-ce-stable<br>å®˜æ–¹æ–‡æ¡£å†™äº†å»ºè®®å®‰è£… 18.06.2ï¼Œå…¶ä»–ç‰ˆæœ¬çš„ docker æ”¯æŒçš„ä¸å¤ªå¥½<br>On each of your machines, install Docker. Version 18.06.2 is recommended, but 1.11, 1.12, 1.13, 17.03 and 18.09 are known to work as well. Keep track of the latest verified Docker version in the Kubernetes release notes.</p>
<p><code>sudo yum list docker-ce.x86_64  --showduplicates |sort -r</code> é€‰æ‹© <code>docker-ce-18.06.1.ce-3.el7</code> ç‰ˆ</p>
<p><code>yum install -y docker-ce-18.06.1.ce-3.el7</code></p>
<p>4.æ·»åŠ  Docker ç”¨æˆ·å’Œç”¨æˆ·ç»„(å¯é€‰) <code>sudo usermod -aG docker $USER</code></p>
<p>5.ä¿®æ”¹ docker daemon é…ç½®æ–‡ä»¶</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/docker/
<span class="token function">cat</span> <span class="token operator">></span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF
&#123;
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": &#123;
    "max-size": "100m"
  &#125;,
  "storage-driver": "overlay2"
&#125;
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸ä¿®æ”¹çš„è¯åé¢åˆå§‹åŒ–çš„æ—¶å€™ä¼š warningğŸ˜‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>WARNING IsDockerSystemdCheck<span class="token punctuation">]</span>: detected <span class="token string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="token string">"systemd"</span><span class="token builtin class-name">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>6.å¯åŠ¨ docker å¹¶æ·»åŠ åˆ°å¼€æœºè‡ªå¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
systemctl restart <span class="token function">docker</span>
systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="2-åœ¨å›½å¤–æœåŠ¡å™¨ä¸‹è½½æ‰€éœ€è¦çš„é•œåƒå¹¶ä¼ è¾“å›å›½å†…æœåŠ¡å™¨ä¸Š"><a href="#2-åœ¨å›½å¤–æœåŠ¡å™¨ä¸‹è½½æ‰€éœ€è¦çš„é•œåƒå¹¶ä¼ è¾“å›å›½å†…æœåŠ¡å™¨ä¸Š" class="headerlink" title="2.åœ¨å›½å¤–æœåŠ¡å™¨ä¸‹è½½æ‰€éœ€è¦çš„é•œåƒå¹¶ä¼ è¾“å›å›½å†…æœåŠ¡å™¨ä¸Š"></a>2.åœ¨å›½å¤–æœåŠ¡å™¨ä¸‹è½½æ‰€éœ€è¦çš„é•œåƒå¹¶ä¼ è¾“å›å›½å†…æœåŠ¡å™¨ä¸Š</h2><p>æˆ‘è‡ªå·±åœ¨ aws ä¸Šåšäº†ä¸ªéå®˜æ–¹ k8s é•œåƒç«™ï¼Œä»…ä»…åŒ…å«äº† kubeadm åˆå§‹åŒ– k8s é›†ç¾¤æ—¶æ‰€éœ€è¦çš„é•œåƒ <a target="_blank" rel="noopener" href="https://images.k8s.k8s.li/">mirror</a>ï¼Œæ²¡æœ‰å¯¹é•œåƒåšä»»ä½•ä¿®æ”¹ï¼Œå®šæ—¶ä»»åŠ¡æ¯å‘¨æ‹‰å–æœ€æ–°çš„é•œåƒã€‚ä½ ä¿¡å¾—è¿‡æˆ‘çš„è¯ä¹Ÿå¯ä»¥å»æˆ‘çš„é•œåƒç«™ä¸‹è½½ã€‚ä¸Šé¢ log æœ‰æ ¡éªŒçš„æ ¡éªŒç ï¼Œä¸‹è½½åè®°å¾—æ ¡éªŒä¸€ä¸‹ã€‚ğŸ˜‚ã€‚æˆ‘ä½¿ç”¨ IDM ä¸‹è½½ï¼Œå¼€å¯ 16 ä¸ªçº¿ç¨‹ä¸‹è½½é€Ÿåº¦èƒ½æ‰“åˆ° 15Mb&#x2F;sã€‚HTTPS ä¼ è¾“ï¼Œä¸ç”¨æ³¨å†Œã€‚å›½å†…çš„ä¸€äº›åšä¸»ç”¨ç™¾åº¦äº‘ ğŸ˜‚ æ¥åˆ†äº«è¿™äº›é•œåƒï¼Œååˆ†ä¸å‹å¥½ã€‚è¿™æ‰æ˜¯æˆ‘å»ºè¿™ä¸ªé•œåƒç«™çš„åŸå› ã€‚<br>ä¸‹è½½å®Œæˆåä½¿ç”¨ <code>docker load &lt; k8s.image.tar.gz</code> å°±èƒ½åŠ è½½é•œåƒï¼Œæ— éœ€è§£å‹ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥è‡ªå·±åœ¨å›½å¤–çš„æœåŠ¡å™¨ä¸Šä¸‹è½½è¿™äº›é•œåƒå¹¶ä¼ è¾“å›å›½å†…çš„æœåŠ¡å™¨ä¸Šã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master ~
â•°â”€<span class="token comment"># kubeadm config images pull</span>
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/kube-apiserver:v1.14.1
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/kube-controller-manager:v1.14.1
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/kube-scheduler:v1.14.1
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/kube-proxy:v1.14.1
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/pause:3.1
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/etcd:3.3.10
<span class="token punctuation">[</span>config/images<span class="token punctuation">]</span> Pulled k8s.gcr.io/coredns:1.3.1
<span class="token comment"># å¯¼å‡ºé•œåƒ</span>
<span class="token function">docker</span> save <span class="token parameter variable">-o</span> k8s.tar <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> k8s.gcr.io <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
<span class="token function">gzip</span> k8s.tar k8s.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å°†è¿™äº›é•œåƒå¯¼å‡ºå¹¶å‹ç¼©ï¼Œä¼ è¾“å›å›½å†…ã€‚http æ–¹å¼å¤šçº¿ç¨‹ä¼ è¾“æœ€å¿«ã€‚IDM64 çº¿ç¨‹èƒ½è·‘æ»¡å¸¦å®½ ğŸ˜‚ï¼Œä¸åˆ°ä¸€åˆ†é’Ÿå°±ä¸‹è½½åˆ°æœ¬åœ°ã€‚ç„¶åå† scp ä¼ è¾“å›å›½å†…çš„äº‘æœåŠ¡å™¨ä¸Šã€‚grep B æ˜¯ä¸ºäº†è¿‡æ»¤æ‰è¾“å‡ºç»“æœç¬¬ä¸€è¡Œæ˜¾ç¤ºçš„ <code>REPOSITORY  TAG  IMAGE ID  CREATED  SIZE</code>ğŸ˜‚<br>åœ¨ä½¿ç”¨ docker save çš„æ—¶å€™ï¼Œè¦æŒ‡å®šé•œåƒçš„åç§°ï¼Œä¸è¦æŒ‡å®šé•œåƒçš„ IDï¼Œä¸ç„¶ä½ è£…è½½é•œåƒçš„æ—¶å€™å…¨æ˜¯ node çš„é•œåƒï¼Œæ˜¯å¯åŠ¨ä¸èµ·æ¥çš„ ğŸ˜¥<br>psï¼šç¬¬ä¸€æ¬¡æˆ‘ä½¿ç”¨çš„æ˜¯ <code>docker save $(docker images -q)</code> å¯¼å‡ºäº†æ‰€æœ‰çš„é•œåƒã€‚åœ¨è£…å…¥é•œåƒçš„æ—¶å€™å‘ç°é•œåƒ NAME å…¨æ˜¯ nodeğŸ˜‚ã€‚ä½¿ç”¨ <code>docker images | grep B | cut -d &#39; &#39; -f1</code> è¿‡æ»¤å‡ºçš„æ˜¯å¸¦ NAME çš„é•œåƒã€‚</p>
<p><code>docker save -o k8s.tar $(docker images | grep B | cut -d &#39; &#39; -f1) | gzip k8s.tar k8s.tar.gz</code></p>
<p>ç„¶åä½ åœ¨å›½å†…çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ <code>docker load &lt; k8s.tar.gz</code> ï¼Œä¸ç”¨æ‰‹åŠ¨ gzip è§£å‹ï¼Œdocker load ä¼šè‡ªåŠ¨è§£å‹å¹¶æŠŠé•œåƒåŠ è½½è¿›å»ã€‚</p>
<h2 id="3-å®‰è£…-kubelet-kubeadm-kubectl"><a href="#3-å®‰è£…-kubelet-kubeadm-kubectl" class="headerlink" title="3.å®‰è£… kubelet kubeadm kubectl"></a>3.å®‰è£… kubelet kubeadm kubectl</h2><p>æ·»åŠ å›½å†…é˜¿é‡Œäº‘çš„ kubernetes é•œåƒç«™ç‚¹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cat<span class="token operator">>></span>/etc/yum.repos.d/kubrenetes.repo<span class="token operator">&lt;&lt;</span><span class="token string">EOF
[kubernetes]
name=Kubernetes Repo
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
EOF</span>

yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kubelet kubeadm kubectl
systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-åˆå§‹åŒ–é›†ç¾¤"><a href="#4-åˆå§‹åŒ–é›†ç¾¤" class="headerlink" title="4.åˆå§‹åŒ–é›†ç¾¤"></a>4.åˆå§‹åŒ–é›†ç¾¤</h2><p>ä½¿ç”¨ kubeadm init åˆå§‹åŒ– kubernetes é›†ç¾¤ï¼Œå¯ä»¥æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ŒæŠŠ IP æ›¿æ¢ä¸ºè¿™å°æœºå™¨çš„å†…ç½‘ IPï¼Œè¦ k8s-node èŠ‚ç‚¹èƒ½å¤Ÿè®¿é—®å¾—åˆ° IPã€‚</p>
<p><code>kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=IP</code></p>
<p>æœ€ååˆå§‹åŒ–æˆåŠŸçš„è¯ä¼šå‡ºç°ä»¥ä¸‹:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the <span class="token function">node</span> k8s-master as control-plane by adding the label <span class="token string">"node-role.kubernetes.io/master=''"</span>
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the <span class="token function">node</span> k8s-master as control-plane by adding the taints <span class="token punctuation">[</span>node-role.kubernetes.io/master:NoSchedule<span class="token punctuation">]</span>
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Using token: ********
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="token keyword">in</span> order <span class="token keyword">for</span> nodes to get long term certificate credentials
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow certificate rotation <span class="token keyword">for</span> all <span class="token function">node</span> client certificates <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> creating the <span class="token string">"cluster-info"</span> ConfigMap <span class="token keyword">in</span> the <span class="token string">"kube-public"</span> namespace
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: CoreDNS
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> IP:6443 <span class="token parameter variable">--token</span> ******i311md.mhwgl9rr3q26rc4n****** <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:2**********2a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹å„ä¸ªå®¹å™¨çš„è¿è¡ŒçŠ¶æ€</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master ~
â•°â”€<span class="token comment"># docker ps -a</span>
CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS               NAMES
38d9c698ec37        efb3887b411d           <span class="token string">"kube-controller-manâ€¦"</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_kube-controller-manager_kube-controller-manager-k8s-master_kube-system_f423ac50e24b65e6d66fe37e6d721912_0
c273979e75b6        8931473d5bdb           <span class="token string">"kube-scheduler --biâ€¦"</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_kube-scheduler_kube-scheduler-k8s-master_kube-system_f44110a0ca540009109bfc32a7eb0baa_0
71f1f40dfa9e        cfaa4ad74c37           <span class="token string">"kube-apiserver --adâ€¦"</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_kube-apiserver_kube-apiserver-k8s-master_kube-system_d57282173a211f69b917251534760047_0
37636f04f5d6        2c4adeb21b4f           <span class="token string">"etcd --advertise-clâ€¦"</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_etcd_etcd-k8s-master_kube-system_dcd3914b600c5e8e86b2026688cc6dc5_0
48fc68b067de        k8s.gcr.io/pause:3.1   <span class="token string">"/pause"</span>                 <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_POD_kube-scheduler-k8s-master_kube-system_f44110a0ca540009109bfc32a7eb0baa_0
3c9f8e8224cf        k8s.gcr.io/pause:3.1   <span class="token string">"/pause"</span>                 <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_POD_kube-apiserver-k8s-master_kube-system_d57282173a211f69b917251534760047_0
b4903d8f18ee        k8s.gcr.io/pause:3.1   <span class="token string">"/pause"</span>                 <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_POD_kube-controller-manager-k8s-master_kube-system_f423ac50e24b65e6d66fe37e6d721912_0
f6d2cd0b03cd        k8s.gcr.io/pause:3.1   <span class="token string">"/pause"</span>                 <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes                            k8s_POD_etcd-k8s-master_kube-system_dcd3914b600c5e8e86b2026688cc6dc5_0
74a3699833bc        20a2d7035165           <span class="token string">"/usr/local/bin/kubeâ€¦"</span>   <span class="token number">9</span> minutes ago       Up <span class="token number">4</span> seconds                            k8s_kube-proxy_kube-proxy-g4nd4_kube-system_afc4ba92-7657-11e9-b684-2aabd22d242a_1
ba61bed68ecc        k8s.gcr.io/pause:3.1   <span class="token string">"/pause"</span>                 <span class="token number">9</span> minutes ago       Up <span class="token number">9</span> minutes                            k8s_POD_kube-proxy-g4nd4_kube-system_afc4ba92-7657-11e9-b684-2aabd22d242a_4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="5-å°†-node-åŠ å…¥åˆ°-master-ç®¡ç†å½“ä¸­æ¥"><a href="#5-å°†-node-åŠ å…¥åˆ°-master-ç®¡ç†å½“ä¸­æ¥" class="headerlink" title="5.å°† node åŠ å…¥åˆ° master ç®¡ç†å½“ä¸­æ¥"></a>5.å°† node åŠ å…¥åˆ° master ç®¡ç†å½“ä¸­æ¥</h2><p>node èŠ‚ç‚¹çš„å®‰è£…è¿‡ç¨‹å’Œ master ä¸€æ ·ï¼Œåªæ˜¯åœ¨æœ€åä¸€æ­¥æ—¶ä¸ç›¸åŒã€‚master ä¸º init åˆå§‹åŒ– k8s é›†ç¾¤ï¼Œè€Œ node èŠ‚ç‚¹ä¸º join é›†ç¾¤å½“ä¸­æ¥ã€‚å®‰è£… dockerã€kubelet ã€kubeadm ã€kubectl å¥½ï¼Œå¹¶å¯¼å…¥æ‰€éœ€è¦çš„é•œåƒã€‚å†æ‰§è¡Œ</p>
<p><code>kubeadm join IP:6443 --token ************ \--discovery-token-ca-cert-hashsha256:******</code></p>
<p>ä¹Ÿå°±æ˜¯ master èŠ‚ç‚¹åˆå§‹åŒ–æˆåŠŸåç”Ÿæˆçš„é‚£ä¸ª ğŸ˜‚ã€‚æ³¨æ„è¿™ä¸ª token æ˜¯æœ‰æœ‰æ•ˆæœŸçš„ï¼Œé»˜è®¤æ˜¯ 3hã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç”Ÿæˆ token ç»™ node åŠ å…¥ master æ¥ç”¨ã€‚ttl ä¸º token æœ‰æ•ˆæœŸï¼Œä¸º 0 çš„è¯å°±æ˜¯æ°¸ä¹…ç”Ÿæ•ˆã€‚</p>
<p><code>kubeadm token create $(kubeadm token generate)  --print-join-command --ttl=0</code></p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kubeadm/" rel="tag"># kubeadm</a>
              <a href="/tags/kubernetes/" rel="tag"># kubernetes</a>
              <a href="/tags/k8s/" rel="tag"># k8s</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/fuch-rush-app-dir.html" rel="prev" title="æ¸…ç†æ¯’ç˜¤appåœ¨sdcardç›®å½•ä¸‹æ‹‰å±äº§ç”Ÿçš„æ–‡ä»¶å¤¹">
                  <i class="fa fa-chevron-left"></i> æ¸…ç†æ¯’ç˜¤appåœ¨sdcardç›®å½•ä¸‹æ‹‰å±äº§ç”Ÿçš„æ–‡ä»¶å¤¹
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/gitlab-install.html" rel="next" title="éƒ¨ç½² Gitlab åŠ gitlab-runner">
                  éƒ¨ç½² Gitlab åŠ gitlab-runner <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">26:14</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
