<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.2.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€å¦‚æœä½ çš„ FastDFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦é«˜å¯ç”¨ï¼Œéœ€è¦éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šçš„è¯ï¼Œå¹¶ä¸”ä½ çš„è¿™äº›æœåŠ¡å™¨ä¸Šåªè·‘ FastDFS è¿™ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆ FastDFS å¯èƒ½å¹¶ä¸é€‚åˆç”¨ Docker æ¥éƒ¨ç½²ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£ç›´æ¥éƒ¨ç½²åœ¨æœºå™¨ä¸Šå°±å¯ä»¥ï¼Œæ²¡å¿…è¦é‡‡ç”¨å®¹å™¨æ¥éƒ¨ç½²ã€‚å…¶å® FastDFS å¹¶ä¸é€‚åˆå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå› ä¸º tracker æœåŠ¡å™¨å‘ storage æœåŠ¡å™¨æŠ¥å‘Šè‡ªå·±çš„ IPï¼Œ è€Œè¿™ä¸ª IP æ˜¯å®¹å™¨å†…çš„ IP ã€‚æ˜¯">
<meta property="og:type" content="blog">
<meta property="og:title" content="Docker éƒ¨ç½² FastDFS">
<meta property="og:url" content="https://blog.k8s.li/docker-deploy-fastdfs.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="å‰è¨€å¦‚æœä½ çš„ FastDFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦é«˜å¯ç”¨ï¼Œéœ€è¦éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šçš„è¯ï¼Œå¹¶ä¸”ä½ çš„è¿™äº›æœåŠ¡å™¨ä¸Šåªè·‘ FastDFS è¿™ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆ FastDFS å¯èƒ½å¹¶ä¸é€‚åˆç”¨ Docker æ¥éƒ¨ç½²ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£ç›´æ¥éƒ¨ç½²åœ¨æœºå™¨ä¸Šå°±å¯ä»¥ï¼Œæ²¡å¿…è¦é‡‡ç”¨å®¹å™¨æ¥éƒ¨ç½²ã€‚å…¶å® FastDFS å¹¶ä¸é€‚åˆå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå› ä¸º tracker æœåŠ¡å™¨å‘ storage æœåŠ¡å™¨æŠ¥å‘Šè‡ªå·±çš„ IPï¼Œ è€Œè¿™ä¸ª IP æ˜¯å®¹å™¨å†…çš„ IP ã€‚æ˜¯">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/1569728664464.png">
<meta property="og:image" content="https://p.k8s.li/1569728744655.png">
<meta property="og:image" content="https://p.k8s.li/1569729043301.png">
<meta property="og:image" content="https://p.k8s.li/1564128425387.png">
<meta property="og:image" content="https://p.k8s.li/1564128874832.png">
<meta property="og:image" content="https://p.k8s.li/1564128721547.png">
<meta property="og:image" content="https://p.k8s.li/1564364594777.png">
<meta property="og:image" content="https://p.k8s.li/1564127683217.png">
<meta property="og:image" content="https://p.k8s.li/1564364294952.png">
<meta property="og:image" content="https://p.k8s.li/1564365025177.png">
<meta property="og:image" content="https://p.k8s.li/1564363829960.png">
<meta property="og:image" content="https://p.k8s.li/1564125161155.png">
<meta property="og:image" content="https://p.k8s.li/1564130238346.png">
<meta property="og:image" content="https://p.k8s.li/1564130789416.png">
<meta property="og:image" content="https://p.k8s.li/1564023927851.png">
<meta property="og:image" content="https://p.k8s.li/1564384530137.png">
<meta property="og:image" content="https://p.k8s.li/1564384711746.png">
<meta property="og:image" content="https://p.k8s.li/1564384906456.png">
<meta property="article:published_time" content="2019-09-24T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-30T14:40:01.914Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="FastDFS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/1569728664464.png">


<link rel="canonical" href="https://blog.k8s.li/docker-deploy-fastdfs.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/docker-deploy-fastdfs.html","path":"docker-deploy-fastdfs.html","title":"Docker éƒ¨ç½² FastDFS"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Docker éƒ¨ç½² FastDFS | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-docker-%E9%95%9C%E5%83%8F"><span class="nav-number">2.</span> <span class="nav-text">æ„å»º docker é•œåƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">å‡†å¤‡é…ç½®æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.2.</span> <span class="nav-text">ä¿®æ”¹é…ç½®æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile"><span class="nav-number">2.3.</span> <span class="nav-text">Dockerfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E4%B8%8D%E5%90%8C%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E5%87%BA%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%AF%B9%E6%AF%94"><span class="nav-number">2.4.</span> <span class="nav-text">æ„ä¸åŒåŸºç¡€é•œåƒæ„å»ºå‡ºçš„å¤§å°å¯¹æ¯”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#musl-libc-%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">2.5.</span> <span class="nav-text">musl libc å¸¦æ¥çš„é—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E6%96%B9%E6%B3%95"><span class="nav-number">2.6.</span> <span class="nav-text">å®¹å™¨å¯åŠ¨æ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">3.</span> <span class="nav-text">æµ‹è¯•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="nav-number">3.1.</span> <span class="nav-text">æµ‹è¯•å·¥å…·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%8B%E8%AF%95"><span class="nav-number">3.2.</span> <span class="nav-text">æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">3.3.</span> <span class="nav-text">æ–‡ä»¶ä¸‹è½½æµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90"><span class="nav-number">3.4.</span> <span class="nav-text">æµ‹è¯•ç»“æœåˆ†æ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%8F%82%E6%95%B0"><span class="nav-number">4.</span> <span class="nav-text">ä¼˜åŒ–å‚æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">5.</span> <span class="nav-text">å¸¸è§é—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3"><span class="nav-number">5.1.</span> <span class="nav-text">å®‰å…¨ç›¸å…³</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">116</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">151</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail â†’ mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/docker-deploy-fastdfs.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Docker éƒ¨ç½² FastDFS | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker éƒ¨ç½² FastDFS
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-09-25 2019-09-25T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2019-09-25T00:00:00+08:00">2019-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-05-30 2022-05-30T22:40:01+08:00" itemprop="dateModified" datetime="2022-05-30T22:40:01+08:00">2022-05-30</time>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/docker-deploy-fastdfs.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="docker-deploy-fastdfs.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>11 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚æœä½ çš„ FastDFS æ–‡ä»¶ç³»ç»Ÿéœ€è¦é«˜å¯ç”¨ï¼Œéœ€è¦éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šçš„è¯ï¼Œå¹¶ä¸”ä½ çš„è¿™äº›æœåŠ¡å™¨ä¸Šåªè·‘ FastDFS è¿™ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆ FastDFS å¯èƒ½å¹¶ä¸é€‚åˆç”¨ Docker æ¥éƒ¨ç½²ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£ç›´æ¥éƒ¨ç½²åœ¨æœºå™¨ä¸Šå°±å¯ä»¥ï¼Œæ²¡å¿…è¦é‡‡ç”¨å®¹å™¨æ¥éƒ¨ç½²ã€‚å…¶å® FastDFS å¹¶ä¸é€‚åˆå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå› ä¸º tracker æœåŠ¡å™¨å‘ storage æœåŠ¡å™¨æŠ¥å‘Šè‡ªå·±çš„ IPï¼Œ è€Œè¿™ä¸ª IP æ˜¯å®¹å™¨å†…çš„ IP ã€‚æ˜¯ Docker çš„ä¸€ä¸ªç§æœ‰ IP æ®µï¼Œè¿™å°†å¯¼è‡´å®¢æˆ·ç«¯æ— æ³•è®¿é—® storage æœåŠ¡å™¨ã€‚å½“ç„¶å¦‚æœä½¿ç”¨ host ç½‘ç»œæˆ–è€…èƒ½æ‰“é€šå®¢æˆ·ç«¯åˆ° storage çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ flannel ï¼Œcalico ç­‰ï¼Œè¿™éƒ½å¯ä»¥ï¼Œåœ¨ Kubernetes åŸºäºæœåŠ¡å‘ç°ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥è®¿é—®åˆ° storage æœåŠ¡å™¨ã€‚</p>
<p>é‚£ä¹ˆ FastDFS é‡‡ç”¨ Docker éƒ¨ç½²é€‚ç”¨äºä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿå…¶å®æ¯”è¾ƒé€‚åˆä¸­å°å‹çš„é¡¹ç›®ï¼Œå¯¹é«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½è¦æ±‚ä¸å¤§çš„æƒ…å†µä¸‹ã€‚æˆ–è€…å°† FastDFS æ‰€æœ‰çš„æœåŠ¡å°è£…åœ¨ä¸€ä¸ªå®¹å™¨é‡Œè¿è¡Œï¼Œå’Œå…¶ä»–æœåŠ¡ä¸€èµ·ä½¿ç”¨ docker-compose å¯åŠ¨ï¼Œè¿™æ ·ç”¨å†é€‚åˆä¸è¿‡äº†ã€‚æˆ‘çš„é¡¹ç›®å°±æ˜¯è¿™ç§åœºæ™¯ï¼Œç”±äºæœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œä¸å¯èƒ½å»å•ç‹¬éƒ¨ç½²ä¸€ä¸ª FastDFS æœåŠ¡å™¨é›†ç¾¤ï¼Œå·´æ‹‰å·´æ‹‰æ•´ä¸ªé«˜å¯ç”¨ã€‚æ‰€æœ‰çš„é¡¹ç›®ç»„ä»¶éƒ½é‡‡ç”¨ Docker éƒ¨ç½²åœ¨ä¸€å°æœºå™¨ä¸Šï¼ŒFastDFS é‡Œçš„  nginx ä¹Ÿæ˜¯æ²¡æœ‰å•ç‹¬å»éƒ¨ç½²ï¼Œå’Œ trackerã€storage æœåŠ¡å™¨ä¸€èµ·è£…åœ¨ä¸€ä¸ªå®¹å™¨é‡Œã€‚ä¸ºäº†èŠ‚çœèµ„æºæ²¡å¾—åŠæ³• ğŸ˜‚</p>
<h2 id="æ„å»º-docker-é•œåƒ"><a href="#æ„å»º-docker-é•œåƒ" class="headerlink" title="æ„å»º docker é•œåƒ"></a>æ„å»º docker é•œåƒ</h2><p>å®˜æ–¹ç»™å‡ºäº†ä¸¤ç§æ„å»º docker é•œåƒçš„æ–¹å¼ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰éƒ½ä¸å¥½ï¼Œä¸€æ˜¯ä½¿ç”¨çš„ çš„æ˜¯ centos åŸºç¡€é•œåƒæ„å»ºï¼Œæ„å»ºå‡ºæ¥çš„å¤§å°å°†è¿‘ï¼Œæ ¹æœ¬å°±ä¸ç”¨åŒºåˆ†æœ¬åœ°æ„å»ºæˆ–è€…ç½‘ç»œæ„å»ºã€‚ä½ æ„å»ºçš„æ•´ä¸ªè¿‡ç¨‹éƒ½è¦éƒ½éœ€è¦è¿æ¥å¤–ç½‘ä¸‹è½½æ„å»ºçš„åŒ…ä¹‹ç±»çš„ï¼Œè¿˜ç”¨åŒºåˆ†ä»€ä¹ˆç½‘ç»œæ„å»ºå’Œæœ¬åœ°æ„å»ºï¼Ÿæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä»…ä»…éœ€è¦å‡†å¤‡é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> â•­â”€root@docker-230 ~/root/container/fastdfs/fastdfs/docker/dockerfile_network â€¹masterâ€º
â•°â”€<span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
fastdfs             centos              c1488537c23c        <span class="token number">8</span> seconds ago       483MB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å‡†å¤‡é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡é…ç½®æ–‡ä»¶"></a>å‡†å¤‡é…ç½®æ–‡ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ä¸€å¹¶æ”¾åˆ° conf ç›®å½•ä¸‹</span>
<span class="token builtin class-name">cd</span> ~
<span class="token function">mkdir</span>  -p fastdfs/conf
<span class="token function">git</span> clone https://github.com/happyfish100/fastdfs.git --depth <span class="token number">1</span>
<span class="token function">cp</span> -rf fastdfs/docker/dockerfile_local/conf/* conf
<span class="token function">cp</span> fastdfs/docker/dockerfile_local/fastdfs.sh conf
<span class="token function">touch</span> Dockerfile.debian
<span class="token function">touch</span> Dockerfile.alpine
<span class="token comment"># å¤åˆ¶å‡ºæ¥é…ç½®æ–‡ä»¶ï¼ŒæŠŠæºç ç§»é™¤æ‰å°±å¯ä»¥</span>
<span class="token function">rm</span> -rf fastdfs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½åœ¨ conf é‡Œï¼Œæˆ‘ä»¬æ ¹æ®è‡ªèº«çš„éœ€è¦ä¿®æ”¹ä¸€ä¸‹å„ä¸ªé…ç½®æ–‡ä»¶å³å¯ï¼Œå…³äº fastdfs é…ç½®æ–‡ä»¶çš„å„ä¸ªå‚æ•°å¯ä»¥å»å‚è€ƒä¸€ä¸‹ä¸‹é¢çš„åšå®¢ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chiangchou/p/fastdfs.html">ç”¨ FastDFS ä¸€æ­¥æ­¥æ­å»ºæ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="https://mhl.xyz/Linux/fastdfs-tracker-storage.html">FastDFS é…ç½®å‚æ•° tracker.confã€storage.conf è¯¦è§£</a></li>
</ul>
<p>æˆ‘ä¿®æ”¹äº†é»˜è®¤çš„é…ç½®ï¼Œæ•°æ®å­˜æ”¾ç›®å½•ä¿®æ”¹æˆäº† <code>/var/fdfs</code> ,åœ¨å†™ <code>Dockerfile</code> çš„æ—¶å€™éœ€è¦å»ºç«‹è¿™ä¸ªç›®å½•ï¼Œå¦‚æœä½ çš„ç›®å½•æ²¡æœ‰ä¿®æ”¹çš„è¯ï¼Œå°±æŠŠ Dockerfile é‡Œåé¢é‚£é‡Œå»ºç«‹æ–‡ä»¶å¤¹çš„è·¯å¾„ä¿®æ”¹æˆé»˜è®¤çš„å³å¯ã€‚</p>
<p>æŠŠ <code>tracker_server</code> ä¿®æ”¹æˆ <code>tracker_server=tracker_ip:22122</code> ï¼Œå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä½¿ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥çš„ <code>FASTDFS_IPADDR</code> æ›¿æ¢æ‰å°±å¯ä»¥ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@debian-deploy-132 ~/fastdfs/conf
â•°â”€<span class="token comment"># tree</span>
<span class="token builtin class-name">.</span>
â”œâ”€â”€ client.conf             <span class="token comment"># C è¯­è¨€ç‰ˆæœ¬å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å¿½ç•¥</span>
â”œâ”€â”€ fastdfs.sh              <span class="token comment"># docker å®¹å™¨å¯åŠ¨ fastdfs æœåŠ¡çš„è„šæœ¬</span>
â”œâ”€â”€ http.conf               <span class="token comment"># http é…ç½®æ–‡ä»¶ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£</span>
â”œâ”€â”€ mime.types              <span class="token comment">#</span>
â”œâ”€â”€ mod_fastdfs.conf        <span class="token comment"># fastdfs nginx æ¨¡å—é…ç½®æ–‡ä»¶</span>
â”œâ”€â”€ nginx.conf              <span class="token comment"># nginx é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®è‡ªèº«é¡¹ç›®ä¿®æ”¹</span>
â”œâ”€â”€ storage.conf            <span class="token comment"># storage æœåŠ¡é…ç½®æ–‡ä»¶</span>
â””â”€â”€ tracker.conf            <span class="token comment"># tracker æœåŠ¡é…ç½®æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="tracker-æœåŠ¡é…ç½®æ–‡ä»¶-tracker-conf"><a href="#tracker-æœåŠ¡é…ç½®æ–‡ä»¶-tracker-conf" class="headerlink" title="tracker æœåŠ¡é…ç½®æ–‡ä»¶ tracker.conf"></a>tracker æœåŠ¡é…ç½®æ–‡ä»¶ tracker.conf</h4><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">disabled</span><span class="token punctuation">=</span><span class="token value attr-value">false                #å¯ç”¨é…ç½®æ–‡ä»¶</span>
<span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">22122                    #è®¾ç½®trackerçš„ç«¯å£å·</span>
<span class="token key attr-name">base_path</span><span class="token punctuation">=</span><span class="token value attr-value">/var/dfs           #è®¾ç½®trackerçš„æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—ç›®å½•ï¼ˆéœ€é¢„å…ˆåˆ›å»ºï¼‰</span>
<span class="token key attr-name">http.server_port</span><span class="token punctuation">=</span><span class="token value attr-value">28080         #è®¾ç½®httpç«¯å£å·</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="storage-æœåŠ¡é…ç½®æ–‡ä»¶-storage-ids-conf"><a href="#storage-æœåŠ¡é…ç½®æ–‡ä»¶-storage-ids-conf" class="headerlink" title="storage æœåŠ¡é…ç½®æ–‡ä»¶ storage_ids.conf"></a>storage æœåŠ¡é…ç½®æ–‡ä»¶ storage_ids.conf</h4><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># storageæœåŠ¡ç«¯å£</span>
<span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">23000                         # ç›‘å¬ç«¯å£å·</span>
<span class="token key attr-name">base_path</span><span class="token punctuation">=</span><span class="token value attr-value">/var/dfs                # æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•</span>
<span class="token key attr-name">store_path0</span><span class="token punctuation">=</span><span class="token value attr-value">/var/dfs              # ç¬¬ä¸€ä¸ªå­˜å‚¨ç›®å½•</span>
<span class="token key attr-name">tracker_server</span><span class="token punctuation">=</span><span class="token value attr-value">tracker_ip:22122    # trackeræœåŠ¡å™¨IPå’Œç«¯å£</span>
<span class="token key attr-name">http.server_port</span><span class="token punctuation">=</span><span class="token value attr-value">28888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="nginx-é…ç½®æ–‡ä»¶-nginx-conf"><a href="#nginx-é…ç½®æ–‡ä»¶-nginx-conf" class="headerlink" title="nginx é…ç½®æ–‡ä»¶ nginx.conf"></a>nginx é…ç½®æ–‡ä»¶ nginx.conf</h4><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># åœ¨ nginx é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¿®æ”¹ä¸‹é¢è¿™æ®µ</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">28888</span></span><span class="token punctuation">;</span>    <span class="token comment">## è¯¥ç«¯å£ä¸ºstorage.confä¸­çš„http.server_portç›¸åŒ</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> ~/group[0-9]/</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">ngx_fastdfs_module</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="nginx-æ¨¡å—é…ç½®æ–‡ä»¶-mod-fastdfs-conf"><a href="#nginx-æ¨¡å—é…ç½®æ–‡ä»¶-mod-fastdfs-conf" class="headerlink" title="nginx æ¨¡å—é…ç½®æ–‡ä»¶ mod_fastdfs.conf"></a>nginx æ¨¡å—é…ç½®æ–‡ä»¶ mod_fastdfs.conf</h4><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">tracker_server</span><span class="token punctuation">=</span><span class="token value attr-value">tracker_ip:22122   # trackeræœåŠ¡å™¨IPå’Œç«¯å£</span>
<span class="token key attr-name">url_have_group_name</span><span class="token punctuation">=</span><span class="token value attr-value">true             # url ä¸­åŒ…å« group çš„åç§°</span>
<span class="token key attr-name">store_path0</span><span class="token punctuation">=</span><span class="token value attr-value">/var/dfs                # æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="fastdfs-æœåŠ¡çš„è„šæœ¬-fastdfs-sh"><a href="#fastdfs-æœåŠ¡çš„è„šæœ¬-fastdfs-sh" class="headerlink" title="fastdfs æœåŠ¡çš„è„šæœ¬ fastdfs.sh"></a>fastdfs æœåŠ¡çš„è„šæœ¬ fastdfs.sh</h4><p>å®˜æ–¹çš„è„šæœ¬å†™çš„å¾ˆéšæ„ï¼Œæˆ‘å°±ä¿®æ”¹äº†ä¸€å“ˆï¼Œä¸ä¿®æ”¹æŒ‰ç…§å®˜æ–¹çš„æ¥ä¹Ÿ ok</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">new_val</span><span class="token operator">=</span><span class="token variable">$FASTDFS_IPADDR</span>
<span class="token assign-left variable">old</span><span class="token operator">=</span><span class="token string">"tracker_ip"</span>

<span class="token function">sed</span> -i <span class="token string">"s/<span class="token variable">$old</span>/<span class="token variable">$new_val</span>/g"</span> /etc/fdfs/storage.conf
<span class="token function">sed</span> -i <span class="token string">"s/<span class="token variable">$old</span>/<span class="token variable">$new_val</span>/g"</span> /etc/fdfs/mod_fastdfs.conf

<span class="token builtin class-name">echo</span> <span class="token string">"start trackerd"</span>
/etc/init.d/fdfs_trackerd start

<span class="token builtin class-name">echo</span> <span class="token string">"start storage"</span>
/etc/init.d/fdfs_storaged start

<span class="token builtin class-name">echo</span> <span class="token string">"start nginx"</span>
/usr/local/nginx/sbin/nginx

<span class="token function">tail</span> -f  /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="æŠŠ-bash-æ›¿æ¢æˆ-sh"><a href="#æŠŠ-bash-æ›¿æ¢æˆ-sh" class="headerlink" title="æŠŠ bash æ›¿æ¢æˆ sh"></a>æŠŠ bash æ›¿æ¢æˆ sh</h4><p>å…¶å®è¿™ä¸€æ­¥éª¤å¯ä»¥ä¸åšï¼Œä½¿ç”¨ bash å¯åŠ¨çš„è¯ï¼Œéœ€è¦åœ¨ alpine å®‰è£… bash ï¼Œä¼šå¢åŠ  6MB å·¦å³çš„é•œåƒå¤§å°ï¼Œæ„Ÿè§‰ä¹Ÿæ²¡å¿…è¦è¿™æ ·åš ğŸ˜‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> -i <span class="token string">'s/bash/sh/g'</span> <span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> -nr <span class="token function">bash</span> <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token string">':'</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">`</span></span>

<span class="token comment"># æ›¿æ¢å</span>
<span class="token function">grep</span> -nr <span class="token punctuation">\</span>#<span class="token punctuation">\</span><span class="token operator">!</span><span class="token punctuation">\</span>/bin<span class="token punctuation">\</span>/sh
stop.sh:1:<span class="token comment">#!/bin/sh</span>
init.d/fdfs_storaged:1:<span class="token comment">#!/bin/sh</span>
init.d/fdfs_trackerd:1:<span class="token comment">#!/bin/sh</span>
conf/fastdfs.sh:1:<span class="token comment">#!/bin/sh</span>
restart.sh:1:<span class="token comment">#!/bin/sh</span>
docker/dockerfile_local/fastdfs.sh:1:<span class="token comment">#!/bin/sh</span>
docker/dockerfile_network/fastdfs.sh:1:<span class="token comment">#!/bin/sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><h4 id="alpine-3-10"><a href="#alpine-3-10" class="headerlink" title="alpine:3.10"></a>alpine:3.10</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> alpine:3.10</span>

<span class="token instruction"><span class="token keyword">COPY</span> conf/ /home</span>
<span class="token instruction"><span class="token keyword">RUN</span> set -xe <span class="token operator">\</span>
    &amp;&amp; echo <span class="token string">"http://mirrors.aliyun.com/alpine/latest-stable/main/"</span> > /etc/apk/repositories <span class="token operator">\</span>
    &amp;&amp; echo <span class="token string">"http://mirrors.aliyun.com/alpine/latest-stable/community/"</span> >> /etc/apk/repositories <span class="token operator">\</span>
    &amp;&amp; apk update <span class="token operator">\</span>
    &amp;&amp; apk add --no-cache --virtual .build-deps alpine-sdk gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev tzdata <span class="token operator">\</span>
    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class="token operator">\</span>
    &amp;&amp; echo <span class="token string">"Asia/Shanghai"</span> > /etc/timezone <span class="token operator">\</span>
    &amp;&amp; mkdir -p /usr/local/src <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src <span class="token operator">\</span>
    &amp;&amp; git clone https://github.com/happyfish100/libfastcommon.git --depth 1 <span class="token operator">\</span>
    &amp;&amp; git clone https://github.com/happyfish100/fastdfs.git --depth 1    <span class="token operator">\</span>
    &amp;&amp; git clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1  <span class="token operator">\</span>
    &amp;&amp; wget http://nginx.org/download/nginx-1.15.4.tar.gz <span class="token operator">\</span>
    &amp;&amp; tar -xf nginx-1.15.4.tar.gz <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src/libfastcommon <span class="token operator">\</span>
    &amp;&amp; sed -i <span class="token string">'s/sys\/poll\.h/poll\.h/g'</span> src/sockopt.c <span class="token operator">\</span>
    &amp;&amp; ./make.sh <span class="token operator">\</span>
    &amp;&amp; ./make.sh install <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; ./make.sh <span class="token operator">\</span>
    &amp;&amp; ./make.sh install <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src/nginx-1.15.4/ <span class="token operator">\</span>
    &amp;&amp; ./configure --add-module=/usr/local/src/fastdfs-nginx-module/src/ <span class="token operator">\</span>
    &amp;&amp; make &amp;&amp; make install <span class="token operator">\</span>
    &amp;&amp; apk del .build-deps tzdata <span class="token operator">\</span>
    &amp;&amp; apk add --no-cache pcre-dev bash <span class="token operator">\</span>
    &amp;&amp; mkdir -p /var/fdfs /home/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; mv /home/fastdfs.sh /home/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; mv /home/*.conf /home/mime.types /etc/fdfs <span class="token operator">\</span>
    &amp;&amp; mv /home/nginx.conf /usr/local/nginx/conf/ <span class="token operator">\</span>
    &amp;&amp; chmod +x /home/fastdfs/fastdfs.sh <span class="token operator">\</span>
    &amp;&amp; sed -i <span class="token string">'s/bash/sh/g'</span> /etc/init.d/fdfs_storaged <span class="token operator">\</span>
    &amp;&amp; sed -i <span class="token string">'s/bash/sh/g'</span> /etc/init.d/fdfs_trackerd <span class="token operator">\</span>
    &amp;&amp; sed -i <span class="token string">'s/bash/sh/g'</span> /home/fastdfs/fastdfs.sh <span class="token operator">\</span>
    &amp;&amp; rm -rf /usr/local/src/* /var/cache/apk/* /tmp/* /var/tmp/* <span class="token variable">$HOME</span>/.cache</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> /var/fdfs</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 22122 23000 28888 28080</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">"/home/fastdfs/fastdfs.sh"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="debian-stretch-slim"><a href="#debian-stretch-slim" class="headerlink" title="debian:stretch-slim"></a>debian:stretch-slim</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> debian:stretch-slim</span>

<span class="token instruction"><span class="token keyword">COPY</span> conf/ /home/</span>
<span class="token instruction"><span class="token keyword">RUN</span> set -x <span class="token operator">\</span>
    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class="token operator">\</span>
    &amp;&amp; echo <span class="token string">"Asia/shanghai"</span> > /etc/timezone <span class="token operator">\</span>
    &amp;&amp; sed -i <span class="token string">'s/deb.debian.org/mirrors.aliyun.com/g'</span> /etc/apt/sources.list <span class="token operator">\</span>
    &amp;&amp; sed -i <span class="token string">'s|security.debian.org/debian-security|mirrors.aliyun.com/debian-security|g'</span> /etc/apt/sources.list <span class="token operator">\</span>
    &amp;&amp; apt update <span class="token operator">\</span>
    &amp;&amp; apt install  --no-install-recommends --no-install-suggests -y build-essential libpcre3 libpcre3-dev zlib1g <span class="token operator">\</span>
                   git wget ca-certificates  zlib1g-dev libtool libssl-dev <span class="token operator">\</span>
    &amp;&amp; rm -rf /var/lib/apt/lists/* <span class="token operator">\</span>
    &amp;&amp; mkdir -p /usr/local/src <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src <span class="token operator">\</span>
    &amp;&amp; git clone https://github.com/happyfish100/libfastcommon.git --depth 1 <span class="token operator">\</span>
    &amp;&amp; git clone https://github.com/happyfish100/fastdfs.git --depth 1    <span class="token operator">\</span>
    &amp;&amp; git clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1  <span class="token operator">\</span>
    &amp;&amp; wget http://nginx.org/download/nginx-1.15.4.tar.gz <span class="token operator">\</span>
    &amp;&amp; tar -xf nginx-1.15.4.tar.gz <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src/libfastcommon <span class="token operator">\</span>
    &amp;&amp; ./make.sh <span class="token operator">\</span>
    &amp;&amp; ./make.sh install <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; ./make.sh <span class="token operator">\</span>
    &amp;&amp; ./make.sh install <span class="token operator">\</span>
    &amp;&amp; cd /usr/local/src/nginx-1.15.4/ <span class="token operator">\</span>
    &amp;&amp; ./configure --add-module=/usr/local/src/fastdfs-nginx-module/src/ <span class="token operator">\</span>
    &amp;&amp; make &amp;&amp; make install <span class="token operator">\</span>
    &amp;&amp; apt purge -y build-essential libtool git wget ca-certificates <span class="token operator">\</span>
    &amp;&amp; apt autoremove -y <span class="token operator">\</span>
    &amp;&amp; mkdir -p /var/dfs /home/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; mv /home/fastdfs.sh /home/fastdfs/ <span class="token operator">\</span>
    &amp;&amp; mv /home/*.conf /home/mime.types /etc/fdfs <span class="token operator">\</span>
    &amp;&amp; mv /home/nginx.conf /usr/local/nginx/conf/ <span class="token operator">\</span>
    &amp;&amp; chmod +x /home/fastdfs/fastdfs.sh <span class="token operator">\</span>
    &amp;&amp; rm -rf /var/lib/apt/list  /usr/local/src/*</span>

<span class="token instruction"><span class="token keyword">VOLUME</span> /var/fdfs</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span>  22122 23000 28888 28080</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æ„ä¸åŒåŸºç¡€é•œåƒæ„å»ºå‡ºçš„å¤§å°å¯¹æ¯”"><a href="#æ„ä¸åŒåŸºç¡€é•œåƒæ„å»ºå‡ºçš„å¤§å°å¯¹æ¯”" class="headerlink" title="æ„ä¸åŒåŸºç¡€é•œåƒæ„å»ºå‡ºçš„å¤§å°å¯¹æ¯”"></a>æ„ä¸åŒåŸºç¡€é•œåƒæ„å»ºå‡ºçš„å¤§å°å¯¹æ¯”</h3><p>å“­äº†ï¼Œå®˜æ–¹æ„å»ºå‡ºæ¥çš„é•œåƒå°†è¿‘ 500MB</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">fastdfs             alpine              e855bd197dbe        <span class="token number">10</span> seconds ago      <span class="token number">29</span>.3MB
fastdfs             debian              e05ca1616604        <span class="token number">20</span> minutes ago      103MB
fastdfs             centos              c1488537c23c        <span class="token number">30</span> minutes ago      483MB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="ä½¿ç”¨-dive-åˆ†æå„ä¸ªé•œåƒ"><a href="#ä½¿ç”¨-dive-åˆ†æå„ä¸ªé•œåƒ" class="headerlink" title="ä½¿ç”¨ dive åˆ†æå„ä¸ªé•œåƒ"></a>ä½¿ç”¨ dive åˆ†æå„ä¸ªé•œåƒ</h4><p>å®˜æ–¹çš„</p>
<p><img data-src="https://p.k8s.li/1569728664464.png"></p>
<h4 id="alpine"><a href="#alpine" class="headerlink" title="alpine"></a>alpine</h4><p>åŸºäº alpine çš„åŸºç¡€é•œåƒæ„å»ºå®Œæˆåï¼Œåªæœ‰ä¸‰å±‚é•œåƒ ğŸ˜‚</p>
<p><img data-src="https://p.k8s.li/1569728744655.png"></p>
<h4 id="debian"><a href="#debian" class="headerlink" title="debian"></a>debian</h4><p><img data-src="https://p.k8s.li/1569729043301.png"></p>
<h3 id="musl-libc-å¸¦æ¥çš„é—®é¢˜"><a href="#musl-libc-å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="musl libc å¸¦æ¥çš„é—®é¢˜"></a><code>musl libc</code> å¸¦æ¥çš„é—®é¢˜</h3><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ CentOS å’Œ Alpine åŸºç¡€é•œåƒåˆ†åˆ«æ„å»ºå‡ºæ¥çš„é•œåƒï¼Œä½¿ç”¨ ldd æŸ¥çœ‹äºŒè€…ç¼–è¯‘å‡ºæ¥çš„ fastdfs ï¼Œä¸¤è€…çš„åŠ¨æ€é“¾æ¥åº“å­˜åœ¨å¾ˆå¤§çš„å·®å¼‚ï¼Œ Alpine ç¼ºå°‘äº†å¾ˆå¤šåŠ¨æ€é“¾æ¥åº“ï¼Œè¿™æ˜¯å› ä¸º alpine çš„ c åº“æ˜¯ <code>musl libc</code> ï¼Œè€Œä¸æ˜¯æ­£ç»Ÿçš„ <code>glibc</code> ï¼Œå¦å¤–å¯¹äºä¸€äº›ä¾èµ– <code>glibc</code> çš„å¤§å‹é¡¹ç›®ï¼Œåƒ openjdk ã€tomcatã€rabbitmq ç­‰éƒ½ä¸å»ºè®®ä½¿ç”¨ alpine åŸºç¡€é•œåƒï¼Œå› ä¸º  <code>musl libc</code> ä¼šå¯¼è‡´ jvm ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ tomcat å®˜æ–¹æ²¡æœ‰ç»™å‡ºåŸºç¡€é•œåƒæ˜¯ alpine çš„ Dockerfile</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">centos<span class="token comment"># find /usr/bin/ -name "fdfs*" | xargs ldd</span>
        linux-vdso.so.1 <span class="token operator">=</span><span class="token operator">></span>  <span class="token punctuation">(</span>0x00007fffe1d30000<span class="token punctuation">)</span>
        libpthread.so.0 <span class="token operator">=</span><span class="token operator">></span> /lib64/libpthread.so.0 <span class="token punctuation">(</span>0x00007f86036e6000<span class="token punctuation">)</span>
        libfastcommon.so <span class="token operator">=</span><span class="token operator">></span> /lib/libfastcommon.so <span class="token punctuation">(</span>0x00007f86034a5000<span class="token punctuation">)</span>
        libc.so.6 <span class="token operator">=</span><span class="token operator">></span> /lib64/libc.so.6 <span class="token punctuation">(</span>0x00007f86030d8000<span class="token punctuation">)</span>
        /lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00007f8603902000<span class="token punctuation">)</span>
        libm.so.6 <span class="token operator">=</span><span class="token operator">></span> /lib64/libm.so.6 <span class="token punctuation">(</span>0x00007f8602dd6000<span class="token punctuation">)</span>
        libdl.so.2 <span class="token operator">=</span><span class="token operator">></span> /lib64/libdl.so.2 <span class="token punctuation">(</span>0x00007f8602bd2000<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">alpine <span class="token comment"># find /usr/bin/ -name "fdfs*" | xargs ldd</span>
        /lib/ld-musl-x86_64.so.1 <span class="token punctuation">(</span>0x7f4f91585000<span class="token punctuation">)</span>
        libfastcommon.so <span class="token operator">=</span><span class="token operator">></span> /usr/lib/libfastcommon.so <span class="token punctuation">(</span>0x7f4f91528000<span class="token punctuation">)</span>
        libc.musl-x86_64.so.1 <span class="token operator">=</span><span class="token operator">></span> /lib/ld-musl-x86_64.so.1 <span class="token punctuation">(</span>0x7f4f91585000<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">debian <span class="token comment"># find /usr/bin/ -name "fdfs*" | xargs ldd</span>
        linux-vdso.so.1 <span class="token punctuation">(</span>0x00007ffd17e50000<span class="token punctuation">)</span>
        libpthread.so.0 <span class="token operator">=</span><span class="token operator">></span> /lib/x86_64-linux-gnu/libpthread.so.0 <span class="token punctuation">(</span>0x00007feadf317000<span class="token punctuation">)</span>
        libfastcommon.so <span class="token operator">=</span><span class="token operator">></span> /usr/lib/libfastcommon.so <span class="token punctuation">(</span>0x00007feadf0d6000<span class="token punctuation">)</span>
        libc.so.6 <span class="token operator">=</span><span class="token operator">></span> /lib/x86_64-linux-gnu/libc.so.6 <span class="token punctuation">(</span>0x00007feaded37000<span class="token punctuation">)</span>
        /lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00007feadf74a000<span class="token punctuation">)</span>
        libm.so.6 <span class="token operator">=</span><span class="token operator">></span> /lib/x86_64-linux-gnu/libm.so.6 <span class="token punctuation">(</span>0x00007feadea33000<span class="token punctuation">)</span>
        libdl.so.2 <span class="token operator">=</span><span class="token operator">></span> /lib/x86_64-linux-gnu/libdl.so.2 <span class="token punctuation">(</span>0x00007feade82f000<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å®¹å™¨å¯åŠ¨æ–¹æ³•"><a href="#å®¹å™¨å¯åŠ¨æ–¹æ³•" class="headerlink" title="å®¹å™¨å¯åŠ¨æ–¹æ³•"></a>å®¹å™¨å¯åŠ¨æ–¹æ³•</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒFastDFS çš„å®¹å™¨éœ€è¦ä½¿ç”¨ host ç½‘ç»œï¼Œå› ä¸º fastdfs storage æœåŠ¡å™¨éœ€è¦å‘ tracker æœåŠ¡å™¨æ±‡æŠ¥è‡ªå·± IPï¼Œè¿™ä¸ª IP è¿˜éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼æ³¨å…¥åˆ°ç›¸å…³çš„é…ç½®æ–‡ä»¶å½“ä¸­ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -d -e <span class="token assign-left variable">FASTDFS_IPADDR</span><span class="token operator">=</span><span class="token number">10.10</span>.107.230 <span class="token punctuation">\</span>
           -p <span class="token number">28888</span>:28888 -p <span class="token number">22122</span>:22122 -p <span class="token number">23000</span>:23000 -p <span class="token number">28088</span>:28080 <span class="token punctuation">\</span>
           -v <span class="token environment constant">$PWD</span>/data:/var/fdfs --net<span class="token operator">=</span>host --name fastdfs fastdfs:alpine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="æµ‹è¯•å·¥å…·"><a href="#æµ‹è¯•å·¥å…·" class="headerlink" title="æµ‹è¯•å·¥å…·"></a>æµ‹è¯•å·¥å…·</h3><ol>
<li>ä¸Šä¼ å®¢æˆ·ç«¯ï¼š<code>fdfs_upload_file</code></li>
<li>å¹¶å‘æ‰§è¡Œå·¥å…· ï¼š<code>xargs</code></li>
<li>æµ‹è¯•æ ·æœ¬ï¼š10W  å¼ è¡¨æƒ…åŒ…å›¾ç‰‡ ï¼Œå¤§å°åœ¨ <strong>8KBâ€“128KB</strong> ä¹‹é—´</li>
<li>ä¸Šä¼ æµ‹è¯•å‘½ä»¤ï¼š<code>time ls  | xargs -n 1 -I &#123;&#125; -P 256 sh -c &quot;/usr/bin/fdfs_upload_file /etc/fdfs/client.conf &#123;&#125;&quot;` </code>-p å‚æ•°æŒ‡å®šå¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡</li>
<li>ä¸‹è½½æµ‹è¯•å·¥å…·ï¼š <code>wget</code></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ä¸‹è½½æµ‹è¯•å‘½ä»¤ï¼š<span class="token variable"><span class="token variable">`</span><span class="token function">time</span> <span class="token function">cat</span> url.log  <span class="token operator">|</span> <span class="token function">xargs</span> -n <span class="token number">1</span> -I <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> -P <span class="token number">256</span> <span class="token function">sh</span> -c <span class="token string">"wget  &#123;&#125;"</span><span class="token variable">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æ–‡ä»¶ä¸Šä¼ æµ‹è¯•"><a href="#æ–‡ä»¶ä¸Šä¼ æµ‹è¯•" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æµ‹è¯•"></a>æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</h3><p>æµ‹è¯•æ ·æœ¬ä¸º 10W å¼  8KB-100 KB å¤§å°ä¸ç­‰çš„å›¾ç‰‡</p>
<p><img data-src="https://p.k8s.li/1564128425387.png"></p>
<p><strong>æµ‹è¯•æ–‡ä»¶æ•°é‡å’Œå¤§å°</strong></p>
<p><img data-src="https://p.k8s.li/1564128874832.png"></p>
<p><strong>ä½¿ç”¨ xargs æ‰§è¡Œ 256 ä¸ªè¿›ç¨‹å¹¶å‘ä¸Šä¼  10w å¼ ç…§ç‰‡æ‰€ç”¨æ‰€ç”¨æ—¶é—´ ä¸º 2 åˆ†é’Ÿå·¦å³ï¼ˆå†…ç½‘ï¼‰</strong></p>
<p><img data-src="https://p.k8s.li/1564128721547.png"></p>
<p><strong>ç”¨æ—¶ 2 åˆ† 11 ç§’</strong></p>
<p><img data-src="https://p.k8s.li/1564364594777.png"></p>
<p><strong>å®¢æˆ·ç«¯è´Ÿè½½æƒ…å†µ</strong></p>
<p><img data-src="https://p.k8s.li/1564127683217.png"></p>
<p><strong>æœåŠ¡ç«¯è´Ÿè½½æƒ…å†µ</strong></p>
<p><img data-src="https://p.k8s.li/1564364294952.png"></p>
<p><strong>æœåŠ¡ç«¯å¸¦å®½æµé‡</strong></p>
<p><img data-src="https://p.k8s.li/1564365025177.png"></p>
<p><strong>æœåŠ¡ç«¯å¸¦å®½æµé‡</strong></p>
<p><img data-src="https://p.k8s.li/1564363829960.png"></p>
<p><strong>æœåŠ¡ç«¯ä¸Šä¼ ç»“æœ</strong></p>
<p><img data-src="https://p.k8s.li/1564125161155.png"></p>
<p><strong>æœåŠ¡ç«¯ä¸Šä¼ æ—¥å¿—è®°å½• ï¼Œå‡æ— é”™è¯¯è¾“å‡º</strong></p>
<p><img data-src="https://p.k8s.li/1564130238346.png"></p>
<h3 id="æ–‡ä»¶ä¸‹è½½æµ‹è¯•"><a href="#æ–‡ä»¶ä¸‹è½½æµ‹è¯•" class="headerlink" title="æ–‡ä»¶ä¸‹è½½æµ‹è¯•"></a>æ–‡ä»¶ä¸‹è½½æµ‹è¯•</h3><p><strong>ä»æ—¥å¿—ä¸­æå–æ–‡ä»¶è·¯å¾„</strong></p>
<p>ä»æœåŠ¡ç«¯çš„ <code>storage_access.log</code> æ—¥å¿—é‡Œæå–å‡ºæ–‡ä»¶çš„è·¯å¾„ï¼Œä½¿ç”¨ <code>sed</code> æ·»åŠ  <code>nginx</code> çš„è®¿é—®ç«¯å£åœ°å€å¾—åˆ° 10W ä¸ªè®°å½• ä¸Šä¼ æ–‡ä»¶çš„ <code>http</code> è®¿é—® <code>url</code> åœ°å€</p>
<p><img data-src="https://p.k8s.li/1564130789416.png"></p>
<p><strong>wget ä¸‹è½½</strong></p>
<p>ä½¿ç”¨ <code>wget -i</code> å‚æ•°æŒ‡å®š <code>url.log</code> ä¸ºæ ‡å‡†è¾“å‡ºæ¥æµ‹è¯•ä¸‹è½½åˆšåˆšä¸Šä¼ çš„ 10W å¼ å›¾ç‰‡ ç”¨æ—¶ 3 åˆ† 23 ç§’</p>
<p><img data-src="https://p.k8s.li/1564023927851.png"></p>
<h3 id="æµ‹è¯•ç»“æœåˆ†æ"><a href="#æµ‹è¯•ç»“æœåˆ†æ" class="headerlink" title="æµ‹è¯•ç»“æœåˆ†æ"></a>æµ‹è¯•ç»“æœåˆ†æ</h3><p>ä½¿ç”¨ FastDFS è‡ªå¸¦çš„ä¸Šä¼ æµ‹è¯•å·¥å…·å’Œ xargs å¹¶å‘æ‰§è¡Œå·¥å…·ï¼Œé€šè¿‡ xargs -P å‚æ•°æŒ‡å®šçš„å¹¶å‘è¯·æ±‚æ•°ï¼Œæµ‹å¾—ç»“æœä¸ºå•æœºæ€§èƒ½åœ¨ç½‘ç»œç¯å¢ƒç¨³å®šçš„æƒ…å†µä¸‹å¯ä»¥è¾¾åˆ° 5000 å¹¶å‘ä¸Šä¼ è¯·æ±‚ã€‚10W å¼ å›¾ç‰‡ä¸Šä¼ æ—¶é—´è€—æ—¶ 2 åˆ† 11 ç§’å·¦å³ã€‚ä½¿ç”¨å®šæ—¶è„šæœ¬æŒç»­æµ‹è¯•ï¼Œæ€»æµ‹è¯•ä¸Šä¼  100W å¼ å›¾ç‰‡ã€‚åˆ†æ tracker æœåŠ¡å™¨å’Œ storage æœåŠ¡å™¨çš„æ—¥å¿—ï¼Œæ— è®ºä¸Šä¼ è¿˜æ˜¯ä¸‹è½½å‡æœªå‘ç°é”™è¯¯å’Œå¼‚å¸¸ï¼Œæ€§èƒ½å’Œç¨³å®šæ€§è¾ƒå¥½ã€‚</p>
<h2 id="ä¼˜åŒ–å‚æ•°"><a href="#ä¼˜åŒ–å‚æ•°" class="headerlink" title="ä¼˜åŒ–å‚æ•°"></a>ä¼˜åŒ–å‚æ•°</h2><p>æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œçº¿ä¸Šç¯å¢ƒè°ƒæ•´ä¸€ä¸‹å‚æ•°ï¼Œå¯å……åˆ†å‘æŒ¥ FastDFS æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># æ¥æ”¶è¯·æ±‚çš„çº¿ç¨‹æ•°æ•°é‡</span>
<span class="token key attr-name">accept_threads</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>

<span class="token comment"># work thread count, should &lt;= max_connections</span>
<span class="token comment"># default value is 4</span>
<span class="token comment"># since V2.00</span>
<span class="token comment"># å·¥ä½œçº¿ç¨‹æ•°é‡ï¼Œåº”å½“å°äºç­‰äºæœ€å¤§è¿æ¥æ•°</span>
<span class="token key attr-name">work_threads</span><span class="token punctuation">=</span><span class="token value attr-value">4</span>

<span class="token comment"># min buff size</span>
<span class="token comment"># default value 8KB</span>
<span class="token comment"># æœ€å°ç¼“å†²å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 8KB</span>
<span class="token key attr-name">min_buff_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">8KB</span>

<span class="token comment"># max buff size</span>
<span class="token comment"># default value 128KB</span>
<span class="token comment"># æœ€å¤§ç¼“å†²å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 128KB</span>
<span class="token key attr-name">max_buff_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">128KB</span>

<span class="token comment"># thread stack size, should >= 64KB</span>
<span class="token comment"># default value is 256KB</span>
<span class="token comment"># çº¿ç¨‹æ ˆçš„å¤§å°ï¼Œåº”å½“å¤§äº 64KBï¼Œé»˜è®¤ä¸º 256KB</span>
<span class="token key attr-name">thread_stack_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">256KB</span>

<span class="token comment"># if use connection pool</span>
<span class="token comment"># default value is false</span>
<span class="token comment"># since V4.05</span>
<span class="token comment"># æ˜¯å¦ä½¿ç”¨è¿æ¥æ± </span>
<span class="token key attr-name">use_connection_pool</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>

<span class="token comment"># connections whose the idle time exceeds this time will be closed</span>
<span class="token comment"># unit: second</span>
<span class="token comment"># default value is 3600</span>
<span class="token comment"># since V4.05</span>
<span class="token comment"># è¿æ¥æ± çš„æœ€å¤§ç©ºé—²æ—¶é—´</span>
<span class="token key attr-name">connection_pool_max_idle_time</span> <span class="token punctuation">=</span> <span class="token value attr-value">3600</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h4 id="æ— æ³•è¿æ¥åˆ°-tracker-æœåŠ¡å™¨"><a href="#æ— æ³•è¿æ¥åˆ°-tracker-æœåŠ¡å™¨" class="headerlink" title="æ— æ³•è¿æ¥åˆ° tracker æœåŠ¡å™¨"></a>æ— æ³•è¿æ¥åˆ° tracker æœåŠ¡å™¨</h4><p>éœ€è¦åœ¨ tracker.conf é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å…è®¸è®¿é—®çš„ IP ,å¹¶æ·»åŠ é˜²ç«å¢™è§„åˆ™</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2019</span>-07-25 <span class="token number">10</span>:40:54<span class="token punctuation">]</span> ERROR - file: <span class="token punctuation">..</span>/client/storage_client.c, line: <span class="token number">996</span>, fdfs_recv_response fail, result: <span class="token number">107</span>
upload <span class="token function">file</span> fail, error no: <span class="token number">107</span>, error info: Transport endpoint is not connected
<span class="token punctuation">[</span><span class="token number">2019</span>-07-25 <span class="token number">10</span>:40:54<span class="token punctuation">]</span> ERROR - file: tracker_proto.c, line: <span class="token number">37</span>, server: <span class="token number">10.20</span>.172.192:23000, recv data fail, errno: <span class="token number">107</span>, error info: Transport endpoint is not connected<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="æœåŠ¡å™¨ç£ç›˜ç”¨å°½"><a href="#æœåŠ¡å™¨ç£ç›˜ç”¨å°½" class="headerlink" title="æœåŠ¡å™¨ç£ç›˜ç”¨å°½"></a>æœåŠ¡å™¨ç£ç›˜ç”¨å°½</h4><p>å½“ storage æœåŠ¡å™¨è®¾å®šçš„ä¸Šä¼ å­˜å‚¨ç›®å½•æ‰€åœ¨çš„åˆ†åŒºç£ç›˜ç”¨å°½å°†ä¼šå‡ºç°æ— å‰©ä½™ç©ºé—´çš„é”™è¯¯æ—¥å¿—</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2019</span>-07-26 <span class="token number">16</span>:16:45<span class="token punctuation">]</span> ERROR - file: tracker_proto.c, line: <span class="token number">48</span>, server: <span class="token number">10.10</span>.107.232:22122, response status <span class="token number">28</span> <span class="token operator">!=</span> <span class="token number">0</span>
<span class="token punctuation">[</span><span class="token number">2019</span>-07-26 <span class="token number">16</span>:16:45<span class="token punctuation">]</span> ERROR - file: <span class="token punctuation">..</span>/client/tracker_client.c, line: <span class="token number">907</span>, fdfs_recv_response fail, result: <span class="token number">28</span>
tracker_query_storage fail, error no: <span class="token number">28</span>, error info: No space left on device<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="é‡å¯æœåŠ¡æ—¶å¤±è´¥"><a href="#é‡å¯æœåŠ¡æ—¶å¤±è´¥" class="headerlink" title="é‡å¯æœåŠ¡æ—¶å¤±è´¥"></a>é‡å¯æœåŠ¡æ—¶å¤±è´¥</h4><p>ä½¿ç”¨ service fdfs_trackerd restart é‡å¯ tracker æˆ–è€… storage æœåŠ¡æ—¶ä¼šæŠ¥é”™ï¼Œä¼šæç¤ºç«¯å£å·²ç»å ç”¨ã€‚è§£å†³çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ kill -9 å‘½ä»¤æ€æ­» tracker æœåŠ¡æˆ–è€… storage æœåŠ¡ï¼Œç„¶åå†é‡æ–°å¯åŠ¨ç›¸åº”æœåŠ¡å³å¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2019</span>-07-25 <span class="token number">10</span>:36:55<span class="token punctuation">]</span> INFO - FastDFS v5.12, <span class="token assign-left variable">base_path</span><span class="token operator">=</span>/home/dfs, <span class="token assign-left variable">run_by_group</span><span class="token operator">=</span>, <span class="token assign-left variable">run_by_user</span><span class="token operator">=</span>, <span class="token assign-left variable">connect_timeout</span><span class="token operator">=</span>10s, <span class="token assign-left variable">network_timeout</span><span class="token operator">=</span>60s, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">22122</span>, <span class="token assign-left variable">bind_addr</span><span class="token operator">=</span>, <span class="token assign-left variable">max_connections</span><span class="token operator">=</span><span class="token number">1024</span>, <span class="token assign-left variable">accept_threads</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">work_threads</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">min_buff_size</span><span class="token operator">=</span><span class="token number">8,192</span>, <span class="token assign-left variable">max_buff_size</span><span class="token operator">=</span><span class="token number">131,072</span>, <span class="token assign-left variable">store_lookup</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">store_group</span><span class="token operator">=</span>, <span class="token assign-left variable">store_server</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">store_path</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">reserved_storage_space</span><span class="token operator">=</span><span class="token number">10.00</span>%, <span class="token assign-left variable">download_server</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">allow_ip_count</span><span class="token operator">=</span>-1, <span class="token assign-left variable">sync_log_buff_interval</span><span class="token operator">=</span>10s, <span class="token assign-left variable">check_active_interval</span><span class="token operator">=</span>120s, <span class="token assign-left variable">thread_stack_size</span><span class="token operator">=</span><span class="token number">256</span> KB, <span class="token assign-left variable">storage_ip_changed_auto_adjust</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">storage_sync_file_max_delay</span><span class="token operator">=</span>86400s, <span class="token assign-left variable">storage_sync_file_max_time</span><span class="token operator">=</span>300s, <span class="token assign-left variable">use_trunk_file</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">slot_min_size</span><span class="token operator">=</span><span class="token number">256</span>, <span class="token assign-left variable">slot_max_size</span><span class="token operator">=</span><span class="token number">16</span> MB, <span class="token assign-left variable">trunk_file_size</span><span class="token operator">=</span><span class="token number">64</span> MB, <span class="token assign-left variable">trunk_create_file_advance</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">trunk_create_file_time_base</span><span class="token operator">=</span>02:00, <span class="token assign-left variable">trunk_create_file_interval</span><span class="token operator">=</span><span class="token number">86400</span>, <span class="token assign-left variable">trunk_create_file_space_threshold</span><span class="token operator">=</span><span class="token number">20</span> GB, <span class="token assign-left variable">trunk_init_check_occupying</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">trunk_init_reload_from_binlog</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">trunk_compress_binlog_min_interval</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">use_storage_id</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">id_type_in_filename</span><span class="token operator">=</span>ip, <span class="token assign-left variable">storage_id_count</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rotate_error_log</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">error_log_rotate_time</span><span class="token operator">=</span>00:00, <span class="token assign-left variable">rotate_error_log_size</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">log_file_keep_days</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">store_slave_file_use_link</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">use_connection_pool</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">g_connection_pool_max_idle_time</span><span class="token operator">=</span>3600s
<span class="token punctuation">[</span><span class="token number">2019</span>-07-25 <span class="token number">10</span>:36:55<span class="token punctuation">]</span> ERROR - file: sockopt.c, line: <span class="token number">868</span>, <span class="token builtin class-name">bind</span> port <span class="token number">22122</span> failed, errno: <span class="token number">98</span>, error info: Address already <span class="token keyword">in</span> use.
<span class="token punctuation">[</span><span class="token number">2019</span>-07-25 <span class="token number">10</span>:36:55<span class="token punctuation">]</span> CRIT - <span class="token builtin class-name">exit</span> abnormally<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="å®‰å…¨ç›¸å…³"><a href="#å®‰å…¨ç›¸å…³" class="headerlink" title="å®‰å…¨ç›¸å…³"></a>å®‰å…¨ç›¸å…³</h3><ol>
<li>tracker.conf ã€storage.conf é…ç½®æ–‡ä»¶é»˜è®¤å…è®¸æ‰€æœ‰ IP åœ°å€è®¿é—® ï¼Œå»ºè®®å»æ‰  <code>allow_hosts=*</code> ä¿®æ”¹ä¸º FastDFS å®¢æˆ·ç«¯æ‰€åœ¨çš„å†…ç½‘ IP åœ°å€ã€‚</li>
</ol>
<p><img data-src="https://p.k8s.li/1564384530137.png"></p>
<p>2.tracker.conf ã€storage.conf  é»˜è®¤é…ç½®æ–‡ä»¶ç›‘å¬çš„åœ°å€ä¸º 0.0.0.0 å³æœ¬æœºæ‰€æœ‰çš„ IP åœ°å€ï¼Œå»ºè®®ä¿®æ”¹ä¸º FastDFS æœåŠ¡å™¨æ‰€åœ¨çš„å†…ç½‘ IP åœ°å€ã€‚</p>
<p><img data-src="https://p.k8s.li/1564384711746.png"></p>
<p>3.é»˜è®¤è¿è¡Œç”¨æˆ·ä¸ºå½“å‰ç”¨æˆ·å’Œç”¨æˆ·ç»„ä¸ºå½“å‰ç”¨æˆ·ï¼Œå»ºè®®æŒ‡å®šä¸ºæƒé™æœ€å°çš„ç”¨æˆ·æ¥è¿è¡Œæ­¤è¿›ç¨‹ã€‚</p>
<p><img data-src="https://p.k8s.li/1564384906456.png"></p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Docker/" rel="tag"># Docker</a>
              <a href="/tags/FastDFS/" rel="tag"># FastDFS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/esp8266-pc-switch.html" rel="prev" title="ä½¿ç”¨ ESP8266 NodeMCU æ‰“é€  WiFi å¼€å…³">
                  <i class="fa fa-chevron-left"></i> ä½¿ç”¨ ESP8266 NodeMCU æ‰“é€  WiFi å¼€å…³
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/fastdfs-lua-redis.html" rel="next" title="Lua + Redis å¯¹ nginx åšåŠ¨æ€è·¯ç”±">
                  Lua + Redis å¯¹ nginx åšåŠ¨æ€è·¯ç”± <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">26:05</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
