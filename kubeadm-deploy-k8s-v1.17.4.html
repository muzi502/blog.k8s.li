<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ç‚’å†·é¥­å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚ kubeadmKubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤">
<meta property="og:type" content="blog">
<meta property="og:title" content="ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s">
<meta property="og:url" content="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="ç‚’å†·é¥­å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚ kubeadmKubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/components-of-kubernetes.png">
<meta property="article:published_time" content="2020-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2020-04-14T16:00:00.000Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="kubeadm">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="ä»é›¶å¼€å§‹å­¦ä¹  K8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/components-of-kubernetes.png">


<link rel="canonical" href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html","path":"kubeadm-deploy-k8s-v1.17.4.html","title":"ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%92%E5%86%B7%E9%A5%AD"><span class="nav-number">1.</span> <span class="nav-text">ç‚’å†·é¥­</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kubeadm"><span class="nav-number">1.1.</span> <span class="nav-text">kubeadm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kubernetes-%E6%9E%B6%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">kubernetes æ¶æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="nav-number">2.1.</span> <span class="nav-text">æ§åˆ¶å¹³é¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%B9%B3%E9%9D%A2"><span class="nav-number">2.2.</span> <span class="nav-text">å·¥ä½œå¹³é¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kubeadm-init-%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">kubeadm init æµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">èŠ‚ç‚¹åˆå§‹åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D%E5%B9%B6%E6%B7%BB%E5%8A%A0-hosts"><span class="nav-number">3.1.</span> <span class="nav-text">è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%97%AD-swap-%E5%92%8C-SELinux"><span class="nav-number">3.2.</span> <span class="nav-text">å…³é—­ swap å’Œ SELinux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">è®¾ç½®å†…æ ¸å‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E6%BA%90%E5%92%8C%E5%AE%89%E8%A3%85"><span class="nav-number">3.4.</span> <span class="nav-text">é…ç½®é•œåƒæºå’Œå®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-docker-%E7%9A%84-daemon-json"><span class="nav-number">3.5.</span> <span class="nav-text">è®¾ç½® docker çš„ daemon.json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="nav-number">3.6.</span> <span class="nav-text">è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-master-%E8%8A%82%E7%82%B9"><span class="nav-number">4.</span> <span class="nav-text">éƒ¨ç½² master èŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E9%95%9C%E5%83%8F"><span class="nav-number">4.1.</span> <span class="nav-text">å‡†å¤‡é•œåƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-master-%E8%8A%82%E7%82%B9"><span class="nav-number">4.2.</span> <span class="nav-text">åˆå§‹åŒ– master èŠ‚ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5-node-%E8%8A%82%E7%82%B9"><span class="nav-number">5.</span> <span class="nav-text">åŠ å…¥ node èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">éƒ¨ç½²ç½‘ç»œæ’ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F"><span class="nav-number">7.</span> <span class="nav-text">ç»“æŸ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">117</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">152</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail â†’ mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2020-04-15 2020-04-15T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-04-15T00:00:00+08:00">2020-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/kubeadm-deploy-k8s-v1.17.4.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="kubeadm-deploy-k8s-v1.17.4.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>13 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="ç‚’å†·é¥­"><a href="#ç‚’å†·é¥­" class="headerlink" title="ç‚’å†·é¥­"></a>ç‚’å†·é¥­</h2><p>å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/install-k8s-ubuntu18-04.html">ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes</a> ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚</p>
<h3 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a>kubeadm</h3><p>Kubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤æ­å»ºçš„è¿‡ç¨‹ï¼Œåœ¨ Kubernetes 1.13 ç‰ˆæœ¬ä¸­ï¼Œkubeadm å·¥å…·è¿›å…¥ GA é˜¶æ®µï¼Œè€Œå½“å‰çš„ kubernetes æœ€æ–°ç‰ˆ stable ä¸º 1.18.1 ï¼Œkubeadm å·²ç»ç»å†è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒ Kubernetes é›†ç¾¤æ­å»ºã€‚å¯¹äºåˆšåˆšæ¥è§¦ kubernetes  çš„åˆå­¦è€…æ¥è®²ï¼Œkubeadm ä¹Ÿæ˜¯ä¸€ä¸ªå¿«é€Ÿéƒ¨ç½²ä½“éªŒ kubernetes çš„ä¸äºŒä¹‹é€‰ã€‚</p>
<h2 id="kubernetes-æ¶æ„"><a href="#kubernetes-æ¶æ„" class="headerlink" title="kubernetes æ¶æ„"></a>kubernetes æ¶æ„</h2><p><img data-src="https://p.k8s.li/components-of-kubernetes.png"></p>
<p>æ¶æ„å›¾æ¥è‡ª kubernetes å®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/overview/components/">Kubernetes ç»„ä»¶</a></p>
<h3 id="æ§åˆ¶å¹³é¢"><a href="#æ§åˆ¶å¹³é¢" class="headerlink" title="æ§åˆ¶å¹³é¢"></a>æ§åˆ¶å¹³é¢</h3><p>æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ä¸»è¦çš„ç»„ä»¶ç”±</p>
<ul>
<li>kube-apiserverï¼šä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶ï¼›å®ƒæ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚</li>
<li>etcdï¼šé›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èµ„æºä¿¡æ¯æ•°æ®ã€‚</li>
<li>kube-schedulerï¼šè´Ÿè´£è°ƒåº¦ Pod èµ„æºåˆ°æŸä¸ª Node èŠ‚ç‚¹ä¸Šã€‚</li>
<li>kube-controller-managerï¼šæ§åˆ¶å™¨ç®¡ç†å™¨ã€‚</li>
<li>kubeletï¼šå¦‚æœä½¿ç”¨ kubeadm éƒ¨ç½²çš„è¯éœ€è¦åœ¨ master èŠ‚ç‚¹å®‰è£… kubelet</li>
</ul>
<h3 id="å·¥ä½œå¹³é¢"><a href="#å·¥ä½œå¹³é¢" class="headerlink" title="å·¥ä½œå¹³é¢"></a>å·¥ä½œå¹³é¢</h3><ul>
<li>kubeletï¼šé€šè¿‡ç›‘å¬ kube-apiserver ï¼Œæ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚</li>
<li>kube-proxyï¼šå®ç° Kubernetes <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ iptables è§„åˆ™å°† service è´Ÿè½½å‡è¡¡åˆ°å„ä¸ª Podã€‚</li>
<li>CRI å®¹å™¨è¿è¡Œæ—¶ï¼šæ ¹æ®ç»Ÿè®¡ç›®å‰ docker ä¾æ—§æ˜¯æ’åç¬¬ä¸€çš„å®¹å™¨è¿è¡Œæ—¶</li>
</ul>
<h3 id="kubeadm-init-æµç¨‹"><a href="#kubeadm-init-æµç¨‹" class="headerlink" title="kubeadm init æµç¨‹"></a>kubeadm init æµç¨‹</h3><p>åœ¨ä½¿ç”¨ kubeadm éƒ¨ç½²æ—¶ï¼Œé™¤äº† kubelet ç»„ä»¶éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶éƒ¨ç½²å¤–ï¼Œå…¶ä»–çš„ç»„ä»¶éƒ½æ˜¯ç”¨ <a href="">static Pod</a> çš„æ–¹å¼è¿è¡Œåœ¨ç›¸åº”çš„èŠ‚ç‚¹ã€‚</p>
<h2 id="èŠ‚ç‚¹åˆå§‹åŒ–"><a href="#èŠ‚ç‚¹åˆå§‹åŒ–" class="headerlink" title="èŠ‚ç‚¹åˆå§‹åŒ–"></a>èŠ‚ç‚¹åˆå§‹åŒ–</h2><p>ç³»ç»Ÿå»ºè®®é€‰æ‹© ubuntu 1804 æˆ–è€… CentOS 7.7ï¼Œå› ä¸º docker å®¹å™¨è™šæ‹ŸåŒ–ä»¥åŠ kubernetes è¿™äº›æ–°æŠ€æœ¯éƒ½æ˜¯å¾ˆä¾èµ–ä¸€äº›å†…æ ¸ç‰¹æ€§ï¼Œæ¯”å¦‚ overlay2ã€cgroupv2 ç­‰ï¼Œè¿™äº›ç‰¹æ€§åœ¨è¾ƒä½ç‰ˆæœ¬çš„å†…æ ¸ä¸Šå¹¶ä¸æ˜¯å¾ˆç¨³å®šï¼Œå»ºè®® 4.14 æˆ–è€… 4.19 ä»¥ä¸Šçš„ LTS  å†…æ ¸ï¼ŒåŠé•¿æœŸç¨³å®šæ”¯æŒç‰ˆå†…æ ¸ï¼Œåœ¨ <a target="_blank" rel="noopener" href="https://www.kernel.org/category/releases.html">kernel.org</a> ä¸Šæœ‰å†…æ ¸æ”¯æŒæ”¯æŒæƒ…å†µã€‚</p>
<h3 id="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts"><a href="#è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts" class="headerlink" title="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts"></a>è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts</h3><p>æ¯å°æœºå™¨ä¸Šéƒ½è¦è®¾ç½®ç›¸åº”çš„ä¸»æœºåå¹¶æ·»åŠ  hosts</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hostnamectl set-hostname k8s-maste-01

<span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts <span class="token operator">&lt;&lt;</span><span class="token string">EOF
10.20.172.211 k8s-master-01
10.20.172.212 k8s-node-01
10.20.172.213 k8s-node-02
10.20.172.214 k8s-node-03
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å…³é—­-swap-å’Œ-SELinux"><a href="#å…³é—­-swap-å’Œ-SELinux" class="headerlink" title="å…³é—­ swap å’Œ SELinux"></a>å…³é—­ swap å’Œ SELinux</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸´æ—¶å…³é—­swapå’ŒSELinux</span>
swapoff <span class="token parameter variable">-a</span>

<span class="token comment"># ubuntu é»˜è®¤æ²¡æœ‰å®‰è£… SELinux å› ä¸ºæ— éœ€å…³é—­</span>
setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^SELINUX=enforcing$/SELINUX= disabled/'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/99-kubernetes-cri.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
net.bridge.bridge-nf-call-iptables  = 1
enet.ipv4.ip_forward                = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF</span>
<span class="token function">sysctl</span> <span class="token parameter variable">--system</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="é…ç½®é•œåƒæºå’Œå®‰è£…"><a href="#é…ç½®é•œåƒæºå’Œå®‰è£…" class="headerlink" title="é…ç½®é•œåƒæºå’Œå®‰è£…"></a>é…ç½®é•œåƒæºå’Œå®‰è£…</h3><p>å¦‚æœå¯¹ docker-ce ç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯å®‰è£… docker-ce æœ€æ–°çš„ stable ç‰ˆæœ¬ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils

<span class="token comment"># å¦‚æœ docker ç‰ˆæœ¬ä½¿ç”¨ 18.09 + ä¸”å­˜å‚¨é©±åŠ¨ä½¿ç”¨ overlay2</span>
<span class="token comment"># å°±ä¸ç”¨ device-mapper-persistent-data å’Œ lvm2</span>

<span class="token comment"># æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº docker</span>
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

<span class="token comment"># æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº kubelet kubeadm kubectl</span>
cat<span class="token operator">>></span>/etc/yum.repos.d/kubrenetes.repo<span class="token operator">&lt;&lt;</span><span class="token string">EOF
[kubernetes]
name=Kubernetes Repo
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
EOF</span>
yum makecache

<span class="token comment"># åˆ—å‡ºå¯ä»¥å®‰è£…çš„ docker-ce ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ docker ç‰ˆæœ¬</span>
yum list docker-ce --showduplicates<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce-19.03.3-3.el7

<span class="token comment"># # åˆ—å‡ºå¯ä»¥å®‰è£…çš„ kubernetes ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ kubeadm kubelet kubectl</span>
yum list kubeadm --showduplicates<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span>
yum <span class="token function">install</span> kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 <span class="token parameter variable">--disableexcludes</span><span class="token operator">=</span>kubernetes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apt-transport-https ca-certificates <span class="token function">curl</span> software-properties-common

<span class="token comment"># æ·»åŠ é˜¿é‡Œäº‘ docker-ce é•œåƒæº</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
add-apt-repository <span class="token string">"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span>
<span class="token comment"># æ·»åŠ é˜¿é‡Œäº‘ kubernetes é•œåƒæº</span>
<span class="token function">curl</span> https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> -
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span>/etc/apt/sources.list.d/kubernetes.list</span>
deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
EOF</span>
<span class="token function">apt-get</span> update
<span class="token comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ docker-ce</span>
<span class="token function">apt</span> list <span class="token parameter variable">-a</span> docker-ce
<span class="token function">apt</span> <span class="token function">install</span> docker-ce<span class="token operator">=</span><span class="token number">5</span>:19.03.8~3-0~ubuntu-bionic
<span class="token comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ kubernetes</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token number">1.17</span>.4-00 <span class="token assign-left variable">kubelet</span><span class="token operator">=</span><span class="token number">1.17</span>.4-00 <span class="token assign-left variable">kubectl</span><span class="token operator">=</span><span class="token number">1.17</span>.4-00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="åä¸ºäº‘å‘"><a href="#åä¸ºäº‘å‘" class="headerlink" title="åä¸ºäº‘å‘"></a>åä¸ºäº‘å‘</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„åä¸ºäº‘ kubernetes é•œåƒæºï¼Œç›®å‰ ï¼ˆ2020-04-15ï¼‰ åä¸ºäº‘ä¸Šçš„ kubernetes ç‰ˆæœ¬æœ€é«˜æ”¯æŒåˆ° 1.14.2ï¼Œè€Œ 1.14 ç‰ˆæœ¬ kubernetes å·²ç»ä¸åœ¨ç»´æŠ¤äº†ï¼Œæ‰€ä»¥æ¨èæ¢ä¸ªé•œåƒæºå®‰è£… v.1.16.8 æˆ–è€… v1.17.4 è¿™ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv1.18.1 ä¹Ÿä¸å»ºè®®å»ºè®®å®‰è£…ä½¿ç”¨ã€‚å…³äºç‰ˆæœ¬çš„é€‰æ‹©å¯ä»¥å‚è€ƒ <a href="https://blog.k8s.li/How-to-choose-the-right-version-of-kubernetes.html">ç”Ÿäº§ç¯å¢ƒå¦‚ä½•ä¿å®ˆåœ°é€‰æ‹© kubernetes ç‰ˆæœ¬</a> ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 ~
â•°â”€<span class="token comment"># yum list kubeadm --showduplicates|sort -r</span>
kubeadm.x86_64                       <span class="token number">1.6</span>.11-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.6</span>.1-0                          kubernetes
kubeadm.x86_64                       <span class="token number">1.6</span>.10-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.6</span>.0-0                          kubernetes
kubeadm.x86_64                       <span class="token number">1.14</span>.2-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.14</span>.1-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.14</span>.0-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.13</span>.6-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.13</span>.5-0                         kubernetes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è®¾ç½®-docker-çš„-daemon-json"><a href="#è®¾ç½®-docker-çš„-daemon-json" class="headerlink" title="è®¾ç½® docker çš„ daemon.json"></a>è®¾ç½® docker çš„ daemon.json</h3><p>å®‰è£…å®Œæˆä¹‹åå…ˆè®¾ç½®ä»¥ä¸‹ docker çš„å¯åŠ¨å‚æ•° <code>/etc/docker/daemon.json</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">cat > /etc/docker/daemon.json &lt;&lt;EOF
<span class="token punctuation">&#123;</span>
  <span class="token property">"exec-opts"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"native.cgroupdriver=systemd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://xlx9erfu.mirror.aliyuncs.com"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"log-driver"</span><span class="token operator">:</span> <span class="token string">"json-file"</span><span class="token punctuation">,</span>
  <span class="token property">"log-opts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"max-size"</span><span class="token operator">:</span> <span class="token string">"100m"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"storage-driver"</span><span class="token operator">:</span> <span class="token string">"overlay2"</span>
<span class="token punctuation">&#125;</span>
EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> kubelet
systemctl daemon-reload
systemctl start <span class="token function">docker</span> kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">â•­â”€root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span>01 ~
â•°â”€<span class="token comment"># docker info</span>
<span class="token key atrule">Client</span><span class="token punctuation">:</span>
 <span class="token key atrule">Debug Mode</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">Server</span><span class="token punctuation">:</span>
 <span class="token key atrule">Containers</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">Running</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">Paused</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">Stopped</span><span class="token punctuation">:</span> <span class="token number">0</span>
 <span class="token key atrule">Images</span><span class="token punctuation">:</span> <span class="token number">0</span>
 <span class="token key atrule">Server Version</span><span class="token punctuation">:</span> 19.03.3
 <span class="token key atrule">Storage Driver</span><span class="token punctuation">:</span> overlay2
  <span class="token key atrule">Backing Filesystem</span><span class="token punctuation">:</span> extfs
  <span class="token key atrule">Supports d_type</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">Native Overlay Diff</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
 <span class="token key atrule">Logging Driver</span><span class="token punctuation">:</span> json<span class="token punctuation">-</span>file
 <span class="token key atrule">Cgroup Driver</span><span class="token punctuation">:</span> cgroupfs
 <span class="token key atrule">Plugins</span><span class="token punctuation">:</span>
  <span class="token key atrule">Volume</span><span class="token punctuation">:</span> local
  <span class="token key atrule">Network</span><span class="token punctuation">:</span> bridge host ipvlan macvlan null overlay
  <span class="token key atrule">Log</span><span class="token punctuation">:</span> awslogs fluentd gcplogs gelf journald json<span class="token punctuation">-</span>file local logentries splunk syslog
 <span class="token key atrule">Swarm</span><span class="token punctuation">:</span> inactive
 <span class="token key atrule">Runtimes</span><span class="token punctuation">:</span> runc
 <span class="token key atrule">Default Runtime</span><span class="token punctuation">:</span> runc
 <span class="token key atrule">Init Binary</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>init
 <span class="token key atrule">containerd version</span><span class="token punctuation">:</span> 894b81a4b802e4eb2a91d1ce216b8817763c29fb
 <span class="token key atrule">runc version</span><span class="token punctuation">:</span> 425e105d5a03fabd737a126ad93d62a9eeede87f
 <span class="token key atrule">init version</span><span class="token punctuation">:</span> fec3683
 <span class="token key atrule">Security Options</span><span class="token punctuation">:</span>
  seccomp
   <span class="token key atrule">Profile</span><span class="token punctuation">:</span> default
 <span class="token key atrule">Kernel Version</span><span class="token punctuation">:</span> 3.10.0<span class="token punctuation">-</span>957.el7.x86_64
 <span class="token key atrule">Operating System</span><span class="token punctuation">:</span> CentOS Linux 7 (Core)
 <span class="token key atrule">OSType</span><span class="token punctuation">:</span> linux
 <span class="token key atrule">Architecture</span><span class="token punctuation">:</span> x86_64
 <span class="token key atrule">CPUs</span><span class="token punctuation">:</span> <span class="token number">4</span>
 <span class="token key atrule">Total Memory</span><span class="token punctuation">:</span> 3.683GiB
 <span class="token key atrule">Name</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">01</span>
 <span class="token key atrule">ID</span><span class="token punctuation">:</span> UXD4<span class="token punctuation">:</span>IK6C<span class="token punctuation">:</span>P3EO<span class="token punctuation">:</span>TXRP<span class="token punctuation">:</span>GQZD<span class="token punctuation">:</span>STGH<span class="token punctuation">:</span>GXZH<span class="token punctuation">:</span>LO2C<span class="token punctuation">:</span>HFBN<span class="token punctuation">:</span>LV2B<span class="token punctuation">:</span>LEVE<span class="token punctuation">:</span>UWT2
 <span class="token key atrule">Docker Root Dir</span><span class="token punctuation">:</span> /var/lib/docker
 <span class="token key atrule">Debug Mode</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
 <span class="token key atrule">Registry</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//index.docker.io/v1/
 <span class="token key atrule">Labels</span><span class="token punctuation">:</span>
 <span class="token key atrule">Experimental</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
 <span class="token key atrule">Insecure Registries</span><span class="token punctuation">:</span>
  127.0.0.0/8
 <span class="token key atrule">Live Restore Enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong>  çš„å­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ <code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£ <code>devicemapper</code>ã€‚å¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># lsmod |grep overlay</span>
overlay                <span class="token number">71964</span>  <span class="token number">16</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="éƒ¨ç½²-master-èŠ‚ç‚¹"><a href="#éƒ¨ç½²-master-èŠ‚ç‚¹" class="headerlink" title="éƒ¨ç½² master èŠ‚ç‚¹"></a>éƒ¨ç½² master èŠ‚ç‚¹</h2><h3 id="å‡†å¤‡é•œåƒ"><a href="#å‡†å¤‡é•œåƒ" class="headerlink" title="å‡†å¤‡é•œåƒ"></a>å‡†å¤‡é•œåƒ</h3><p>å¯¹äº kubernetes 1.17.4 ç‰ˆæœ¬çš„ kubeadm éœ€è¦ä½¿ç”¨åˆ°ä»¥ä¸‹ docker é•œåƒå¦‚ä¸‹ï¼Œå¯¹äºå¢™å›½ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä½ éœ€è¦æ‰¾å°å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ï¼Œåœ¨ä¸Šé¢æŠŠå®ƒ pull ä¸‹æ¥ï¼Œç„¶å save æˆ tar åŒ…ä¼ å›æœ¬åœ°å† docker load è¿›é•œåƒ ğŸ˜‚ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k8s.gcr.io/kube-apiserver:v1.17.4
k8s.gcr.io/kube-controller-manager:v1.17.4
k8s.gcr.io/kube-scheduler:v1.17.4
k8s.gcr.io/kube-proxy:v1.17.4
k8s.gcr.io/pause:3.1
k8s.gcr.io/etcd:3.4.3-0
k8s.gcr.io/coredns:1.6.5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ kubeadm pull ç›¸å…³é•œåƒæ—¶ï¼Œkubeadm çš„ç‰ˆæœ¬æœ€å¥½å’Œ â€“kubernetes-version&#x3D;${version} ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯æœ‰äº›ç‰ˆæœ¬çš„é•œåƒæ˜¯ pull ä¸ä¸‹æ¥çš„ã€‚å¯¹åº”ç‰ˆæœ¬çš„ kubenetes è¦ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„é•œåƒæ‰å¯ä»¥ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬åœ¨å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ä¸Šå°† pull æŒ‡å®šç‰ˆæœ¬çš„é•œåƒã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># for: use kubeadm pull kubernetes images</span>
<span class="token comment"># date: 2019-08-15</span>
<span class="token comment"># author: muzi502</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-xue</span>
<span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apt-transport-https <span class="token function">curl</span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> -
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span>/etc/apt/sources.list.d/kubernetes.list</span>
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF</span>
<span class="token function">apt-get</span> update

<span class="token keyword">for</span> <span class="token for-or-select variable">version</span> <span class="token keyword">in</span> <span class="token number">1.17</span>.4
<span class="token keyword">do</span>
    <span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token variable">$&#123;version&#125;</span>-00
    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$&#123;version&#125;</span>/bin
    <span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
    kubeadm config images pull --kubernetes-version<span class="token operator">=</span><span class="token variable">$&#123;version&#125;</span>
    <span class="token function">docker</span> save <span class="token parameter variable">-o</span> <span class="token function">v</span><span class="token variable">$&#123;version&#125;</span>.tar <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> TAG <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
    <span class="token function">gzip</span> <span class="token function">v</span><span class="token variable">$&#123;version&#125;</span>.tar <span class="token function">v</span><span class="token variable">$&#123;version&#125;</span>.tar.gz
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯¼å…¥ä¹‹åçš„é•œåƒ</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># docker load &lt; v1.17.4.tar.gz</span>
fc4976bd934b: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">53</span>.88MB/53.88MB
f6953727aaba: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">42</span>.1MB/42.1MB
Loaded image: k8s.gcr.io/kube-scheduler:v1.17.4
225df95e717c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">336</span>.4kB/336.4kB
7c9b0f448297: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">41</span>.37MB/41.37MB
Loaded image: k8s.gcr.io/coredns:1.6.5
fe9a8b4f1dcc: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">43</span>.87MB/43.87MB
ce04b89b7def: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">224</span>.9MB/224.9MB
1b2bc745b46f: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">21</span>.22MB/21.22MB
Loaded image: k8s.gcr.io/etcd:3.4.3-0
e17133b79956: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">744</span>.4kB/744.4kB
Loaded image: k8s.gcr.io/pause:3.1
682fbb19de80: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">21</span>.06MB/21.06MB
2dc2f2423ad1: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">5</span>.168MB/5.168MB
ad9fb2411669: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">4</span>.608kB/4.608kB
597151d24476: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">8</span>.192kB/8.192kB
0d8d54147a3a: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">8</span>.704kB/8.704kB
960d0ce862e2: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">37</span>.81MB/37.81MB
Loaded image: k8s.gcr.io/kube-proxy:v1.17.4
9daac3fed755: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">118</span>.7MB/118.7MB
Loaded image: k8s.gcr.io/kube-apiserver:v1.17.4
99df54617e88: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">108</span>.6MB/108.6MB
Loaded image: k8s.gcr.io/kube-controller-manager:v1.17.4
â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># docker images</span>
REPOSITORY                           TAG                 CREATED             SIZE
k8s.gcr.io/kube-proxy                v1.17.4             <span class="token number">4</span> weeks ago         116MB
k8s.gcr.io/kube-controller-manager   v1.17.4             <span class="token number">4</span> weeks ago         161MB
k8s.gcr.io/kube-apiserver            v1.17.4             <span class="token number">4</span> weeks ago         171MB
k8s.gcr.io/kube-scheduler            v1.17.4             <span class="token number">4</span> weeks ago         <span class="token number">94</span>.4MB
k8s.gcr.io/coredns                   <span class="token number">1.6</span>.5               <span class="token number">5</span> months ago        <span class="token number">41</span>.6MB
k8s.gcr.io/etcd                      <span class="token number">3.4</span>.3-0             <span class="token number">5</span> months ago        288MB
k8s.gcr.io/pause                     <span class="token number">3.1</span>                 <span class="token number">2</span> years ago         742kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="åˆå§‹åŒ–-master-èŠ‚ç‚¹"><a href="#åˆå§‹åŒ–-master-èŠ‚ç‚¹" class="headerlink" title="åˆå§‹åŒ– master èŠ‚ç‚¹"></a>åˆå§‹åŒ– master èŠ‚ç‚¹</h3><p>ä½¿ç”¨ kubeadm init å‘½ä»¤åˆå§‹åŒ– master èŠ‚ç‚¹ï¼Œå…³äº kubeadm çš„å‚æ•°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/">kubeadm init</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubeadm init --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 --apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.20</span>.172.211 --kubernetes-version<span class="token operator">=</span><span class="token number">1.17</span>.4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>â€“pod-network-cidr&#x3D; æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—</li>
<li>â€“apiserver-advertise-address&#x3D; æŒ‡å®š api-server ç›‘å¬çš„åœ°å€</li>
<li>â€“kubernetes-version&#x3D; æŒ‡å®š kubernetes çš„ç‰ˆæœ¬ï¼Œæœ€å¥½å’Œ kubeadm ç‰ˆæœ¬ä¿æŒä¸€è‡´</li>
</ul>
<p>æ­£å¸¸å®Œæˆä¹‹åçš„æ—¥å¿—è¾“å‡ºå¦‚ä¸‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211 --kubernetes-version=1.17.4</span>

Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">10.20</span>.172.211:6443 <span class="token parameter variable">--token</span> hi66lb.r13y2hottst2ks6f <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åˆšåˆšå®‰è£…å®Œä¹‹å coreDNS çš„ Pod ä¼šä¸€ç›´å‡ºäº pending çŠ¶æ€ï¼Œè€Œä¸” Master çš„ STATUS çŠ¶æ€ä¹Ÿæ˜¯ <code>NotReady</code> ã€‚é‡åˆ°è¿™ç§é—®é¢˜ <code>ä¸è¦æ…Œ,é—®é¢˜ä¸å¤§.jpg</code> è¿™æ˜¯å› ä¸ºé›†ç¾¤ä¸­è¿˜æ²¡æœ‰å®‰è£…å¥½ CNI ç½‘ç»œæ’ä»¶ï¼Œç­‰ä¸‹éƒ¨ç½²å¥½ flannel å°±å¯ä»¥ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl get node</span>
NAME            STATUS     ROLES    AGE     VERSION
k8s-master-01   NotReady   master   9m19s   v1.17.4
â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl get pod --all-namespaces</span>
NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE
kube-system   coredns-6955765f44-t4b6k                <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          49s
kube-system   coredns-6955765f44-vm5tm                <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          49s
kube-system   etcd-k8s-master-01                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s
kube-system   kube-apiserver-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s
kube-system   kube-controller-manager-k8s-master-01   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s
kube-system   kube-proxy-rmgwl                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          49s
kube-system   kube-scheduler-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åŠ å…¥-node-èŠ‚ç‚¹"><a href="#åŠ å…¥-node-èŠ‚ç‚¹" class="headerlink" title="åŠ å…¥ node èŠ‚ç‚¹"></a>åŠ å…¥ node èŠ‚ç‚¹</h2><p>åœ¨å¦ä¸€å° Node èŠ‚ç‚¹ä¸Šé‡å¤èŠ‚ç‚¹åˆå§‹åŒ–çš„å†…å®¹ï¼Œå¹¶å°†å°†æ‰€éœ€çš„é•œåƒå¯¼å…¥åˆ° node èŠ‚ç‚¹ã€‚ä¹‹åä½¿ç”¨ kubeadm joine å‘½ä»¤å°† Node èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­å³å¯ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-node-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span>
<span class="token operator">></span>     --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1
W0415 00:52:08.127829    <span class="token number">9901</span> join.go:346<span class="token punctuation">]</span> <span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
        <span class="token punctuation">[</span>WARNING Hostname<span class="token punctuation">]</span>: <span class="token function">hostname</span> <span class="token string">"k8s-node-01"</span> could not be reached
        <span class="token punctuation">[</span>WARNING Hostname<span class="token punctuation">]</span>: <span class="token function">hostname</span> <span class="token string">"k8s-node-01"</span><span class="token builtin class-name">:</span> lookup k8s-node-01 on <span class="token number">192.168</span>.10.254:53: no such <span class="token function">host</span>
        <span class="token punctuation">[</span>WARNING Service-Kubelet<span class="token punctuation">]</span>: kubelet <span class="token function">service</span> is not enabled, please run <span class="token string">'systemctl enable kubelet.service'</span>
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">'kubectl -n kube-system get cm kubeadm-config -oyaml'</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Downloading configuration <span class="token keyword">for</span> the kubelet from the <span class="token string">"kubelet-config-1.17"</span> ConfigMap <span class="token keyword">in</span> the kube-system namespace
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/config.yaml"</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/kubeadm-flags.env"</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.

This <span class="token function">node</span> has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run <span class="token string">'kubectl get nodes'</span> on the control-plane to see this <span class="token function">node</span> <span class="token function">join</span> the cluster.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦‚æœä¸å‡ºæ„å¤–çš„è¯ä¼šæç¤º <code>This node has joined the cluster:</code> ï¼Œç„¶ååœ¨ master èŠ‚ç‚¹çœ‹ä¸€ä¸‹èŠ‚ç‚¹æ˜¯å¦åŠ å…¥</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl get node</span>
NAME            STATUS     ROLES    AGE   VERSION
k8s-master-01   NotReady   master   31m   v1.17.4
k8s-node-01     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   58s   v1.17.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦‚æœçŠ¶æ€è¿˜æ˜¯ <code>NotReady</code> ä¸è¦æ…Œï¼Œé—®é¢˜ä¸å¤§ï¼‰ã€‚æ¥ä¸‹æ¥å®‰è£… CNI ç½‘ç»œæ’ä»¶å³å¯</p>
<h2 id="éƒ¨ç½²ç½‘ç»œæ’ä»¶"><a href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶" class="headerlink" title="éƒ¨ç½²ç½‘ç»œæ’ä»¶"></a>éƒ¨ç½²ç½‘ç»œæ’ä»¶</h2><p>åœ¨è¿™æˆ‘ä»¬ä½¿ç”¨ flannel ä½œä¸º Kubernetes ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œåœ¨ kubeadm init çš„æ—¶å€™æŒ‡å®šçš„ â€“pod-network-cidr&#x3D; æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—ï¼Œå³ä¸º flannel é»˜è®¤çš„ IP æ®µï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹çš„è¯å°±ç›´æ¥åœ¨ master èŠ‚ç‚¹ä¸Šä½¿ç”¨ kubectl apply -f å‘½ä»¤éƒ¨ç½²å³å¯ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ç”±äºå¢™å›½ç½‘ç»œåŸå› ï¼Œè®¿é—® <code>raw.githubusercontent.com</code> è¿™ä¸ªåŸŸåä¼šæ¯”è¾ƒæ…¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ jsdelivr æ¥è¿›è¡ŒåŠ é€Ÿã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl apply -f https://cdn.jsdelivr.net/gh/coreos/flannel/Documentation/kube-flannel.yml</span>
podsecuritypolicy.policy/psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
serviceaccount/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds-amd64 created
daemonset.apps/kube-flannel-ds-arm64 created
daemonset.apps/kube-flannel-ds-arm created
daemonset.apps/kube-flannel-ds-ppc64le created
daemonset.apps/kube-flannel-ds-s390x created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flannel çš„ docker é•œåƒæ˜¯åœ¨ <code>quay.io/coreos/flannel</code> ä¸€èˆ¬æƒ…å†µä¸‹æ²¡é—®é¢˜èƒ½é¡ºåˆ© pull ä¸‹æ¥ã€‚ç„¶åä½¿ç”¨ <code>kubectl get pod -n kube-system</code> å‘½ä»¤æŸ¥çœ‹ pod çš„çŠ¶æ€æ˜¯ä¸æ˜¯éƒ½åœ¨ running çŠ¶æ€ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl get pod -n kube-system</span>
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-6955765f44-g5fwl                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
coredns-6955765f44-g7cls                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
etcd-k8s-master-01                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-apiserver-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-controller-manager-k8s-master-01   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-flannel-ds-amd64-94hfr             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
kube-flannel-ds-amd64-vpdfd             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
kube-proxy-rmgwl                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-proxy-xqcsq                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-scheduler-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h

â•­â”€root@k8s-master-01 /opt/1.17.4
â•°â”€<span class="token comment"># kubectl get node</span>
NAME            STATUS   ROLES    AGE   VERSION
k8s-master-01   Ready    master   29h   v1.17.4
k8s-node-01     Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   28h   v1.17.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç”±æ­¤ï¼Œä¸€ä¸ªç®€é™‹çš„ kubernetes é›†ç¾¤å·²ç»éƒ¨ç½²å®Œäº† ğŸ˜‚ï¼Œæ–‡ç« æœ‰ç‚¹æ°´äº†~~ã€‚å¯¹äºæƒ³è¦å…¥é—¨å’Œå­¦ä¹  kubernetes çš„åŒå­¦æ¥è¯´ kubeadm æ˜¯ä¸ªå¥½å·¥å…·ã€‚åç»­ä¼šæ›´æ–°ä¸€äº› kubernetes å†…å®¹ã€‚</p>
<h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æœ€åæä¸€ä¸‹ï¼Œæ–‡ä¸­æåˆ°çš„å¯¹äºä¸‹è½½ github ä¸Šæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è§„åˆ™è¿›è¡Œæ›¿æ¢ï¼Œå°±å¯ä»¥ä½¿ç”¨ jsdelivr æ¥ fuck ä¸€ä¸‹ GFW ï¼Œæ— ç—›ä¸‹è½½ GitHub ä¸Šçš„æ–‡ä»¶ã€‚è¿™è¿˜æ˜¯ä» <a target="_blank" rel="noopener" href="https://chanshiyu.com/#/post/94">JsDelivr å…¨ç«™æ‰˜ç®¡</a> å­¦æ¥çš„éªšæ“ä½œ ğŸ˜‚ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">GitHub rul</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh
<span class="token key atrule">jsDelivr url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>è§„åˆ™å°±æ˜¯å°† <code>github.com</code> æ›¿æ¢ä¸º <code>cdn.jsdelivr.net/gh</code> ï¼Œç„¶åå»æ‰ <code>/blob/master</code>ï¼Œæ¥ä¸Š repo é‡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„å³å¯ã€‚ä¹Ÿå¯ä»¥å°†ä»¥ä¸‹è„šæœ¬ä¿å­˜ä¸ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ &#x2F;usr&#x2F;bin&#x2F;rawgï¼Œå½“ä½¿ç”¨ rawg <a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</a> å°±å¯ä»¥ç›´æ¥å°† url è¿›è¡Œæ›¿æ¢ï¼Œå¿«é€Ÿåœ°ä¸‹è½½æ–‡ä»¶ã€‚æ€ä¹ˆæ ·ï¼Œå¾ˆçˆ½å§ ğŸ˜‚ï¼Œå¯¹äºæŸäº› Linux æœºå™¨ä¸Šæ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># data: 2020-03-31</span>
<span class="token comment"># author: muzi502</span>
<span class="token comment"># for: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span>
<span class="token comment"># usage: save the .she to your local such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span>
<span class="token comment"># use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-xue</span>
<span class="token comment"># GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span>
<span class="token comment"># jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span>

<span class="token function">wget</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $1 <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> <span class="token punctuation">\</span>
               <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> <span class="token punctuation">\</span>
               <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\/master//'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\/blob//'</span> <span class="token variable">)</span></span>

<span class="token comment"># curl $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span>
<span class="token comment">#                | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span>
<span class="token comment">#                | sed 's/\/master//' | sed 's/\/blob//' )</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kubeadm/" rel="tag"># kubeadm</a>
              <a href="/tags/kubernetes/" rel="tag"># kubernetes</a>
              <a href="/tags/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0-K8s/" rel="tag"># ä»é›¶å¼€å§‹å­¦ä¹  K8s</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/gitlab-ci-harbor.html" rel="prev" title="åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿">
                  <i class="fa fa-chevron-left"></i> åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/interview-wordpress-install.html" rel="next" title="ä¸€æ¬¡æœ‰è¶£çš„é¢è¯•ï¼šWordPress éƒ¨ç½²">
                  ä¸€æ¬¡æœ‰è¶£çš„é¢è¯•ï¼šWordPress éƒ¨ç½² <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">26:14</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
