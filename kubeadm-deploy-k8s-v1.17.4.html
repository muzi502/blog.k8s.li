<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.k8s.li').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
  <meta name="description" content="ç‚’å†·é¥­å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚ kubeadmKubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s">
<meta property="og:url" content="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">
<meta property="og:site_name" content="æœ¨å­">
<meta property="og:description" content="ç‚’å†·é¥­å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚ kubeadmKubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/components-of-kubernetes.png">
<meta property="article:published_time" content="2020-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2020-04-14T16:00:00.000Z">
<meta property="article:author" content="æœ¨å­">
<meta property="article:tag" content="kubeadm">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="ä»é›¶å¼€å§‹å­¦ä¹  K8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/components-of-kubernetes.png">
<link rel="canonical" href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
  <title>ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s | æœ¨å­</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
<link rel="alternate" href="/atom.xml" title="æœ¨å­" type="application/atom+xml">
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">
    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æœ¨å­</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>
  </li>
        <li class="menu-item menu-item-books">
    <a href="/booklist.html" rel="section"><i class="fa fa-fw fa-book"></i>Books</a>
  </li>
        <li class="menu-item menu-item-kindle">
    <a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
  </li>
        <li class="menu-item menu-item-friend">
    <a href="/link/" rel="section"><i class="fa fa-fw fa-link"></i>Friend</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>
  </li>
  </ul>
</nav>
</div>
    </header>
  <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
  <div class="posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.k8s.li/avatar.png">
      <meta itemprop="name" content="æœ¨å­">
      <meta itemprop="description" content="">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æœ¨å­">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s
        </h2>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-04-15 2020-04-15T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-04-15T00:00:00+08:00">2020-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">æŠ€æœ¯</span>
                  </a>
                </span>
            </span>
  <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    <a title="disqus" href="/kubeadm-deploy-k8s-v1.17.4.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="kubeadm-deploy-k8s-v1.17.4.html" itemprop="commentCount"></span>
    </a>
  </span>
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>25 åˆ†é’Ÿ</span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <h2 id="ç‚’å†·é¥­"><a href="#ç‚’å†·é¥­" class="headerlink" title="ç‚’å†·é¥­"></a>ç‚’å†·é¥­</h2><p>å¤§æ¦‚æ˜¯ä»å»å¹´ 5 æœˆå¼€å§‹æ‰æ¥è§¦  kubernetes ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»å¿«ä¸€å¹´ï¼Œå½“åˆå†™çš„ä¸€ç¯‡åšå®¢ <a href="https://blog.k8s.li/install-k8s-ubuntu18-04.html">ubuntu 1804 ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes</a> ç¿»å‡ºæ¥é‡æ–°ä¿®æ”¹ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨ kubeadm éƒ¨ç½² kubernetes v1.17.4 ç‰ˆçš„æµç¨‹ã€‚é€‚ç”¨äºå›½å†…ç½‘ç»œç¯å¢ƒä¸‹ã€‚</p>
<h3 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a>kubeadm</h3><p>Kubernetes ä» 1.4 ç‰ˆæœ¬å¼€å§‹åå°±å¼•å…¥äº† kubeadm ç”¨äºç®€åŒ–é›†ç¾¤æ­å»ºçš„è¿‡ç¨‹ï¼Œåœ¨ Kubernetes 1.13 ç‰ˆæœ¬ä¸­ï¼Œkubeadm å·¥å…·è¿›å…¥ GA é˜¶æ®µï¼Œè€Œå½“å‰çš„ kubernetes æœ€æ–°ç‰ˆ stable ä¸º 1.18.1 ï¼Œkubeadm å·²ç»ç»å†è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒ Kubernetes é›†ç¾¤æ­å»ºã€‚å¯¹äºåˆšåˆšæ¥è§¦ kubernetes  çš„åˆå­¦è€…æ¥è®²ï¼Œkubeadm ä¹Ÿæ˜¯ä¸€ä¸ªå¿«é€Ÿéƒ¨ç½²ä½“éªŒ kubernetes çš„ä¸äºŒä¹‹é€‰ã€‚</p>
<h2 id="kubernetes-æ¶æ„"><a href="#kubernetes-æ¶æ„" class="headerlink" title="kubernetes æ¶æ„"></a>kubernetes æ¶æ„</h2><p><img src="https://p.k8s.li/components-of-kubernetes.png" alt=""></p>
<p>æ¶æ„å›¾æ¥è‡ª kubernetes å®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh/docs/concepts/overview/components/" target="_blank" rel="noopener">Kubernetes ç»„ä»¶</a></p>
<h3 id="æ§åˆ¶å¹³é¢"><a href="#æ§åˆ¶å¹³é¢" class="headerlink" title="æ§åˆ¶å¹³é¢"></a>æ§åˆ¶å¹³é¢</h3><p>æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ä¸»è¦çš„ç»„ä»¶ç”±</p>
<ul>
<li>kube-apiserverï¼šä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶ï¼›å®ƒæ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚</li>
<li>etcdï¼šé›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èµ„æºä¿¡æ¯æ•°æ®ã€‚</li>
<li>kube-schedulerï¼šè´Ÿè´£è°ƒåº¦ Pod èµ„æºåˆ°æŸä¸ª Node èŠ‚ç‚¹ä¸Šã€‚</li>
<li>kube-controller-managerï¼šæ§åˆ¶å™¨ç®¡ç†å™¨ã€‚</li>
<li>kubeletï¼šå¦‚æœä½¿ç”¨ kubeadm éƒ¨ç½²çš„è¯éœ€è¦åœ¨ master èŠ‚ç‚¹å®‰è£… kubelet</li>
</ul>
<h3 id="å·¥ä½œå¹³é¢"><a href="#å·¥ä½œå¹³é¢" class="headerlink" title="å·¥ä½œå¹³é¢"></a>å·¥ä½œå¹³é¢</h3><ul>
<li>kubeletï¼šé€šè¿‡ç›‘å¬ kube-apiserver ï¼Œæ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚</li>
<li>kube-proxyï¼šå®ç° Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">Service</a> æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ iptables è§„åˆ™å°† service è´Ÿè½½å‡è¡¡åˆ°å„ä¸ª Podã€‚</li>
<li>CRIå®¹å™¨è¿è¡Œæ—¶ï¼šæ ¹æ®ç»Ÿè®¡ç›®å‰ docker ä¾æ—§æ˜¯æ’åç¬¬ä¸€çš„å®¹å™¨è¿è¡Œæ—¶</li>
</ul>
<h3 id="kubeadm-init-æµç¨‹"><a href="#kubeadm-init-æµç¨‹" class="headerlink" title="kubeadm init æµç¨‹"></a>kubeadm init æµç¨‹</h3><p>åœ¨ä½¿ç”¨ kubeadm éƒ¨ç½²æ—¶ï¼Œé™¤äº† kubelet ç»„ä»¶éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶éƒ¨ç½²å¤–ï¼Œå…¶ä»–çš„ç»„ä»¶éƒ½æ˜¯ç”¨ <a href="">static Pod</a> çš„æ–¹å¼è¿è¡Œåœ¨ç›¸åº”çš„èŠ‚ç‚¹ã€‚</p>
<h2 id="èŠ‚ç‚¹åˆå§‹åŒ–"><a href="#èŠ‚ç‚¹åˆå§‹åŒ–" class="headerlink" title="èŠ‚ç‚¹åˆå§‹åŒ–"></a>èŠ‚ç‚¹åˆå§‹åŒ–</h2><p>ç³»ç»Ÿå»ºè®®é€‰æ‹© ubuntu 1804 æˆ–è€… CentOS 7.7ï¼Œå› ä¸º docker å®¹å™¨è™šæ‹ŸåŒ–ä»¥åŠ kubernetes è¿™äº›æ–°æŠ€æœ¯éƒ½æ˜¯å¾ˆä¾èµ–ä¸€äº›å†…æ ¸ç‰¹æ€§ï¼Œæ¯”å¦‚ overlay2ã€cgroupv2 ç­‰ï¼Œè¿™äº›ç‰¹æ€§åœ¨è¾ƒä½ç‰ˆæœ¬çš„å†…æ ¸ä¸Šå¹¶ä¸æ˜¯å¾ˆç¨³å®šï¼Œå»ºè®® 4.14 æˆ–è€… 4.19 ä»¥ä¸Šçš„ LTS  å†…æ ¸ï¼ŒåŠé•¿æœŸç¨³å®šæ”¯æŒç‰ˆå†…æ ¸ï¼Œåœ¨ <a href="https://www.kernel.org/category/releases.html" target="_blank" rel="noopener">kernel.org</a> ä¸Šæœ‰å†…æ ¸æ”¯æŒæ”¯æŒæƒ…å†µã€‚</p>
<h3 id="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts"><a href="#è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts" class="headerlink" title="è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts"></a>è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts</h3><p>æ¯å°æœºå™¨ä¸Šéƒ½è¦è®¾ç½®ç›¸åº”çš„ä¸»æœºåå¹¶æ·»åŠ  hosts</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname k8s-maste-01</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">10.20.172.211 k8s-master-01</span><br><span class="line">10.20.172.212 k8s-node-01</span><br><span class="line">10.20.172.213 k8s-node-02</span><br><span class="line">10.20.172.214 k8s-node-03</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="å…³é—­-swap-å’Œ-SELinux"><a href="#å…³é—­-swap-å’Œ-SELinux" class="headerlink" title="å…³é—­ swap å’Œ SELinux"></a>å…³é—­ swap å’Œ SELinux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸´æ—¶å…³é—­swapå’ŒSELinux</span></span><br><span class="line">swapoff -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu é»˜è®¤æ²¡æœ‰å®‰è£… SELinux å› ä¸ºæ— éœ€å…³é—­</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i 's/^SELINUX=enforcing$/SELINUX= disabled/' /etc/selinux/config</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="line">enet.ipv4.ip_forward                = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®é•œåƒæºå’Œå®‰è£…"><a href="#é…ç½®é•œåƒæºå’Œå®‰è£…" class="headerlink" title="é…ç½®é•œåƒæºå’Œå®‰è£…"></a>é…ç½®é•œåƒæºå’Œå®‰è£…</h3><p>å¦‚æœå¯¹ docker-ce ç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯å®‰è£… docker-ce æœ€æ–°çš„ stable ç‰ˆæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>
<h4 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœ docker ç‰ˆæœ¬ä½¿ç”¨ 18.09 + ä¸”å­˜å‚¨é©±åŠ¨ä½¿ç”¨ overlay2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°±ä¸ç”¨ device-mapper-persistent-data å’Œ lvm2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº docker</span></span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ aliyunè½¯ä»¶åŒ…yumæº kubelet kubeadm kubectl</span></span><br><span class="line"><span class="meta">cat&gt;</span><span class="bash">&gt;/etc/yum.repos.d/kubrenetes.repo&lt;&lt;EOF</span></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes Repo</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">EOF</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ—å‡ºå¯ä»¥å®‰è£…çš„ docker-ce ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ docker ç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates|sort -r</span><br><span class="line">yum install -y docker-ce-19.03.3-3.el7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment"># åˆ—å‡ºå¯ä»¥å®‰è£…çš„ kubernetes ç‰ˆæœ¬ï¼Œå®‰è£…æŒ‡å®šçš„ kubeadm kubelet kubectl</span></span></span><br><span class="line">yum list kubeadm --showduplicates|sort -r</span><br><span class="line">yum install kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure>
<h4 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt-get install -y apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ é˜¿é‡Œäº‘ docker-ce é•œåƒæº</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ é˜¿é‡Œäº‘ kubernetes é•œåƒæº</span></span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ docker-ce</span></span><br><span class="line">apt list -a docker-ce</span><br><span class="line">apt install docker-ce=5:19.03.8~3-0~ubuntu-bionic</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ kubernetes</span></span><br><span class="line">apt install kubeadm=1.17.4-00 kubelet=1.17.4-00 kubectl=1.17.4-00</span><br></pre></td></tr></table></figure>
<h4 id="åä¸ºäº‘å‘"><a href="#åä¸ºäº‘å‘" class="headerlink" title="åä¸ºäº‘å‘"></a>åä¸ºäº‘å‘</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„åä¸ºäº‘ kubernetes é•œåƒæºï¼Œç›®å‰ ï¼ˆ2020-04-15ï¼‰ åä¸ºäº‘ä¸Šçš„ kubernetes ç‰ˆæœ¬æœ€é«˜æ”¯æŒåˆ° 1.14.2ï¼Œè€Œ 1.14 ç‰ˆæœ¬ kubernetes å·²ç»ä¸åœ¨ç»´æŠ¤äº†ï¼Œæ‰€ä»¥æ¨èæ¢ä¸ªé•œåƒæºå®‰è£… v.1.16.8 æˆ–è€… v1.17.4 è¿™ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv1.18.1 ä¹Ÿä¸å»ºè®®å»ºè®®å®‰è£…ä½¿ç”¨ã€‚å…³äºç‰ˆæœ¬çš„é€‰æ‹©å¯ä»¥å‚è€ƒ <a href="https://blog.k8s.li/How-to-choose-the-right-version-of-kubernetes.html">ç”Ÿäº§ç¯å¢ƒå¦‚ä½•ä¿å®ˆåœ°é€‰æ‹© kubernetes ç‰ˆæœ¬</a> ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 ~</span><br><span class="line">â•°â”€# yum list kubeadm --showduplicates|sort -r</span><br><span class="line">kubeadm.x86_64                       1.6.11-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.1-0                          kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.10-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.6.0-0                          kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.2-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.1-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.14.0-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.13.6-0                         kubernetes</span><br><span class="line">kubeadm.x86_64                       1.13.5-0                         kubernetes</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®-docker-çš„daemon-json"><a href="#è®¾ç½®-docker-çš„daemon-json" class="headerlink" title="è®¾ç½® docker çš„daemon.json"></a>è®¾ç½® docker çš„daemon.json</h3><p>å®‰è£…å®Œæˆä¹‹åå…ˆè®¾ç½®ä»¥ä¸‹ docker çš„å¯åŠ¨å‚æ•° <code>/etc/docker/daemon.json</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"exec-opts"</span>: [<span class="string">"native.cgroupdriver=systemd"</span>],</span><br><span class="line">  <span class="attr">"registry-mirrors"</span>: [<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span>],</span><br><span class="line">  <span class="attr">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">  <span class="attr">"log-opts"</span>: &#123;</span><br><span class="line">    <span class="attr">"max-size"</span>: <span class="string">"100m"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"storage-driver"</span>: <span class="string">"overlay2"</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker kubelet</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker kubelet</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â•­â”€root@k8s-master-01</span> <span class="string">~</span></span><br><span class="line"><span class="string">â•°â”€#</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"> <span class="attr">Containers:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Running:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Paused:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">Stopped:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Images:</span> <span class="number">0</span></span><br><span class="line"> <span class="attr">Server Version:</span> <span class="number">19.03</span><span class="number">.3</span></span><br><span class="line"> <span class="attr">Storage Driver:</span> <span class="string">overlay2</span></span><br><span class="line">  <span class="attr">Backing Filesystem:</span> <span class="string">extfs</span></span><br><span class="line">  <span class="attr">Supports d_type:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">Native Overlay Diff:</span> <span class="literal">true</span></span><br><span class="line"> <span class="attr">Logging Driver:</span> <span class="string">json-file</span></span><br><span class="line"> <span class="attr">Cgroup Driver:</span> <span class="string">cgroupfs</span></span><br><span class="line"> <span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Volume:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">Network:</span> <span class="string">bridge</span> <span class="string">host</span> <span class="string">ipvlan</span> <span class="string">macvlan</span> <span class="literal">null</span> <span class="string">overlay</span></span><br><span class="line">  <span class="attr">Log:</span> <span class="string">awslogs</span> <span class="string">fluentd</span> <span class="string">gcplogs</span> <span class="string">gelf</span> <span class="string">journald</span> <span class="string">json-file</span> <span class="string">local</span> <span class="string">logentries</span> <span class="string">splunk</span> <span class="string">syslog</span></span><br><span class="line"> <span class="attr">Swarm:</span> <span class="string">inactive</span></span><br><span class="line"> <span class="attr">Runtimes:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Default Runtime:</span> <span class="string">runc</span></span><br><span class="line"> <span class="attr">Init Binary:</span> <span class="string">docker-init</span></span><br><span class="line"> <span class="attr">containerd version:</span> <span class="string">894b81a4b802e4eb2a91d1ce216b8817763c29fb</span></span><br><span class="line"> <span class="attr">runc version:</span> <span class="string">425e105d5a03fabd737a126ad93d62a9eeede87f</span></span><br><span class="line"> <span class="attr">init version:</span> <span class="string">fec3683</span></span><br><span class="line"> <span class="attr">Security Options:</span></span><br><span class="line">  <span class="string">seccomp</span></span><br><span class="line">   <span class="attr">Profile:</span> <span class="string">default</span></span><br><span class="line"> <span class="attr">Kernel Version:</span> <span class="number">3.10</span><span class="number">.0</span><span class="number">-957.</span><span class="string">el7.x86_64</span></span><br><span class="line"> <span class="attr">Operating System:</span> <span class="string">CentOS</span> <span class="string">Linux</span> <span class="number">7</span> <span class="string">(Core)</span></span><br><span class="line"> <span class="attr">OSType:</span> <span class="string">linux</span></span><br><span class="line"> <span class="attr">Architecture:</span> <span class="string">x86_64</span></span><br><span class="line"> <span class="attr">CPUs:</span> <span class="number">4</span></span><br><span class="line"> <span class="attr">Total Memory:</span> <span class="number">3.</span><span class="string">683GiB</span></span><br><span class="line"> <span class="attr">Name:</span> <span class="string">k8s-master-01</span></span><br><span class="line"> <span class="attr">ID:</span> <span class="string">UXD4:IK6C:P3EO:TXRP:GQZD:STGH:GXZH:LO2C:HFBN:LV2B:LEVE:UWT2</span></span><br><span class="line"> <span class="attr">Docker Root Dir:</span> <span class="string">/var/lib/docker</span></span><br><span class="line"> <span class="attr">Debug Mode:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Registry:</span> <span class="string">https://index.docker.io/v1/</span></span><br><span class="line"> <span class="attr">Labels:</span></span><br><span class="line"> <span class="attr">Experimental:</span> <span class="literal">false</span></span><br><span class="line"> <span class="attr">Insecure Registries:</span></span><br><span class="line">  <span class="number">127.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8</span></span><br><span class="line"> <span class="attr">Live Restore Enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ <strong>overlay2</strong>  çš„å­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯<code>devicemapper</code> å­˜å‚¨é©±åŠ¨å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œdocker å®˜æ–¹æ¨èä½¿ç”¨ <code>overlay2</code> æ›¿ä»£<code>devicemapper</code>ã€‚å¯ä½¿ç”¨ lsmod å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2 ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# lsmod |grep overlay</span><br><span class="line">overlay                71964  16</span><br></pre></td></tr></table></figure>
<h2 id="éƒ¨ç½²-master-èŠ‚ç‚¹"><a href="#éƒ¨ç½²-master-èŠ‚ç‚¹" class="headerlink" title="éƒ¨ç½² master èŠ‚ç‚¹"></a>éƒ¨ç½² master èŠ‚ç‚¹</h2><h3 id="å‡†å¤‡é•œåƒ"><a href="#å‡†å¤‡é•œåƒ" class="headerlink" title="å‡†å¤‡é•œåƒ"></a>å‡†å¤‡é•œåƒ</h3><p>å¯¹äº kubernetes 1.17.4 ç‰ˆæœ¬çš„ kubeadm éœ€è¦ä½¿ç”¨åˆ°ä»¥ä¸‹ docker é•œåƒå¦‚ä¸‹ï¼Œå¯¹äºå¢™å›½ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä½ éœ€è¦æ‰¾å°å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ï¼Œåœ¨ä¸Šé¢æŠŠå®ƒ pull ä¸‹æ¥ï¼Œç„¶å save æˆ tar åŒ…ä¼ å›æœ¬åœ°å† docker load è¿›é•œåƒğŸ˜‚ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io/kube-apiserver:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.17.4</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.17.4</span><br><span class="line">k8s.gcr.io/pause:3.1</span><br><span class="line">k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">k8s.gcr.io/coredns:1.6.5</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ kubeadm pull ç›¸å…³é•œåƒæ—¶ï¼Œkubeadm çš„ç‰ˆæœ¬æœ€å¥½å’Œ â€“kubernetes-version=${version} ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯æœ‰äº›ç‰ˆæœ¬çš„é•œåƒæ˜¯ pull ä¸ä¸‹æ¥çš„ã€‚å¯¹åº”ç‰ˆæœ¬çš„ kubenetes è¦ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„é•œåƒæ‰å¯ä»¥ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬åœ¨å¯ä»¥è‡ªç”±è®¿é—®äº’è”ç½‘çš„æœåŠ¡å™¨ä¸Šå°† pull æŒ‡å®šç‰ˆæœ¬çš„é•œåƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: use kubeadm pull kubernetes images</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> date: 2019-08-15</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">for version in 1.17.4</span><br><span class="line">do</span><br><span class="line">    apt install kubeadm=$&#123;version&#125;-00</span><br><span class="line">    mkdir -p $&#123;version&#125;/bin</span><br><span class="line">    docker rmi $(docker images -q)</span><br><span class="line">    kubeadm config images pull --kubernetes-version=$&#123;version&#125;</span><br><span class="line">    docker save -o v$&#123;version&#125;.tar $(docker images | grep -v TAG | cut -d ' ' -f1)</span><br><span class="line">    gzip v$&#123;version&#125;.tar v$&#123;version&#125;.tar.gz</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>å¯¼å…¥ä¹‹åçš„é•œåƒ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# docker load &lt; v1.17.4.tar.gz</span><br><span class="line">fc4976bd934b: Loading layer [=============&gt;]  53.88MB/53.88MB</span><br><span class="line">f6953727aaba: Loading layer [=============&gt;]   42.1MB/42.1MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-scheduler:v1.17.4</span><br><span class="line">225df95e717c: Loading layer [=============&gt;]  336.4kB/336.4kB</span><br><span class="line">7c9b0f448297: Loading layer [=============&gt;]  41.37MB/41.37MB</span><br><span class="line">Loaded image: k8s.gcr.io/coredns:1.6.5</span><br><span class="line">fe9a8b4f1dcc: Loading layer [=============&gt;]  43.87MB/43.87MB</span><br><span class="line">ce04b89b7def: Loading layer [=============&gt;]  224.9MB/224.9MB</span><br><span class="line">1b2bc745b46f: Loading layer [=============&gt;]  21.22MB/21.22MB</span><br><span class="line">Loaded image: k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">e17133b79956: Loading layer [=============&gt;]  744.4kB/744.4kB</span><br><span class="line">Loaded image: k8s.gcr.io/pause:3.1</span><br><span class="line">682fbb19de80: Loading layer [=============&gt;]  21.06MB/21.06MB</span><br><span class="line">2dc2f2423ad1: Loading layer [=============&gt;]  5.168MB/5.168MB</span><br><span class="line">ad9fb2411669: Loading layer [=============&gt;]  4.608kB/4.608kB</span><br><span class="line">597151d24476: Loading layer [=============&gt;]  8.192kB/8.192kB</span><br><span class="line">0d8d54147a3a: Loading layer [=============&gt;]  8.704kB/8.704kB</span><br><span class="line">960d0ce862e2: Loading layer [=============&gt;]  37.81MB/37.81MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-proxy:v1.17.4</span><br><span class="line">9daac3fed755: Loading layer [=============&gt;]  118.7MB/118.7MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-apiserver:v1.17.4</span><br><span class="line">99df54617e88: Loading layer [=============&gt;]  108.6MB/108.6MB</span><br><span class="line">Loaded image: k8s.gcr.io/kube-controller-manager:v1.17.4</span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# docker images</span><br><span class="line">REPOSITORY                           TAG                 CREATED             SIZE</span><br><span class="line">k8s.gcr.io/kube-proxy                v1.17.4             4 weeks ago         116MB</span><br><span class="line">k8s.gcr.io/kube-controller-manager   v1.17.4             4 weeks ago         161MB</span><br><span class="line">k8s.gcr.io/kube-apiserver            v1.17.4             4 weeks ago         171MB</span><br><span class="line">k8s.gcr.io/kube-scheduler            v1.17.4             4 weeks ago         94.4MB</span><br><span class="line">k8s.gcr.io/coredns                   1.6.5               5 months ago        41.6MB</span><br><span class="line">k8s.gcr.io/etcd                      3.4.3-0             5 months ago        288MB</span><br><span class="line">k8s.gcr.io/pause                     3.1                 2 years ago         742kB</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–-master-èŠ‚ç‚¹"><a href="#åˆå§‹åŒ–-master-èŠ‚ç‚¹" class="headerlink" title="åˆå§‹åŒ– master èŠ‚ç‚¹"></a>åˆå§‹åŒ– master èŠ‚ç‚¹</h3><p>ä½¿ç”¨ kubeadm init å‘½ä»¤åˆå§‹åŒ– master èŠ‚ç‚¹ï¼Œå…³äº kubeadm çš„å‚æ•°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/" target="_blank" rel="noopener">kubeadm init</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211 --kubernetes-version=1.17.4</span><br></pre></td></tr></table></figure>
<ul>
<li>â€“pod-network-cidr= æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—</li>
<li>â€“apiserver-advertise-address= æŒ‡å®š api-server ç›‘å¬çš„åœ°å€</li>
<li>â€“kubernetes-version= æŒ‡å®š kubernetes çš„ç‰ˆæœ¬ï¼Œæœ€å¥½å’Œ kubeadm ç‰ˆæœ¬ä¿æŒä¸€è‡´</li>
</ul>
<p>æ­£å¸¸å®Œæˆä¹‹åçš„æ—¥å¿—è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211 --kubernetes-version=1.17.4</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1</span><br></pre></td></tr></table></figure>
<p>åˆšåˆšå®‰è£…å®Œä¹‹å coreDNS çš„ Pod ä¼šä¸€ç›´å‡ºäº pending çŠ¶æ€ï¼Œè€Œä¸” Master çš„ STATUS çŠ¶æ€ä¹Ÿæ˜¯ <code>NotReady</code> ã€‚é‡åˆ°è¿™ç§é—®é¢˜<code>ä¸è¦æ…Œ,é—®é¢˜ä¸å¤§.jpg</code> è¿™æ˜¯å› ä¸ºé›†ç¾¤ä¸­è¿˜æ²¡æœ‰å®‰è£…å¥½ CNI ç½‘ç»œæ’ä»¶ï¼Œç­‰ä¸‹éƒ¨ç½²å¥½ flannel å°±å¯ä»¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS     ROLES    AGE     VERSION</span><br><span class="line">k8s-master-01   NotReady   master   9m19s   v1.17.4</span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get pod --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-6955765f44-t4b6k                0/1     Pending   0          49s</span><br><span class="line">kube-system   coredns-6955765f44-vm5tm                0/1     Pending   0          49s</span><br><span class="line">kube-system   etcd-k8s-master-01                      1/1     Running   0          62s</span><br><span class="line">kube-system   kube-apiserver-k8s-master-01            1/1     Running   0          62s</span><br><span class="line">kube-system   kube-controller-manager-k8s-master-01   1/1     Running   0          62s</span><br><span class="line">kube-system   kube-proxy-rmgwl                        1/1     Running   0          49s</span><br><span class="line">kube-system   kube-scheduler-k8s-master-01            1/1     Running   0          62s</span><br></pre></td></tr></table></figure>
<h2 id="åŠ å…¥-node-èŠ‚ç‚¹"><a href="#åŠ å…¥-node-èŠ‚ç‚¹" class="headerlink" title="åŠ å…¥ node èŠ‚ç‚¹"></a>åŠ å…¥ node èŠ‚ç‚¹</h2><p>åœ¨å¦ä¸€å° Node èŠ‚ç‚¹ä¸Šé‡å¤èŠ‚ç‚¹åˆå§‹åŒ–çš„å†…å®¹ï¼Œå¹¶å°†å°†æ‰€éœ€çš„é•œåƒå¯¼å…¥åˆ° node èŠ‚ç‚¹ã€‚ä¹‹åä½¿ç”¨ kubeadm joine å‘½ä»¤å°† Node èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­å³å¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-node-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1</span></span><br><span class="line">W0415 00:52:08.127829    9901 join.go:346] [preflight] WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">        [WARNING Hostname]: hostname "k8s-node-01" could not be reached</span><br><span class="line">        [WARNING Hostname]: hostname "k8s-node-01": lookup k8s-node-01 on 192.168.10.254:53: no such host</span><br><span class="line">        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'</span><br><span class="line">[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.17" ConfigMap in the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸å‡ºæ„å¤–çš„è¯ä¼šæç¤º <code>This node has joined the cluster:</code> ï¼Œç„¶ååœ¨ master èŠ‚ç‚¹çœ‹ä¸€ä¸‹èŠ‚ç‚¹æ˜¯å¦åŠ å…¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master-01   NotReady   master   31m   v1.17.4</span><br><span class="line">k8s-node-01     NotReady   &lt;none&gt;   58s   v1.17.4</span><br></pre></td></tr></table></figure>
<p>å¦‚æœçŠ¶æ€è¿˜æ˜¯ <code>NotReady</code> ä¸è¦æ…Œï¼Œé—®é¢˜ä¸å¤§ï¼‰ã€‚æ¥ä¸‹æ¥å®‰è£… CNI ç½‘ç»œæ’ä»¶å³å¯</p>
<h2 id="éƒ¨ç½²ç½‘ç»œæ’ä»¶"><a href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶" class="headerlink" title="éƒ¨ç½²ç½‘ç»œæ’ä»¶"></a>éƒ¨ç½²ç½‘ç»œæ’ä»¶</h2><p>åœ¨è¿™æˆ‘ä»¬ä½¿ç”¨ flannel ä½œä¸º Kubernetes ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œåœ¨ kubeadm init çš„æ—¶å€™æŒ‡å®šçš„ â€“pod-network-cidr= æŒ‡å®š Pod ç½‘æ®µçš„ IP åœ°å€å—ï¼Œå³ä¸º flannel é»˜è®¤çš„ IP æ®µï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹çš„è¯å°±ç›´æ¥åœ¨ master èŠ‚ç‚¹ä¸Šä½¿ç”¨ kubectl apply -f å‘½ä»¤éƒ¨ç½²å³å¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>
<p>ç”±äºå¢™å›½ç½‘ç»œåŸå› ï¼Œè®¿é—® <code>raw.githubusercontent.com</code> è¿™ä¸ªåŸŸåä¼šæ¯”è¾ƒæ…¢ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ jsdelivr æ¥è¿›è¡ŒåŠ é€Ÿã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl apply -f https://cdn.jsdelivr.net/gh/coreos/flannel/Documentation/kube-flannel.yml</span><br><span class="line">podsecuritypolicy.policy/psp.flannel.unprivileged created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.apps/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.apps/kube-flannel-ds-arm created</span><br><span class="line">daemonset.apps/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.apps/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure>
<p>flannel çš„ docker é•œåƒæ˜¯åœ¨ <code>quay.io/coreos/flannel</code> ä¸€èˆ¬æƒ…å†µä¸‹æ²¡é—®é¢˜èƒ½é¡ºåˆ© pull ä¸‹æ¥ã€‚ç„¶åä½¿ç”¨ <code>kubectl get pod -n kube-system</code> å‘½ä»¤æŸ¥çœ‹ pod çš„çŠ¶æ€æ˜¯ä¸æ˜¯éƒ½åœ¨ running çŠ¶æ€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get pod -n kube-system</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-g5fwl                1/1     Running   0          23h</span><br><span class="line">coredns-6955765f44-g7cls                1/1     Running   0          23h</span><br><span class="line">etcd-k8s-master-01                      1/1     Running   0          24h</span><br><span class="line">kube-apiserver-k8s-master-01            1/1     Running   0          24h</span><br><span class="line">kube-controller-manager-k8s-master-01   1/1     Running   0          24h</span><br><span class="line">kube-flannel-ds-amd64-94hfr             1/1     Running   0          23h</span><br><span class="line">kube-flannel-ds-amd64-vpdfd             1/1     Running   0          23h</span><br><span class="line">kube-proxy-rmgwl                        1/1     Running   0          24h</span><br><span class="line">kube-proxy-xqcsq                        1/1     Running   0          24h</span><br><span class="line">kube-scheduler-k8s-master-01            1/1     Running   0          24h</span><br><span class="line"></span><br><span class="line">â•­â”€root@k8s-master-01 /opt/1.17.4</span><br><span class="line">â•°â”€# kubectl get node</span><br><span class="line">NAME            STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master-01   Ready    master   29h   v1.17.4</span><br><span class="line">k8s-node-01     Ready    &lt;none&gt;   28h   v1.17.4</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤ï¼Œä¸€ä¸ªç®€é™‹çš„ kubernetes é›†ç¾¤å·²ç»éƒ¨ç½²å®Œäº†ğŸ˜‚ï¼Œæ–‡ç« æœ‰ç‚¹æ°´äº†~~ã€‚å¯¹äºæƒ³è¦å…¥é—¨å’Œå­¦ä¹  kubernetes çš„åŒå­¦æ¥è¯´ kubeadm æ˜¯ä¸ªå¥½å·¥å…·ã€‚åç»­ä¼šæ›´æ–°ä¸€äº› kubernetes å†…å®¹ã€‚</p>
<h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>æœ€åæä¸€ä¸‹ï¼Œæ–‡ä¸­æåˆ°çš„å¯¹äºä¸‹è½½ github ä¸Šæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è§„åˆ™è¿›è¡Œæ›¿æ¢ï¼Œå°±å¯ä»¥ä½¿ç”¨ jsdelivr æ¥ fuck ä¸€ä¸‹ GFW ï¼Œæ— ç—›ä¸‹è½½ GitHub ä¸Šçš„æ–‡ä»¶ã€‚è¿™è¿˜æ˜¯ä» <a href="https://chanshiyu.com/#/post/94" target="_blank" rel="noopener">JsDelivr å…¨ç«™æ‰˜ç®¡</a> å­¦æ¥çš„éªšæ“ä½œğŸ˜‚ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GitHub rul:</span> <span class="string">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="attr">jsDelivr url:</span> <span class="string">https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br></pre></td></tr></table></figure>
<p>è§„åˆ™å°±æ˜¯å°† <code>github.com</code> æ›¿æ¢ä¸º <code>cdn.jsdelivr.net/gh</code> ï¼Œç„¶åå»æ‰ <code>/blob/master</code>ï¼Œæ¥ä¸Š repo é‡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„å³å¯ã€‚ä¹Ÿå¯ä»¥å°†ä»¥ä¸‹è„šæœ¬ä¿å­˜ä¸ºä¸€ä¸ªå¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ /usr/bin/rawgï¼Œå½“ä½¿ç”¨ rawg <a href="https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh" target="_blank" rel="noopener">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</a> å°±å¯ä»¥ç›´æ¥å°† url è¿›è¡Œæ›¿æ¢ï¼Œå¿«é€Ÿåœ°ä¸‹è½½æ–‡ä»¶ã€‚æ€ä¹ˆæ ·ï¼Œå¾ˆçˆ½å§ğŸ˜‚ï¼Œå¯¹äºæŸäº› Linux æœºå™¨ä¸Šæ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data: 2020-03-31</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> author: muzi502</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span>: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> usage: save the .she to your <span class="built_in">local</span> such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span></span><br><span class="line"></span><br><span class="line">set -xue</span><br><span class="line"><span class="meta">#</span><span class="bash"> GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span></span><br><span class="line"></span><br><span class="line">wget $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">               | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span><br><span class="line">               | sed 's/\/master//' | sed 's/\/blob//' )</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> curl $(<span class="built_in">echo</span> <span class="variable">$1</span> | sed <span class="string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> \</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                | sed <span class="string">'s/\/master//'</span> | sed <span class="string">'s/\/blob//'</span> )</span></span><br></pre></td></tr></table></figure>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kubeadm/" rel="tag"><i class="fa fa-tag"></i> kubeadm</a>
              <a href="/tags/kubernetes/" rel="tag"><i class="fa fa-tag"></i> kubernetes</a>
              <a href="/tags/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0-K8s/" rel="tag"><i class="fa fa-tag"></i> ä»é›¶å¼€å§‹å­¦ä¹  K8s</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/gitlab-ci-harbor.html" rel="prev" title="åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿">
      <i class="fa fa-chevron-left"></i> åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿
    </a></div>
      <div class="post-nav-item">
    <a href="/interview-wordpress-install.html" rel="next" title="ä¸€æ¬¡æœ‰è¶£çš„é¢è¯•ï¼šWordPress éƒ¨ç½²">
      ä¸€æ¬¡æœ‰è¶£çš„é¢è¯•ï¼šWordPress éƒ¨ç½² <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
  </div>
          </div>
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ç‚’å†·é¥­"><span class="nav-number">1.</span> <span class="nav-text">ç‚’å†·é¥­</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kubeadm"><span class="nav-number">1.1.</span> <span class="nav-text">kubeadm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kubernetes-æ¶æ„"><span class="nav-number">2.</span> <span class="nav-text">kubernetes æ¶æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ§åˆ¶å¹³é¢"><span class="nav-number">2.1.</span> <span class="nav-text">æ§åˆ¶å¹³é¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å·¥ä½œå¹³é¢"><span class="nav-number">2.2.</span> <span class="nav-text">å·¥ä½œå¹³é¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kubeadm-init-æµç¨‹"><span class="nav-number">2.3.</span> <span class="nav-text">kubeadm init æµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#èŠ‚ç‚¹åˆå§‹åŒ–"><span class="nav-number">3.</span> <span class="nav-text">èŠ‚ç‚¹åˆå§‹åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ -hosts"><span class="nav-number">3.1.</span> <span class="nav-text">è®¾ç½®ä¸»æœºåå¹¶æ·»åŠ   hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…³é—­-swap-å’Œ-SELinux"><span class="nav-number">3.2.</span> <span class="nav-text">å…³é—­ swap å’Œ SELinux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®å†…æ ¸å‚æ•°"><span class="nav-number">3.3.</span> <span class="nav-text">è®¾ç½®å†…æ ¸å‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é…ç½®é•œåƒæºå’Œå®‰è£…"><span class="nav-number">3.4.</span> <span class="nav-text">é…ç½®é•œåƒæºå’Œå®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®-docker-çš„daemon-json"><span class="nav-number">3.5.</span> <span class="nav-text">è®¾ç½® docker çš„daemon.json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨"><span class="nav-number">3.6.</span> <span class="nav-text">è®¾ç½®å¼€æœºè‡ªå¯å¹¶å¯åŠ¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éƒ¨ç½²-master-èŠ‚ç‚¹"><span class="nav-number">4.</span> <span class="nav-text">éƒ¨ç½² master èŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‡†å¤‡é•œåƒ"><span class="nav-number">4.1.</span> <span class="nav-text">å‡†å¤‡é•œåƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆå§‹åŒ–-master-èŠ‚ç‚¹"><span class="nav-number">4.2.</span> <span class="nav-text">åˆå§‹åŒ– master èŠ‚ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŠ å…¥-node-èŠ‚ç‚¹"><span class="nav-number">5.</span> <span class="nav-text">åŠ å…¥ node èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶"><span class="nav-number">6.</span> <span class="nav-text">éƒ¨ç½²ç½‘ç»œæ’ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç»“æŸ"><span class="nav-number">7.</span> <span class="nav-text">ç»“æŸ</span></a></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="æœ¨å­"
      src="https://blog.k8s.li/avatar.png">
  <p class="site-author-name" itemprop="name">æœ¨å­</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail â†’ mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://kindle.502.li/" title="Kindle â†’ https:&#x2F;&#x2F;kindle.502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tg.k8s.li/" title="Channel â†’ https:&#x2F;&#x2F;tg.k8s.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Channel</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æœ¨å­</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">39:50</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
      </div>
    </footer>
  </div>
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html",
            identifier: "kubeadm-deploy-k8s-v1.17.4.html",
            title: "ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://muzi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>
</body>
</html>
