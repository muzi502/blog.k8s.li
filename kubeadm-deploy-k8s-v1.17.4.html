<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="炒冷饭大概是从去年 5 月开始才接触  kubernetes ，时至今日已经快一年，当初写的一篇博客 ubuntu 1804 使用 kubeadm 部署 kubernetes 翻出来重新修改一下，记录一下使用 kubeadm 部署 kubernetes v1.17.4 版的流程。适用于国内网络环境下。 kubeadmKubernetes 从 1.4 版本开始后就引入了 kubeadm 用于简化集群">
<meta property="og:type" content="blog">
<meta property="og:title" content="使用 kubeadm 快速部署体验 K8s">
<meta property="og:url" content="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="炒冷饭大概是从去年 5 月开始才接触  kubernetes ，时至今日已经快一年，当初写的一篇博客 ubuntu 1804 使用 kubeadm 部署 kubernetes 翻出来重新修改一下，记录一下使用 kubeadm 部署 kubernetes v1.17.4 版的流程。适用于国内网络环境下。 kubeadmKubernetes 从 1.4 版本开始后就引入了 kubeadm 用于简化集群">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/components-of-kubernetes.png">
<meta property="article:published_time" content="2020-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2020-04-14T16:00:00.000Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="kubeadm">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="从零开始学习 K8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/components-of-kubernetes.png">


<link rel="canonical" href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html","path":"kubeadm-deploy-k8s-v1.17.4.html","title":"使用 kubeadm 快速部署体验 K8s"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>使用 kubeadm 快速部署体验 K8s | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%92%E5%86%B7%E9%A5%AD"><span class="nav-number">1.</span> <span class="nav-text">炒冷饭</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kubeadm"><span class="nav-number">1.1.</span> <span class="nav-text">kubeadm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kubernetes-%E6%9E%B6%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">kubernetes 架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="nav-number">2.1.</span> <span class="nav-text">控制平面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%B9%B3%E9%9D%A2"><span class="nav-number">2.2.</span> <span class="nav-text">工作平面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kubeadm-init-%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">kubeadm init 流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">节点初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D%E5%B9%B6%E6%B7%BB%E5%8A%A0-hosts"><span class="nav-number">3.1.</span> <span class="nav-text">设置主机名并添加  hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%97%AD-swap-%E5%92%8C-SELinux"><span class="nav-number">3.2.</span> <span class="nav-text">关闭 swap 和 SELinux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">设置内核参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E6%BA%90%E5%92%8C%E5%AE%89%E8%A3%85"><span class="nav-number">3.4.</span> <span class="nav-text">配置镜像源和安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-docker-%E7%9A%84-daemon-json"><span class="nav-number">3.5.</span> <span class="nav-text">设置 docker 的 daemon.json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="nav-number">3.6.</span> <span class="nav-text">设置开机自启并启动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-master-%E8%8A%82%E7%82%B9"><span class="nav-number">4.</span> <span class="nav-text">部署 master 节点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E9%95%9C%E5%83%8F"><span class="nav-number">4.1.</span> <span class="nav-text">准备镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-master-%E8%8A%82%E7%82%B9"><span class="nav-number">4.2.</span> <span class="nav-text">初始化 master 节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5-node-%E8%8A%82%E7%82%B9"><span class="nav-number">5.</span> <span class="nav-text">加入 node 节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">部署网络插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F"><span class="nav-number">7.</span> <span class="nav-text">结束</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">117</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">152</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail → mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/kubeadm-deploy-k8s-v1.17.4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="使用 kubeadm 快速部署体验 K8s | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用 kubeadm 快速部署体验 K8s
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-15 2020-04-15T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-04-15T00:00:00+08:00">2020-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/kubeadm-deploy-k8s-v1.17.4.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="kubeadm-deploy-k8s-v1.17.4.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>13 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="炒冷饭"><a href="#炒冷饭" class="headerlink" title="炒冷饭"></a>炒冷饭</h2><p>大概是从去年 5 月开始才接触  kubernetes ，时至今日已经快一年，当初写的一篇博客 <a href="https://blog.k8s.li/install-k8s-ubuntu18-04.html">ubuntu 1804 使用 kubeadm 部署 kubernetes</a> 翻出来重新修改一下，记录一下使用 kubeadm 部署 kubernetes v1.17.4 版的流程。适用于国内网络环境下。</p>
<h3 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a>kubeadm</h3><p>Kubernetes 从 1.4 版本开始后就引入了 kubeadm 用于简化集群搭建的过程，在 Kubernetes 1.13 版本中，kubeadm 工具进入 GA 阶段，而当前的 kubernetes 最新版 stable 为 1.18.1 ，kubeadm 已经经历过多个版本的迭代，可用于生产环境 Kubernetes 集群搭建。对于刚刚接触 kubernetes  的初学者来讲，kubeadm 也是一个快速部署体验 kubernetes 的不二之选。</p>
<h2 id="kubernetes-架构"><a href="#kubernetes-架构" class="headerlink" title="kubernetes 架构"></a>kubernetes 架构</h2><p><img data-src="https://p.k8s.li/components-of-kubernetes.png"></p>
<p>架构图来自 kubernetes 官方文档 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/overview/components/">Kubernetes 组件</a></p>
<h3 id="控制平面"><a href="#控制平面" class="headerlink" title="控制平面"></a>控制平面</h3><p>控制平面的组件对集群做出全局决策(比如调度)，以及检测和响应集群事件主要的组件由</p>
<ul>
<li>kube-apiserver：主节点上负责提供 Kubernetes API 服务的组件；它是 Kubernetes 控制面的前端。</li>
<li>etcd：集群中唯一一个有状态的服务，用来存储集群中的所有资源信息数据。</li>
<li>kube-scheduler：负责调度 Pod 资源到某个 Node 节点上。</li>
<li>kube-controller-manager：控制器管理器。</li>
<li>kubelet：如果使用 kubeadm 部署的话需要在 master 节点安装 kubelet</li>
</ul>
<h3 id="工作平面"><a href="#工作平面" class="headerlink" title="工作平面"></a>工作平面</h3><ul>
<li>kubelet：通过监听 kube-apiserver ，接收一组通过各类机制提供给它的 PodSpecs，确保这些 PodSpecs 中描述的容器处于运行状态且健康。</li>
<li>kube-proxy：实现 Kubernetes <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> 概念的一部分，通过 iptables 规则将 service 负载均衡到各个 Pod。</li>
<li>CRI 容器运行时：根据统计目前 docker 依旧是排名第一的容器运行时</li>
</ul>
<h3 id="kubeadm-init-流程"><a href="#kubeadm-init-流程" class="headerlink" title="kubeadm init 流程"></a>kubeadm init 流程</h3><p>在使用 kubeadm 部署时，除了 kubelet 组件需要使用二进制部署外，其他的组件都是用 <a href="">static Pod</a> 的方式运行在相应的节点。</p>
<h2 id="节点初始化"><a href="#节点初始化" class="headerlink" title="节点初始化"></a>节点初始化</h2><p>系统建议选择 ubuntu 1804 或者 CentOS 7.7，因为 docker 容器虚拟化以及 kubernetes 这些新技术都是很依赖一些内核特性，比如 overlay2、cgroupv2 等，这些特性在较低版本的内核上并不是很稳定，建议 4.14 或者 4.19 以上的 LTS  内核，及长期稳定支持版内核，在 <a target="_blank" rel="noopener" href="https://www.kernel.org/category/releases.html">kernel.org</a> 上有内核支持支持情况。</p>
<h3 id="设置主机名并添加-hosts"><a href="#设置主机名并添加-hosts" class="headerlink" title="设置主机名并添加  hosts"></a>设置主机名并添加  hosts</h3><p>每台机器上都要设置相应的主机名并添加 hosts</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hostnamectl set-hostname k8s-maste-01

<span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts <span class="token operator">&lt;&lt;</span><span class="token string">EOF
10.20.172.211 k8s-master-01
10.20.172.212 k8s-node-01
10.20.172.213 k8s-node-02
10.20.172.214 k8s-node-03
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="关闭-swap-和-SELinux"><a href="#关闭-swap-和-SELinux" class="headerlink" title="关闭 swap 和 SELinux"></a>关闭 swap 和 SELinux</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 临时关闭swap和SELinux</span>
swapoff <span class="token parameter variable">-a</span>

<span class="token comment"># ubuntu 默认没有安装 SELinux 因为无需关闭</span>
setenforce <span class="token number">0</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^SELINUX=enforcing$/SELINUX= disabled/'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="设置内核参数"><a href="#设置内核参数" class="headerlink" title="设置内核参数"></a>设置内核参数</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/99-kubernetes-cri.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
net.bridge.bridge-nf-call-iptables  = 1
enet.ipv4.ip_forward                = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF</span>
<span class="token function">sysctl</span> <span class="token parameter variable">--system</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="配置镜像源和安装"><a href="#配置镜像源和安装" class="headerlink" title="配置镜像源和安装"></a>配置镜像源和安装</h3><p>如果对 docker-ce 版本没有特殊要求，使用以下命令可安装 docker-ce 最新的 stable 版本。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils

<span class="token comment"># 如果 docker 版本使用 18.09 + 且存储驱动使用 overlay2</span>
<span class="token comment"># 就不用 device-mapper-persistent-data 和 lvm2</span>

<span class="token comment"># 添加aliyun软件包yum源 docker</span>
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

<span class="token comment"># 添加aliyun软件包yum源 kubelet kubeadm kubectl</span>
cat<span class="token operator">>></span>/etc/yum.repos.d/kubrenetes.repo<span class="token operator">&lt;&lt;</span><span class="token string">EOF
[kubernetes]
name=Kubernetes Repo
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
EOF</span>
yum makecache

<span class="token comment"># 列出可以安装的 docker-ce 版本，安装指定的 docker 版本</span>
yum list docker-ce --showduplicates<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce-19.03.3-3.el7

<span class="token comment"># # 列出可以安装的 kubernetes 版本，安装指定的 kubeadm kubelet kubectl</span>
yum list kubeadm --showduplicates<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span>
yum <span class="token function">install</span> kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 <span class="token parameter variable">--disableexcludes</span><span class="token operator">=</span>kubernetes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apt-transport-https ca-certificates <span class="token function">curl</span> software-properties-common

<span class="token comment"># 添加阿里云 docker-ce 镜像源</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
add-apt-repository <span class="token string">"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span>
<span class="token comment"># 添加阿里云 kubernetes 镜像源</span>
<span class="token function">curl</span> https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> -
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span>/etc/apt/sources.list.d/kubernetes.list</span>
deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
EOF</span>
<span class="token function">apt-get</span> update
<span class="token comment"># 安装指定版本的 docker-ce</span>
<span class="token function">apt</span> list <span class="token parameter variable">-a</span> docker-ce
<span class="token function">apt</span> <span class="token function">install</span> docker-ce<span class="token operator">=</span><span class="token number">5</span>:19.03.8~3-0~ubuntu-bionic
<span class="token comment"># 安装指定版本的 kubernetes</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token number">1.17</span>.4-00 <span class="token assign-left variable">kubelet</span><span class="token operator">=</span><span class="token number">1.17</span>.4-00 <span class="token assign-left variable">kubectl</span><span class="token operator">=</span><span class="token number">1.17</span>.4-00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="华为云坑"><a href="#华为云坑" class="headerlink" title="华为云坑"></a>华为云坑</h4><p>需要注意的是，如果你使用的华为云 kubernetes 镜像源，目前 （2020-04-15） 华为云上的 kubernetes 版本最高支持到 1.14.2，而 1.14 版本 kubernetes 已经不在维护了，所以推荐换个镜像源安装 v.1.16.8 或者 v1.17.4 这两个版本，v1.18.1 也不建议建议安装使用。关于版本的选择可以参考 <a href="https://blog.k8s.li/How-to-choose-the-right-version-of-kubernetes.html">生产环境如何保守地选择 kubernetes 版本</a> 。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 ~
╰─<span class="token comment"># yum list kubeadm --showduplicates|sort -r</span>
kubeadm.x86_64                       <span class="token number">1.6</span>.11-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.6</span>.1-0                          kubernetes
kubeadm.x86_64                       <span class="token number">1.6</span>.10-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.6</span>.0-0                          kubernetes
kubeadm.x86_64                       <span class="token number">1.14</span>.2-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.14</span>.1-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.14</span>.0-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.13</span>.6-0                         kubernetes
kubeadm.x86_64                       <span class="token number">1.13</span>.5-0                         kubernetes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="设置-docker-的-daemon-json"><a href="#设置-docker-的-daemon-json" class="headerlink" title="设置 docker 的 daemon.json"></a>设置 docker 的 daemon.json</h3><p>安装完成之后先设置以下 docker 的启动参数 <code>/etc/docker/daemon.json</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">cat > /etc/docker/daemon.json &lt;&lt;EOF
<span class="token punctuation">&#123;</span>
  <span class="token property">"exec-opts"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"native.cgroupdriver=systemd"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://xlx9erfu.mirror.aliyuncs.com"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"log-driver"</span><span class="token operator">:</span> <span class="token string">"json-file"</span><span class="token punctuation">,</span>
  <span class="token property">"log-opts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"max-size"</span><span class="token operator">:</span> <span class="token string">"100m"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"storage-driver"</span><span class="token operator">:</span> <span class="token string">"overlay2"</span>
<span class="token punctuation">&#125;</span>
EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="设置开机自启并启动"><a href="#设置开机自启并启动" class="headerlink" title="设置开机自启并启动"></a>设置开机自启并启动</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> kubelet
systemctl daemon-reload
systemctl start <span class="token function">docker</span> kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">╭─root@k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span>01 ~
╰─<span class="token comment"># docker info</span>
<span class="token key atrule">Client</span><span class="token punctuation">:</span>
 <span class="token key atrule">Debug Mode</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">Server</span><span class="token punctuation">:</span>
 <span class="token key atrule">Containers</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">Running</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">Paused</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">Stopped</span><span class="token punctuation">:</span> <span class="token number">0</span>
 <span class="token key atrule">Images</span><span class="token punctuation">:</span> <span class="token number">0</span>
 <span class="token key atrule">Server Version</span><span class="token punctuation">:</span> 19.03.3
 <span class="token key atrule">Storage Driver</span><span class="token punctuation">:</span> overlay2
  <span class="token key atrule">Backing Filesystem</span><span class="token punctuation">:</span> extfs
  <span class="token key atrule">Supports d_type</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">Native Overlay Diff</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
 <span class="token key atrule">Logging Driver</span><span class="token punctuation">:</span> json<span class="token punctuation">-</span>file
 <span class="token key atrule">Cgroup Driver</span><span class="token punctuation">:</span> cgroupfs
 <span class="token key atrule">Plugins</span><span class="token punctuation">:</span>
  <span class="token key atrule">Volume</span><span class="token punctuation">:</span> local
  <span class="token key atrule">Network</span><span class="token punctuation">:</span> bridge host ipvlan macvlan null overlay
  <span class="token key atrule">Log</span><span class="token punctuation">:</span> awslogs fluentd gcplogs gelf journald json<span class="token punctuation">-</span>file local logentries splunk syslog
 <span class="token key atrule">Swarm</span><span class="token punctuation">:</span> inactive
 <span class="token key atrule">Runtimes</span><span class="token punctuation">:</span> runc
 <span class="token key atrule">Default Runtime</span><span class="token punctuation">:</span> runc
 <span class="token key atrule">Init Binary</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>init
 <span class="token key atrule">containerd version</span><span class="token punctuation">:</span> 894b81a4b802e4eb2a91d1ce216b8817763c29fb
 <span class="token key atrule">runc version</span><span class="token punctuation">:</span> 425e105d5a03fabd737a126ad93d62a9eeede87f
 <span class="token key atrule">init version</span><span class="token punctuation">:</span> fec3683
 <span class="token key atrule">Security Options</span><span class="token punctuation">:</span>
  seccomp
   <span class="token key atrule">Profile</span><span class="token punctuation">:</span> default
 <span class="token key atrule">Kernel Version</span><span class="token punctuation">:</span> 3.10.0<span class="token punctuation">-</span>957.el7.x86_64
 <span class="token key atrule">Operating System</span><span class="token punctuation">:</span> CentOS Linux 7 (Core)
 <span class="token key atrule">OSType</span><span class="token punctuation">:</span> linux
 <span class="token key atrule">Architecture</span><span class="token punctuation">:</span> x86_64
 <span class="token key atrule">CPUs</span><span class="token punctuation">:</span> <span class="token number">4</span>
 <span class="token key atrule">Total Memory</span><span class="token punctuation">:</span> 3.683GiB
 <span class="token key atrule">Name</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">01</span>
 <span class="token key atrule">ID</span><span class="token punctuation">:</span> UXD4<span class="token punctuation">:</span>IK6C<span class="token punctuation">:</span>P3EO<span class="token punctuation">:</span>TXRP<span class="token punctuation">:</span>GQZD<span class="token punctuation">:</span>STGH<span class="token punctuation">:</span>GXZH<span class="token punctuation">:</span>LO2C<span class="token punctuation">:</span>HFBN<span class="token punctuation">:</span>LV2B<span class="token punctuation">:</span>LEVE<span class="token punctuation">:</span>UWT2
 <span class="token key atrule">Docker Root Dir</span><span class="token punctuation">:</span> /var/lib/docker
 <span class="token key atrule">Debug Mode</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
 <span class="token key atrule">Registry</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//index.docker.io/v1/
 <span class="token key atrule">Labels</span><span class="token punctuation">:</span>
 <span class="token key atrule">Experimental</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
 <span class="token key atrule">Insecure Registries</span><span class="token punctuation">:</span>
  127.0.0.0/8
 <span class="token key atrule">Live Restore Enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>目前最新版本的 docker 默认优先采用 <strong>overlay2</strong>  的存储驱动，对于已支持该驱动的 Linux 发行版，不需要任何进行任何额外的配置。另外需要注意的是 <code>devicemapper</code> 存储驱动已经在 docker 18.09 版本中被废弃，docker 官方推荐使用 <code>overlay2</code> 替代 <code>devicemapper</code>。可使用 lsmod 命令查看当前系统内核是否支持 overlay2 。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># lsmod |grep overlay</span>
overlay                <span class="token number">71964</span>  <span class="token number">16</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="部署-master-节点"><a href="#部署-master-节点" class="headerlink" title="部署 master 节点"></a>部署 master 节点</h2><h3 id="准备镜像"><a href="#准备镜像" class="headerlink" title="准备镜像"></a>准备镜像</h3><p>对于 kubernetes 1.17.4 版本的 kubeadm 需要使用到以下 docker 镜像如下，对于墙国网络环境下，你需要找台可以自由访问互联网的服务器，在上面把它 pull 下来，然后 save 成 tar 包传回本地再 docker load 进镜像 😂。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k8s.gcr.io/kube-apiserver:v1.17.4
k8s.gcr.io/kube-controller-manager:v1.17.4
k8s.gcr.io/kube-scheduler:v1.17.4
k8s.gcr.io/kube-proxy:v1.17.4
k8s.gcr.io/pause:3.1
k8s.gcr.io/etcd:3.4.3-0
k8s.gcr.io/coredns:1.6.5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要注意的是，当使用 kubeadm pull 相关镜像时，kubeadm 的版本最好和 –kubernetes-version&#x3D;${version} 版本一致，不一致的话有些版本的镜像是 pull 不下来的。对应版本的 kubenetes 要使用对应版本的镜像才可以。可以使用下面的脚本在可以自由访问互联网的服务器上将 pull 指定版本的镜像。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># for: use kubeadm pull kubernetes images</span>
<span class="token comment"># date: 2019-08-15</span>
<span class="token comment"># author: muzi502</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-xue</span>
<span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apt-transport-https <span class="token function">curl</span>
<span class="token function">curl</span> <span class="token parameter variable">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> -
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span>/etc/apt/sources.list.d/kubernetes.list</span>
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF</span>
<span class="token function">apt-get</span> update

<span class="token keyword">for</span> <span class="token for-or-select variable">version</span> <span class="token keyword">in</span> <span class="token number">1.17</span>.4
<span class="token keyword">do</span>
    <span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token variable">$&#123;version&#125;</span>-00
    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$&#123;version&#125;</span>/bin
    <span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
    kubeadm config images pull --kubernetes-version<span class="token operator">=</span><span class="token variable">$&#123;version&#125;</span>
    <span class="token function">docker</span> save <span class="token parameter variable">-o</span> <span class="token function">v</span><span class="token variable">$&#123;version&#125;</span>.tar <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> TAG <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
    <span class="token function">gzip</span> <span class="token function">v</span><span class="token variable">$&#123;version&#125;</span>.tar <span class="token function">v</span><span class="token variable">$&#123;version&#125;</span>.tar.gz
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>导入之后的镜像</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># docker load &lt; v1.17.4.tar.gz</span>
fc4976bd934b: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">53</span>.88MB/53.88MB
f6953727aaba: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">42</span>.1MB/42.1MB
Loaded image: k8s.gcr.io/kube-scheduler:v1.17.4
225df95e717c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">336</span>.4kB/336.4kB
7c9b0f448297: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">41</span>.37MB/41.37MB
Loaded image: k8s.gcr.io/coredns:1.6.5
fe9a8b4f1dcc: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">43</span>.87MB/43.87MB
ce04b89b7def: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">224</span>.9MB/224.9MB
1b2bc745b46f: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">21</span>.22MB/21.22MB
Loaded image: k8s.gcr.io/etcd:3.4.3-0
e17133b79956: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">744</span>.4kB/744.4kB
Loaded image: k8s.gcr.io/pause:3.1
682fbb19de80: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">21</span>.06MB/21.06MB
2dc2f2423ad1: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">5</span>.168MB/5.168MB
ad9fb2411669: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">4</span>.608kB/4.608kB
597151d24476: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">8</span>.192kB/8.192kB
0d8d54147a3a: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">8</span>.704kB/8.704kB
960d0ce862e2: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">37</span>.81MB/37.81MB
Loaded image: k8s.gcr.io/kube-proxy:v1.17.4
9daac3fed755: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">118</span>.7MB/118.7MB
Loaded image: k8s.gcr.io/kube-apiserver:v1.17.4
99df54617e88: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">108</span>.6MB/108.6MB
Loaded image: k8s.gcr.io/kube-controller-manager:v1.17.4
╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># docker images</span>
REPOSITORY                           TAG                 CREATED             SIZE
k8s.gcr.io/kube-proxy                v1.17.4             <span class="token number">4</span> weeks ago         116MB
k8s.gcr.io/kube-controller-manager   v1.17.4             <span class="token number">4</span> weeks ago         161MB
k8s.gcr.io/kube-apiserver            v1.17.4             <span class="token number">4</span> weeks ago         171MB
k8s.gcr.io/kube-scheduler            v1.17.4             <span class="token number">4</span> weeks ago         <span class="token number">94</span>.4MB
k8s.gcr.io/coredns                   <span class="token number">1.6</span>.5               <span class="token number">5</span> months ago        <span class="token number">41</span>.6MB
k8s.gcr.io/etcd                      <span class="token number">3.4</span>.3-0             <span class="token number">5</span> months ago        288MB
k8s.gcr.io/pause                     <span class="token number">3.1</span>                 <span class="token number">2</span> years ago         742kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="初始化-master-节点"><a href="#初始化-master-节点" class="headerlink" title="初始化 master 节点"></a>初始化 master 节点</h3><p>使用 kubeadm init 命令初始化 master 节点，关于 kubeadm 的参数可以参考官方文档 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/">kubeadm init</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubeadm init --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 --apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.20</span>.172.211 --kubernetes-version<span class="token operator">=</span><span class="token number">1.17</span>.4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>–pod-network-cidr&#x3D; 指定 Pod 网段的 IP 地址块</li>
<li>–apiserver-advertise-address&#x3D; 指定 api-server 监听的地址</li>
<li>–kubernetes-version&#x3D; 指定 kubernetes 的版本，最好和 kubeadm 版本保持一致</li>
</ul>
<p>正常完成之后的日志输出如下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=10.20.172.211 --kubernetes-version=1.17.4</span>

Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">10.20</span>.172.211:6443 <span class="token parameter variable">--token</span> hi66lb.r13y2hottst2ks6f <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>刚刚安装完之后 coreDNS 的 Pod 会一直出于 pending 状态，而且 Master 的 STATUS 状态也是 <code>NotReady</code> 。遇到这种问题 <code>不要慌,问题不大.jpg</code> 这是因为集群中还没有安装好 CNI 网络插件，等下部署好 flannel 就可以。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl get node</span>
NAME            STATUS     ROLES    AGE     VERSION
k8s-master-01   NotReady   master   9m19s   v1.17.4
╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl get pod --all-namespaces</span>
NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE
kube-system   coredns-6955765f44-t4b6k                <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          49s
kube-system   coredns-6955765f44-vm5tm                <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          49s
kube-system   etcd-k8s-master-01                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s
kube-system   kube-apiserver-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s
kube-system   kube-controller-manager-k8s-master-01   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s
kube-system   kube-proxy-rmgwl                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          49s
kube-system   kube-scheduler-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          62s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="加入-node-节点"><a href="#加入-node-节点" class="headerlink" title="加入 node 节点"></a>加入 node 节点</h2><p>在另一台 Node 节点上重复节点初始化的内容，并将将所需的镜像导入到 node 节点。之后使用 kubeadm joine 命令将 Node 节点加入到集群中即可。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-node-01 /opt/1.17.4
╰─<span class="token comment"># kubeadm join 10.20.172.211:6443 --token hi66lb.r13y2hottst2ks6f \</span>
<span class="token operator">></span>     --discovery-token-ca-cert-hash sha256:9b96a436f2897a8371fccb3af4d8f2fff348fcb42763e005e9175a4e925c51d1
W0415 00:52:08.127829    <span class="token number">9901</span> join.go:346<span class="token punctuation">]</span> <span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
        <span class="token punctuation">[</span>WARNING Hostname<span class="token punctuation">]</span>: <span class="token function">hostname</span> <span class="token string">"k8s-node-01"</span> could not be reached
        <span class="token punctuation">[</span>WARNING Hostname<span class="token punctuation">]</span>: <span class="token function">hostname</span> <span class="token string">"k8s-node-01"</span><span class="token builtin class-name">:</span> lookup k8s-node-01 on <span class="token number">192.168</span>.10.254:53: no such <span class="token function">host</span>
        <span class="token punctuation">[</span>WARNING Service-Kubelet<span class="token punctuation">]</span>: kubelet <span class="token function">service</span> is not enabled, please run <span class="token string">'systemctl enable kubelet.service'</span>
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">'kubectl -n kube-system get cm kubeadm-config -oyaml'</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Downloading configuration <span class="token keyword">for</span> the kubelet from the <span class="token string">"kubelet-config-1.17"</span> ConfigMap <span class="token keyword">in</span> the kube-system namespace
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/config.yaml"</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/kubeadm-flags.env"</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.

This <span class="token function">node</span> has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run <span class="token string">'kubectl get nodes'</span> on the control-plane to see this <span class="token function">node</span> <span class="token function">join</span> the cluster.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果不出意外的话会提示 <code>This node has joined the cluster:</code> ，然后在 master 节点看一下节点是否加入</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl get node</span>
NAME            STATUS     ROLES    AGE   VERSION
k8s-master-01   NotReady   master   31m   v1.17.4
k8s-node-01     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   58s   v1.17.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果状态还是 <code>NotReady</code> 不要慌，问题不大）。接下来安装 CNI 网络插件即可</p>
<h2 id="部署网络插件"><a href="#部署网络插件" class="headerlink" title="部署网络插件"></a>部署网络插件</h2><p>在这我们使用 flannel 作为 Kubernetes 网络解决方案，在 kubeadm init 的时候指定的 –pod-network-cidr&#x3D; 指定 Pod 网段的 IP 地址块，即为 flannel 默认的 IP 段，如果没有修改的话就直接在 master 节点上使用 kubectl apply -f 命令部署即可。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>由于墙国网络原因，访问 <code>raw.githubusercontent.com</code> 这个域名会比较慢，在这里可以使用 jsdelivr 来进行加速。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl apply -f https://cdn.jsdelivr.net/gh/coreos/flannel/Documentation/kube-flannel.yml</span>
podsecuritypolicy.policy/psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
serviceaccount/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds-amd64 created
daemonset.apps/kube-flannel-ds-arm64 created
daemonset.apps/kube-flannel-ds-arm created
daemonset.apps/kube-flannel-ds-ppc64le created
daemonset.apps/kube-flannel-ds-s390x created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flannel 的 docker 镜像是在 <code>quay.io/coreos/flannel</code> 一般情况下没问题能顺利 pull 下来。然后使用 <code>kubectl get pod -n kube-system</code> 命令查看 pod 的状态是不是都在 running 状态。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl get pod -n kube-system</span>
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-6955765f44-g5fwl                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
coredns-6955765f44-g7cls                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
etcd-k8s-master-01                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-apiserver-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-controller-manager-k8s-master-01   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-flannel-ds-amd64-94hfr             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
kube-flannel-ds-amd64-vpdfd             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          23h
kube-proxy-rmgwl                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-proxy-xqcsq                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h
kube-scheduler-k8s-master-01            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          24h

╭─root@k8s-master-01 /opt/1.17.4
╰─<span class="token comment"># kubectl get node</span>
NAME            STATUS   ROLES    AGE   VERSION
k8s-master-01   Ready    master   29h   v1.17.4
k8s-node-01     Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   28h   v1.17.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由此，一个简陋的 kubernetes 集群已经部署完了 😂，文章有点水了~~。对于想要入门和学习 kubernetes 的同学来说 kubeadm 是个好工具。后续会更新一些 kubernetes 内容。</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>最后提一下，文中提到的对于下载 github 上文件，可以通过以下规则进行替换，就可以使用 jsdelivr 来 fuck 一下 GFW ，无痛下载 GitHub 上的文件。这还是从 <a target="_blank" rel="noopener" href="https://chanshiyu.com/#/post/94">JsDelivr 全站托管</a> 学来的骚操作 😂。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">GitHub rul</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh
<span class="token key atrule">jsDelivr url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>规则就是将 <code>github.com</code> 替换为 <code>cdn.jsdelivr.net/gh</code> ，然后去掉 <code>/blob/master</code>，接上 repo 里文件的绝对路径即可。也可以将以下脚本保存为一个可执行脚本文件 &#x2F;usr&#x2F;bin&#x2F;rawg，当使用 rawg <a target="_blank" rel="noopener" href="https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh">https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</a> 就可以直接将 url 进行替换，快速地下载文件。怎么样，很爽吧 😂，对于某些 Linux 机器上没有代理的情况下该方法有效。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># data: 2020-03-31</span>
<span class="token comment"># author: muzi502</span>
<span class="token comment"># for: Fuck GFW and download some raw file form github without proxy using jsDelivr CDN</span>
<span class="token comment"># usage: save the .she to your local such as /usr/bin/rawg, and chmod +x /usr/bin/rawg</span>
<span class="token comment"># use rawg https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh to download</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-xue</span>
<span class="token comment"># GitHub rul: https://github.com/ohmyzsh/ohmyzsh/blob/master/tools/install.sh</span>
<span class="token comment"># jsDelivr url: https://cdn.jsdelivr.net/gh/ohmyzsh/ohmyzsh/tools/install.sh</span>

<span class="token function">wget</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $1 <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/'</span> <span class="token punctuation">\</span>
               <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/github.com/cdn.jsdelivr.net\/gh/'</span> <span class="token punctuation">\</span>
               <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\/master//'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\/blob//'</span> <span class="token variable">)</span></span>

<span class="token comment"># curl $(echo $1 | sed 's/raw.githubusercontent.com/cdn.jsdelivr.net\/gh/' \</span>
<span class="token comment">#                | sed 's/github.com/cdn.jsdelivr.net\/gh/' \</span>
<span class="token comment">#                | sed 's/\/master//' | sed 's/\/blob//' )</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kubeadm/" rel="tag"># kubeadm</a>
              <a href="/tags/kubernetes/" rel="tag"># kubernetes</a>
              <a href="/tags/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0-K8s/" rel="tag"># 从零开始学习 K8s</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/gitlab-ci-harbor.html" rel="prev" title="基于 Gitlab-ci + Harbor 的 CI 流水线">
                  <i class="fa fa-chevron-left"></i> 基于 Gitlab-ci + Harbor 的 CI 流水线
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/interview-wordpress-install.html" rel="next" title="一次有趣的面试：WordPress 部署">
                  一次有趣的面试：WordPress 部署 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">26:14</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
