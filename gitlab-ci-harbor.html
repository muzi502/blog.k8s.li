<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.k8s.li').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
  <meta name="description" content="å¯¹äº CI&#x2F;CDï¼ˆæŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ï¼‰çš„åŸºæœ¬æ¦‚å¿µç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šå¤§ä½¬åœ¨æ™®åŠå•¦ï¼Œå’±æ‰ç–å­¦æµ…æ€•è¯¯äººå­å¼Ÿæ‰€ä»¥å°±å‰½çªƒä¸€ä¸‹åˆ«äººçš„è§£é‡Šå•¦ğŸ˜‚ã€‚ä¸‹é¢å°±å‰½çªƒä¸€ä¸‹çº¢å¸½å­å®¶çš„ CI&#x2F;CDæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç†è§£æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½² å®˜æ–¹æ–‡æ¡£ï¼š CI æŒç»­é›†æˆ  å›¾ç‰‡å‰½çªƒè‡ª  The Product Managersâ€™ Guide to Continuous Delivery and DevOps  CI&#x2F;CD ä¸­çš„â€œ">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿">
<meta property="og:url" content="https://blog.k8s.li/gitlab-ci-harbor.html">
<meta property="og:site_name" content="æœ¨å­">
<meta property="og:description" content="å¯¹äº CI&#x2F;CDï¼ˆæŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ï¼‰çš„åŸºæœ¬æ¦‚å¿µç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šå¤§ä½¬åœ¨æ™®åŠå•¦ï¼Œå’±æ‰ç–å­¦æµ…æ€•è¯¯äººå­å¼Ÿæ‰€ä»¥å°±å‰½çªƒä¸€ä¸‹åˆ«äººçš„è§£é‡Šå•¦ğŸ˜‚ã€‚ä¸‹é¢å°±å‰½çªƒä¸€ä¸‹çº¢å¸½å­å®¶çš„ CI&#x2F;CDæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç†è§£æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½² å®˜æ–¹æ–‡æ¡£ï¼š CI æŒç»­é›†æˆ  å›¾ç‰‡å‰½çªƒè‡ª  The Product Managersâ€™ Guide to Continuous Delivery and DevOps  CI&#x2F;CD ä¸­çš„â€œ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/409-images-for-snap-blog-postedit_image1.png">
<meta property="og:image" content="https://p.k8s.li/409-images-for-snap-blog-postedit_image4-manual.png">
<meta property="og:image" content="https://p.k8s.li/409-images-for-snap-blog-postedit_image4-manual-1585574252795.png">
<meta property="og:image" content="https://p.k8s.li/20200326163733610.png">
<meta property="og:image" content="https://p.k8s.li/20200326170403918.png">
<meta property="og:image" content="https://p.k8s.li/20200326170523433.png">
<meta property="og:image" content="https://p.k8s.li/20200327102511419.png">
<meta property="og:image" content="https://p.k8s.li/20200325163138089.png">
<meta property="og:image" content="https://p.k8s.li/20200325163254316.png">
<meta property="og:image" content="https://p.k8s.li/20200325163400519.png">
<meta property="article:published_time" content="2020-04-11T16:00:00.000Z">
<meta property="article:modified_time" content="2020-04-11T16:00:00.000Z">
<meta property="article:author" content="æœ¨å­">
<meta property="article:tag" content="harbor">
<meta property="article:tag" content="gitlab">
<meta property="article:tag" content="CI&#x2F;CD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/409-images-for-snap-blog-postedit_image1.png">
<link rel="canonical" href="https://blog.k8s.li/gitlab-ci-harbor.html">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
  <title>åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿ | æœ¨å­</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
<link rel="alternate" href="/atom.xml" title="æœ¨å­" type="application/atom+xml">
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">
    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æœ¨å­</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>
  </li>
        <li class="menu-item menu-item-books">
    <a href="/booklist.html" rel="section"><i class="fa fa-fw fa-book"></i>Books</a>
  </li>
        <li class="menu-item menu-item-kindle">
    <a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
  </li>
        <li class="menu-item menu-item-friend">
    <a href="/link/" rel="section"><i class="fa fa-fw fa-link"></i>Friend</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>
  </li>
  </ul>
</nav>
</div>
    </header>
  <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
  <div class="posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/gitlab-ci-harbor.html">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.k8s.li/avatar.png">
      <meta itemprop="name" content="æœ¨å­">
      <meta itemprop="description" content="">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æœ¨å­">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿
        </h2>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-04-12 2020-04-12T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-04-12T00:00:00+08:00">2020-04-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">æŠ€æœ¯</span>
                  </a>
                </span>
            </span>
  <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    <a title="disqus" href="/gitlab-ci-harbor.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="gitlab-ci-harbor.html" itemprop="commentCount"></span>
    </a>
  </span>
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>29k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>48 åˆ†é’Ÿ</span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <p>å¯¹äº CI/CDï¼ˆæŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ï¼‰çš„åŸºæœ¬æ¦‚å¿µç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šå¤§ä½¬åœ¨æ™®åŠå•¦ï¼Œå’±æ‰ç–å­¦æµ…æ€•è¯¯äººå­å¼Ÿæ‰€ä»¥å°±å‰½çªƒä¸€ä¸‹åˆ«äººçš„è§£é‡Šå•¦ğŸ˜‚ã€‚ä¸‹é¢å°±å‰½çªƒä¸€ä¸‹çº¢å¸½å­å®¶çš„ <a href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd" target="_blank" rel="noopener">CI/CDæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç†è§£æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²</a> å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><strong>CI æŒç»­é›†æˆ</strong></p>
<p><img src="https://p.k8s.li/409-images-for-snap-blog-postedit_image1.png" alt=""></p>
<p>å›¾ç‰‡å‰½çªƒè‡ª  <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p>
<blockquote>
<p>CI/CD ä¸­çš„â€œCIâ€å§‹ç»ˆæŒ‡æŒç»­é›†æˆï¼Œå®ƒå±äºå¼€å‘äººå‘˜çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚æˆåŠŸçš„ CI æ„å‘³ç€åº”ç”¨ä»£ç çš„æ–°æ›´æ”¹ä¼šå®šæœŸæ„å»ºã€æµ‹è¯•å¹¶åˆå¹¶åˆ°å…±äº«å­˜å‚¨åº“ä¸­ã€‚è¯¥è§£å†³æ–¹æ¡ˆå¯ä»¥è§£å†³åœ¨ä¸€æ¬¡å¼€å‘ä¸­æœ‰å¤ªå¤šåº”ç”¨åˆ†æ”¯ï¼Œä»è€Œå¯¼è‡´ç›¸äº’å†²çªçš„é—®é¢˜ã€‚</p>
</blockquote>
<p><strong>CD æŒç»­äº¤ä»˜</strong></p>
<p><img src="https://p.k8s.li/409-images-for-snap-blog-postedit_image4-manual.png" alt=""></p>
<p>å›¾ç‰‡å‰½çªƒè‡ª <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p>
<blockquote>
<p>CI/CD ä¸­çš„â€œCDâ€æŒ‡çš„æ˜¯æŒç»­äº¤ä»˜å’Œ/æˆ–æŒç»­éƒ¨ç½²ï¼Œè¿™äº›ç›¸å…³æ¦‚å¿µæœ‰æ—¶ä¼šäº¤å‰ä½¿ç”¨ã€‚ä¸¤è€…éƒ½äº‹å…³ç®¡é“åç»­é˜¶æ®µçš„è‡ªåŠ¨åŒ–ï¼Œä½†å®ƒä»¬æœ‰æ—¶ä¹Ÿä¼šå•ç‹¬ä½¿ç”¨ï¼Œç”¨äºè¯´æ˜è‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚</p>
<p>æŒç»­<em>äº¤ä»˜</em>é€šå¸¸æ˜¯æŒ‡å¼€å‘äººå‘˜å¯¹åº”ç”¨çš„æ›´æ”¹ä¼šè‡ªåŠ¨è¿›è¡Œé”™è¯¯æµ‹è¯•å¹¶ä¸Šä¼ åˆ°å­˜å‚¨åº“ï¼ˆå¦‚ <a href="https://redhatofficial.github.io/#!/main" target="_blank" rel="noopener">GitHub</a> æˆ–å®¹å™¨æ³¨å†Œè¡¨ï¼‰ï¼Œç„¶åç”±è¿ç»´å›¢é˜Ÿå°†å…¶éƒ¨ç½²åˆ°å®æ—¶ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™æ—¨åœ¨è§£å†³å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´å¯è§æ€§åŠæ²Ÿé€šè¾ƒå·®çš„é—®é¢˜ã€‚å› æ­¤ï¼ŒæŒç»­äº¤ä»˜çš„ç›®çš„å°±æ˜¯ç¡®ä¿å°½å¯èƒ½å‡å°‘éƒ¨ç½²æ–°ä»£ç æ—¶æ‰€éœ€çš„å·¥ä½œé‡ã€‚</p>
</blockquote>
<p><strong>æŒç»­éƒ¨ç½²</strong></p>
<p><img src="https://p.k8s.li/409-images-for-snap-blog-postedit_image4-manual-1585574252795.png" alt=""></p>
<p>å›¾ç‰‡å‰½çªƒè‡ª  <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps</a></p>
<blockquote>
<p>æŒç»­<em>éƒ¨ç½²</em>ï¼ˆå¦ä¸€ç§â€œCDâ€ï¼‰æŒ‡çš„æ˜¯è‡ªåŠ¨å°†å¼€å‘äººå‘˜çš„æ›´æ”¹ä»å­˜å‚¨åº“å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä»¥ä¾›å®¢æˆ·ä½¿ç”¨ã€‚å®ƒä¸»è¦ä¸ºäº†è§£å†³å› æ‰‹åŠ¨æµç¨‹é™ä½åº”ç”¨äº¤ä»˜é€Ÿåº¦ï¼Œä»è€Œä½¿è¿ç»´å›¢é˜Ÿè¶…è´Ÿè·çš„é—®é¢˜ã€‚æŒç»­éƒ¨ç½²ä»¥æŒç»­äº¤ä»˜çš„ä¼˜åŠ¿ä¸ºæ ¹åŸºï¼Œå®ç°äº†ç®¡é“åç»­é˜¶æ®µçš„è‡ªåŠ¨åŒ–ã€‚</p>
</blockquote>
<p>æ€»ä¹‹è€Œè¨€  CI/CD æ˜¯ä¸€æ•´å¥—è½¯ä»¶å¼€å‘çš„æµæ°´çº¿ï¼Œå¼€å‘äººå‘˜æäº¤å®Œæ›´æ–°çš„ä»£ç ä¹‹åï¼Œæ ¹æ®æµæ°´çº¿çš„è§¦å‘æƒ…å†µæ¥æ‰§è¡Œè‡ªå®šä¹‰çš„æµæ°´çº¿ä»»åŠ¡ï¼Œæ¯”å¦‚ä»£ç è´¨é‡æ£€æµ‹ã€æ„å»º docker é•œåƒä¸ºäº¤ä»˜äº§å“ã€è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚è¿™äº›éœ€è¦ä¸€ç³»åˆ—ç›¸å…³çš„è½¯ä»¶æ¥æ„å»ºè¿™å¥— CI/CD çš„ç³»ç»Ÿï¼Œæœ¬æ–‡å°±é€šè¿‡ Gitlab + gitlab-ci + Harbor æ„å»ºä¸€ä¸ªç®€é™‹çš„ CI/CD æµæ°´çº¿ã€‚</p>
<p>å¦å¤–æ¨èè¯»ä¸€ä¸‹è¿™ç¯‡ <a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="noopener">The Product Managersâ€™ Guide to Continuous Delivery and DevOps </a></p>
<h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><p>ç›®å‰ Gitlab å®˜æ–¹ç»™å‡ºçš„å®‰è£…æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ™®éé‡‡ç”¨ Omnibus åŒ…ã€Docker å®‰è£…ã€‚ä¹Ÿå¯ä»¥ç”¨å®˜æ–¹çš„ helm Chart éƒ¨ç½²åœ¨ Kubernenets é›†ç¾¤ä¸­ï¼Œç„¶åä½¿ç”¨ç½‘ç»œå­˜å‚¨ï¼Œæ¯”å¦‚ Glusterã€NFSã€Cephã€vSAN ç­‰è¿›è¡Œ PG æ•°æ®åº“å’Œä»£ç ä»“åº“æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
<p><strong>å®˜æ–¹å»ºè®®é‡‡ç”¨ Omnibus æ–¹å¼å®‰è£…ï¼š</strong></p>
<blockquote>
<p>æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ Omnibus åŒ…å®‰è£… GitLab ï¼Œå› ä¸ºå®ƒå®‰è£…èµ·æ¥æ›´å¿«ã€æ›´å®¹æ˜“å‡çº§ç‰ˆæœ¬ï¼Œè€Œä¸”åŒ…å«äº†å…¶ä»–å®‰è£…æ–¹å¼æ‰€æ²¡æœ‰çš„å¯é æ€§åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 id="Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"><a href="#Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ" class="headerlink" title="Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"></a>Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ</h3><p>æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£</p>
<ul>
<li>âœ… - Installed by default</li>
<li>âš™ - Requires additional configuration, or GitLab Managed Apps</li>
<li>â¤“ - Manual installation required</li>
<li>âŒ - Not supported or no instructions available</li>
<li>N/A - Not applicable</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Component</th>
<th align="left">Description</th>
<th align="center"><a href="https://docs.gitlab.com/omnibus/" target="_blank" rel="noopener">Omnibus GitLab</a></th>
<th align="center"><a href="https://docs.gitlab.com/charts/" target="_blank" rel="noopener">GitLab chart</a></th>
<th align="center"><a href="https://gitlab.com/" target="_blank" rel="noopener">GitLab.com</a></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#nginx" target="_blank" rel="noopener">NGINX</a></td>
<td align="left">Routes requests to appropriate components, terminates SSL</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/nginx/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#unicorn" target="_blank" rel="noopener">Unicorn (GitLab Rails)</a></td>
<td align="left">Handles requests for the web interface and API</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/unicorn.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/unicorn/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#unicorn" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sidekiq" target="_blank" rel="noopener">Sidekiq</a></td>
<td align="left">Background jobs processor</td>
<td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/sidekiq/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#sidekiq" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitaly" target="_blank" rel="noopener">Gitaly</a></td>
<td align="left">Git RPC service for handling all Git calls made by GitLab</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/gitaly/index.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitaly/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#praefect" target="_blank" rel="noopener">Praefect</a></td>
<td align="left">A transparent proxy between any Git client and Gitaly storage nodes.</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/gitaly/index.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitaly/" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-workhorse" target="_blank" rel="noopener">GitLab Workhorse</a></td>
<td align="left">Smart reverse proxy, handles large HTTP requests</td>
<td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/unicorn/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-shell" target="_blank" rel="noopener">GitLab Shell</a></td>
<td align="left">Handles <code>git</code> over SSH sessions</td>
<td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitlab-shell/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-pages" target="_blank" rel="noopener">GitLab Pages</a></td>
<td align="left">Hosts static websites</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/pages/index.html" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/37" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#gitlab-pages" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#registry" target="_blank" rel="noopener">Registry</a></td>
<td align="left">Container registry, allows pushing and pulling of images</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/packages/container_registry.html#container-registry-domain-configuration" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/registry/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/packages/container_registry/index.html#build-and-push-images-using-gitlab-cicd" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#redis" target="_blank" rel="noopener">Redis</a></td>
<td align="left">Caching service</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/redis.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/redis.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#service-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#postgresql" target="_blank" rel="noopener">PostgreSQL</a></td>
<td align="left">Database</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/database.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://github.com/helm/charts/tree/master/stable/postgresql" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#postgresql" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#pgbouncer" target="_blank" rel="noopener">PgBouncer</a></td>
<td align="left">Database connection pooling, failover</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/high_availability/pgbouncer.html" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#database-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#consul" target="_blank" rel="noopener">Consul</a></td>
<td align="left">Database node discovery, failover</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/high_availability/consul.html" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#consul" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#prometheus" target="_blank" rel="noopener">GitLab self-monitoring: Prometheus</a></td>
<td align="left">Time-series database, metrics collection, and query service</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/index.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#prometheus" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#alertmanager" target="_blank" rel="noopener">GitLab self-monitoring: Alertmanager</a></td>
<td align="left">Deduplicates, groups, and routes alerts from Prometheus</td>
<td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://github.com/helm/charts/tree/master/stable/prometheus" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#grafana" target="_blank" rel="noopener">GitLab self-monitoring: Grafana</a></td>
<td align="left">Metrics dashboard</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/performance/grafana_configuration.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://github.com/helm/charts/tree/master/stable/grafana" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://dashboards.gitlab.com/d/RZmbBr7mk/gitlab-triage?refresh=30s" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sentry" target="_blank" rel="noopener">GitLab self-monitoring: Sentry</a></td>
<td align="left">Track errors generated by the GitLab instance</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/configuration.html#error-reporting-and-logging-with-sentry" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1319" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/support/workflows/500_errors.html#searching-sentry" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#jaeger" target="_blank" rel="noopener">GitLab self-monitoring: Jaeger</a></td>
<td align="left">View traces generated by the GitLab instance</td>
<td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4104" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1320" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4104" target="_blank" rel="noopener">âŒ</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#redis-exporter" target="_blank" rel="noopener">Redis Exporter</a></td>
<td align="left">Prometheus endpoint with Redis metrics</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/redis_exporter.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/redis/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#postgresql-exporter" target="_blank" rel="noopener">PostgreSQL Exporter</a></td>
<td align="left">Prometheus endpoint with PostgreSQL metrics</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/postgres_exporter.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://github.com/helm/charts/tree/master/stable/postgresql" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#pgbouncer-exporter" target="_blank" rel="noopener">PgBouncer Exporter</a></td>
<td align="left">Prometheus endpoint with PgBouncer metrics</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/pgbouncer_exporter.html" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/installation/deployment.html#postgresql" target="_blank" rel="noopener">âŒ</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-exporter" target="_blank" rel="noopener">GitLab Exporter</a></td>
<td align="left">Generates a variety of GitLab metrics</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/gitlab_exporter.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/gitlab-exporter/index.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#node-exporter" target="_blank" rel="noopener">Node Exporter</a></td>
<td align="left">Prometheus endpoint with system metrics</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/monitoring/prometheus/node_exporter.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/1332" target="_blank" rel="noopener">N/A</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/monitoring/" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#mattermost" target="_blank" rel="noopener">Mattermost</a></td>
<td align="left">Open-source Slack alternative</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/gitlab-mattermost/" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://docs.mattermost.com/install/install-mmte-helm-gitlab-helm.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/integrations/mattermost.html" target="_blank" rel="noopener">â¤“</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#minio" target="_blank" rel="noopener">MinIO</a></td>
<td align="left">Object storage service</td>
<td align="center"><a href="https://min.io/download" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/minio/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#storage-architecture" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-runner" target="_blank" rel="noopener">Runner</a></td>
<td align="left">Executes GitLab CI/CD jobs</td>
<td align="center"><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/runner/install/kubernetes.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#shared-runners" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#database-migrations" target="_blank" rel="noopener">Database Migrations</a></td>
<td align="left">Database migrations</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/database.html#disabling-automatic-database-migration" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/gitlab/migrations/" target="_blank" rel="noopener">âœ…</a></td>
<td align="center">âœ…</td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#certificate-management" target="_blank" rel="noopener">Certificate Management</a></td>
<td align="left">TLS Settings, Letâ€™s Encrypt</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/ssl.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/installation/tls.html" target="_blank" rel="noopener">âœ…</a></td>
<td align="center"><a href="https://about.gitlab.com/handbook/engineering/infrastructure/production/architecture/#secrets-management" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-geo" target="_blank" rel="noopener">GitLab Geo Node</a></td>
<td align="left">Geographically distributed GitLab nodes</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/geo/replication/index.html#setup-instructions" target="_blank" rel="noopener">âš™</a></td>
<td align="center"><a href="https://gitlab.com/gitlab-org/charts/gitlab/issues/8" target="_blank" rel="noopener">âŒ</a></td>
<td align="center">âœ…</td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#ldap-authentication" target="_blank" rel="noopener">LDAP Authentication</a></td>
<td align="left">Authenticate users against centralized LDAP directory</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/auth/ldap.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/charts/globals.html#ldap" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://about.gitlab.com/pricing/#gitlab-com" target="_blank" rel="noopener">âŒ</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#outbound-email" target="_blank" rel="noopener">Outbound email (SMTP)</a></td>
<td align="left">Send email messages to users</td>
<td align="center"><a href="https://docs.gitlab.com/omnibus/settings/smtp.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/installation/command-line-options.html#outgoing-email-configuration" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#mail-configuration" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#inbound-email" target="_blank" rel="noopener">Inbound email (SMTP)</a></td>
<td align="left">Receive messages to update issues</td>
<td align="center"><a href="https://docs.gitlab.com/ee/administration/incoming_email.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/charts/installation/command-line-options.html#incoming-email-configuration" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/gitlab_com/index.html#mail-configuration" target="_blank" rel="noopener">âœ…</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#elasticsearch" target="_blank" rel="noopener">Elasticsearch</a></td>
<td align="left">Improved search within GitLab</td>
<td align="center"><a href="https://docs.gitlab.com/ee/integration/elasticsearch.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/integration/elasticsearch.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://gitlab.com/groups/gitlab-org/-/epics/153" target="_blank" rel="noopener">âŒ</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#sentry" target="_blank" rel="noopener">Sentry integration</a></td>
<td align="left">Error tracking for deployed apps</td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/error_tracking.html" target="_blank" rel="noopener">â¤“</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#jaeger" target="_blank" rel="noopener">Jaeger integration</a></td>
<td align="left">Distributed tracing for deployed apps</td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/operations/tracing.html" target="_blank" rel="noopener">â¤“</a></td>
</tr>
<tr>
<td align="left"><a href="https://docs.gitlab.com/ee/development/architecture.html#gitlab-managed-apps" target="_blank" rel="noopener">GitLab Managed Apps</a></td>
<td align="left">Deploy <a href="https://helm.sh/docs/" target="_blank" rel="noopener">Helm</a>, <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">Ingress</a>, <a href="https://docs.cert-manager.io/en/latest/" target="_blank" rel="noopener">Cert-Manager</a>, <a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener">Prometheus</a>, a <a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">Runner</a>, <a href="https://jupyter.org/" target="_blank" rel="noopener">JupyterHub</a>, <a href="https://cloud.google.com/knative/" target="_blank" rel="noopener">Knative</a> to a cluster</td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td>
<td align="center"><a href="https://docs.gitlab.com/ee/user/project/clusters/index.html#installing-applications" target="_blank" rel="noopener">â¤“</a></td>
</tr>
</tbody></table>
<h2 id="å®‰è£…-Gitlab"><a href="#å®‰è£…-Gitlab" class="headerlink" title="å®‰è£… Gitlab"></a>å®‰è£… Gitlab</h2><p>å’±éµä»å®˜æ–¹çš„å»ºè®®ï¼Œä½¿ç”¨ Omnibus åŒ…çš„æ–¹å¼æ¥éƒ¨ç½² Gitlab å®ä¾‹ã€‚</p>
<h3 id="Ubuntu-1804"><a href="#Ubuntu-1804" class="headerlink" title="Ubuntu 1804"></a>Ubuntu 1804</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ¸…åå¤§å­¦çš„é•œåƒç«™æº bionicæ˜¯ Ubuntu18.04 xenialæ˜¯16.04ï¼Œæ ¹æ®è‡ªå·±çš„ Ubuntu å‘è¡Œç‰ˆæœ¬ä¿®æ”¹ä¸€ä¸‹ä¸‹</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu bionic main</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gitlab-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ deb åŒ…ä¸‹è½½ä¸‹æ¥</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/bionic/main/g/gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br><span class="line"></span><br><span class="line">opkg -i gitlab-ce/gitlab-ce_12.3.5-ce.0_amd64.deb</span><br></pre></td></tr></table></figure>
<h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™</span></span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ¸…åå¤§å­¦é•œåƒç«™çš„æºï¼Œä¸‹è½½é€Ÿåº¦ä¼šå¿«äº›ã€‚</span></span><br><span class="line">sudo cat &gt; /etc/yum.repos.d/gitlab-ce.repo &lt;&lt;EOF</span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">Ece</span><br><span class="line"></span><br><span class="line">sudo yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬neng'b</span></span><br><span class="line">yum list gitlab-ce --showduplicates</span><br><span class="line"><span class="comment"># ç„¶åå®‰è£…æœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class="line">yum install -y gitlab-ce</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ 12.3.5</span></span><br><span class="line">yum install gitlab-ce-12.3.5-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ rpm åŒ…ä¸‹è½½ä¸‹æ¥å®‰è£…</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br><span class="line">yum install gitlab-ce-12.8.2-ce.0.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>å®‰è£…æˆåŠŸä¹‹åä¼šå‡ºç° Gitlab çš„ Logo</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">       *.                  *.</span><br><span class="line">      ***                 ***</span><br><span class="line">     *****               *****</span><br><span class="line">    .******             *******</span><br><span class="line">    ********            ********</span><br><span class="line">   ,,,,,,,,,***********,,,,,,,,,</span><br><span class="line">  ,,,,,,,,,,,*********,,,,,,,,,,,</span><br><span class="line">  .,,,,,,,,,,,*******,,,,,,,,,,,,</span><br><span class="line">      ,,,,,,,,,*****,,,,,,,,,.</span><br><span class="line">         ,,,,,,,****,,,,,,</span><br><span class="line">            .,,,***,,,,</span><br><span class="line">                ,*,.</span><br><span class="line"></span><br><span class="line">     _______ __  __          __</span><br><span class="line">    / ____(_) /_/ /   ____ _/ /_</span><br><span class="line">   / / __/ / __/ /   / __ `/ __ \</span><br><span class="line">  / /_/ / / /_/ /___/ /_/ / /_/ /</span><br><span class="line">  \____/_/\__/_____/\__,_/_.___/</span><br><span class="line"></span><br><span class="line">Thank you for installing GitLab!</span><br><span class="line">GitLab was unable to detect a valid hostname for your instance.</span><br><span class="line">Please configure a URL for your GitLab instance by setting `external_url`</span><br><span class="line">configuration in /etc/gitlab/gitlab.rb file.</span><br><span class="line">Then, you can start your GitLab instance by running the following command:</span><br><span class="line">  sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<h3 id="2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"><a href="#2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸" class="headerlink" title="2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"></a>2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line"><span class="built_in">cd</span> gitlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">gitlab_version=$(cat /opt/gitlab/embedded/service/gitlab-rails/VERSION)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬è¡¥ä¸æ–‡ä»¶</span></span><br><span class="line">git diff v<span class="variable">$&#123;gitlab_version&#125;</span> v<span class="variable">$&#123;gitlab_version&#125;</span>-zh &gt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“è¡¥ä¸çš„æ—¶å€™ä¼šæç¤ºä¸€äº›è¡¥ä¸æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šè¦è·³è¿‡è¿™äº›æ–‡ä»¶ï¼Œä¸ç„¶åé¢reconfigçš„æ—¶å€™ä¼šæŠ¥é”™çš„ã€‚</span></span><br><span class="line">patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; <span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br></pre></td></tr></table></figure>
<h3 id="3-ä¿®æ”¹é»˜è®¤é…ç½®"><a href="#3-ä¿®æ”¹é»˜è®¤é…ç½®" class="headerlink" title="3. ä¿®æ”¹é»˜è®¤é…ç½®"></a>3. ä¿®æ”¹é»˜è®¤é…ç½®</h3><p>ä¿®æ”¹ gitlab çš„é…ç½®æ–‡ä»¶ <code>/etc/gitlab/gitlab.rb</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„åŸŸåæˆ–è€… IPï¼Œæ˜¯å•å¼•å·ï¼Œè€Œä¸”å‰é¢çš„ http ä¸è¦æ”¹</span></span><br><span class="line">external_url  'http://gitlab.domain'</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‚®ä»¶é…ç½®ï¼Œæ²¡æœ‰é‚®ä»¶æœåŠ¡å™¨å¯ä»¥å…³é—­é‚®ä»¶æœåŠ¡åŠŸèƒ½</span></span><br><span class="line">gitlab_rails['smtp_enable'] = false</span><br><span class="line">gitlab_rails['smtp_address'] = ""</span><br><span class="line">gitlab_rails['smtp_port'] =  587</span><br><span class="line">gitlab_rails['smtp_user_name'] = ""</span><br><span class="line">gitlab_rails['smtp_password'] = ""</span><br><span class="line">gitlab_rails['smtp_authentication'] = ""</span><br><span class="line">gitlab_rails['smtp_enable_starttls_auto'] =</span><br><span class="line">gitlab_rails['smtp_tls'] =</span><br><span class="line">gitlab_rails['gitlab_email_from'] = ''</span><br></pre></td></tr></table></figure>
<h3 id="4-åˆå§‹åŒ–è®¾ç½®"><a href="#4-åˆå§‹åŒ–è®¾ç½®" class="headerlink" title="4. åˆå§‹åŒ–è®¾ç½®"></a>4. åˆå§‹åŒ–è®¾ç½®</h3><p>ä¿®æ”¹å®Œæˆé…ç½®ä¹‹åä½¿ç”¨ <code>gitlab-ctl reconfigure</code> é‡æ–°æ›´æ–°ä¸€ä¸‹ gitlab æœåŠ¡çš„é…ç½®ï¼Œæ›´æ–°å®Œæˆé…ç½®ä¹‹åä½¿ç”¨<br><code>gitlab-ctl restart</code> æ¥é‡æ–°å¯åŠ¨ gitlab ã€‚å¦‚æœ reconfigure å¤±è´¥ï¼Œåˆ™éœ€è¦ <code>systemctl enable gitlab- runsvdir &amp;&amp; systemctl restart gitlab- runsvdir</code> é‡å¯ä¸€ä¸‹  <code>gitlab-runsvdir</code> æœåŠ¡ã€‚</p>
<p>æ‰“å¼€æµè§ˆå™¨è¿›è¡Œåˆå§‹åŒ–è´¦æˆ·è®¾å®šå¯†ç ï¼Œè¿™ä¸ªå¯†ç ä¸º root ç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ã€‚è®¾ç½®å®Œå¯†ç ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚username ä¸º <code>root</code> å¯†ç ä¸ºåˆšåˆšè®¾ç½®çš„å¯†ç ã€‚</p>
<h2 id="å®‰è£…-gitlab-runner"><a href="#å®‰è£…-gitlab-runner" class="headerlink" title="å®‰è£… gitlab-runner"></a>å®‰è£… gitlab-runner</h2><h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h3><p>é¦–å…ˆä¿¡ä»» GitLab çš„ GPG å…¬é’¥:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/gpg.key 2&gt; /dev/null | sudo apt-key add - &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure>
<p>å†é€‰æ‹©ä½ çš„ Debian/Ubuntu ç‰ˆæœ¬ï¼Œæ–‡æœ¬æ¡†ä¸­å†…å®¹å†™è¿› <code>/etc/apt/sources.list.d/gitlab-runner.list</code></p>
<h4 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h4><p>æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆä»£å·ä¿®æ”¹ä¸€ä¸‹ <code>stretch</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/debian stretch main</span><br></pre></td></tr></table></figure>
<h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><p>æ ¹æ®è‡ªå·±çš„å‘è¡Œç‰ˆä»£å·ä¿®æ”¹ä¸€ä¸‹ <code>bionic</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/ubuntu bionic main</span><br></pre></td></tr></table></figure>
<p>é…ç½®å¥½ deb æºä¹‹åå†æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt uodate</span><br><span class="line">apt install gitlab-runner -y</span><br></pre></td></tr></table></figure>
<h3 id="CentOS7-1"><a href="#CentOS7-1" class="headerlink" title="CentOS7"></a>CentOS7</h3><p>æ–°å»º <code>/etc/yum.repos.d/gitlab-runner.repo</code>ï¼Œå†…å®¹ä¸º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-runner]</span><br><span class="line">name=gitlab-runner</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br></pre></td></tr></table></figure>
<p>å†æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum makecache</span><br><span class="line">sudo yum install gitlab-runner -y</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ å…¶ä¸­ 12.3.5 å³ä¸ºæŒ‡å®šçš„ç‰ˆæœ¬å·</span></span><br><span class="line">yum install gitlab-runner-12.3.5-1.x86_64 -y</span><br></pre></td></tr></table></figure>
<h3 id="æ³¨å†Œ-gitlab-runner"><a href="#æ³¨å†Œ-gitlab-runner" class="headerlink" title="æ³¨å†Œ gitlab-runner"></a>æ³¨å†Œ gitlab-runner</h3><p>ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒã€‚åœ¨ <code>æ¦‚è§ˆ</code> â€“&gt; <code>Runner</code> ã€‚åœ¨å³ä¸Šè§’ä¼šæœ‰ä»¥ä¸‹ï¼Œç¨åä¼šç”¨åˆ°ã€‚</p>
<ul>
<li>åœ¨ Runner è®¾ç½®æ—¶æŒ‡å®šä»¥ä¸‹ URL</li>
<li>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹æ³¨å†Œä»¤ç‰Œï¼š</li>
</ul>
<p>å®‰è£…å¥½ gitlab-runner ä¹‹åå¦‚æœç›´æ¥å‘ gitlab æ³¨å†Œåˆ™ä¼šæç¤ºå¤±è´¥ï¼Œæç¤º <code>ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</code> ã€‚è¿™æ˜¯å› ä¸º Gitlab é»˜è®¤ç¦æ­¢äº†ç§æœ‰ç½‘æ®µ IP é‡Œçš„ API è¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯æ‰è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform   arch=amd64 os=linux pid=6818 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">qRGh2M86iTasjBn1dU8L</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[gitlab]: runner-centos</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">ERROR: Registering runner... failed   runner=qRGh2M86 status=500 Internal Server Error</span><br><span class="line">PANIC: Failed to register this runner. Perhaps you are having network problems</span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®"><a href="#ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®" class="headerlink" title="ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®"></a>ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®</h3><p>ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒ http://${ip}/admin ã€‚ç®¡ç†ä¸­å¿ƒ â€“&gt; è®¾ç½® â€“&gt; ç½‘ç»œ â€“&gt; å¤–å‘è¯·æ±‚ â€“&gt; å…è®¸æ¥è‡ªé’©å­å’ŒæœåŠ¡çš„å¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚ã€‚ä»¥ä¸‹é€‰é¡¹å…¨éƒ¨å…è®¸ï¼Œæ‰èƒ½é€šè¿‡å¤–éƒ¨è¯·æ±‚çš„æ–¹å¼æ³¨å†Œ gitlab-runnerã€‚</p>
<ul>
<li>Allow requests to the local network from web hooks and services</li>
<li>Allow requests to the local network from system hooks</li>
</ul>
<p><strong>ä¸ºäº†å®‰å…¨èµ·è§</strong>ï¼Œä¹Ÿå¯ä»¥åœ¨ Whitelist to allow requests to the local network from hooks and services ä¸‹æ–¹çš„é‚£ä¸ªæ¡†æ¡†é‡Œæ·»åŠ ä¸Šç™½åå•ï¼Œå…è®¸æˆæƒçš„ IP ã€‚ä¿®æ”¹å¥½ä¹‹åä¸è¦å¿˜è®°ç‚¹å‡»åº•éƒ¨é‚£ä¸ªç»¿è‰²æŒ‰é’® <code>ä¿å­˜ä¿®æ”¹</code> ã€‚</p>
<h4 id="500-é”™è¯¯"><a href="#500-é”™è¯¯" class="headerlink" title="500 é”™è¯¯"></a>500 é”™è¯¯</h4><p>å¦‚æœç‚¹å‡» <code>ä¿å­˜ä¿®æ”¹</code> ä¹‹åå°±è·³è½¬åˆ° Gitlab 500 é”™è¯¯çš„é¡µé¢ã€‚å°è¯•åœ¨ç®¡ç†ä¸­å¿ƒä¿®æ”¹å…¶ä»–è®¾ç½®ä¿å­˜æ—¶ï¼Œä¹Ÿä¼šå‡ºç° 500 çš„æƒ…å†µã€‚åœ¨å®‰è£… gitlab çš„æœºå™¨ä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ã€‚è¿è¡Œ <code>gitlab-ctl tail</code> æŸ¥çœ‹å®æ—¶çš„æ—¥å¿—ã€‚æ­¤æ—¶ç­‰åˆ°æ—¥å¿—è¾“å‡ºå‡æ…¢çš„æ—¶å€™æˆ‘ä»¬å¤šæŒ‰å‡ ä¸‹å›è½¦ï¼Œç„¶åå°±ç«‹å³å»ç‚¹å‡»<code>ä¿å­˜ä¿®æ”¹</code>  æŒ‰é’®ï¼Œè¿™æ ·å°±èƒ½æ•æ‰åˆ°æ­¤åˆ»çš„é”™è¯¯æ—¥å¿—ã€‚</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /<span class="keyword">var</span>/log/gitlab/gitlab-rails/production<span class="variable">.log</span> &lt;==</span><br><span class="line">Started PATCH <span class="string">"/admin/application_settings/network"</span> <span class="keyword">for</span> <span class="number">10</span><span class="variable">.0</span><span class="variable">.30</span><span class="variable">.2</span> at <span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> <span class="number">11</span>:<span class="number">08</span>:<span class="number">20</span> +<span class="number">0000</span></span><br><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br><span class="line">lib/gitlab/crypto_helper<span class="variable">.rb</span>:<span class="number">27</span>:in <span class="meta">`aes256_gcm_decrypt'</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­é”™è¯¯çš„è¾“å‡ºæ˜¯åœ¨ <code>OpenSSL::Cipher::CipherError ():</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Processing by Admin::ApplicationSettingsController#network as HTML</span><br><span class="line">  Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>, <span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed <span class="number">500</span> Internal Server Error in <span class="number">40</span>ms (ActiveRecord: <span class="number">14</span><span class="variable">.5ms</span> | Elasticsearch: <span class="number">0</span><span class="variable">.0ms</span>)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°ç½‘ä¸Šè¯´æ˜¯ç”±äºè¿ç§»å¯¼å…¥é¡¹ç›®åï¼Œæ²¡æœ‰å¯¼å…¥åŸæ¥çš„åŠ å¯†ä¿¡æ¯<code>/etc/gitlab/gitlab-secrets.json</code>ï¼Œ ä½†æ˜¯åŸæ¥çš„åŠ å¯†ä¿¡æ¯æ–‡ä»¶æˆ‘å·²ç»æ‰¾ä¸åˆ°äº†ï¼Œåé¢å‘ç°å¯ä»¥ç›´æ¥é‡ç½®å°±è¡Œäº†</p>
<p>å‚è€ƒ <a href="https://hihozhou.com/blog/2019/08/01/gitlab-500.html" target="_blank" rel="noopener">è‡ªæ­gitlabæŠ¥500é”™è¯¯</a></p>
</blockquote>
<p>å‘½ä»¤è¡Œè¾“å…¥<code>gitlab-rails console</code>ï¼Œç„¶åè¾“å…¥</p>
<p><code>ApplicationSetting.current.reset_runners_registration_token!</code>å³å¯ï¼Œè¿™æ ·åœ¨ä¿å­˜ä¿®æ”¹çš„æ—¶å€™å°±ä¸ä¼šå†æŠ¥ 500 çš„é—®é¢˜äº†ã€‚åº”è¯¥æ˜¯é‡æ–°å®‰è£… Gitlab ä¹‹åçš„åŠ å¯†ä¿¡æ¯ä¸å¯¹æ‰€è‡´ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-rails console</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> GitLab:       12.3.5 (2417d5becc7)</span><br><span class="line"> GitLab Shell: 10.0.0</span><br><span class="line"> PostgreSQL:   10.9</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 5.2.3)</span><br><span class="line">irb(main):001:0&gt; ApplicationSetting.current.reset_runners_registration_token!</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):002:0&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h3 id="åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner"><a href="#åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner" class="headerlink" title="åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner"></a>åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner</h3><p>ä»¥ä¸Šå·²ç»å®‰è£…å¥½å¹¶ä¿®æ”¹é»˜è®¤çš„ç½‘ç»œè®¾ç½®å…è®¸ runner æ‰€åœ¨çš„ IP å‘ gitlab å‘èµ·å¤–éƒ¨è¯·æ±‚ã€‚è¿è¡Œ <code>gitlab-runner register</code> æ ¹æ®ç›¸åº”çš„æç¤ºè¾“å…¥ <code>URL</code> å’Œ <code>token</code> å³å¯ã€‚æœ€åæ ¹æ®æœºå™¨çš„ç±»å‹é€‰æ‹©å¥½ runner çš„ç±»å‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯è·‘ CI ä»»åŠ¡æ—¶çš„ç¯å¢ƒï¼Œåˆ°æ—¶å€™å¯ä»¥åœ¨é¡¹ç›®çš„è®¾ç½®ä¸­é€‰æ‹©å¯åŠ¨ç›¸åº”çš„ runner ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@runner ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-runner register</span></span><br><span class="line">Runtime platform   arch=amd64 os=linux pid=7501 revision=1b659122 version=12.8.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://10.10.107.216/</span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">4hjjA7meRGuxEm3LyMjq</span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[runner]:</span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">centos</span><br><span class="line">Registering runner... succeeded                     runner=4hjjA7me</span><br><span class="line">Please enter the executor: shell, ssh, virtualbox, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, docker+machine, custom:</span><br><span class="line">[shell]: shell</span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">'s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æç¤ºæˆåŠŸä¹‹åç„¶ååœ¨ <code>ç®¡ç†ä¸­å¿ƒ</code>â€“&gt; <code>æ¦‚è§ˆ</code> â€“&gt; <code>Runner</code> å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„ Runner äº†ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ <code>/etc/gitlab-runner/config.toml</code> æ¥æ³¨å†Œç›¸åº”ç±»å‹çš„  Runner</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">concurrent</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">check_interval</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[session_server]</span></span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  name = "runner"</span><br><span class="line">  url = "http://10.10.107.216/"</span><br><span class="line">  token = "ZTSAQ3q6x_upW9toyKTY"</span><br><span class="line">  executor = "shell"</span><br><span class="line">  <span class="section">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="section">[runners.cache]</span></span><br><span class="line">    <span class="section">[runners.cache.s3]</span></span><br><span class="line">    <span class="section">[runners.cache.gcs]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[runners]]</span></span><br><span class="line">  name = "docker-runner"</span><br><span class="line">  url = "http://10.10.107.216/"</span><br><span class="line">  token = "Cf1cy6yx4Y-bGjVnRf8m"</span><br><span class="line">  executor = "docker"</span><br><span class="line">  <span class="section">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="section">[runners.cache]</span></span><br><span class="line">    <span class="section">[runners.cache.s3]</span></span><br><span class="line">    <span class="section">[runners.cache.gcs]</span></span><br><span class="line">  <span class="section">[runners.docker]</span></span><br><span class="line">  <span class="comment"># åœ¨è¿™é‡Œéœ€è¦æ·»åŠ ä¸Š harbor çš„åœ°å€ï¼Œæ‰èƒ½å…è®¸ pull ç§æœ‰ registry çš„é•œåƒ</span></span><br><span class="line">    allowed_images = ["10.10.107.217/*:*"]</span><br><span class="line">    tls_verify = false</span><br><span class="line">    image = "golang:latest"</span><br><span class="line">    privileged = true</span><br><span class="line">    disable_entrypoint_overwrite = false</span><br><span class="line">    oom_kill_disable = false</span><br><span class="line">    disable_cache = false</span><br><span class="line">    volumes = ["/cache"]</span><br><span class="line">    shm_size = 0</span><br></pre></td></tr></table></figure>
<h2 id="éƒ¨ç½²-Harbor"><a href="#éƒ¨ç½²-Harbor" class="headerlink" title="éƒ¨ç½² Harbor"></a>éƒ¨ç½² Harbor</h2><ul>
<li>åœ¨ harbor é¡¹ç›®çš„ release é¡µé¢ä¸‹è½½ç¦»çº¿å®‰è£…åŒ… <a href="https://github.com/goharbor/harbor/releases/download/v1.9.4/harbor-offline-installer-v1.9.4.tgz" target="_blank" rel="noopener">harbor-offline-installer-v1.9.4.tgz</a> åˆ°éƒ¨ç½²çš„æœºå™¨ä¸Šã€‚éƒ¨ç½²ä¹‹å‰éœ€è¦å®‰è£…å¥½ <code>docker</code> å’Œ <code>docker-compose</code> ã€‚ä¹‹åå†ä¿®æ”¹ <code>harbor.yml</code> é…ç½®æ–‡ä»¶ä¸­çš„ä»¥ä¸‹å†…å®¹ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostname éœ€è¦ä¿®æ”¹ä¸ºç›¸åº”çš„åŸŸåæˆ–è€… IP</span></span><br><span class="line"><span class="attr">hostname:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.217</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># http related config</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">  <span class="comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¦–æ¬¡ç™»å½•æ—¶è®¾å®šçš„ admin è´¦æˆ·å¯†ç </span></span><br><span class="line"><span class="attr">harbor_admin_password:</span> <span class="string">Harbor12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨çš„ç›®å½•</span></span><br><span class="line"><span class="attr">data_volume:</span> <span class="string">/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clair CVE æ¼æ´æ•°æ®åº“æ›´æ–°ï¼Œè¿™é‡Œå»ºè®®è®¾ç½®ä¸º 1h</span></span><br><span class="line"><span class="comment"># ç”±äº clair æ•°æ®åº“åœ¨å›½å†…ç½‘ç»œè®¿é—®é—®é¢˜ï¼Œéœ€è¦è®¾ç½® http ä»£ç†</span></span><br><span class="line"><span class="attr">clair:</span></span><br><span class="line">  <span class="comment"># The interval of clair updaters, the unit is hour, set to 0 to disable the updaters.</span></span><br><span class="line">  <span class="attr">updaters_interval:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">proxy:</span></span><br><span class="line">  <span class="attr">http_proxy:</span> <span class="number">10.20</span><span class="number">.172</span><span class="number">.106</span><span class="string">:2080</span></span><br><span class="line">  <span class="attr">https_proxy:</span></span><br><span class="line">  <span class="attr">no_proxy:</span></span><br><span class="line">  <span class="attr">components:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">clair</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ä¹‹åå†è¿è¡Œ <code>./install.sh --with-clair --with-chartmuseum</code> å°† clair é›†æˆåˆ° harbor ä¸­ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@harbor /opt/harbor</span><br><span class="line">â•°â”€# ./install.sh --with-clair --with-chartmuseum</span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line">[Step 1]: loading Harbor images ...</span><br><span class="line">[Step 2]: preparing environment ...</span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network "harbor_harbor" with the default driver</span><br><span class="line">Creating network "harbor_harbor-clair" with the default driver</span><br><span class="line">Creating network "harbor_harbor-chartmuseum" with the default driver</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">Creating harbor-db     ... done</span><br><span class="line">Creating registryctl   ... done</span><br><span class="line">Creating harbor-portal ... done</span><br><span class="line">Creating chartmuseum   ... done</span><br><span class="line">Creating registry      ... done</span><br><span class="line">Creating redis         ... done</span><br><span class="line">Creating clair         ... done</span><br><span class="line">Creating harbor-core   ... done</span><br><span class="line">Creating harbor-jobservice ... done</span><br><span class="line">Creating nginx             ... done</span><br><span class="line"></span><br><span class="line">âœ” ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://10.20.172.236.</span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ <code>docker-compose ps</code> æ£€æŸ¥ harbor ç›¸å…³å®¹å™¨æ˜¯å¦æ­£å¸¸ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@harbor /opt/harbor</span><br><span class="line">â•°â”€# docker-compose ps</span><br><span class="line">      Name                     Command                  State                 Ports</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">chartmuseum         /docker-entrypoint.sh            Up (healthy)   9999/tcp</span><br><span class="line">clair               /docker-entrypoint.sh            Up (healthy)   6060/tcp, 6061/tcp</span><br><span class="line">harbor-core         /harbor/harbor_core              Up (healthy)</span><br><span class="line">harbor-db           /docker-entrypoint.sh            Up (healthy)   5432/tcp</span><br><span class="line">harbor-jobservice   /harbor/harbor_jobservice  ...   Up (healthy)</span><br><span class="line">harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal       nginx -g daemon off;             Up (healthy)   8080/tcp</span><br><span class="line">nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;8080/tcp</span><br><span class="line">redis               redis-server /etc/redis.conf     Up (healthy)   6379/tcp</span><br><span class="line">registry            /entrypoint.sh /etc/regist ...   Up (healthy)   5000/tcp</span><br><span class="line">registryctl         /harbor/start.sh                 Up (healthy)</span><br></pre></td></tr></table></figure>
<p><img src="https://p.k8s.li/20200326163733610.png" alt=""></p>
<h3 id="è®¾ç½®-insecure-registry"><a href="#è®¾ç½®-insecure-registry" class="headerlink" title="è®¾ç½® insecure registry"></a>è®¾ç½® insecure registry</h3><ul>
<li>åœ¨ runner æœåŠ¡å™¨ä¸Šè®¾ç½®ä¸€ä¸‹ <code>/etc/docker/daemon.json</code> å°†ç§æœ‰ registry çš„ IP åœ°å€å¡«å…¥åˆ° <code>insecure-registries</code> æ•°ç»„ä¸­ã€‚è¿™æ ·æ‰å¯ä»¥æ¨é€å’Œæ‹‰å–é•œåƒ</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"insecure-registries"</span> : [<span class="string">"10.10.107.217"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ <code>docker login</code> æµ‹è¯•æ˜¯å¦èƒ½ç™»å½•æˆåŠŸï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker login 10.10.107.217</span><br><span class="line">Username: admin</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>
<ul>
<li>ç™»å½•åˆ° harbor æ–°å»ºä¸€ä¸ªé¡¹ç›®ä»“åº“ï¼Œå¹¶æŒ‰ç…§ <code>docker tag SOURCE_IMAGE[:TAG] 10.20.172.236/ciest/IMAGE[:TAG]</code> æ ¼å¼ç»™æœ¬åœ° docker é•œåƒæ‰“ä¸Š tag å¹¶æµ‹è¯•æ¨é€åˆ° harbor æ˜¯å¦æˆåŠŸã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker tag openjdk:8-jdk-alpine 10.10.107.217/ops/openjdk:8-jdk-alpine</span><br><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker push !$</span><br><span class="line">â•­â”€root@docker-230 /opt</span><br><span class="line">â•°â”€# docker push 10.10.107.217/ops/openjdk:8-jdk-alpine</span><br><span class="line">The push refers to repository [10.10.107.217/ops/openjdk]</span><br><span class="line">ceaf9e1ebef5: Mounted from ops/ci-test</span><br><span class="line">9b9b7f3d56a0: Mounted from ops/ci-test</span><br><span class="line">f1b5933fe4b5: Mounted from ops/ci-test</span><br><span class="line">8-jdk-alpine: digest: sha256:44b3cea369c947527e266275cee85c71a81f20fc5076f6ebb5a13f19015dce71 size: 947</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨ harbor é¡¹ç›®çš„é¡µé¢æŸ¥çœ‹æ˜¯å¦æ¨é€æˆåŠŸ</li>
</ul>
<p><img src="https://p.k8s.li/20200326170403918.png" alt=""></p>
<h2 id="æµ‹è¯•-CI-CD-é¡¹ç›®"><a href="#æµ‹è¯•-CI-CD-é¡¹ç›®" class="headerlink" title="æµ‹è¯• CI/CD é¡¹ç›®"></a>æµ‹è¯• CI/CD é¡¹ç›®</h2><ul>
<li>åœ¨ Gitlab ä¸­ä½¿ç”¨ Spring æ¨¡æ¿æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶æ·»åŠ  <code>.gitlab-ci.yaml</code> é…ç½®æ–‡ä»¶ã€‚</li>
</ul>
<p><img src="https://p.k8s.li/20200326170523433.png" alt=""></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="attr">build-master:</span></span><br><span class="line">  <span class="comment"># Official docker image.</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">maven-runner</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">"$CI_REGISTRY_USER"</span> <span class="string">-p</span> <span class="string">"$CI_REGISTRY_PASSWORD"</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">info</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">--pull</span> <span class="string">-t</span> <span class="string">"$CI_REGISTRY_IMAGE"</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">"$CI_REGISTRY_IMAGE"</span></span><br><span class="line">  <span class="attr">allow_failure:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="comment"># Official docker image.</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:latest</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker:dind</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">-u</span> <span class="string">"$CI_REGISTRY_USER"</span> <span class="string">-p</span> <span class="string">"$CI_REGISTRY_PASSWORD"</span> <span class="string">$CI_REGISTRY</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">--pull</span> <span class="string">-t</span> <span class="string">"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG"</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG"</span></span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<h3 id="gitlab-ci-yaml"><a href="#gitlab-ci-yaml" class="headerlink" title=".gitlab-ci.yaml"></a>.gitlab-ci.yaml</h3><p><code>.gitlab-ci.yaml</code> æ–‡ä»¶çš„é…ç½®é«˜åº¦ä¾èµ–äºé¡¹ç›®æœ¬èº«ï¼Œä»¥åŠ CI/CD æµæ°´çº¿çš„éœ€æ±‚ã€‚å…¶é…ç½®æ–‡ä»¶ä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<h4 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h4><p>ä¸€æ¬¡ Pipeline å…¶å®ç›¸å½“äºä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªæµç¨‹ï¼Œå¦‚å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€ç¼–è¯‘ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ã€éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ç­‰æµç¨‹ã€‚ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipeline æ„å»ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------------------+           +----------------+</span><br><span class="line">|                  |  trigger  |                |</span><br><span class="line">|   Commit &#x2F; MR    +----------&gt;+    Pipeline    |</span><br><span class="line">|                  |           |                |</span><br><span class="line">+------------------+           +----------------+</span><br></pre></td></tr></table></figure>
<h4 id="Stages"><a href="#Stages" class="headerlink" title="Stages"></a>Stages</h4><p>Stages è¡¨ç¤ºä¸€ä¸ªæ„å»ºé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæµç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡ Pipeline ä¸­å®šä¹‰å¤šä¸ª Stagesï¼Œè¿™äº› Stages ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ‰€æœ‰ Stages ä¼šæŒ‰ç…§é¡ºåºè¿è¡Œï¼Œå³å½“ä¸€ä¸ª Stage å®Œæˆåï¼Œä¸‹ä¸€ä¸ª Stage æ‰ä¼šå¼€å§‹</li>
<li>åªæœ‰å½“æ‰€æœ‰ Stages å®Œæˆåï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) æ‰ä¼šæˆåŠŸ</li>
<li>å¦‚æœä»»ä½•ä¸€ä¸ª Stage å¤±è´¥ï¼Œé‚£ä¹ˆåé¢çš„ Stages ä¸ä¼šæ‰§è¡Œï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥</li>
</ul>
<p>Stages å’Œ Pipeline çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|                                                        |</span><br><span class="line">|  Pipeline                                              |</span><br><span class="line">|                                                        |</span><br><span class="line">|  +-----------+     +------------+      +------------+  |</span><br><span class="line">|  |  Stage 1  |----&gt;|   Stage 2  |-----&gt;|   Stage 3  |  |</span><br><span class="line">|  +-----------+     +------------+      +------------+  |</span><br><span class="line">|                                                        |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="Jobs"><a href="#Jobs" class="headerlink" title="Jobs"></a>Jobs</h4><p>Jobs è¡¨ç¤ºæ„å»ºå·¥ä½œï¼Œè¡¨ç¤ºæŸä¸ª Stage é‡Œé¢æ‰§è¡Œçš„å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Stages é‡Œé¢å®šä¹‰å¤šä¸ª Jobsï¼Œè¿™äº› Jobs ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç›¸åŒ Stage ä¸­çš„ Jobs ä¼šå¹¶è¡Œæ‰§è¡Œ</li>
<li>ç›¸åŒ Stage ä¸­çš„ Jobs éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¯¥ Stage æ‰ä¼šæˆåŠŸ</li>
<li>å¦‚æœä»»ä½•ä¸€ä¸ª Job å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥ Stage å¤±è´¥ï¼Œå³è¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥</li>
</ul>
<p>Jobs å’Œ Stage çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------------------+</span><br><span class="line">|                                          |</span><br><span class="line">|  Stage 1                                 |</span><br><span class="line">|                                          |</span><br><span class="line">|  +---------+  +---------+  +---------+   |</span><br><span class="line">|  |  Job 1  |  |  Job 2  |  |  Job 3  |   |</span><br><span class="line">|  +---------+  +---------+  +---------+   |</span><br><span class="line">|                                          |</span><br><span class="line">+------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>.gitlab-ci.yaml</code>  æ ·ä¾‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">analytics</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">package</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">analytics</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æ‰“åŒ…ä»»åŠ¡  ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæ‰“åŒ…ä»»åŠ¡  ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test_manual:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">manual</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_production_manual:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨  ==============="</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://staging.example.com</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">manual</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹å¥½ <code>.gitlab-ci.yaml</code> ä¹‹åï¼Œå°† CI/CD è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨å˜é‡çš„æ–¹å¼å¡«å…¥åœ¨ é¡¹ç›® <code>è®¾ç½®</code> â€”&gt; <code>CI/CD</code> â€”&gt; <code>å˜é‡</code> é‡Œã€‚æ¯”å¦‚ Harbor ä»“åº“çš„ç”¨æˆ·åå¯†ç ã€ssh å¯†é’¥ä¿¡æ¯ã€æ•°æ®åº“é…ç½®ä¿¡æ¯ç­‰æœºå¯†ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CI_REGISTRY: # Harbor é•œåƒä»“åº“çš„åœ°å€</span><br><span class="line">CI_REGISTRY_USER: # Harbor ç”¨æˆ·å</span><br><span class="line">CI_REGISTRY_PASSWORD: # Harbor å¯†ç </span><br><span class="line">CI_REGISTRY_IMAGE: # æ„å»ºé•œåƒçš„åç§°</span><br><span class="line">SSH_PASSWORD: # éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ ssh å¯†ç </span><br></pre></td></tr></table></figure>
<p><img src="https://p.k8s.li/20200327102511419.png" alt=""></p>
<ul>
<li>è®¾ç½®å¥½ç›¸å…³å˜é‡ä¹‹ååœ¨ï¼Œåœ¨é¡¹ç›®é¡µé¢çš„ <code>CI/CD</code> â€”â€“&gt; <code>æµæ°´çº¿</code> é¡µé¢ç‚¹å‡» <code>è¿è¡Œæµæ°´çº¿</code>æ‰‹åŠ¨è§¦å‘æµæ°´çº¿ä»»åŠ¡è¿›è¡Œæµ‹è¯•ã€‚</li>
</ul>
<p><img src="https://p.k8s.li/20200325163138089.png" alt=""></p>
<ul>
<li>å¦‚æœæµæ°´çº¿ä»»åŠ¡æ„å»ºæˆåŠŸçš„è¯ï¼Œä¼šæ˜¾ç¤º <code>å·²é€šè¿‡</code> çš„è¡¨ç¤º</li>
</ul>
<p><img src="https://p.k8s.li/20200325163254316.png" alt=""></p>
<ul>
<li>ç™»å½•åˆ° Harbor <a href="http://10.10.107.217" target="_blank" rel="noopener">http://10.10.107.217</a> æŸ¥çœ‹é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ</li>
</ul>
<p><img src="https://p.k8s.li/20200325163400519.png" alt=""></p>
<h2 id="å‚è€ƒ-æ¨è"><a href="#å‚è€ƒ-æ¨è" class="headerlink" title="å‚è€ƒ/æ¨è"></a>å‚è€ƒ/æ¨è</h2><ul>
<li><p><a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">GitLab Runner Docs</a></p>
</li>
<li><p><a href="https://docs.gitlab.com/ee/README.html" target="_blank" rel="noopener">GitLab Docs</a></p>
</li>
<li><p><a href="https://nicksors.cc/2019/07/12/kubernetesç³»åˆ—ä¹‹ã€Šæ„å»ºä¼ä¸šçº§CICDå¹³å°-ä¸€-ã€‹.html" target="_blank" rel="noopener">kubernetesç³»åˆ—ä¹‹ã€Šæ„å»ºä¼ä¸šçº§CICDå¹³å°(ä¸€)ã€‹</a></p>
</li>
<li><p><a href="https://notes.mengxin.science/2018/09/02/gitlab-ci-cd-question-and-answer/" target="_blank" rel="noopener">GitLabçš„CI/CDä½¿ç”¨é—®é¢˜æ±‡æ€»</a></p>
</li>
<li><p><a href="https://moelove.info/2018/08/05/%E5%9F%BA%E4%BA%8E-GitLab-%E7%9A%84-CI-%E5%AE%9E%E8%B7%B5/" target="_blank" rel="noopener">åŸºäº GitLab çš„ CI å®è·µ</a></p>
</li>
<li><p><a href="https://blog.fleeto.us/courses/gitlab-notes/" target="_blank" rel="noopener">gitlab-notes</a></p>
</li>
<li><p><a href="https://xiaogenban1993.github.io/18.5/xiaomi_gitlabrunner.html" target="_blank" rel="noopener">gitlab runneréƒ¨ç½²ç»†èŠ‚ä¼˜åŒ–</a></p>
</li>
<li><p><a href="https://tech.meituan.com/2018/08/02/erp-cd-jenkins-pipeline.html" target="_blank" rel="noopener">Jenkinsçš„Pipelineè„šæœ¬åœ¨ç¾å›¢é¤é¥®SaaSä¸­çš„å®è·µ</a></p>
</li>
<li><p><a href="https://laogen.site/gitlab-ci/example-docker-ssh-deploy/" target="_blank" rel="noopener">GitLab CI ç¤ºä¾‹ï¼šDocker é•œåƒæ‰“åŒ…å‘å¸ƒ &amp; SSH éƒ¨ç½²</a></p>
</li>
<li><p><a href="https://theviper.xyz/gitlab-ci-cd-optimize.html" target="_blank" rel="noopener">gitlab CI/CDä¼˜åŒ–</a></p>
</li>
<li><p><a href="http://zacksleo.top/2017/04/22/GitLab-CI%E4%BD%BF%E7%94%A8Docker%E8%BF%9B%E8%A1%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/" target="_blank" rel="noopener">GitLab-CIä½¿ç”¨Dockerè¿›è¡ŒæŒç»­éƒ¨ç½²</a></p>
</li>
<li><p><a href="https://furur.xyz/2019/11/03/docker-gitlab-ci-deploy-springboot-project/" target="_blank" rel="noopener">Docker Gitlab CI éƒ¨ç½² Spring Boot é¡¹ç›®</a></p>
</li>
<li><p><a href="https://wsgzao.github.io/post/gitlab/" target="_blank" rel="noopener">RHEL7/CentOS7 åœ¨çº¿å’Œç¦»çº¿å®‰è£… GitLab é…ç½®ä½¿ç”¨å®è·µ</a></p>
</li>
<li><p><a href="https://wayjam.me/post/how-gitlab-shell-works-with-ssh.md" target="_blank" rel="noopener">GitLab Shellå¦‚ä½•é€šè¿‡SSHå·¥ä½œ</a></p>
</li>
<li><p><a href="https://websoft9.gitbook.io/gitlab-image-guide/" target="_blank" rel="noopener">GitLabé•œåƒæ‰‹å†Œ</a></p>
</li>
<li><p><a href="https://xuanwo.io/2016/04/13/gitlab-install-intro/" target="_blank" rel="noopener">Gitlabéƒ¨ç½²å’Œæ±‰åŒ–ä»¥åŠç®€å•è¿ç»´</a></p>
</li>
</ul>
<h2 id="ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³"><a href="#ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³" class="headerlink" title="ç¤¾ç¾¤é—®ç­” QA | CI/CD ç›¸å…³"></a>ç¤¾ç¾¤é—®ç­” QA | CI/CD ç›¸å…³</h2><p>ä»¥ä¸‹å†…å®¹æ˜¯æ•´ç†æ‘˜è‡ª <a href="https://blog.k8s.li/K8s-QA.html">ã€Š(2000+) kubernetes ç¤¾ç¾¤åˆ†äº« QA æ±‡æ€»ã€‹</a>ï¼Œä¸­æœ‰å…³ CI/CD ç›¸å…³çš„é—®ç­”ï¼Œä» 2000 å¤šä¸ª QA é‡Œä½¿ç”¨å…³é”®å­—æœç´¢ Gitlabã€CI/CDã€Jenkins ç­‰ï¼Œç„¶åå°†ä¸€äº›ç›¸å…³çš„é—®é¢˜è¿›è¡Œæ±‡æ€»ã€‚æ–¹ä¾¿é—®é¢˜è‡ªæŸ¥å’Œä»ä¸­å¸å–ç»éªŒã€‚</p>
<h3 id="2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"><a href="#2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ" class="headerlink" title="2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"></a>2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ</h3><blockquote>
<p>Qï¼šKubernetes ä¸Šä¸»æµçš„ CI/CD æ–¹æ¡ˆæ˜¯å•¥ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå…¶å®è¿™æ— å…³Kubernetesï¼Œä»å¸‚åœºå æœ‰ç‡æ¥çœ‹ï¼Œå‰ä¸‰ååˆ†åˆ«æ˜¯ Jenkinsã€JetBrains TeamCityã€CircleCIã€‚<a href="https://www.datanyze.com/market-share/ci" target="_blank" rel="noopener">æ¥æºï¼š</a></p>
<blockquote>
<p>Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚</p>
</blockquote>
<p>Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ä»æˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkinsç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CIç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkinså…¨é¢ã€‚å¦‚æœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸ŠJenkinsï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚</p>
<blockquote>
<p>Qï¼šJenkins å¦‚æœä¸æƒ³è¿è¡Œåœ¨ Kubernetes é‡Œé¢ï¼Œè¯¥æ€ä¹ˆå’Œ Kubernetes é›†æˆï¼Ÿ</p>
</blockquote>
<p>Aï¼šä» CI çš„æµç¨‹æ¥è¯´ï¼ŒCI åº”ç”¨æ˜¯ä¸æ˜¯è·‘åœ¨ Kubernetes çš„å¹¶ä¸é‡è¦ï¼ŒCIåªè¦èƒ½è®¿é—®ä»£ç åº“ï¼Œæœ‰æƒé™åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒï¼Œæ˜¯ä¸æ˜¯è·‘åœ¨å®¹å™¨é‡Œä»æ•ˆæœæ¥è¯´å…¶å®æ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯ç”¨Kubernetes éƒ¨ç½² Jenkinsçš„è¯ï¼Œè¿ç»´çš„ä¸€è‡´æ€§æ¯”è¾ƒå¥½ï¼Œè¿ç»´å›¢é˜Ÿä¸ç”¨é¢å¤–èŠ±æ—¶é—´ç»´æŠ¤ä¸€å¥—ç‰©ç†æœºçš„éƒ¨ç½²æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>Qï¼šKubernetesçš„å›æ»šæ–¹æ¡ˆæ˜¯å›æ»šä»£ç ï¼Œé‡åšé•œåƒï¼Œè¿˜æ˜¯å…ˆåˆ‡æµé‡ï¼Œååšä¿®æ”¹ï¼Ÿ</p>
</blockquote>
<p>Aï¼šä»£ç ä¸€å®šæ˜¯æ‰“åŒ…åˆ°é•œåƒé‡Œçš„ï¼Œé•œåƒçš„ç‰ˆæœ¬å°±æ˜¯ä»£ç çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯åˆ‡é•œåƒã€‚è‡³äºå›æ»šæ“ä½œæœ¬èº«ï¼ŒKuberneteså·²ç»å†…ç½®äº†å¾ˆå¤šæ»šåŠ¨å‘å¸ƒï¼ˆRollingupdateï¼‰çš„ç­–ç•¥ï¼Œæ— è®ºæ˜¯å‘æ–°ç‰ˆæœ¬è¿˜æ˜¯å›æ»šç‰ˆæœ¬ï¼Œéƒ½å¯ä»¥åšåˆ°ç”¨æˆ·æ— æ„ŸçŸ¥ã€‚</p>
<blockquote>
<p>Qï¼šé•œåƒå¤§åˆ°å‡  G çš„è¯å¦‚ä½•æ›´æ–°éƒ¨ç½²ï¼Œæœ‰ä»€ä¹ˆå¥½çš„å®è·µå‘¢ï¼Œä»¥åŠå¦‚ä½•å›æ»šï¼Ÿ</p>
</blockquote>
<p>Aï¼šå‡ ä¸ªè¦ç‚¹ï¼š&gt; Qï¼šDrone å¼€æ”¾ API æœåŠ¡å—ï¼Ÿè¿™æ ·æ–¹ä¾¿å…¶ä»–ç³»ç»Ÿé›†æˆã€‚</p>
<p>Aï¼šå¯ä»¥è°ƒæ•´ä¸€ä¸‹æ€è·¯ï¼Œç›´æ¥æŠŠéœ€è¦çš„åŠŸèƒ½åšæˆé•œåƒåœ¨ Drone é‡Œè°ƒç”¨å°±å¥½äº†ã€‚</p>
<blockquote>
<p>Qï¼šå¦‚æœæœ‰ Drone çš„ Serveræ€ä¹ˆåšé«˜å¯ç”¨ï¼Ÿ</p>
</blockquote>
<p>Aï¼šDrone serve rç”¨ Kuberneteséƒ¨ç½²çš„è¯æœ¬èº«åªèµ·åˆ°äº†ä¸€ä¸ªä»»åŠ¡è°ƒåº¦çš„ä½œç”¨ï¼Œå¾ˆéš¾ä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆã€‚çœŸçš„æœ‰æ€§èƒ½é—®é¢˜å¯ä»¥å°è¯•æ°´å¹³æ‰©å±•Drone serverï¼Œå…±äº«åŒä¸€æ•°æ®åº“ã€‚</p>
<h3 id="åŸºäº-GitLab-çš„-CI-å®è·µ"><a href="#åŸºäº-GitLab-çš„-CI-å®è·µ" class="headerlink" title="åŸºäº GitLab çš„ CI å®è·µ"></a><a href="https://moelove.info/2018/08/05/åŸºäº-GitLab-çš„-CI-å®è·µ/" target="_blank" rel="noopener">åŸºäº GitLab çš„ CI å®è·µ</a></h3><blockquote>
<p>Qï¼šæ‚¨æåˆ°æŠŠå„ç§ä¾èµ–éƒ½ä»¥ Service çš„æä¾›ï¼Œè¯·é—®æ˜¯ä»¥å“ªç§æ–¹å¼å‘¢ï¼Ÿ æ¯”å¦‚Pythonçš„ä¾èµ–ï¼Œæ€ä¹ˆåšæˆServiceå‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šService åŒ–çš„ä¾èµ–ï¼Œä¸»è¦æ˜¯æŒ‡ç±»ä¼¼ DB / MySQL/ Reids ä¹‹ç±»çš„ã€‚ æˆ–è€…æ˜¯ dind å…¶å®å®ƒæä¾›çš„æ˜¯ 2375 ç«¯å£çš„TCPæœåŠ¡ã€‚ Python çš„ä¾èµ–ï¼Œæˆ‘æ¨èçš„åšæ³•æ˜¯ï¼Œ æ„å»ºä¸€ä¸ªæ¢äº†æºçš„ Python é•œåƒã€‚ å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œè€—æ—¶ä¼šå°‘å¾ˆå¤šã€‚ æˆ–è€…è¯´ï¼Œ å¯ä»¥åœ¨å®šä¹‰ Pipeline çš„æ—¶å€™ï¼Œ å°†è™šæ‹Ÿç¯å¢ƒçš„ venv æ–‡ä»¶å¤¹ä½œä¸º cache ï¼Œä¹‹åçš„å®‰è£…ä¹Ÿä¼šæ£€æŸ¥è¿™ä¸ªï¼Œé¿å…ä¸å¿…è¦çš„å®‰è£…ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ï¼Œä½ ä»¬ä¸ºä»€ä¹ˆä¸ç”¨Jenkins Pipelineï¼Œè€Œä½¿ç”¨GitLab CIï¼Ÿ</p>
</blockquote>
<p>Aï¼šä¸»è¦åŸå› æ˜¯æˆ‘æåˆ°çš„é‚£å‡ ä¸ªæ–¹é¢ã€‚ é›†æˆè¾ƒå¥½ï¼Œ ç•Œé¢ç¾è§‚ä¼˜é›…ï¼Œ ä½¿ç”¨ç®€å•ï¼ˆæ‰€æœ‰æœ‰ä»“åº“å†™æƒé™çš„äºº éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ åªè¦åˆ›å»º .gitlab-ci.yml å¹¶ä¸”é…ç½®äº† Runner å³å¯ä½¿ç”¨ï¼‰ ã€‚æ¢ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä½¿ç”¨Jenkins çš„é—®é¢˜ï¼Œ Jenkins å¯¹äºé¡¹ç›®çš„é…ç½®å…¶å®å’Œ GitLab çš„ä»£ç æ˜¯åˆ†ç¦»çš„ï¼Œ ä¸¤éƒ¨åˆ†çš„ï¼Œ ç”¨æˆ·ï¼ˆæˆ–è€…è¯´æˆ‘ä»¬çš„å¼€å‘è€…ï¼‰åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œ éœ€è¦æœ‰ä¸¤ä¸ªå¹³å°ï¼Œ å¹¶ä¸”ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œ Jenkins çš„æƒé™æ˜¯ä¸æ”¾å¼€çš„ã€‚ å¯¹ç”¨æˆ·æ¥è®²ï¼Œ é‚£ç›¸å½“äºæ˜¯ä¸ªé»‘ç›’ã€‚ é‚£å¯èƒ½çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é‡åˆ°æ„å»ºå¤±è´¥äº†ï¼Œ ä½†æ˜¯åªæœ‰è¿ç»´çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯ç ”å‘æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæ²¡æœ‰æƒé™ã€‚ ä½¿ç”¨GItLabçš„å¥½å¤„ï¼Œè¿™ä¸ªæ—¶å€™å°±æ›´åŠ çªå‡ºäº†ï¼Œ é…ç½®å°±åœ¨ä»£ç ä»“åº“é‡Œé¢ï¼Œå¹¶ä¸”ä½¿ç”¨ YAML çš„é…ç½®ï¼Œå¾ˆç®€å•ã€‚ æœ‰å•¥é—®é¢˜ï¼Œç›´æ¥æŸ¥ï¼Œç›´æ¥æ”¹ã€‚</p>
<blockquote>
<p>Qï¼šå…³äº Runner çš„æ¸…ç†çš„é—®é¢˜ï¼Œåœ¨é•¿æ—¶é—´ä½¿ç”¨åï¼ŒRunner æœºå™¨ä¸Šå›äº§ç”Ÿå¾ˆå¤šçš„ Cache å®¹å™¨ï¼Œå¦‚ä½•æ¸…ç†å‘¢ã€‚èƒ½å¤Ÿåœ¨ä»»åŠ¡ä¸­è‡ªåŠ¨æ¸…é™¤å—ï¼Ÿ</p>
</blockquote>
<p>Aï¼šè¿™ä¸ªå°±ç›¸å¯¹ç®€å•äº†ï¼Œé¦–å…ˆï¼Œ å¦‚æœä½ çš„ Cache å®¹å™¨ç¡®è®¤æ²¡ç”¨äº†ï¼Œ æ¯ä¸ª Cache å®¹å™¨å…¶å®éƒ½æœ‰åå­—çš„ï¼Œ ç›´æ¥æŒ‰ Cache çš„åå­—è¿‡ç•¥ï¼Œ æ‰¹é‡åˆ æ‰ã€‚ å¦‚æœä½ ä¸ç¡®å®šå®ƒæ˜¯å¦æœ‰ç”¨ï¼Œé‚£ä½ ç›´æ¥åˆ æ‰ä¹Ÿæ˜¯ä¸å½±å“çš„ï¼Œ å› ä¸º Docker Excutor çš„æ‰§è¡Œæœºåˆ¶æ˜¯åˆ›å»ºå®Œ Service å®¹å™¨åï¼Œ åˆ›å»º Cache å®¹å™¨ã€‚ è¦æ˜¯åˆ æ‰äº†ï¼Œå®ƒåªæ˜¯ä¼šå†åˆ›å»ºä¸€æ¬¡ã€‚ å¦‚æœä½ æƒ³åœ¨ä»»åŠ¡ä¸­æ¸…é™¤ï¼Œ ç›®å‰è¿˜æ²¡åšç›¸å…³çš„å®è·µï¼Œå¾…æˆ‘å®è·µåï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¾ˆä¼˜é›…çš„æ–¹å¼ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚</p>
<blockquote>
<p>Qï¼šåœ¨GitLabçš„CDæ–¹æ¡ˆä¸­ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å˜é‡ä¸­é…ç½®è·³æ¿æœºçš„ç§é’¥ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®æ˜¯å¯¹å…¬å¸æ•´éƒ¨é—¨å¼€å‘ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿æŠ¤è¿™ä¸ªç§é’¥å‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå¯ä»¥ä½¿ç”¨ secret variable å°†ç§é’¥å†™å…¥å…¶ä¸­ï¼Œ ï¼ˆä½†æ˜¯é¡¹ç›®çš„ç®¡ç†å‘˜ï¼Œå…·å¤‡æŸ¥çœ‹è¯¥ variable çš„æƒé™ï¼‰å¼€å‘ä¸€ä¸ª web server ï¼ˆå…¶å®åªè¦æš´éœ² IP ç«¯å£ä¹‹ç±»çš„å°±å¯ä»¥ï¼‰ åœ¨ CI æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å»è¯·æ±‚ï¼Œ server å¯¹æ¥æºåšåˆ¤æ–­ ï¼ˆæ¯”å¦‚ æ‰§è¡ŒCI çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„å˜é‡ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ï¼Œæ˜¯å¦çœŸçš„æ˜¯ CI åœ¨è¯·æ±‚ï¼‰ç„¶åè¿”å›ç§é’¥ã€‚</p>
<blockquote>
<p>Qï¼šGitLab CIé€‚åˆä»€ä¹ˆç±»å‹çš„é¡¹ç›®å‘¢ï¼Ÿå›½å†…ç›®å‰è¿˜æ¯”è¾ƒå°ä¼—å§ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå›½å†…ç›®å‰è¿˜è¾ƒä¸ºå°ä¼—ï¼ˆç›¸æ¯” Jenkins æ¥è¯´ï¼‰å…¶å®åªè¦éœ€è¦ CI çš„é¡¹ç›®ï¼Œå®ƒéƒ½é€‚åˆã€‚</p>
<h2 id="2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"><a href="#2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ" class="headerlink" title="2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"></a>2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ</h2><blockquote>
<p>Qï¼šCIè¿‡ç¨‹ä¸­testéœ€è¦è¿æ¥æ•°æ®åº“çš„ä»£ç æ—¶ï¼Œæ‚¨åœ¨å†™æµ‹è¯•æ¡ˆä¾‹æ–¹é¢æœ‰å“ªäº›ç»éªŒåˆ†äº«ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå•å…ƒæµ‹è¯•ä¸èƒ½ä¾èµ–å¤–éƒ¨èµ„æºï¼Œç”¨mockï¼Œæˆ–è€…ç”¨h2ç­‰å†…å­˜æ•°æ®åº“æ›¿ä»£ã€‚é›†æˆæµ‹è¯•çš„æ—¶å€™æ˜¯ä»æ¥å£å±‚ç›´æ¥è°ƒç”¨æµ‹è¯•çš„ï¼Œæµ‹è¯•ç”¨ä¾‹å¯¹æ•°æ®åº“æ— æ„ŸçŸ¥ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ˜¯è‡ªåŠ¨è§¦å‘è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å®¡æ‰¹ï¼ŸSQLæ‰§è¡Œæˆ–å›æ»šæ˜¯å¦è‡ªåŠ¨åŒ–ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå½“å‰æ˜¯éœ€è¦æ‰‹åŠ¨è§¦å‘ã€‚SQLæ›´æ–°å½“å‰æ²¡åšåˆ°è‡ªåŠ¨åŒ–ï¼Œè¿™å—æ­£åœ¨æ”¹è¿›ï¼Œå› ä¸ºéƒ¨ç½²ç§æœ‰ç¯å¢ƒéœ€è¦ã€‚SQLä¸æ”¯æŒå›æ»šï¼Œä»£ç åšå…¼å®¹ã€‚Dockeré•œåƒå›æ»šæ²¡æœ‰è‡ªåŠ¨åŒ–ã€‚</p>
<blockquote>
<p>Qï¼š é—®ä¸€ä¸‹ä½ ä»¬çš„Rediså†…å­˜ç‰ˆæ˜¯ç”¨çš„ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬ç”¨çš„å†…å­˜ç‰ˆçš„redisæ˜¯ <a href="https://github.com/spullara/redis-protocol" target="_blank" rel="noopener">spullara/redis-protocol</a>ä¸­çš„serverå®ç°ã€‚ä¸è¿‡è¿™ä¸ªå®ç°éƒ¨åˆ†åŠŸèƒ½æ²¡æ”¯æŒï¼Œæ¯”å¦‚luaè„šæœ¬ï¼Œæˆ‘ä»¬è‡ªå·±åšäº†æ”¹è¿›ã€‚</p>
<blockquote>
<p>Qï¼šä»‹ç»ä¸‹workflowå¸¦æ¥çš„å¥½å¤„ã€‚</p>
</blockquote>
<p>Aï¼šworkflowçš„å¥½å¤„æˆ‘é‚£ç¯‡æ–‡ç« ä¸­æœ‰è¯´æ˜ï¼Œå¦‚æœæ²¡æœ‰workflowï¼Œæ‰€æœ‰çš„æ­¥éª¤éƒ½åœ¨åŒä¸€ä¸ªé…ç½®çš„ä¸åŒstepå®ç°ï¼Œå¦‚æœåé¢çš„å¤±è´¥ï¼Œè¦é‡æ–°ä»å¤´å¼€å§‹ã€‚workflowå¯ä»¥ä¸­é€”å¼€å§‹ï¼Œå¹¶ä¸”æ¯ä¸€æ­¥éª¤å®Œæˆéƒ½ä¼šè§¦å‘é€šçŸ¥ã€‚</p>
<blockquote>
<p>Qï¼šh2å¹¶ä¸å®Œå…¨å…¼å®¹MySQLè„šæœ¬ï¼Œä½ ä»¬å¦‚ä½•å¤„ç†çš„ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬é€šè¿‡ä¸€äº›hackçš„åŠæ³•ï¼Œä¼šæ¢æµ‹ä¸‹æ•°æ®åº“æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæ›¿æ¢æ‰ä¸€äº›ä¸å…¼å®¹çš„SQLï¼Œè¿›è¡Œå®¹é”™ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ä½ ä»¬åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæ„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æ§å’Œå¥åº·ç›‘æ§ä½ ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Œå¦‚æœæœ‰buildå¤±è´¥äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šCIçš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’ŒCIé›†æˆï¼Œå¦‚æœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚</p>
<blockquote>
<p>Qï¼šcleanupè„šæœ¬åšå“ªäº›ï¼Ÿ</p>
</blockquote>
<p>Aï¼šä¸»è¦æ˜¯æ¸…ç†æ—§çš„Dockeré•œåƒï¼Œä»¥åŠæ¸…ç†è‡ªåŠ¨åŒ–æµ‹è¯•äº§ç”Ÿçš„åƒåœ¾æ•°æ®ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ä½ ä»¬æ–‡ä»¶å­˜å‚¨æ€ä¹ˆè§£å†³çš„å‘¢ï¼Œä½¿ç”¨è‡ªå·±çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯äº‘æœåŠ¡ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒå¤šç§storageé…ç½®ï¼Œå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•ï¼ˆä¾¿äºæµ‹è¯•ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿äº‘æœåŠ¡ï¼ˆæ¯”å¦‚s3ï¼‰ã€‚</p>
<blockquote>
<p>Qï¼šåˆšæ‰è¯´ä½ ä»¬èƒ½é€šè¿‡ä¸€é”®éƒ¨ç½²ï¼Œä½†æ˜¯ä¸­é—´æ— æ³•ç›‘æ§ï¼Œæµ‹è¯•ç¯å¢ƒå¯ä»¥è¿™ä¹ˆç©ï¼Œé‚£ç”Ÿäº§ç¯å¢ƒä½ ä»¬æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿè¿˜æœ‰ä½ ä»¬åç»­çš„æ”¹é€ æ–¹å‘æ˜¯è‡ªå·±å¼€å‘ï¼Ÿè¿˜æ˜¯é‡‡ç”¨é›†æˆç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Ÿ</p>
</blockquote>
<p>Aï¼šç”Ÿäº§ç¯å¢ƒshellå½“å‰åªèƒ½æ˜¯å¤šåŠ é”™è¯¯åˆ¤æ–­ã€‚è¿™å—æˆ‘ä»¬åœ¨æ”¹è¿›ï¼Œæ¯”å¦‚é€šè¿‡ansibleç­‰å·¥å…·ï¼Œä»¥åŠä½¿ç”¨Kuberneteså†…ç½®çš„rolling-updateã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²è¿™å—è¿˜æ²¡æœ‰å¥½çš„å¼€æºå·¥å…·ã€‚</p>
<blockquote>
<p>Qï¼šä½ ä»¬çš„æµ‹è¯•ç”¨äº†å¾ˆå¤šä»£æ›¿æ–¹æ¡ˆã€å¦‚h2ä»£MySQLï¼Œè¦ä¿è¯æµ‹è¯•æ•ˆæœï¼Œé™¤äº†ä½ ä»¬ç”¨çš„hackæ–¹æ³•ä¹‹å¤–ï¼Œæ˜¯ä¸æ˜¯ä»å†™ä»£ç çš„æ—¶å€™å°±å¼€å§‹åšäº†æ–¹ä¾¿æµ‹è¯•çš„è®¾è®¡ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå¯¹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ–‡ç« ä¸­åˆ†äº«çš„è§‚ç‚¹ä¹‹ä¸€ã€‚æµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™äººå‘˜è¦æœ‰ä¸šåŠ¡ä»£ç çš„ä¿®æ”¹æƒé™ï¼Œæœ€å¥½æ˜¯åŒä¸€ä¸ªäººã€‚è¦åšè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä¸šåŠ¡ä»£ç å¿…é¡»è¦ç»™æµ‹è¯•ç•™å„ç§é’©å­ä»¥åŠåé—¨ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ä½ ä»¬çš„é›†ç¾¤åº”ç”¨ç¼–æ’æ€ä¹ˆåšçš„ï¼Ÿ</p>
</blockquote>
<p>Aï¼šä¸Šé¢è¯´äº†ï¼Œè¿˜æ²¡ç”¨åˆ°ç¼–æ’ã€‚ä¸€ç›´ç­‰ç¼–æ’å·¥å…·çš„æˆç†Ÿã€‚æ­£åœ¨æµ‹è¯•k8sã€‚</p>
<blockquote>
<p>Qï¼šä½ ä»¬åšè¿™ä¸ªé¡¹ç›®é€‰å‹æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘çš„ï¼Œä»‹ç»é‡Œæœ‰æåˆ°ä½¿ç”¨ä¸€äº›è„šæœ¬æ¥ç®¡ç†å®¹å™¨è§£å†³å¼€å‘å’Œæµ‹è¯•å„ç§é—®é¢˜ï¼Œæ„Ÿè§‰è¿™ç§ç®¡ç†å®¹å™¨æ–¹å¼è¿‡äºç®€å•ä¼šå¸¦æ¥ç®¡ç†é—®é¢˜ï¼Œä¸ºä½•ä¸ç”¨ç¬¬ä¸‰æ–¹å¼€æºé¡¹ç›®æ¥åšäºŒæ¬¡å¼€å‘ï¼Œå¦‚ï¼šKubernetesï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸‹ä¸€æ­¥æœ‰æ²¡æœ‰è€ƒè™‘å¦‚ä½•è®©ä½ çš„Dockerå’Œäº‘æœåŠ¡å¹³å°ç»“åˆï¼Œè¦è§£å†³è¿è¥æˆæœ¬é—®é¢˜ï¼ˆDockeræœ€å¤§å¸å¼•åŠ›åœ¨è¿™é‡Œï¼‰ï¼Œè€Œä¸åªæ˜¯è§£å†³å¼€å‘æµ‹è¯•é—®é¢˜ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå› ä¸ºæˆ‘ä»¬æœ€æ—©ç”¨çš„æ—¶å€™k8s 1.0 è¿˜æ²¡æœ‰ï¼Œå˜åŒ–å¤ªå¤§ï¼Œåˆ›ä¸šå›¢é˜Ÿæ²¡ç²¾åŠ›è·Ÿè¿›ï¼Œè„šæœ¬æ˜¯ç²—æš´ç®€å•çš„åŠæ³•ã€‚ä¸€ç›´åœ¨ç­‰å¾…å„ç§åŸºäºDockerçš„äº‘è§£å†³æ–¹æ¡ˆå‘€ï¼Œè‚¯å®šè€ƒè™‘ç»“åˆã€‚</p>
<blockquote>
<p>Qï¼šå¯¹äºDocker storageåˆ†åŒºç”¨å®Œé—®é¢˜ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä½ ä»¬æ˜¯ä½¿ç”¨Dockerå®˜æ–¹æä¾›çš„Registryä»“åº“å—ï¼Œå¦‚ä½•è§£å†³ä»“åº“å•ç‚¹é—®é¢˜ï¼Œè¿™æœºå™¨è¦æ˜¯æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ</p>
</blockquote>
<p>Aï¼šRegistryç”¨çš„æ˜¯å®˜æ–¹çš„ï¼Œåç«¯å­˜å‚¨æ˜¯æŒ‚è½½åˆ°s3ä¸Šçš„ã€‚æ²¡æœ‰s3,æ¨èä½¿ç”¨äº¬ä¸œç”°çªå›¢é˜Ÿå¼€æºçš„<a href="https://github.com/jcloudpub/speedy" target="_blank" rel="noopener">Speedy</a>ï¼Œå®ç°äº†åˆ†å¸ƒå¼å­˜å‚¨ã€‚</p>
<blockquote>
<p>Qï¼šé™¤äº†ä»‹ç»çš„Javaç›¸å…³çš„CIæ–¹æ¡ˆï¼Œå¯¹äºC/C++å¼€å‘è¯­è¨€æœ‰æ²¡æœ‰æ¨èçš„CIæ–¹æ¡ˆï¼Ÿ</p>
</blockquote>
<p>Aï¼šTeamcity/Jenkinsç­‰CIå·¥å…·æ”¯æŒä»»ä½•è¯­è¨€çš„ã€‚å…¶å®ä»»ä½•è¯­è¨€çš„CIéƒ½å·®ä¸å¤šï¼Œå•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ã€‚å…³é”®è¿˜åœ¨äºä¾èµ–ç¯å¢ƒçš„å‡†å¤‡ä»¥åŠé›†æˆæµ‹è¯•ç”¨ä¾‹çš„ç®¡ç†ã€‚</p>
<blockquote>
<p>Qï¼šæˆ‘çœ‹åˆ°ä½ ä»¬ä¸ºäº†æ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•ä¼šæœ‰ç‹¬ç«‹çš„é›†åˆDockerç¯å¢ƒï¼Œè¿™ç§ç¯å¢ƒå’Œä¸Šçº¿ç¯å¢ƒå…¶å®æ˜¯æœ‰å·®åˆ«çš„ï¼Œè¿™æ ·æµ‹è¯•çš„ç»“æœèƒ½å¤Ÿä»£è¡¨çº¿ä¸Šç¯å¢ƒå—ï¼Ÿè¿™ç§é—®é¢˜æ€ä¹ˆçœ‹å¾…ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæ‰€ä»¥æˆ‘ä»¬æœ‰å¤šä¸ªæµç¨‹ã€‚æ¸…ç†æ•°æ®çš„æµ‹è¯•ç¯å¢ƒï¼Œä»¥åŠä¸æ¸…ç†ç¯å¢ƒçš„æ²™ç®±ç¯å¢ƒã€‚ä½†è¿™ä¹Ÿä¸èƒ½é¿å…ä¸€éƒ¨åˆ†çº¿ä¸Šç¯å¢ƒçš„æ•°æ®å¯¼è‡´çš„bugã€‚å¦å¤–å°±æ˜¯é…åˆç°åº¦ä¸Šçº¿æœºåˆ¶ã€‚å½“å‰æˆ‘ä»¬çš„ç°åº¦æ˜¯é€šè¿‡ä»£ç ä¸­çš„å¼€å…³å®ç°çš„ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆçš„ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚facebookçš„Gatekeeperã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®Groukæœ‰æ¶‰åŠå‰ç«¯ï¼ˆNode.jsæ–¹é¢çš„ï¼‰å¹¶ç»“åˆDockerçš„CI/CDç»å†å—ï¼Œå¯ä»¥åˆ†äº«ä¸‹å—ï¼Ÿ</p>
</blockquote>
<p>Aï¼šè¿™æˆ‘ä»¬ä¹Ÿåœ¨å°è¯•ã€‚å½“å‰jsçš„æµ‹è¯•ä¸»è¦è¿˜æ˜¯åŸºäº<a href="https://github.com/ariya/phantomjs" target="_blank" rel="noopener">ariya/phantomjs</a>ï¼Œçº¯ç²¹çš„jsåº“æ¯”è¾ƒæ–¹ä¾¿æµ‹è¯•ï¼Œä½†å¦‚æœç‰µæ‰¯åˆ°ç•Œé¢ï¼Œå°±æ¯”è¾ƒå¤æ‚äº›äº†ã€‚</p>
<h2 id="2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"><a href="#2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ" class="headerlink" title="2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"></a>2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ</h2><blockquote>
<p>Qï¼šå¼€å‘æ¯æäº¤ä¸€ä¸ªbugfixï¼Œéƒ½ä¼šè§¦å‘jinkenså»æ„å»ºé•œåƒï¼Œé‚£ä¹ˆå¤šçš„å¼€å‘è€…ï¼Œå²‚ä¸æ˜¯è¦æ„å»ºå¾ˆå¤šé•œåƒï¼Ÿ</p>
</blockquote>
<p>Aï¼šæ²¡æœ‰é”™ï¼Œæˆ‘ä»¬æ˜¯æ¯æ¬¡éƒ½è§¦å‘æ„å»º imageï¼Œç”±äºimageæ˜¯åˆ†å±‚çš„ï¼Œåº•å±‚å·²ç»å­˜åœ¨çš„çˆ¶å¯¹è±¡ï¼Œæ˜¯ä¸ç”¨å­˜å‚¨ï¼Œåªå­˜å‚¨å˜åŒ–çš„éƒ¨åˆ†æ‰€ä»¥å†ç”¨çš„ç£ç›˜ç©ºé—´å¾ˆä½ï¼Œåœ¨ç³»ç»Ÿå¼€å§‹åˆï¼Œæˆ‘åšè¿‡ç»Ÿè®¡ï¼Œ1000ä¸ª image ä¹Ÿä¸åˆ° 9Gï¼Œè¿™å…¶ä¸­è¿˜æœ‰å¾ˆå¤šåŸºç¡€é•œåƒã€‚</p>
<blockquote>
<p>Qï¼šæƒ³é—®ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„ï¼ŒåƒDockeréƒ¨ç½²è¿™éƒ¨æ˜¯ç›´æ¥è°ƒç”¨Dockeréƒ¨ç½²å®¹å™¨ï¼Œè¿˜æ˜¯é€šè¿‡Ansibleæˆ–å…¶ä»–å·¥å…·ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæœ‰äº† Kubernetes ç®¡ç†é›†ç¾¤åï¼Œå‘å¸ƒçš„å·¥ä½œå°±æ¯”è¾ƒç®€å•äº†ï¼Œç”¨ä¸ä¸Š Ansibleã€‚ä½†æ˜¯ Ansible è¿˜æ˜¯æœ‰å®ƒçš„ç”¨å¤„çš„ï¼Œæ¯”å¦‚æ¸…ç†é›†ç¾¤ä¸­è¿‡æ—¶çš„ imageï¼Œå’Œå·²ç»é€€å‡ºçš„ Containerç­‰ã€‚</p>
<blockquote>
<p>Qï¼šä½ å¥½ï¼Œä»¥å‰ä¹Ÿåšè¿‡ç±»ä¼¼çš„æœåŠ¡â€ç¬¬ä¸‰æ­¥ï¼šJenkins ä¼šæŠŠç›¸åº”çš„ imageéƒ¨ç½²åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼Œå¼€å‘è€…å°±å¯ä»¥é€šè¿‡ iss001.kingdeeè¿™ä¸ªåŸŸåè®¿é—®åˆšåˆšå¯¹åº”åˆ†æ”¯çš„æœåŠ¡äº†â€ï¼Œå•ç‹¬ä¸€ä¸ªåˆ†æ”¯è§£å†³äº†å¯¹åº”çš„bugï¼Œä½†å®é™…ç”Ÿäº§ä¸­éå¸¸å®¹æ˜“ä¿®æ”¹ä¸€ä¸ªbugå¼•èµ·å…¶ä»–çš„bugï¼Œä½ ä»¬æ˜¯æ€ä¹ˆå»æŠŠæ§æ•´ä½“çš„ç¨³å®šæ€§ï¼Ÿå¦‚ä½•æé«˜è¿™ç§å•ä¸ªbugåˆ†æ”¯å•ä¸ªæµ‹è¯•ç¯å¢ƒçš„æ„ä¹‰ï¼Ÿ</p>
</blockquote>
<p>Aï¼šè¿™ä¸ª pull-request çš„å·¥ä½œæ–¹å¼æ˜¯åº”å¯¹åŠŸèƒ½å¼€å‘çš„ï¼Œå¦‚åƒé•¿æœŸå¼€å‘æŸä¸ª new featureï¼Œä½ åˆšåˆšè¯´çš„ä¸€ä¸ª bug äº§ç”Ÿå¦å¤–ä¸€ä¸ªbugï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯æœ‰å›å½’æµ‹è¯•ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª smoke åˆ†æ”¯ï¼ŒæŒç»­ä¸æ–­çš„å¯¹å…¶åšåŠŸèƒ½å›å½’æµ‹è¯•ï¼Œåªæœ‰é€šè¿‡çš„æ‰èƒ½ cherry pick åˆ°release ä¸Šã€‚</p>
<blockquote>
<p>Qï¼šæµ‹è¯•ç¯å¢ƒä¾èµ–çš„redis/MQä¹‹ç±»çš„å¤–éƒ¨æœåŠ¡å¦‚ä½•åšçš„éš”ç¦»?æ¯æ¬¡æµ‹è¯•å•ç‹¬æ‹‰èµ·æ¥ä¸€å¥—å¤–éƒ¨ä¾èµ–çš„æœåŠ¡å—ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬é€šè¿‡å¤šä¸ªæ‰‹æ®µæ¥å®ç°å…±äº«æ•°æ®ï¼šmasterã€smokeã€release åˆ†æ”¯æµ‹è¯•éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸­é—´ä»¶ï¼Œè¦æ˜¯ä¸ç”¨è®¿é—®å…±äº«çš„æ•°æ®ï¼Œå¯ä»¥éƒ¨ç½²å¦‚ MQ imageï¼Œä»£ç å±‚é¢çš„ï¼Œå¦‚ MQ key çš„åç§°åŠ ä¸Šæœºå™¨çš„ IPã€‚</p>
<blockquote>
<p>Qï¼šæœ‰æ²¡æœ‰ç”¨åˆ°Mesosï¼Ÿæ˜¯å¦å®¹æ˜“é‡åˆ°é—®é¢˜ï¼Ÿè¿™æ–¹é¢çš„æ–‡æ¡£å¥½åƒå¹¶ä¸å¤šã€‚</p>
</blockquote>
<p>Aï¼šMesos æ˜¯ä¸ªäºŒçº§è°ƒåº¦ï¼Œé€‚ç”¨äºåƒå­˜åœ¨å¤šå¥—é›†ç¾¤çš„æƒ…å†µï¼Œæ¥å‡è¡¡èµ„æºï¼Œå¦‚ï¼šéƒ¨ç½²äº† Hadoop å’Œ storm ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ storm æ¥å¤„ç†å®æ—¶çš„è¯·æ±‚ï¼ŒHadoop åšç¦»çº¿å·¥ä½œã€‚æ™šä¸Šå’Œç™½å¤©å°±å­˜åœ¨ä¸€ç§å¯èƒ½å°±æ˜¯ Hadoop é—²ç½®ï¼Œä½†æ˜¯ storm å¯èƒ½å¾ˆå¿™ï¼Œè¿™æ—¶ Mesos è¿™æ ·çš„äºŒçº§è°ƒåº¦å°±å¯ä»¥å¹³è¡¡èµ„æºï¼ŒèŠ‚çº¦æˆæœ¬ï¼Œæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ã€‚è‡³äºæ–‡æ¡£æ–¹é¢æˆ‘ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œå»ºè®®çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ä½ ä»¬åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä½ è¯´æœ‰äº›éœ€è¦åŠä¸ªå°æ—¶å·¦å³ï¼Œé‚£ä¹ˆæ„å»ºè¿‡ç¨‹çš„è¿›åº¦ç›‘æ§å’Œå¥åº·ç›‘æ§ä½ ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Œå¦‚æœæœ‰buildå¤±è´¥äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šCIçš„æ¯ä¸€æ­¥éƒ½æœ‰è¿›åº¦çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å›¢é˜Ÿé€šè®¯å·¥å…·å¯ä»¥å’ŒCIé›†æˆï¼Œå¦‚æœå¤±è´¥ä¼šå‘æ¶ˆæ¯åˆ°ç¾¤é‡Œé€šçŸ¥å¤§å®¶ã€‚</p>
<h2 id="QA-Gitlab"><a href="#QA-Gitlab" class="headerlink" title="QA Gitlab"></a>QA Gitlab</h2><blockquote>
<p>Q9ï¼šgitlabæ¥æ”¶ä¸€ä¸ªpush eventè§¦å‘æ„å»ºï¼Œè¿™ä¸ªæ˜¯ç›‘æ§æ‰€æœ‰çš„åˆ†æ”¯å—ï¼Œåˆ†æ”¯æ¨¡å‹æ˜¯æ€ä¹ˆæ ·çš„</p>
</blockquote>
<p>Aï¼šä¸æ˜¯çš„ï¼ŒæŒ‰éœ€ã€‚æˆ‘ä»¬å†…éƒ¨åˆ†æ”¯æ¨¡å‹å¤§æ¦‚æœ‰å››ç§ï¼Œdevâ€”â€”&gt;testâ€”â€”&gt;releaseâ€”â€”&gt;masterã€‚masterä»¥å¤–çš„ä¸ºäº†æ•ˆç‡éƒ½ä¼šåšè‡ªåŠ¨è§¦å‘</p>
<blockquote>
<p>Q11ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨gitlab-runner è€Œæ¥jenkins</p>
</blockquote>
<p>Aï¼šgitlab-runner éœ€è¦æ¯ä¸ªä»“åº“éƒ½é…ç½®æ„å»ºä¿¡æ¯ï¼Œå½“éœ€è¦ç»Ÿä¸€ä¿®æ”¹æ„å»ºçš„æ—¶å€™å¾ˆéº»çƒ¦</p>
<blockquote>
<p>Qï¼šæŒç»­é›†æˆç³»ç»Ÿå…·ä½“çš„ç»†èŠ‚å¯ä»¥é€éœ²ä¸‹å—ï¼ŸåŸºäºgitlab ciï¼Œjekinsï¼Ÿæˆ–è€…å°å…¬å¸å¯ä»¥ç›´æ¥ç”¨Spinnaker è¿™äº›å—ï¼Ÿ</p>
</blockquote>
<p>Aï¼šci cdçš„è¯å› ä¸ºæˆ‘ä»¬æœ‰è‡ªå·±ç°æœ‰çš„å‘å¸ƒå¹³å°ï¼ŒèƒŒåçš„åŸç†å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨jenkinså»å¤„ç†</p>
<blockquote>
<p>Qï¼šå’Œgitlab ciç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿</p>
</blockquote>
<p>Aï¼š å’Œ gitlab ci ç›¸æ¯”çš„ä¼˜åŠ¿å¯ä»¥å‚è€ƒä¸‹ jenkins ä¸ jenkins xçš„å¯¹æ¯”ã€‚åœ¨ç”¨æˆ·è§’åº¦æ¥è¯´ï¼Œä»¥åº”ç”¨ä¸ºè§†è§’ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ–¹ä¾¿åˆ©ç”¨ç¤¾åŒºèµ„æºã€‚ä»æ¶æ„å’Œå¯ç»´æŠ¤æ€§æ¥è¯´ï¼ŒJenkins X çš„æ¶æ„ä¼šç›¸å¯¹æ›´åŠ å…ˆè¿›ï¼ˆä¸è¯ç”Ÿå¹´ä»£æœ‰ç›´æ¥å…³ç³»)ã€‚</p>
<blockquote>
<p>Qï¼š ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„gitlab-ci-runner éƒ¨ç½²äºk8sä¹‹å¤–å®ç°ci/cdã€‚å‘ç°gitlab-ciåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å¡æ­»æŠ¥é”™ã€‚è¯·é—®ä¸‹ï¼Œç›¸æ¯”jenkins åšci/cd æ˜¯ä¼šæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡jenkins.</p>
</blockquote>
<p>Aï¼šgitlab-ciç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä½¿ç”¨ï¼Œæˆ‘ä»¬è°ƒç ”çš„ç»“æœæ˜¯1ã€æœ‰ä¾µå…¥æ€§ 2ã€pipelineåŠŸèƒ½è¾ƒå¼±ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯é‡åˆ°é”™è¯¯å¥½åƒè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚jenkinsé‡åˆ°é”™è¯¯ä¼šä¸­æ–­æµç¨‹ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®Jenkinswebhooké‚£äº›æ„å»ºå‚æ•°å¦‚ä½•ä¼ å…¥GitLabè§¦å‘ï¼Ÿ</p>
</blockquote>
<p>Aï¼šwebhookçš„è§¦å‘å’Œç•Œé¢å‚æ•°ä¼šæœ‰ä¸€äº›åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬é‡Œé¢åšäº†å¤„ç†ã€‚</p>
<blockquote>
<p>Qï¼šç¦»çº¿éƒ¨ç½²ï¼Œæ˜¯ä¸æ˜¯é€šè¿‡æ‰“å‡ºé•œåƒå‹ç¼©åŒ…ï¼Œç„¶åå¸¦ç€é•œåƒåŒ…åˆ°ç°åœºéƒ¨ç½²çš„å®¹å™¨äº‘å¹³å°ä¸Šï¼Œä¸Šä¼ éƒ¨ç½²çš„æ–¹å¼ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæ˜¯åœ¨å®¶é‡Œæ‰“å‡ºé•œåƒå‹ç¼©åŒ…ï¼Œç„¶ååˆ°ç°åœºè§£å‹å‡ºæ¥ï¼Œæ ¹æ®é•œåƒç±»å‹è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ä¸€äº›åŸºç¡€é•œåƒï¼Œä¼šç›´æ¥ä¸Šä¼ åˆ°èŠ‚ç‚¹ï¼Œä¸šåŠ¡çš„é•œåƒä¼šåœ¨éƒ¨ç½²å®Œæˆåä¸Šä¼ åˆ°Harborï¼Œç„¶åèŠ‚ç‚¹ä»Harborå»æ‹‰å–ã€‚</p>
<blockquote>
<p>Qï¼šGitLab è‡ªå¸¦çš„ CI ä¸Jenkins å’Œ GitLab ç»“åˆçš„ CIï¼Œè¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿæƒ³çŸ¥é“æ›´æ·±å±‚æ¬¡çš„ç†è§£ã€‚</p>
</blockquote>
<p>Aï¼šè¿˜æ˜¯è¦ç»“åˆè‡ªå·±å›¢é˜Ÿçš„å®é™…æƒ…å†µåšé€‰æ‹©ã€‚ä»æˆç†Ÿåº¦æ¥è¯´ï¼Œè‚¯å®šæ˜¯ Jenkinsç”¨æˆ·æœ€å¤šï¼Œæˆç†Ÿåº¦æœ€é«˜ï¼Œç¼ºç‚¹æ˜¯ä¾§é‡ Javaï¼Œé…ç½®ç›¸å¯¹ç¹çã€‚GitLab è‡ªå¸¦çš„ CIç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç”¨ yamlï¼Œå’Œ GitLab ç»“åˆçš„æœ€å¥½ï¼Œä½†åŠŸèƒ½è‚¯å®šæ²¡æœ‰ Jenkinså…¨é¢ã€‚å¦‚æœæ˜¯å°å›¢é˜Ÿæ–°é¡¹ç›®ï¼ŒGitLab CI åˆå·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œå¹¶ä¸éœ€è¦ä¸ŠJenkinsï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„å›¢é˜Ÿï¼Œåˆæ˜¯å Java çš„ï¼Œä¸ªäººæ›´åå‘ Jenkinsã€‚</p>
<blockquote>
<p>Qï¼šæœ‰äº†Gerritï¼Œä¸ºä»€ä¹ˆè¿˜è¦GitLabï¼ŒGerritä¹Ÿå¯ä»¥æ‰˜ç®¡ä»£ç å•Šï¼Ÿ</p>
</blockquote>
<p>Aï¼šè¿™ä¸ªæ˜¯æœ‰å†å²èƒŒæ™¯çš„ï¼Œæˆ‘ä»¬æ˜¯å…ˆé€‰æ‹©ä½¿ç”¨GitLabåšä»£ç æ‰˜ç®¡ï¼ŒåæœŸæ‰åŠ å…¥Gerritåšcode reviewã€‚Gerritåœ¨ä»£ç reviewæ–¹é¢æ¯”GitLabçš„merge requestè¦æ–¹ä¾¿è®¸å¤šï¼Œæ›´é€‚åˆä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚å…³äºè¿™ä¸ªï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè¦ä¹ˆå°†GitLabè¿ç§»åˆ°Gerritï¼Œè¦ä¹ˆä¸ç”¨Gerritï¼Œå¯ä»¥ä½¿ç”¨GitLabçš„merge requestæ¥è¿›è¡Œreviewï¼Œé‚£GitLabå…¶å®æ˜¯å¯ä»¥ä¸è¦çš„ã€‚</p>
<blockquote>
<p>Qï¼šå…¬å¸ç¯å¢ƒè¾ƒå¤æ‚ï¼šåŒ…å«Javaé¡¹ç›®ã€PHPé¡¹ç›®ï¼ŒJavaé¡¹ç›®ç›®å‰å¤§å¤šæ˜¯SpringBootæ¡†æ¶ï¼ŒPHPæ˜¯ThinkPHPæ¡†æ¶ï¼Œé¡¹ç›®æ¶æ„å¹¶ä¸å¤æ‚ï¼Œæœ‰å°‘è®¸Javaé¡¹ç›®éœ€è¦ç”¨Redisåˆ°Memcachedã€ç¼“å­˜æœºåˆ¶ã€‚æœ€å¤§é—®é¢˜çš„æ˜¯å¤šï¼Œé¡¹ç›®åº”è¯¥å¦‚ä½•è¾ƒå¥½çš„ä¾æ‰˜Kubernetesé¡ºåˆ©æ¶æ„ï¼Œå°†é¡¹ç›®å¯æŒç»­é›†æˆï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬çš„Redisè¿™ä¸€ç±»ä¸­é—´ä»¶è¿˜æ”¾åœ¨VMä¸Šï¼Œç›®å‰å°šæœªæ‰“ç®—æ¬ç§»åˆ°Kubernetesä¸Šï¼ŒKubernetes+Dockerå¤©ç„¶æ˜¯è·¨å¹³å°çš„ï¼ŒPHPä¹Ÿå¯ä»¥æ”¯æŒï¼Œå¹¶ä¸”å¯¹å®¹å™¨é›†ç¾¤ï¼ˆæ—¢åº”ç”¨é›†ç¾¤ï¼‰ç®¡ç†éå¸¸å‡ºè‰²ï¼ŒåŒ…å«éƒ¨åˆ†è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå¹¶ä¸ä¼šå› å¤šç§å¼€å‘è¯­è¨€è€Œå¢åŠ è´Ÿæ‹…ï¼ŒæŒç»­é›†æˆæ˜¯å¦å¤–ä¸€å—ï¼Œç›®å‰å„å¤§CIå·¥å…·å‚å•†ä¹Ÿéƒ½æ”¯æŒKubernetesï¼Œæ¯”è¾ƒå‹å¥½ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯GitLab-CIã€‚</p>
<blockquote>
<p>Qï¼šSonarQubeçš„æƒé™æ§åˆ¶åŠæ€§èƒ½å½“é¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæƒé™æ§åˆ¶ä½¿ç”¨SonarQubeæä¾›çš„APIï¼Œå°†é¡¹ç›®è·ŸGitLabä¸­ç›¸åº”é¡¹ç›®æƒé™åŒ¹é…èµ·æ¥ï¼ŒGitLabä¸­å¯ä»¥æŸ¥çœ‹è¿™ä¸ªé¡¹ç›®ä»£ç ï¼Œé‚£ä¹ˆSonarQubeä¸­å°±èƒ½çœ‹åˆ°è¿™ä¸ªé¡¹ç›®ç»“æœå’ŒCodeã€‚</p>
<blockquote>
<p>Q: ä½ ä»¬æ˜¯ç›´æ¥å°†SonarQubeã€GitLab/Jenkinsçš„æƒé™æ§åˆ¶åˆ°ä¸€èµ·äº†ï¼Ÿæ€æ ·åšçš„ç»Ÿä¸€ï¼Ÿ</p>
</blockquote>
<p>Aï¼šä½¿ç”¨LDAPè®¤è¯ã€‚</p>
<blockquote>
<p>Qï¼šGit Checkoutçš„æ—¶å€™ï¼Œä½ ä»¬çš„Git SCMæ²¡æœ‰è€ƒè™‘éšç§å®‰å…¨çš„äº‹æƒ…å—ï¼Œæ¯”å¦‚ä»£ç æƒé™å—é™ï¼Ÿ</p>
</blockquote>
<p>Aï¼šJenkinsä½¿ç”¨äº†ä¸€ä¸ªæœ€å°æƒé™ç”¨æˆ·å»GitLabä¸Šæ‹‰ä»£ç ã€‚å®‰å…¨æ–¹é¢ï¼ŒJenkinsæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¯æ§çš„ã€‚</p>
<blockquote>
<p>Qï¼šJenkinsçš„æŒç»­é›†æˆæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿæ¯”å¦‚ä¸åŒçš„æºç ä»“åº“çš„æäº¤è§¦å‘ï¼Œå¦‚GitHubã€GitLabç‰ˆæœ¬å·æ€ä¹ˆæ§åˆ¶çš„ï¼Ÿ</p>
</blockquote>
<p>Aï¼šJenkinsçš„CIæµç¨‹è§¦å‘å¯ä»¥æœ‰å¾ˆå¤šç§ï¼Œä»£ç æäº¤è§¦å‘ï¼Œå®šæ—¶è§¦å‘ï¼Œæ‰‹åŠ¨è§¦å‘ã€‚ç‰ˆæœ¬å·çš„æ§åˆ¶ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨jobçš„ç¼–å·ï¼Œä½¿ç”¨Gitçš„commitå·ï¼Œä½¿ç”¨æ—¶é—´æˆ³ç­‰ç­‰ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ï¼Œæˆ‘ä»¬æ˜¯javaé¡¹ç›®ï¼Œåœ¨ä¸šåŠ¡ä»£ç æ‰“æˆwaråŒ…åï¼ŒwaråŒ…å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œåœ¨å‘å¸ƒæµç¨‹ä¸­ï¼Œå¦‚ä½•å®Œæˆpodä¸­çš„å®¹å™¨çš„ä»£ç æ›´æ–°ï¼Œæ˜¯é‡‡ç”¨æŒ‚è½½ä»£ç åé‡å¯å®¹å™¨æ–¹å¼ï¼Œè¿˜æ˜¯é‡‡ç”¨æ¯æ¬¡é‡æ–°æ„å»ºä»£ç é•œåƒï¼Œç›´æ¥æ›´æ–°å®¹å™¨ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆæ›´å¥½çš„å»ºè®®å—</p>
</blockquote>
<p>Aï¼šé…ç½®åˆ†ç¦»ï¼ˆä¸Šé…ç½®ä¸­å¿ƒ)ï¼Œå‚æ•°é€šè¿‡å¯åŠ¨é‰´æƒä¸‹è½½é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œè¿™æ ·å­ç¯å¢ƒçš„æ›´æ–°åªéœ€è¦åŸºäºé€šè¿‡ä¸€ä¸ªåŒ…å³å¯ã€‚</p>
<blockquote>
<p>Qï¼šä¸€ä¸ªJobç”Ÿæˆæ‰€æœ‰çš„Dockeré•œåƒï¼Œå¦‚æœæ„å»ºé‡åˆ°é—®é¢˜ï¼Œæ€ä¹ˆå»è¿½è¸ªè¿™äº›è®°å½•ï¼Ÿ</p>
</blockquote>
<p>Aï¼šåœ¨é¡¹ç›®å‰æœŸæ¥å…¥æ—¶ï¼Œç”Ÿæˆé•œåƒçš„æµç¨‹éƒ½ä½œäº†å®£ä¼ å’Œæ¨å¹¿ã€‚æ ‡å‡†åŒ–çš„æµç¨‹ï¼Œä¼šå‡å°‘äº§ç”Ÿé—®é¢˜çš„æœºç‡ã€‚å¦‚æœåœ¨æ„å»ºä¸­é‡åˆ°é—®é¢˜ï¼ŒPrism4kçš„ç•Œé¢ä¸­ï¼Œä¼šç›´æ¥æœ‰é“¾æ¥åˆ°æœ¬æ¬¡å»ºçš„æ¬¡åºå·ã€‚ç‚¹å‡»é“¾æ¥ï¼Œå¯ç›´æ¥å®šä½åˆ°Consoleè¾“å‡ºã€‚</p>
<blockquote>
<p>Qï¼šJobå’Œdindå¦‚ä½•é…åˆå»å®ç°æ‰“åŒ…é•œåƒçš„å‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šé¦–å…ˆæ˜¯dindæŠ€æœ¯ï¼Œé€šè¿‡æŒ‚è½½å®¿ä¸»æœºçš„docker clientå’Œdockersockï¼Œå¯ä»¥å®ç°åœ¨å®¹å™¨å†…è°ƒç”¨å®¿ä¸»æœºçš„Dockeræ¥åšä¸€äº›äº‹æƒ…ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å°±ç”¨äºbuildã€‚Kubernetesçš„Jobåˆ™æ˜¯ç”¨äºæ‰§è¡Œè¿™ä¸ªæ„å»ºworkerçš„æ–¹å¼ï¼Œåˆ©ç”¨Kubernetesçš„Jobæ¥è°ƒåº¦æ„å»ºä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨æµ‹è¯•é›†ç¾¤çš„ç©ºé—²èµ„æºã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®ä¸‹Mavençš„settings.xmlæ€ä¹ˆå¤„ç†ï¼Ÿæœ¬åœ°Mavenä»“åº“å‘¢ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬æ„å»ºäº†ç§æœ‰çš„ Maven é•œåƒï¼Œ ç§æœ‰é•œåƒä¸­æ˜¯é»˜è®¤ä½¿ç”¨äº†æˆ‘ä»¬çš„ç§æœ‰æºã€‚ å¯¹äºé¡¹ç›®ä¸­ç”¨æˆ·æ— éœ€å…³æ³¨ settings.xml ä¸­æ˜¯å¦é…ç½®repoã€‚</p>
<blockquote>
<p>Qï¼šç”Ÿæˆæ–°çš„é•œåƒæ€ä¹ˆè‡ªåŠ¨æ‰“æ–°çš„tagï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬é•œåƒTagä½¿ç”¨æœ¬æ¬¡æ„å»ºé€‰å®šçš„Gitç‰ˆæœ¬ï¼Œå¦‚åˆ†æ”¯åç§°æˆ–è€…Tagã€‚</p>
<blockquote>
<p>Qï¼š å¦‚ä½•åŠ¨æ€ç”ŸæˆDockerfileï¼Œå¦‚ä½•åœ¨Dockeré•œåƒé‡Œé…ç½®JVMå‚æ•°ï¼Ÿ</p>
</blockquote>
<p>Aï¼šDockerfileæ–‡ä»¶ï¼šæˆ‘ä»¬æ˜¯ä½¿ç”¨shè„šæœ¬ç”Ÿæˆçš„ï¼Œå°†å†…å®¹ &gt;&gt; Dockerfileä¸­ï¼›JVMå‚æ•°æ˜¯åœ¨åº”ç”¨ä¸­é…ç½®çš„ï¼Œå‘é€æ„å»ºæ¶ˆæ¯æ—¶ï¼Œä½œä¸ºæ¶ˆæ¯å†…å®¹é€è¿‡å»ã€‚</p>
<blockquote>
<p>Qï¼šDocker çš„æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒå·²ç»æ„å»ºäº†ä¼ä¸šç§æœ‰ Registry Harborï¼Œé‚£ä¹ˆæˆ‘è¦æ„å»ºåŸºäºä¸šåŠ¡çš„åº”ç”¨æ—¶ï¼Œæ˜¯å…ˆä» Linux ç³»åˆ—çš„åƒ Ubuntu æˆ– CentOS çš„ Base çš„ Docker é•œåƒå¼€å§‹ï¼Œç„¶åé€šè¿‡ Dockerfile å®šåˆ¶ä¸šåŠ¡éœ€æ±‚ï¼Œæ¥ä½¿ç”¨å—ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬åŸºç¡€é•œåƒç»Ÿä¸€é‡‡ç”¨ CentOS 6.8ï¼Œä¸åŒçš„ä¸šåŠ¡æœ‰ä¸åŒçš„ Dockerfile æ¨¡æ¿ï¼Œç”Ÿæˆé•œåƒçš„è¿‡ç¨‹ä¸šåŠ¡å¯¹ Dockerfile æ˜¯é€æ˜çš„ã€‚</p>
<blockquote>
<p>Qï¼šä½¿ç”¨Pipelineå…ˆæ„å»ºç¼–è¯‘ç¯å¢ƒé•œåƒï¼Œå†ç¼–è¯‘ï¼Œæ˜¯å¦ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Ÿæ˜¯å¦æœ‰ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ</p>
</blockquote>
<p>Aï¼šç¼–è¯‘é•œåƒç”±äºä¸ä¼šç»å¸¸å˜åŠ¨ï¼Œå› æ­¤è¿™ä¸ªé•œåƒçš„æ„å»ºé€šå¸¸ä½¿ç”¨cacheå°±èƒ½ç›´æ¥å®Œæˆï¼Œå¦å¤–æˆ‘ä»¬ä¹ŸæŠŠç¼–è¯‘ç¯å¢ƒé•œåƒæ‰“åŒ…è¿™ä¸ªæ­¥éª¤æŠ½å‡ºæ¥å•ç‹¬ä½œä¸ºjobæ‰§è¡Œäº†ï¼Œè¿™æ ·åœ¨å®é™…ç¼–è¯‘æµç¨‹ä¸­å°±æ— éœ€å†è¿›è¡Œç¼–è¯‘ç¯å¢ƒæ„å»ºã€‚</p>
<blockquote>
<p>Qï¼šDockerå­˜å‚¨è€ƒè™‘è¿‡Overlayå½“æ—¶å—ï¼Ÿæ®è¯´è¿™ç§æ„å»ºé•œåƒæ¯”è¾ƒå¿«ã€‚</p>
</blockquote>
<p>Aï¼šè€ƒè™‘è¿‡ï¼Œå½“æ—¶ä¹Ÿåšè¿‡å„ä¸ªæ–¹é¢çš„æµ‹è¯•ï¼Œè¿™ç§å¢é‡å¼çš„æ„å»ºï¼Œè‚¯å®šæœ€å¿«ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æœ‰ä¸“äººä»æºç çº§åˆ«å¯¹å…¶è¿›è¡Œç»´æŠ¤ï¼Œæˆæœ¬å¯¹äºæˆ‘ä»¬è¿˜æ˜¯æœ‰ç‚¹é«˜ï¼Œæˆ‘ä»¬åæœŸæ‰“ç®—é‡‡ç”¨ç¯å¢ƒå’Œä»£ç åˆ†ç¦»çš„æ–¹å¼ï¼Œå³ç¯å¢ƒéƒ¨ç½²ä¸€æ¬¡ï¼Œä»£ç å¤šæ¬¡éƒ¨ç½²æ¥æå‡æ•ˆç‡ã€‚</p>
<blockquote>
<p>Qï¼šæ‚¨æåˆ°ä¸è¿‡åˆ†å¼ºè°ƒæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œå°½é‡ä¸æ”¹å˜æµ‹è¯•æµç¨‹ï¼Œé‚£ä¹ˆå¯¹äºè‡ªåŠ¨æ„å»ºå’Œå•å…ƒæµ‹è¯•çš„è‡ªåŠ¨åŒ–æœ‰æ²¡æœ‰è€ƒè™‘å‘¢ï¼Ÿæ¯•ç«Ÿè¿™äº›æ˜¯æ¯”è¾ƒæ¶ˆè€—äººåŠ›çš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<p>Aï¼šè‡ªåŠ¨æ„å»ºæˆ‘è®¤ä¸ºæ¯”è¾ƒç°å®ï¼Œå•å…ƒæµ‹è¯•æœ‰è€ƒè™‘ã€‚ä¸è¿‡æˆ‘ä»¬æµ‹è¯•æ¡ˆä¾‹è¿‡äºå¤æ‚ï¼Œç›®å‰çœ‹çŸ­æœŸå®ç°ä¸å¤ªç°å®ã€‚è€Œä¸”æ€§èƒ½ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸‹ä¸€æ­¥è¦åšæˆ‘ä»¬ä¼šæ›´å¤šè€ƒè™‘ä¸€äº›ç‰¹å®šåœºæ™¯ã€‚æ¯”å¦‚äº§å“å‘å¸ƒåçš„å›å½’æµ‹è¯•ï¼Œè¿™ä¸ªæœ‰å¯èƒ½ï¼Œä½†ä¸ä¼šæ˜¯æ™®éåº”ç”¨ã€‚</p>
<blockquote>
<p>Qï¼šè‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯¹åº”ç”¨çš„æµ‹è¯•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p>
</blockquote>
<p>Aï¼šå•å…ƒæµ‹è¯•å¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å®Œæˆï¼ŒåŠŸèƒ½æµ‹è¯•éœ€è¦å¯åŠ¨éƒ¨ç½²ã€‚</p>
<blockquote>
<p>Qï¼šé€šè¿‡é•œåƒçš„æ„å»ºè„šæœ¬æ˜¯æ€ä¹ˆç”Ÿæˆé•œåƒçš„ï¼Ÿåœ¨åŸºç¡€é•œåƒä¸Šæ‰§è¡Œç›¸å…³è„šæœ¬ä¹ˆï¼Ÿä¸€äº›ç«¯å£å­˜å‚¨å·ç¯å¢ƒå˜é‡è¿™äº›é•œåƒä¸­çš„ä¿¡æ¯æ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ</p>
</blockquote>
<p>Aï¼šæˆ‘ä»¬å¯¹Dockerfileè¿›è¡Œäº†å°è£…ï¼Œä¸šåŠ¡å’Œå¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒDockerfileè¯­æ³•ï¼Œç›´æ¥å†™ä¸€ä¸ªé•œåƒæ„å»ºè„šæœ¬ï¼Œæœ€åæ ¹æ®ä¸€å®šçš„è§„åˆ™ç”±Harborç”ŸæˆDockerfileï¼Œä¹‹åè°ƒç”¨docker buildå»ç”Ÿæˆé•œåƒã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ é•œåƒçš„åç§°ï¼Œç‰ˆæœ¬éƒ½å·²ç»æ ¹æ®è§„åˆ™ç”Ÿæˆ</p>
<blockquote>
<p>Qï¼šåœ¨æ„å»ºæ—¶å€™ï¼Œè¿™äº›ç¯å¢ƒå¯ä»¥æå‰å®‰è£…å¥½ï¼Ÿ</p>
</blockquote>
<p>Aï¼šåº”ç”¨é‡Œéƒ½æœ‰è‡ªå·±çš„ç‰ˆæœ¬æ¦‚å¿µï¼Œæ¯ä¸ªåº”ç”¨ç‰ˆæœ¬é‡Œæœ‰ï¼šé•œåƒç‰ˆæœ¬ï¼Œç¯å¢ƒå˜é‡ã€ exportã€Volmueç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å›é€€æˆ–è€…å‡çº§æ—¶å€™ï¼Œæœ€ç»ˆçš„è¡¨ç°å½¢å¼å°±æ˜¯æ€æ‰æ—§å®¹å™¨ï¼Œæ ¹æ®ç‰ˆæœ¬çš„å‚æ•°åˆ›å»ºæ–°å®¹å™¨ã€‚</p>
<blockquote>
<p>Qï¼šè¯·é—®æ„å»ºä¸€æ¬¡å¹³å‡è¦å¤šé•¿æ—¶é—´ï¼Ÿ</p>
</blockquote>
<p>Aï¼šç°åœ¨Javaã€Dubboã€Pythonã€goçš„å¤šï¼Œ ä¸€èˆ¬2åˆ†é’Ÿï¼Œè€Œä¸”æœ‰çš„é•œåƒç”¨æˆ·å¼€å¯äº†è‡ªåŠ¨æ„å»ºåï¼Œåœ¨ä»–ä»¬æ²¡æ„è¯†çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½å·²ç»æ„å»ºå®Œæˆã€‚ åˆ°æ—¶å€™å‡çº§æ—¶å€™ï¼Œé€‰æ‹©å¯¹åº”çš„é•œåƒç‰ˆæœ¬å³å¯ã€‚</p>
<blockquote>
<p>Qï¼šAppçš„æ¯ä¸€æ¬¡æäº¤éƒ½æ˜¯ä¸€ä¸ªversionå—ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡æ„å»ºå®Œæµ‹è¯•å®Œæˆï¼Œå°±å¯ä»¥å‘å¸ƒäº†ï¼Ÿ</p>
</blockquote>
<p>Aï¼šApp æ²¡æœ‰æäº¤çš„æ¦‚å¿µï¼Œæ‚¨è¯´çš„åº”è¯¥æ˜¯é•œåƒï¼Œæˆ‘ä»¬è®¾è®¡çš„æ˜¯ä¸€ä¸ªé•œåƒå¯¹åº”ä¸€ä¸ªGitä»“åº“ä»¥åŠåˆ†æ”¯ã€‚å½“æœ‰pushæˆ–è€…tagæ“ä½œåï¼Œä¼šè‡ªåŠ¨è§¦å‘æ„å»ºï¼Œæ„å»ºçš„è¡Œä¸ºæ˜¯æ ¹æ®ç”¨æˆ·å†™çš„é•œåƒæ„å»ºshellè„šæœ¬æ¥å†³å®šçš„ã€‚ ä¸€èˆ¬æˆ‘ä»¬å»ºè®®ä¸šåŠ¡éƒ¨é—¨åšå‡ºçš„é•œåƒè·Ÿæµ‹è¯•ç¯å¢ƒå’Œç”Ÿæˆç¯å¢ƒæ²¡å…³ç³»ã€‚ é•œåƒå°±æ˜¯é•œåƒï¼Œåªæœ‰åº”ç”¨æœ‰æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚</p>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/harbor/" rel="tag"><i class="fa fa-tag"></i> harbor</a>
              <a href="/tags/gitlab/" rel="tag"><i class="fa fa-tag"></i> gitlab</a>
              <a href="/tags/CI-CD/" rel="tag"><i class="fa fa-tag"></i> CI/CD</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/with-chanshiyu-qa.html" rel="prev" title="å’Œè‰æ—¶é›¨çš„æœ‰è¶£ç¬”è°ˆ">
      <i class="fa fa-chevron-left"></i> å’Œè‰æ—¶é›¨çš„æœ‰è¶£ç¬”è°ˆ
    </a></div>
      <div class="post-nav-item">
    <a href="/kubeadm-deploy-k8s-v1.17.4.html" rel="next" title="ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s">
      ä½¿ç”¨ kubeadm å¿«é€Ÿéƒ¨ç½²ä½“éªŒ K8s <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
  </div>
          </div>
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitlab"><span class="nav-number">1.</span> <span class="nav-text">Gitlab</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Omnibus-åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ"><span class="nav-number">1.1.</span> <span class="nav-text">Omnibus åŒ…å®‰è£…æ–¹å¼æ¯”è¾ƒ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£…-Gitlab"><span class="nav-number">2.</span> <span class="nav-text">å®‰è£… Gitlab</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu-1804"><span class="nav-number">2.1.</span> <span class="nav-text">Ubuntu 1804</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CentOS7"><span class="nav-number">2.2.</span> <span class="nav-text">CentOS7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸"><span class="nav-number">2.3.</span> <span class="nav-text">2.æ‰“è¡¥ä¸ï¼Œè¡¥å……æ±‰åŒ–çš„è¡¥ä¸</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-ä¿®æ”¹é»˜è®¤é…ç½®"><span class="nav-number">2.4.</span> <span class="nav-text">3. ä¿®æ”¹é»˜è®¤é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-åˆå§‹åŒ–è®¾ç½®"><span class="nav-number">2.5.</span> <span class="nav-text">4. åˆå§‹åŒ–è®¾ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£…-gitlab-runner"><span class="nav-number">3.</span> <span class="nav-text">å®‰è£… gitlab-runner</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debian-Ubuntu"><span class="nav-number">3.1.</span> <span class="nav-text">Debian&#x2F;Ubuntu</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CentOS7-1"><span class="nav-number">3.2.</span> <span class="nav-text">CentOS7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ³¨å†Œ-gitlab-runner"><span class="nav-number">3.3.</span> <span class="nav-text">æ³¨å†Œ gitlab-runner</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¿®æ”¹-gitlab-é»˜è®¤ç½‘ç»œè®¾ç½®"><span class="nav-number">3.4.</span> <span class="nav-text">ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨é¡¹ç›®ä¸­æ³¨å†Œ-Runner"><span class="nav-number">3.5.</span> <span class="nav-text">åœ¨é¡¹ç›®ä¸­æ³¨å†Œ Runner</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éƒ¨ç½²-Harbor"><span class="nav-number">4.</span> <span class="nav-text">éƒ¨ç½² Harbor</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®-insecure-registry"><span class="nav-number">4.1.</span> <span class="nav-text">è®¾ç½® insecure registry</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æµ‹è¯•-CI-CD-é¡¹ç›®"><span class="nav-number">5.</span> <span class="nav-text">æµ‹è¯• CI&#x2F;CD é¡¹ç›®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#gitlab-ci-yaml"><span class="nav-number">5.1.</span> <span class="nav-text">.gitlab-ci.yaml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒ-æ¨è"><span class="nav-number">6.</span> <span class="nav-text">å‚è€ƒ&#x2F;æ¨è</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç¤¾ç¾¤é—®ç­”-QA-CI-CD-ç›¸å…³"><span class="nav-number">7.</span> <span class="nav-text">ç¤¾ç¾¤é—®ç­” QA | CI&#x2F;CD ç›¸å…³</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ"><span class="nav-number">7.1.</span> <span class="nav-text">2019-04-03ï¼šå®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŸºäº-GitLab-çš„-CI-å®è·µ"><span class="nav-number">7.2.</span> <span class="nav-text">åŸºäº GitLab çš„ CI å®è·µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ"><span class="nav-number">8.</span> <span class="nav-text">2015-09-23ï¼šåŸºäºDockerå’ŒJavaçš„æŒç»­é›†æˆå®è·µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ"><span class="nav-number">9.</span> <span class="nav-text">2015-12-22ï¼šåŸºäºDockerå’ŒGitçš„æŒç»­é›†æˆå·¥ä½œæµ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QA-Gitlab"><span class="nav-number">10.</span> <span class="nav-text">QA Gitlab</span></a></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="æœ¨å­"
      src="https://blog.k8s.li/avatar.png">
  <p class="site-author-name" itemprop="name">æœ¨å­</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail â†’ mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://kindle.502.li/" title="Kindle â†’ https:&#x2F;&#x2F;kindle.502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tg.k8s.li/" title="Channel â†’ https:&#x2F;&#x2F;tg.k8s.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Channel</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æœ¨å­</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">39:50</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
      </div>
    </footer>
  </div>
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.k8s.li/gitlab-ci-harbor.html",
            identifier: "gitlab-ci-harbor.html",
            title: "åŸºäº Gitlab-ci + Harbor çš„ CI æµæ°´çº¿"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://muzi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>
</body>
</html>
