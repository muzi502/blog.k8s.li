<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="//fonts.loli.net" crossorigin>
<link rel="preconnect" href="null//null" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="更新日志 2019-12-31 初稿，可能完成不了，等到来年了 😂 2020-01-01  容器优化型操作系统？GKE 的  Container-Optimized OSGoogle 家的  GKE  中的每个节点都是使用 Container-Optimized OS 来运行工作负载，不过仅仅是针对 GCE 来进行优化的，可能在 OpenStack 或者 vSphere 上运行不起来，(瞎猜 �">
<meta property="og:type" content="blog">
<meta property="og:title" content="Container Linux OS 从入坑到爬出来😂">
<meta property="og:url" content="https://blog.k8s.li/container-linux-os.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="更新日志 2019-12-31 初稿，可能完成不了，等到来年了 😂 2020-01-01  容器优化型操作系统？GKE 的  Container-Optimized OSGoogle 家的  GKE  中的每个节点都是使用 Container-Optimized OS 来运行工作负载，不过仅仅是针对 GCE 来进行优化的，可能在 OpenStack 或者 vSphere 上运行不起来，(瞎猜 �">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20191231163325900.png">
<meta property="og:image" content="https://p.k8s.li/20191231163400135.png">
<meta property="og:image" content="https://p.k8s.li/rancheroshowitworks.png">
<meta property="og:image" content="https://p.k8s.li/20191231105906355.png">
<meta property="og:image" content="https://p.k8s.li/20191231110111943.png">
<meta property="og:image" content="https://p.k8s.li/20191231110153113.png">
<meta property="og:image" content="https://p.k8s.li/20191231110231422.png">
<meta property="og:image" content="https://p.k8s.li/20191231110339494.png">
<meta property="og:image" content="https://p.k8s.li/20191231110531238.png">
<meta property="og:image" content="https://p.k8s.li/20191231111131193.png">
<meta property="og:image" content="https://p.k8s.li/20191231113306435.png">
<meta property="og:image" content="https://p.k8s.li/20191231125441199.png">
<meta property="og:image" content="https://p.k8s.li/20191231133509428.png">
<meta property="og:image" content="https://p.k8s.li/20191231135348120.png">
<meta property="og:image" content="https://p.k8s.li/20191231142454934.png">
<meta property="og:image" content="https://p.k8s.li/20191231143958024.png">
<meta property="article:published_time" content="2019-12-30T16:00:00.000Z">
<meta property="article:modified_time" content="2024-06-16T00:36:30.191Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="容器">
<meta property="article:tag" content="kubernees">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20191231163325900.png">


<link rel="canonical" href="https://blog.k8s.li/container-linux-os.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/container-linux-os.html","path":"container-linux-os.html","title":"Container Linux OS 从入坑到爬出来😂"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Container Linux OS 从入坑到爬出来😂 | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97"><span class="nav-number">1.</span> <span class="nav-text">更新日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E4%BC%98%E5%8C%96%E5%9E%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">容器优化型操作系统？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GKE-%E7%9A%84-Container-Optimized-OS"><span class="nav-number">2.1.</span> <span class="nav-text">GKE 的  Container-Optimized OS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CoreOS-Container-Linux"><span class="nav-number">2.2.</span> <span class="nav-text">CoreOS Container Linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Photon-OS"><span class="nav-number">2.3.</span> <span class="nav-text">Photon OS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RancherOS"><span class="nav-number">2.4.</span> <span class="nav-text">RancherOS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%BD%93%E9%AA%8C"><span class="nav-number">3.</span> <span class="nav-text">安装体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Container-Optimized-OS"><span class="nav-number">3.1.</span> <span class="nav-text">Container-Optimized OS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Photon-OS-1"><span class="nav-number">4.</span> <span class="nav-text">Photon OS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-number">4.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F"><span class="nav-number">4.2.</span> <span class="nav-text">安装镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">4.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8"><span class="nav-number">4.4.</span> <span class="nav-text">系统启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E6%A0%B8"><span class="nav-number">4.5.</span> <span class="nav-text">内核</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%8D%A0%E7%94%A8%E6%83%85%E5%86%B5"><span class="nav-number">4.6.</span> <span class="nav-text">资源占用情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.7.</span> <span class="nav-text">进程和服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="nav-number">4.8.</span> <span class="nav-text">包管理工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E"><span class="nav-number">4.9.</span> <span class="nav-text">docker 容器引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C"><span class="nav-number">4.10.</span> <span class="nav-text">使用体验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CoreOS-Container-Linux-1"><span class="nav-number">5.</span> <span class="nav-text">CoreOS Container Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-1"><span class="nav-number">5.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F-OVA"><span class="nav-number">5.2.</span> <span class="nav-text">安装镜像 OVA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">5.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8-1"><span class="nav-number">5.4.</span> <span class="nav-text">系统启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%8D%A0%E7%94%A8%E6%83%85%E5%86%B5-1"><span class="nav-number">5.5.</span> <span class="nav-text">资源占用情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E4%BB%A5%E5%8F%8A%E5%8F%91%E8%A1%8C%E7%89%88%E4%BF%A1%E6%81%AF"><span class="nav-number">5.6.</span> <span class="nav-text">内核以及发行版信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E-1"><span class="nav-number">5.7.</span> <span class="nav-text">docker 容器引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD-1"><span class="nav-number">5.8.</span> <span class="nav-text">负载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E6%9C%8D%E5%8A%A1-1"><span class="nav-number">5.9.</span> <span class="nav-text">进程和服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-1"><span class="nav-number">5.10.</span> <span class="nav-text">包管理工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C-1"><span class="nav-number">5.11.</span> <span class="nav-text">使用体验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RancherOS-1"><span class="nav-number">6.</span> <span class="nav-text">RancherOS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-2"><span class="nav-number">6.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F-1"><span class="nav-number">6.2.</span> <span class="nav-text">安装镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-2"><span class="nav-number">6.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E4%BB%A5%E5%8F%8A%E5%8F%91%E8%A1%8C%E7%89%88%E4%BF%A1%E6%81%AF-1"><span class="nav-number">6.4.</span> <span class="nav-text">内核以及发行版信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E-2"><span class="nav-number">6.5.</span> <span class="nav-text">docker 容器引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rancher-%E5%BC%95%E6%93%8E"><span class="nav-number">6.6.</span> <span class="nav-text">rancher 引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%8D%A0%E7%94%A8"><span class="nav-number">6.7.</span> <span class="nav-text">资源占用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96"><span class="nav-number">6.8.</span> <span class="nav-text">系统服务容器化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ros"><span class="nav-number">6.9.</span> <span class="nav-text">ros</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B"><span class="nav-number">6.10.</span> <span class="nav-text">系统进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">6.11.</span> <span class="nav-text">包管理器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F"><span class="nav-number">7.</span> <span class="nav-text">结束</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">120</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">155</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:muzi502.li@gmail.com" title="E-Mail → mailto:muzi502.li@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi502" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/container-linux-os.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Container Linux OS 从入坑到爬出来😂 | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Container Linux OS 从入坑到爬出来😂
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-31 2019-12-31T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2019-12-31T00:00:00+08:00">2019-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-16 2024-06-16T08:36:30+08:00" itemprop="dateModified" datetime="2024-06-16T08:36:30+08:00">2024-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/container-linux-os.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="container-linux-os.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>37k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>33 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><ul>
<li>2019-12-31 初稿，可能完成不了，等到来年了 😂</li>
<li>2020-01-01</li>
</ul>
<h2 id="容器优化型操作系统？"><a href="#容器优化型操作系统？" class="headerlink" title="容器优化型操作系统？"></a>容器优化型操作系统？</h2><h3 id="GKE-的-Container-Optimized-OS"><a href="#GKE-的-Container-Optimized-OS" class="headerlink" title="GKE 的  Container-Optimized OS"></a>GKE 的  <a target="_blank" rel="noopener" href="https://cloud.google.com/container-optimized-os/docs/">Container-Optimized OS</a></h3><p>Google 家的  GKE  中的每个节点都是使用 <a target="_blank" rel="noopener" href="https://cloud.google.com/container-optimized-os/docs/">Container-Optimized OS</a> 来运行工作负载，不过仅仅是针对 GCE 来进行优化的，可能在 OpenStack 或者 vSphere 上运行不起来，(瞎猜 😂</p>
<blockquote>
<p>Container-Optimized OS 是适用于 <a target="_blank" rel="noopener" href="https://cloud.google.com/compute">Compute Engine</a> 虚拟机的操作系统映像，专为运行 Docker 容器而优化。借助 Container-Optimized OS，您可以快速、高效、安全地在  Google Cloud Platform 上启动 Docker 容器。Container-Optimized OS 由 Google  维护，基于 <a target="_blank" rel="noopener" href="https://www.chromium.org/chromium-os">Chromium OS</a> 开放源代码项目。</p>
</blockquote>
<h3 id="CoreOS-Container-Linux"><a href="#CoreOS-Container-Linux" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h3><p>个人认为 CoreOS 的 CoreOS Container Linux 要比 Container-Optimized OS 和 Photon OS 要更加专业，尤其是针对容器来讲， CoreOS 就是专门用来运行容器的，它没有像 yum 或 apt 这样的包管理器来安装软件，在 CoreOS 中你不需要安装软件，因为所有的应用程序都要使用 docker 来打包。</p>
<blockquote>
<p>额外提一句，CoreOS 是一个团队，现如今已经被 Red Hat® 收购了，而 Red Hat® 已经被 IBM 收购了，按照关系来讲而 CoreOS 应该是 IBM 的孙子吧 🙃。而 CoreOS Container Linux 仅仅是他们维护项目的其中一个，CoreOS 开源的项目还有：</p>
<ul>
<li>etcd：</li>
<li>Clair:</li>
<li>dex：</li>
<li>Prometheus：</li>
<li>flannel：</li>
</ul>
</blockquote>
<p>在 Linux 世界里有大量的发行版可以做为服务器系统使用, 但是这些系统大多部署复杂, 更新系统更是困难重重. 这些都是 CoreOS 试图解决的问题。</p>
<h4 id="特点如下"><a href="#特点如下" class="headerlink" title="特点如下"></a>特点如下</h4><ul>
<li>最小化的操作系统： 占用内存很少，比典型的服务器版本 Linux 少占 40% 的内存。</li>
<li>易于升级： CoreOS 采用双系统分区（主动分区&#x2F;被动分区）设计而不是采用传统的通过升级包来升级系统，这使得每次升级更加快速，可靠和易于回滚。</li>
<li>集成 Docker： CoreOS 默认集成 Docker 并作了很好的支持和优化，省去用户安装，配置，优化 Docker 的时间，极大地方便了用户。</li>
<li>易于集群化： CoreOS 本身提供了大型 Docker 容器集群的整体解决方案，通过内置的 fleet 工具在多台系统中部署容器并进行集群化管理。同时通过提供 Discovery Service，便于动态部署和管理集群，解决方案比较成熟。</li>
<li>自动化的大规模部署： CoreOS 自身提供的解决方案能够自动地大规模批量部署并操作系统，极大地减少用户工作量。</li>
<li>使用 systemd 做为系统服务管理工具，性能比较好，systemd 有现代化的日志功能，同时采用 socket 式与 D-Bus 总线式激活服务.</li>
</ul>
<h3 id="Photon-OS"><a href="#Photon-OS" class="headerlink" title="Photon OS"></a>Photon OS</h3><h4 id="官方宣传册"><a href="#官方宣传册" class="headerlink" title="官方宣传册"></a>官方宣传册</h4><p>PPT 做的不错呦 😂</p>
<p><img data-src="https://p.k8s.li/20191231163325900.png"></p>
<p><img data-src="https://p.k8s.li/20191231163400135.png"></p>
<p>剽窃一段 VMware 官方的<a target="_blank" rel="noopener" href="https://vmware.github.io/photon/">文档</a>介绍：</p>
<blockquote>
<p>Project Photon OS™ is an open source, minimal Linux container host  that is optimized for cloud-native applications, cloud platforms, and  VMware infrastructure. Photon OS 3.0 introduces ARM64 support, installer improvements and updated packages. We invite partners, customers, and  community members to collaborate on using Photon OS to run  high-performance virtual machines and containerized applications.</p>
<ul>
<li><strong>Optimized for VMware vSphere®</strong>: The Linux kernel is tuned for performance when Photon OS runs on vSphere.</li>
<li><strong>Support for containers</strong>: Photon OS includes the Docker daemon and works with container orchestration frameworks, such as Mesos and Kubernetes.</li>
<li><strong>Efficient lifecycle management</strong>: Photon OS is easy to manage, patch, and update.</li>
<li><strong>Security hardened</strong>: The kernel and other aspects of the operating system are built with an emphasis on security.</li>
</ul>
<p>For more information, see the <a target="_blank" rel="noopener" href="https://vmware.github.io/photon/assets/files/photon-os-datasheet.pdf">datasheet</a>.</p>
<p>Track our progress in earning the Linux Foundation’s Core Infrastructure Initiative’s Best Practices Badge.</p>
</blockquote>
<p>可以看出 Photon OS™ 是针对 VMware vSphere® 虚拟化平台进行内核优化的容器专用操作系统，就和 CoreOS 一样。十分适合专门用来运行容器，当作 Kubernetes 集群中的工作负载来使用。</p>
<h3 id="RancherOS"><a href="#RancherOS" class="headerlink" title="RancherOS"></a>RancherOS</h3><p>剽窃一段官方的<a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/">介绍</a>：</p>
<blockquote>
<p>RancherOS is the smallest, easiest way to run Docker in production. Every process in RancherOS is a container managed by Docker. This includes system services such as <code>udev</code> and <code>syslog</code>. Because it only includes the services necessary to run Docker, RancherOS is significantly smaller than most traditional operating systems. By removing unnecessary libraries and services, requirements for security patches and other maintenance are also reduced. This is possible because, with Docker, users typically package all necessary libraries into their containers.</p>
<p>Another way in which RancherOS is designed specifically for running Docker is that it always runs the latest version of Docker. This allows users to take advantage of the latest Docker capabilities and bug fixes.</p>
<p>Like other minimalist Linux distributions, RancherOS boots incredibly quickly. Starting Docker containers is nearly instant, similar to starting any other process. This speed is ideal for organizations adopting microservices and autoscaling.</p>
<p>Docker is an open-source platform designed for developers, system admins, and DevOps. It is used to build, ship, and run containers, using a simple and powerful command line interface (CLI). To get started with Docker, please visit the <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/userguide/">Docker user guide</a>.</p>
</blockquote>
<p>RancherOS 是 Rancher 团队所维护的开源项目，也是对标 CoreOS 一样，专门用来运行容器，并且可以运行在生产环境（至少官方做了这么样的承诺，咱也没在生产用过，不好说。在 RancherOS 中所有的进程（包括系统所有的服务，比如 udev 和 syslog）都是用 docker 来管理，这一点要比 CoreOS 更加激进一些，而 CoreOS 还是使用传统 Linux 发行版中的 systemd 来管理系统中的服务。通过移除传统 Linux 发行版中不必要的服务和库来最小化系统，使他专注单一的功能，即运行 docker 容器。</p>
<blockquote>
<p>Everything in RancherOS is a Docker container. We accomplish this by launching two instances of Docker. One is what we call <strong>System Docker</strong> and is the first process on the system. All other system services, like <code>ntpd</code>, <code>syslog</code>, and <code>console</code>, are running in Docker containers. System Docker replaces traditional init systems like <code>systemd</code> and is used to launch <a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/system-services/adding-system-services/">additional system services</a>.</p>
<p>System Docker runs a special container called <strong>Docker</strong>, which is another Docker daemon responsible for managing all of the user’s containers. Any containers that you launch as a user from the console will run inside this Docker. This creates isolation from the System Docker containers and ensures that normal user commands don’t impact system services.</p>
<p>We created this separation not only for the security benefits, but also to make sure that commands like <code>docker rm -f $(docker ps -qa)</code> don’t delete the entire OS.</p>
</blockquote>
<p><code>Everything in RancherOS is a Docker container.</code> 感觉这个要比 CoreOS 更加容器化，甚至使用 docker 取代了 systemd 来管理系统的各种服务。系统启动后运行两个 docker 服务进程，一个是系统 docker ，在此之上在运行系统服务容器，和用户层面的 docker 。不过看一下下面的这张图你就会明白。总的来讲 RancherOS 是使用 docker 来管理整个系统的服务的，包括用户层面的 docker 。</p>
<p><img data-src="https://p.k8s.li/rancheroshowitworks.png"></p>
<h2 id="安装体验"><a href="#安装体验" class="headerlink" title="安装体验"></a>安装体验</h2><p>咱的虚拟化平台是 VMware vSphere ，因为硬件服务器大多数都是 Dell 的，而  Dell  是 VMware 母公司，对于我司这种传统企业来讲使用 VMware vSphere 这种用户 UI 友好的虚拟化无疑是最好的选择，哈哈 😂。其他虚拟化平台比如 OpenStack 安装步骤会有所不同。</p>
<h3 id="Container-Optimized-OS"><a href="#Container-Optimized-OS" class="headerlink" title="Container-Optimized OS"></a>Container-Optimized OS</h3><p>因为仅仅是针对 GCE 进行优化的系统，传统的虚拟化比如 KVM 、 ESXi 可能用不了。另外还需要拿 <a target="_blank" rel="noopener" href="https://www.chromium.org/chromium-os">Chromium OS</a>  的源码来编译镜像，没有现成的  ISO 或者 OVA 虚拟机模板可用，咱就不折腾了。毕竟硬件资源有限，现场编译一个 <a target="_blank" rel="noopener" href="https://www.chromium.org/chromium-os">Chromium OS</a>  也需要十几个小时 😥</p>
<h2 id="Photon-OS-1"><a href="#Photon-OS-1" class="headerlink" title="Photon OS"></a>Photon OS</h2><p>可以现成编译一个 ISO 镜像，也可以使用官方已经编译好的 ISO 镜像或者 OVA 虚拟机模板。不过也支持常见的公有云，比如 Amazon AMI 、Google GCE Image、Azure VHD。甚至还有 Raspberry Pi3 Image 树莓派 3😂</p>
<h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a><a target="_blank" rel="noopener" href="https://vmware.github.io/photon/assets/files/html/3.0/photon_installation/">官方文档</a></h3><p>官方的安装文档中都给出了各种环境的安装方式，选择自己的环境按照文档一步一步来就行，不过在此注意以下几点。</p>
<h3 id="安装镜像"><a href="#安装镜像" class="headerlink" title="安装镜像"></a>安装镜像</h3><ul>
<li><h4 id="ISO"><a href="#ISO" class="headerlink" title="ISO"></a><a target="_blank" rel="noopener" href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS">ISO</a></h4></li>
</ul>
<p>通用的方案，适用于各种环境，无论是虚拟机还是物理机，由于咱使用的是 VMware vSphere 虚拟化，咱就使用 OVA 格式，因为后者对 vSphere 进行了优化。对于 VMware 用户来讲最好使用 OVA 格式来进行安装。</p>
<ul>
<li><h4 id="OVA"><a href="#OVA" class="headerlink" title="OVA"></a><a target="_blank" rel="noopener" href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS">OVA</a></h4></li>
</ul>
<blockquote>
<p>Pre-installed minimal environment, customized for VMware hypervisor  environments. These customizations include a highly sanitized and  optimized kernel to give improved boot and runtime performance for  containers and Linux applications. Since an OVA is a complete virtual  machine definition, we’ve made available a Photon OS OVA that has  virtual hardware version 11; this will allow for compatibility with  several versions of VMware platforms or allow for the latest and  greatest virtual hardware enhancements.</p>
</blockquote>
<p>根据官方文档所描述的 OVA 虚拟机模板是针对  VMware hypervisor  虚拟化环境进行优化定制的。</p>
<ul>
<li><h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS">Amazon Machine Image</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS">Google Compute Engine image</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS">Azure VHD</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS">Raspberry Pi3</a></li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>下载好 OVA 虚拟机模板后，登录到 ESXi 或者 vCenter 中直接使用 OVA 创建虚拟机模板即可，对于 <code>VMware® Workstation 1x Pro</code>  可以直接将 OVA 导入成为虚拟机来运行。</p>
<h4 id="1-导入-OVA-虚拟机模板"><a href="#1-导入-OVA-虚拟机模板" class="headerlink" title="1. 导入 OVA 虚拟机模板"></a>1. 导入 OVA 虚拟机模板</h4><p><img data-src="https://p.k8s.li/20191231105906355.png"></p>
<h4 id="2-添加-OVA-虚拟机模板"><a href="#2-添加-OVA-虚拟机模板" class="headerlink" title="2.添加 OVA 虚拟机模板"></a>2.添加 OVA 虚拟机模板</h4><p><img data-src="https://p.k8s.li/20191231110111943.png"></p>
<h4 id="3-选择存储"><a href="#3-选择存储" class="headerlink" title="3. 选择存储"></a>3. 选择存储</h4><p><img data-src="https://p.k8s.li/20191231110153113.png"></p>
<h4 id="4-同意许可协议"><a href="#4-同意许可协议" class="headerlink" title="4. 同意许可协议"></a>4. 同意许可协议</h4><p><img data-src="https://p.k8s.li/20191231110231422.png"></p>
<h4 id="5-部署选项"><a href="#5-部署选项" class="headerlink" title="5.部署选项"></a>5.部署选项</h4><ul>
<li>选择好网络</li>
<li>磁盘置备的方式：精简就是使用到的时候再对磁盘进行制令。厚置备就是创建虚拟机的时候对磁盘进行置零，性能会好一些。</li>
</ul>
<p><img data-src="https://p.k8s.li/20191231110339494.png"></p>
<h4 id="6-即将完成"><a href="#6-即将完成" class="headerlink" title="6. 即将完成"></a>6. 即将完成</h4><p><img data-src="https://p.k8s.li/20191231110531238.png"></p>
<h3 id="系统启动"><a href="#系统启动" class="headerlink" title="系统启动"></a>系统启动</h3><p><img data-src="https://p.k8s.li/20191231111131193.png"></p>
<p>初始用户名是 <code>root</code> ，密码是 <code>changeme</code> ，输入完密码之后会强制要求你更改密码，在输入一次 <code>changeme</code> 之后输入两次修改的密码即可。</p>
<p>登录到系统之后使用 <code>ip addr</code> 命令查看由默认的 DHCP 获取到的方式来查看 IP，然后编辑 sshd_config 配置文件允许 root 登录。不得不说 ESXi 的 Web 控制台实在是太难用了，还是 ssh 上去使用吧。</p>
<ul>
<li><code>vi /etc/ssh/sshd_config</code> 把 <code>PermitRootLogin</code> 配置项修改为 <code>yes</code> 即可</li>
<li>重启 sshd 服务 <code>systemctl restart sshd</code></li>
</ul>
<h3 id="内核"><a href="#内核" class="headerlink" title="内核"></a>内核</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Linux  <span class="token number">4.19</span>.79-1.ph3-esx <span class="token comment">#1-photon SMP Tue Oct 22 23:53:27 UTC 2019 x86_64 GNU/Linux</span>

root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># cat /etc/os-release</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"VMware Photon OS"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"3.0"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span>photon
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token number">3.0</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"VMware Photon OS/Linux"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"1;34"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://vmware.github.io/photon/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/vmware/photon/issues"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>目前的内核版本是 4.19.79 ，比 CentOS 7 系那种五年前的 3.18 内核高到不知道哪里去了。不过个人认为，对于容器虚拟化这种依赖于内核特性的技术来讲还是要选择高一点的版本比较好。像 CentOS 那种五年前的 3.18 版本，那时候容器所依赖的很多内核特性在这些版本上还不够成熟。从使用来讲，或外的公有云像 GKE 、AKS、AKE 等都是使用的 4.14 内核版本以上。</p>
<p>4.19 版本有个小问题，就是如果 kube-proxy 使用 IPVS 的话，需要开启相应的内核模块，主要依赖的内核模块有以下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在 4.19 版本之后 nf_conntrack_ipv4 内核模块替换成了 nf_conntrack ，参看 <a target="_blank" rel="noopener" href="https://github.com/coreos/bugs/issues/2518">coreos&#x2F;bugs#2518</a></p>
<h3 id="资源占用情况"><a href="#资源占用情况" class="headerlink" title="资源占用情况"></a>资源占用情况</h3><h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><ul>
<li>系统初始化启动之后内存仅仅使用了 45Mi</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># free -h</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:          <span class="token number">2</span>.0Gi        45Mi       <span class="token number">1</span>.8Gi       <span class="token number">0</span>.0Ki        93Mi       <span class="token number">1</span>.8Gi
Swap:            0B          0B          0B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>启动 docker 进程之后的占用情况，也仅仅 109Mi</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># free -h</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:          <span class="token number">2</span>.0Gi       109Mi       <span class="token number">1</span>.6Gi       <span class="token number">0</span>.0Ki       238Mi       <span class="token number">1</span>.8Gi
Swap:            0B          0B          0B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h4><p>使用 OVA 虚拟机模板启动后的虚拟机，磁盘仅仅占用了 515MB ，确实是相当轻量化，这还是包含了 docker。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        16G  515M   15G   <span class="token number">4</span>% /
devtmpfs        998M     <span class="token number">0</span>  998M   <span class="token number">0</span>% /dev
tmpfs          1000M     <span class="token number">0</span> 1000M   <span class="token number">0</span>% /dev/shm
tmpfs          1000M  532K  999M   <span class="token number">1</span>% /run
tmpfs          1000M     <span class="token number">0</span> 1000M   <span class="token number">0</span>% /sys/fs/cgroup
tmpfs          1000M     <span class="token number">0</span> 1000M   <span class="token number">0</span>% /tmp
/dev/sda2        10M  <span class="token number">2</span>.2M  <span class="token number">7</span>.9M  <span class="token number">22</span>% /boot/efi
tmpfs           200M     <span class="token number">0</span>  200M   <span class="token number">0</span>% /run/user/0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="负载"><a href="#负载" class="headerlink" title="负载"></a>负载</h4><p><img data-src="https://p.k8s.li/20191231113306435.png"></p>
<h3 id="进程和服务"><a href="#进程和服务" class="headerlink" title="进程和服务"></a>进程和服务</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">● photon-machine
    State: running
     Jobs: <span class="token number">0</span> queued
   Failed: <span class="token number">0</span> <span class="token function">units</span>
    Since: Tue <span class="token number">2019</span>-12-31 <span class="token number">13</span>:53:18 UTC<span class="token punctuation">;</span> 11min ago
   CGroup: /
           ├─user.slice
           │ └─user-0.slice
           │   ├─session-c1.scope
           │   │ ├─363 /bin/login <span class="token parameter variable">-p</span> --
           │   │ └─396 <span class="token parameter variable">-bash</span>
           │   ├─session-c2.scope
           │   │ ├─408 sshd: root@pts/0
           │   │ ├─415 <span class="token parameter variable">-bash</span>
           │   │ └─560 systemctl status
           │   └─user@0.service
           │     └─init.scope
           │       ├─388 /lib/systemd/systemd <span class="token parameter variable">--user</span>
           │       └─389 <span class="token punctuation">(</span>sd-pam<span class="token punctuation">)</span>
           ├─init.scope
           │ └─1 /lib/systemd/systemd
           └─system.slice
             ├─systemd-networkd.service
             │ └─255 /lib/systemd/systemd-networkd
             ├─systemd-udevd.service
             │ └─125 /lib/systemd/systemd-udevd
             ├─vgauthd.service
             │ └─197 /usr/bin/VGAuthService <span class="token parameter variable">-s</span>
             ├─docker.service
             │ ├─430 /usr/bin/dockerd
             │ └─437 docker-containerd <span class="token parameter variable">--config</span> /var/run/docker/containerd/containerd.toml
             ├─systemd-journald.service
             │ └─100 /lib/systemd/systemd-journald
             ├─sshd.service
             │ └─361 /usr/sbin/sshd <span class="token parameter variable">-D</span>
             ├─vmtoolsd.service
             │ └─94 /usr/bin/vmtoolsd
             ├─systemd-resolved.service
             │ └─257 /lib/systemd/systemd-resolved
             ├─dbus.service
             │ └─198 /usr/bin/dbus-daemon <span class="token parameter variable">--system</span> <span class="token parameter variable">--address</span><span class="token operator">=</span>systemd: <span class="token parameter variable">--nofork</span> <span class="token parameter variable">--nopidfile</span> --systemd-activation --syslog-only
             ├─systemd-timesyncd.service
             │ └─167 /lib/systemd/systemd-timesyncd
             └─systemd-logind.service
               └─195 /lib/systemd/systemd-logind<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h3><p>Photon OS 默认的包管理工具是 tdnf ，不过也支持 yum ，两者使用方式有细微的差别，使用的也是相同的软件包源，而且对于国内用户来讲，软件包源在国外服务器上（<a target="_blank" rel="noopener" href="https://dl.bintray.com/vmware/">https://dl.bintray.com/vmware/</a>），速度感人，肉眼可见 KB&#x2F;s 级别的速度。你懂的，操他奶奶的 GFW，尼玛死了 😡，搞网络封锁耽误这人搬砖。安装速度慢得一批，单单下载 50 MB 的软件包就下不下来，不得不用上我那台透明代理的旁路网关。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-OS <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># tdnf upgrade</span>

Installing:
runc                x86_64  <span class="token number">1.0</span>.0.rc9-1.ph3   photon-updates     <span class="token number">10</span>.24M <span class="token number">10736757</span>
containerd          x86_64  <span class="token number">1.2</span>.10-1.ph3      photon-updates     <span class="token number">76</span>.25M <span class="token number">79950751</span>
docker-engine       x86_64  <span class="token number">18.09</span>.9-1.ph3     photon-updates     <span class="token number">91</span>.29M <span class="token number">95721322</span>
docker-cli          x86_64  <span class="token number">18.09</span>.9-1.ph3     photon-updates     <span class="token number">72</span>.76M <span class="token number">76299393</span>

Total installed size: <span class="token number">250</span>.54M <span class="token number">262708223</span>

Upgrading:
sqlite-libs         x86_64  <span class="token number">3.27</span>.2-6.ph3      photon-updates      <span class="token number">1</span>.08M <span class="token number">1129424</span>
python3-setuptools  noarch  <span class="token number">3.7</span>.5-1.ph3       photon-updates      <span class="token number">1</span>.61M <span class="token number">1692186</span>
python3-xml         x86_64  <span class="token number">3.7</span>.5-1.ph3       photon-updates    <span class="token number">333</span>.69k <span class="token number">341698</span>
python3-libs        x86_64  <span class="token number">3.7</span>.5-1.ph3       photon-updates     <span class="token number">22</span>.88M <span class="token number">23990697</span>
python3             x86_64  <span class="token number">3.7</span>.5-1.ph3       photon-updates      <span class="token number">2</span>.90M <span class="token number">3044206</span>
openssl             x86_64  <span class="token number">1.0</span>.2t-2.ph3      photon-updates      <span class="token number">4</span>.53M <span class="token number">4750710</span>
openssh-server      x86_64  <span class="token number">7</span>.8p1-6.ph3       photon-updates    <span class="token number">904</span>.54k <span class="token number">926254</span>
openssh-clients     x86_64  <span class="token number">7</span>.8p1-6.ph3       photon-updates      <span class="token number">3</span>.65M <span class="token number">3831266</span>
openssh             x86_64  <span class="token number">7</span>.8p1-6.ph3       photon-updates        <span class="token number">0</span>.00b <span class="token number">0</span>
linux-esx           x86_64  <span class="token number">4.19</span>.87-1.ph3     photon-updates     <span class="token number">12</span>.67M <span class="token number">13284780</span>
libarchive          x86_64  <span class="token number">3.3</span>.3-4.ph3       photon-updates    <span class="token number">804</span>.34k <span class="token number">823648</span>
e2fsprogs-libs      x86_64  <span class="token number">1.44</span>.3-4.ph3      photon-updates     <span class="token number">74</span>.62k <span class="token number">76416</span>
e2fsprogs           x86_64  <span class="token number">1.44</span>.3-4.ph3      photon-updates      <span class="token number">1</span>.88M <span class="token number">1972142</span>
<span class="token function">docker</span>              x86_64  <span class="token number">18.09</span>.9-1.ph3     photon-updates        <span class="token number">0</span>.00b <span class="token number">0</span>
dhcp-libs           x86_64  <span class="token number">4.3</span>.5-7.ph3       photon-updates    <span class="token number">264</span>.25k <span class="token number">270588</span>
dhcp-client         x86_64  <span class="token number">4.3</span>.5-7.ph3       photon-updates      <span class="token number">2</span>.52M <span class="token number">2642853</span>

Total installed size:  <span class="token number">56</span>.05M <span class="token number">58776868</span>
Is this ok <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>:y

Downloading:
docker-engine                           <span class="token number">302192</span>      <span class="token number">1</span>%

docker-engine                           <span class="token number">515184</span>      <span class="token number">2</span>%
docker-engine                           <span class="token number">523376</span>      <span class="token number">2</span>%
docker-engine                          <span class="token number">4234352</span>     <span class="token number">15</span>%
docker-engine                         <span class="token number">23477360</span>     <span class="token number">84</span>%

docker-engine                         <span class="token number">23477360</span>     <span class="token number">84</span>%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>56.05M &#x2F; 58776868B 大小的文件，下载了一上午都没搞完……气的我想掀桌子、砸键盘、摔鼠标 😑</li>
</ul>
<p>不过可以根据官方的编译文档，把整个软件包源编译出来 ，放在本地使用，然后添加本的 yum 源码即可。</p>
<h3 id="docker-容器引擎"><a href="#docker-容器引擎" class="headerlink" title="docker 容器引擎"></a>docker 容器引擎</h3><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">root@photon-machine [ ~ ]# docker info
Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 18.06.2-ce
Storage Driver: overlay2
 Backing Filesystem: extfs
 Supports d_type: true
 Native Overlay Diff: true
Logging Driver: json-file
Cgroup Driver: cgroupfs
Plugins:
 Volume: local
 Network: bridge host macvlan null overlay
 Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog
Swarm: inactive
Runtimes: runc
Default Runtime: runc
Init Binary: docker-init
containerd version: 468a545b9edcd5932818eb9de8e72413e616e86e
runc version: a592beb5bc4c4092b1b1bac971afed27687340c5 (expected: 69663f0bd4b60df09991c08812a60108003fa340)
init version: fec3683
Security Options:
 apparmor
 seccomp
  Profile: default
Kernel Version: 4.19.79-1.ph3-esx
Operating System: VMware Photon OS/Linux
OSType: linux
Architecture: x86_64
CPUs: 1
Total Memory: 1.951GiB
Name: photon-machine
ID: N53E:2APV:XYZX:QFPE:GGZU:7567:XBFB:M4VQ:F5HZ:XPRK:W33H:QYMI
Docker Root Dir: /var/lib/docker
Debug Mode (client): false
Debug Mode (server): false
Registry: https://index.docker.io/v1/
Labels:
Experimental: false
Insecure Registries:
 127.0.0.0/8
Live Restore Enabled: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="使用体验"><a href="#使用体验" class="headerlink" title="使用体验"></a>使用体验</h3><p>总体来讲，除了安装软件速度极慢之外，使用起来和普通的 Linux 发行版无多大差别，系统资源占用比传统的 Linux 发行版要低的多。即便是运行了 docker 进程后系统内存也仅仅占用 100 Mb 左右，而磁盘占用才 500MB 算是比较轻量化的。至于性能方面，目前我还是找不到可以测试对比的方案。</p>
<p>较传统的 Linux 发行版，精简了大量不必要的服务和软件，甚至连 tar 命令都没有……。如果把它当作 kubenetes 工作负载 Node 节点来使用，需要注意的是，kube-proxy 依赖的一些工具并没有安装上。我使用 kubeadm 将该节点加入到集群当中的时候就提示缺少以下几个工具： <code>ipset socat ethtool ebtables</code> ，这些对于 IPVS 都是需要的。最好使用 tdnf 一并安装上，并且开启相应的 IPVS 内核模块。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tdnf <span class="token function">install</span> ipset socat <span class="token function">ethtool</span> ebtables <span class="token function">tar</span> <span class="token parameter variable">-y</span>
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>虽然经过了 3 个版本的更新迭代，但 Photon OS 用于生产环境还需要进行稳定性测试，它不如 CoreOS 那样已经在大规模集群中得到的实践，目前用 Photon OS 的企业我目前还未见到过。而 CoreOS</p>
<blockquote>
<p>“作为 Linux 以及开源软件的支持者，我们相信与 CoreOS  这样的开源社区创新先锋合作是非常重要的。我们希望通过这样的合作来为云平台用户带来更多、更灵活的选择。” 微软 Azure 的首席技术官 Mark Russinovich 提到， “CoreOS Linux  与高性能、大规模的微软云相结合，无疑将会促进各种应用服务的创新、以及全球团队的协作。”</p>
</blockquote>
<blockquote>
<p>“我们已经在上千台物理机上成功部署并运行了 CoreOS  Linux。无论从操作系统的安装、升级，还是从容器的管理和应用部署上，她给我们带来了前所未有的体验！对于光音网络这种飞速发展的互联网公司来说，CoreOS 为我们平台的建设提供了有力的技术保障！在使用 CoreOS 的这两年中，我们不再去担心操作系统、Docker 以及 Kubernetes  的兼容性、版本升级以及稳定性，这使得我们可以更专注于应用、业务层上的管理和研发。”  光音网络技术负责人王鹏说，“我们的平台不仅可以跑在自己的物理机上，而且还可以轻松地部署到 AWS 及阿里云上，CoreOS  在这方面功不可没。我们现在很高兴地得知 CoreOS 将强势登陆中国市场，我们对于更好的技术支持和服务无比期待！”</p>
<p>此处引用 CoreOS <a target="_blank" rel="noopener" href="https://coreos.com/blog/coreos-linux-available-in-china.html">官网博客</a></p>
</blockquote>
<p>CoreOS 的稳定性以及生产实践已经相当成熟了，那么接下来就介绍 CoreOS 的使用体验。</p>
<h2 id="CoreOS-Container-Linux-1"><a href="#CoreOS-Container-Linux-1" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h2><p>CoreOS 使用用来创建一套大规模的集群环境，单独使用的意义并不大。而且对于我司的 VMware vSphere 并没有进行优化。所以就按照裸金属部署的方式来安装体验。</p>
<h3 id="官方文档-1"><a href="#官方文档-1" class="headerlink" title="官方文档"></a><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/">官方文档</a></h3><h4 id="Cloud-Providers"><a href="#Cloud-Providers" class="headerlink" title="Cloud Providers"></a>Cloud Providers</h4><p>适用于公有云</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-ec2.html">Amazon EC2</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-digitalocean.html">DigitalOcean</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-google-compute-engine.html">Google Compute Engine</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-azure.html">Microsoft Azure</a><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-with-qemu.html">QEMU</a></li>
</ul>
<h4 id="Bare-Metal"><a href="#Bare-Metal" class="headerlink" title="Bare Metal"></a>Bare Metal</h4><p>适用于物理机</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://coreos.com/matchbox/">Using Matchbox</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-with-ipxe.html">Booting with iPXE</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-with-pxe.html">Booting with PXE</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/installing-to-disk.html">Installing to Disk</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-with-iso.html">Booting from ISO</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/root-filesystem-placement.html">Root filesystem placement</a></li>
</ul>
<h4 id="Community-Platforms"><a href="#Community-Platforms" class="headerlink" title="Community Platforms"></a>Community Platforms</h4><p>社区提供支持的</p>
<p>These <a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/community-platforms.html">platforms and providers</a> offer support and documentation for running Container Linux.</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-cloudstack.html">CloudStack</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-eucalyptus.html">Eucalyptus</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-with-libvirt.html">libvirt</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-openstack.html">OpenStack</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-vagrant.html">Vagrant</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-virtualbox.html">VirtualBox</a></li>
<li><a target="_blank" rel="noopener" href="http://coreos.com/os/docs/latest/booting-on-vmware.html">VMware</a></li>
</ul>
<h3 id="安装镜像-OVA"><a href="#安装镜像-OVA" class="headerlink" title="安装镜像 OVA"></a>安装镜像 <a target="_blank" rel="noopener" href="https://stable.release.core-os.net/amd64-usr/current/coreos_production_vmware_ova.ova">OVA</a></h3><p>下载下来 OVA 虚拟机模板 <a target="_blank" rel="noopener" href="https://stable.release.core-os.net/amd64-usr/current/coreos_production_vmware_ova.ova">OVA</a></p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>和 Photon OS 安装步骤一样，在 ESXi 上导入 OVA 虚拟机模板即可，不过需要在最后一步配置好 OS ，包括主机名、配置文件数配置文件 url、加密的配置文件等等，根据自身需求配好即可。可以参照官方<a target="_blank" rel="noopener" href="https://coreos.com/os/docs/latest/clc-examples.html">配置文件的文档</a> 。这一步是必须要做的，不然没有 ssh 公钥和密码你是无法登录到系统中的。</p>
<p>注意，官方给了两种配置文件合适，一个是 yaml 一个是 json ，不过在这里要使用</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"ignition"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"config"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"timeouts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.1.0"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"networkd"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"passwd"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"users"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"core"</span><span class="token punctuation">,</span>
        <span class="token property">"passwordHash"</span><span class="token operator">:</span> <span class="token string">"$6$43y3tkl..."</span><span class="token punctuation">,</span>
        <span class="token property">"sshAuthorizedKeys"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"key1"</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"storage"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"systemd"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>password_hash</code> 可以通过 openssl 命令来生成，把生成的一整串内容填写到上面，包括后面那个点 <code>.</code></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">╭─@debian ~
╰─$ openssl <span class="token function">passwd</span> <span class="token parameter variable">-1</span>
Password:
Verifying - Password:
<span class="token variable">$1</span><span class="token variable">$nCzW8953</span><span class="token variable">$un</span>/JUMJDE2588l7Y6KkP.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>ssh_authorized_keys</code> 通过 ssh-keygen 生成，生成的公钥填写在上面。</li>
</ul>
<p>配置完成之后就把整个内容复制粘贴到第二个框框 <code>CoreOS config data</code> 里</p>
<h4 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h4><p><img data-src="https://p.k8s.li/20191231125441199.png"></p>
<h3 id="系统启动-1"><a href="#系统启动-1" class="headerlink" title="系统启动"></a>系统启动</h3><p>可能是 coreos config 配置文件没有配好，而导致启动后输入设置的密码提示错误 😥，僵硬，只能通过修改 grub 启动参数来跳过了。</p>
<ul>
<li>1.打开 CoreOS 虚拟机电源，并打开控制台。</li>
<li>2.当 Boot Loader 提示出现的时候，按下 e 键来编辑 GRUB 菜单。选择第一个 coreos default 编辑。</li>
<li>3.添加 <code>coreos.autologin</code> 作为启动参数，并 Ctrl-x 或 F10 重启。这将使控制台跳过登录提示并直接进入用户 core 的 shell。</li>
<li><img data-src="https://p.k8s.li/20191231133509428.png"></li>
<li>启动进入系统之后输入 <code>sudo passwd</code> 来修改 root 密码。然后切换到 root 用户下 <code>passwd core</code> 修改 core 这个用户的密码。修改之后就可以通过 ssh 登录啦 😂，比 Photon OS 要折腾一番呀。不过啊，使用 OVA 部署最好结合 could-init 来设置虚拟机的 ssh 密钥，网络，主机名等参数。</li>
</ul>
<h3 id="资源占用情况-1"><a href="#资源占用情况-1" class="headerlink" title="资源占用情况"></a>资源占用情况</h3><h5 id="内存-1"><a href="#内存-1" class="headerlink" title="内存"></a>内存</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">core@localhost ~ $ <span class="token function">free</span> <span class="token parameter variable">-h</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:          961Mi       177Mi       398Mi       199Mi       385Mi       445Mi
Swap:            0B          0B          0B
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="磁盘-1"><a href="#磁盘-1" class="headerlink" title="磁盘"></a>磁盘</h4><p>CoreOS 的磁盘分区和 Photon OS 略有不同</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">core@localhost ~ $ <span class="token function">df</span> <span class="token parameter variable">-h</span>
Filesystem       Size  Used Avail Use% Mounted on
devtmpfs         460M     <span class="token number">0</span>  460M   <span class="token number">0</span>% /dev
tmpfs            481M     <span class="token number">0</span>  481M   <span class="token number">0</span>% /dev/shm
tmpfs            481M  484K  481M   <span class="token number">1</span>% /run
tmpfs            481M     <span class="token number">0</span>  481M   <span class="token number">0</span>% /sys/fs/cgroup
/dev/sda9        <span class="token number">6</span>.0G   60M  <span class="token number">5</span>.6G   <span class="token number">2</span>% /
/dev/mapper/usr  985M  854M   80M  <span class="token number">92</span>% /usr
none             481M  200M  282M  <span class="token number">42</span>% /run/torcx/unpack
tmpfs            481M     <span class="token number">0</span>  481M   <span class="token number">0</span>% /media
tmpfs            481M     <span class="token number">0</span>  481M   <span class="token number">0</span>% /tmp
/dev/sda6        108M  <span class="token number">7</span>.9M   92M   <span class="token number">8</span>% /usr/share/oem
/dev/sda1        127M   54M   73M  <span class="token number">43</span>% /boot
tmpfs             97M     <span class="token number">0</span>   97M   <span class="token number">0</span>% /run/user/500<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="内核以及发行版信息"><a href="#内核以及发行版信息" class="headerlink" title="内核以及发行版信息"></a>内核以及发行版信息</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Linux localhost <span class="token number">4.19</span>.86-coreos <span class="token comment">#1 SMP Mon Dec 2 20:13:38 -00 2019 x86_64 Intel(R) Core(TM) i5-4590 CPU @ 3.30GHz GenuineIntel GNU/Linux</span>

core@localhost ~ $ <span class="token function">cat</span> /etc/os-release
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Container Linux by CoreOS"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span>coreos
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token number">2303.3</span>.0
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token number">2303.3</span>.0
<span class="token assign-left variable">BUILD_ID</span><span class="token operator">=</span><span class="token number">2019</span>-12-02-2049
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Container Linux by CoreOS 2303.3.0 (Rhyolite)"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"38;5;75"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://coreos.com/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://issues.coreos.com"</span>
<span class="token assign-left variable">COREOS_BOARD</span><span class="token operator">=</span><span class="token string">"amd64-usr"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker-容器引擎-1"><a href="#docker-容器引擎-1" class="headerlink" title="docker 容器引擎"></a>docker 容器引擎</h3><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">core@localhost ~ $ docker info
Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 18.06.3-ce
Storage Driver: overlay2
 Backing Filesystem: extfs
 Supports d_type: true
 Native Overlay Diff: true
Logging Driver: json-file
Cgroup Driver: cgroupfs
Plugins:
 Volume: local
 Network: bridge host macvlan null overlay
 Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog
Swarm: inactive
Runtimes: runc
Default Runtime: runc
Init Binary: docker-init
containerd version: 468a545b9edcd5932818eb9de8e72413e616e86e
runc version: a592beb5bc4c4092b1b1bac971afed27687340c5
init version: fec3683b971d9c3ef73f284f176672c44b448662
Security Options:
 seccomp
  Profile: default
 selinux
Kernel Version: 4.19.86-coreos
Operating System: Container Linux by CoreOS 2303.3.0 (Rhyolite)
OSType: linux
Architecture: x86_64
CPUs: 2
Total Memory: 961.7MiB
Name: localhost
ID: VUKA:LDLW:WECP:IZKO:A6ED:IKIN:6C3V:VRIL:S4ND:SCII:66EH:GDYP
Docker Root Dir: /var/lib/docker
Debug Mode (client): false
Debug Mode (server): false
Registry: https://index.docker.io/v1/
Labels:
Experimental: false
Insecure Registries:
 127.0.0.0/8
Live Restore Enabled: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="负载-1"><a href="#负载-1" class="headerlink" title="负载"></a>负载</h3><p><img data-src="https://p.k8s.li/20191231135348120.png"></p>
<h3 id="进程和服务-1"><a href="#进程和服务-1" class="headerlink" title="进程和服务"></a>进程和服务</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">● localhost
    State: running
     Jobs: <span class="token number">0</span> queued
   Failed: <span class="token number">0</span> <span class="token function">units</span>
    Since: Tue <span class="token number">2019</span>-12-31 <span class="token number">13</span>:38:05 UTC<span class="token punctuation">;</span> 7h left
   CGroup: /
           ├─user.slice
           │ └─user-500.slice
           │   ├─user@500.service
           │   │ └─init.scope
           │   │   ├─725 /usr/lib/systemd/systemd <span class="token parameter variable">--user</span>
           │   │   └─726 <span class="token punctuation">(</span>sd-pam<span class="token punctuation">)</span>
           │   ├─session-2.scope
           │   │ ├─768 sshd: core <span class="token punctuation">[</span>priv<span class="token punctuation">]</span>
           │   │ ├─781 sshd: core@pts/0
           │   │ ├─782 <span class="token parameter variable">-bash</span>
           │   │ └─978 systemctl status
           │   └─session-1.scope
           │     ├─713 /bin/login <span class="token parameter variable">-f</span>
           │     ├─731 <span class="token parameter variable">-bash</span>
           │     ├─762 <span class="token function">su</span>
           │     ├─763 <span class="token function">bash</span>
           │     ├─770 <span class="token function">su</span> core
           │     ├─771 <span class="token function">bash</span>
           │     ├─775 <span class="token function">su</span>
           │     └─776 <span class="token function">bash</span>
           ├─init.scope
           │ └─1 /usr/lib/systemd/systemd --switched-root <span class="token parameter variable">--system</span> <span class="token parameter variable">--deserialize</span> <span class="token number">16</span>
           └─system.slice
             ├─locksmithd.service
             │ └─718 /usr/lib/locksmith/locksmithd
             ├─containerd.service
             │ └─800 /run/torcx/bin/containerd <span class="token parameter variable">--config</span> /run/torcx/unpack/docker/usr/share/containerd/config.toml
             ├─systemd-networkd.service
             │ └─584 /usr/lib/systemd/systemd-networkd
             ├─systemd-udevd.service
             │ └─583 /usr/lib/systemd/systemd-udevd
             ├─docker.service
             │ └─802 /run/torcx/bin/dockerd <span class="token parameter variable">--host</span><span class="token operator">=</span>fd:// <span class="token parameter variable">--containerd</span><span class="token operator">=</span>/var/run/docker/libcontainerd/docker-containerd.sock --selinux-enabled<span class="token operator">=</span>true
             ├─update-engine.service
             │ └─663 /usr/sbin/update_engine <span class="token parameter variable">-foreground</span> <span class="token parameter variable">-logtostderr</span>
             ├─systemd-journald.service
             │ └─553 /usr/lib/systemd/systemd-journald
             ├─systemd-resolved.service
             │ └─635 /usr/lib/systemd/systemd-resolved
             ├─dbus.service
             │ └─674 /usr/bin/dbus-daemon <span class="token parameter variable">--system</span> <span class="token parameter variable">--address</span><span class="token operator">=</span>systemd: <span class="token parameter variable">--nofork</span> <span class="token parameter variable">--nopidfile</span> --systemd-activation
             ├─systemd-timesyncd.service
             │ └─634 /usr/lib/systemd/systemd-timesyncd
             └─systemd-logind.service
               └─672 /usr/lib/systemd/systemd-logind<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="包管理工具-1"><a href="#包管理工具-1" class="headerlink" title="包管理工具"></a>包管理工具</h3><p><strong>没得 😂</strong>，你没看错，确实如此，在 CoreOS 上没有你可以用的包管理器，不像 PhotonOS 那样有个 tdnf&#x2F;yum 让你爽一把 😂。在 CoreOS 一切皆容器。可以看一下 <code>stackexchange.com</code> 这个答案 😂：</p>
<blockquote>
<p>To do this on a CoreOS box, following the hints from the <a target="_blank" rel="noopener" href="https://coreos.com/os/docs/latest/install-debugging-tools.html">guide here</a>:</p>
<ol>
<li>Boot up the CoreOS box and connect as the <code>core</code> user</li>
<li>Run the <code>/bin/toolbox</code> command to enter the stock Fedora container.</li>
<li>Install any software you need. To install nano in this case, it would be as simple as doing a <code>dnf -y install nano</code> (dnf has replaced yum)</li>
<li>Use nano to edit files. “But wait – I’m in a container!” Don’t worry – the host’s file system is mounted at <code>/media/root</code> when inside the container. So just save a sample text file at <code>/media/root/home/core/test.txt</code>, then <code>exit</code> the container, and finally go list the files in <code>/home/core</code>. Notice your test.txt file?</li>
</ol>
<p>If any part of this is too cryptic or confusing, please ask follow up questions. :-)</p>
</blockquote>
<p>官方推荐使用 <a target="_blank" rel="noopener" href="https://github.com/coreos">coreos</a>&#x2F;<strong><a target="_blank" rel="noopener" href="https://github.com/coreos/toolbox">toolbox</a></strong> 来安装所需要的软件，这个工具以后再详细讲解一下吧。</p>
<h3 id="使用体验-1"><a href="#使用体验-1" class="headerlink" title="使用体验"></a>使用体验</h3><p>安装过程要出于安全考虑比 Photon OS 多于个步骤来登录到系统，目前我还没有找到启动的时候添加 ssh 密钥的办法。总的来讲，再 CoreOS 里一切皆容器运行所需要的服务，这种里面要先进的多。下面的 RancherOS 更是将一切皆容器贯彻到底，甚至将 systemd 取代掉，使用 docker 来管理系统服务。</p>
<h2 id="RancherOS-1"><a href="#RancherOS-1" class="headerlink" title="RancherOS"></a>RancherOS</h2><p>目前 RancherOS 的版本是 v1.5.5</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">Linux 4.14.138
Buildroot: 2018.02.11
Docker docker-19.03.5 by default
RPi64: Linux 4.14.114
Console:
Alpine: 3.10
CentOS: 7.7.1908
Debian: stretch
Fedora: 31
Ubuntu: bionic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="官方文档-2"><a href="#官方文档-2" class="headerlink" title="官方文档"></a><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/">官方文档</a></h3><p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/">安装文档</a></p>
<h4 id="Cloud-云平台"><a href="#Cloud-云平台" class="headerlink" title="Cloud 云平台"></a>Cloud 云平台</h4><p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/aws">Amazon EC2</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/gce">Google Compute Engine</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/do">DigitalOcean</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/azure">Azure</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/openstack">OpenStack</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/vmware-esxi">VMware ESXi</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/aliyun">Aliyun</a></p>
<h4 id="Bare-Metal-amp-Virtual-Servers-裸金属"><a href="#Bare-Metal-amp-Virtual-Servers-裸金属" class="headerlink" title="Bare Metal &amp; Virtual Servers 裸金属"></a>Bare Metal &amp; Virtual Servers 裸金属</h4><p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/server/pxe">PXE</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/server/install-to-disk">Install to Hard Disk</a></p>
<p><a target="_blank" rel="noopener" href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/server/raspberry-pi">Raspberry Pi</a></p>
<h3 id="安装镜像-1"><a href="#安装镜像-1" class="headerlink" title="安装镜像"></a><a target="_blank" rel="noopener" href="https://github.com/rancher/os/releases/">安装镜像</a></h3><p>RancherOS 将各个平台的安装镜像都放在了 GitHub <a target="_blank" rel="noopener" href="https://github.com/rancher/os/releases/">release</a> 页面上。对于 VMware 用户就使用 <a target="_blank" rel="noopener" href="https://github.com/rancher/os/releases/download/v1.5.5/rancheros-vmware.iso">rancheros-vmware.iso</a> 这个镜像即可。没得 OVA 虚拟机模板只能手动搓一个啦。下载完成之后将这个镜像上传到 vSphere 的数据存储中，按照创建常规虚拟机的方式来创建虚拟机。</p>
<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><p><img data-src="https://p.k8s.li/20191231142454934.png"></p>
<p>使用 ISO 启动之后进入得是一个 liveCD 型得系统，并没有安装虚拟机得磁盘当中，我们需要将 RancherOS 安装到磁盘上。提前准备好 cloud-init 的配置文件，只需要执行 <code>ros install -c cloud-config.yml -d /dev/sda</code> 命令就行啦。-d 参数后面跟着安装到的磁盘。</p>
<p>不过需要像 CoreOS 那样准备给一个 <code>cloud-config.yml</code> 配置文件，将我们得 ssh 公钥和用户密码填写到里面，不过 <code>cloud-config</code> 能配置得选项非常多，在此就不赘述了，等抽空专门写一篇博客来讲讲 cloud-init 的使用。（又挖坑 😂，不知何时能填上 🙃</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># ros install -c cloud-config.yml -d /dev/sda</span>
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> No <span class="token function">install</span> <span class="token builtin class-name">type</span> specified<span class="token punctuation">..</span>.defaulting to generic
Installing from rancher/os:v1.5.5
Continue <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y
INFO<span class="token punctuation">[</span>0002<span class="token punctuation">]</span> start <span class="token operator">!</span>isoinstallerloaded
INFO<span class="token punctuation">[</span>0002<span class="token punctuation">]</span> trying to load /bootiso/rancheros/installer.tar.gz
69b8396f5d61: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">11</span>.89MB/11.89MB
cae31a9aae74: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">1</span>.645MB/1.645MB
78885fd6d98c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">1</span>.536kB/1.536kB
51228f31b9ce: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">2</span>.56kB/2.56kB
d8162179e708: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>   <span class="token number">2</span>.56kB/2.56kB
3ee208751cd2: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span><span class="token punctuation">]</span>  <span class="token number">3</span>.072kB/3.072kB
Loaded image: rancher/os-installer:latest
INFO<span class="token punctuation">[</span>0002<span class="token punctuation">]</span> Loaded images from /bootiso/rancheros/installer.tar.gz
INFO<span class="token punctuation">[</span>0002<span class="token punctuation">]</span> starting installer container <span class="token keyword">for</span> rancher/os-installer:latest <span class="token punctuation">(</span>new<span class="token punctuation">)</span>
Installing from rancher/os-installer:latest
<span class="token function">mke2fs</span> <span class="token number">1.45</span>.2 <span class="token punctuation">(</span><span class="token number">27</span>-May-2019<span class="token punctuation">)</span>
<span class="token number">64</span>-bit filesystem support is not enabled.  The larger fields afforded by this feature <span class="token builtin class-name">enable</span> full-strength checksumming.  Pass <span class="token parameter variable">-O</span> 64bit to rectify.
Creating filesystem with <span class="token number">7863808</span> 4k blocks and <span class="token number">7864320</span> inodes
Filesystem UUID: fe29cb27-b4ac-4c75-a12d-895ea7e52af9
Superblock backups stored on blocks:
        <span class="token number">32768</span>, <span class="token number">98304</span>, <span class="token number">163840</span>, <span class="token number">229376</span>, <span class="token number">294912</span>, <span class="token number">819200</span>, <span class="token number">884736</span>, <span class="token number">1605632</span>, <span class="token number">2654208</span>,
        <span class="token number">4096000</span>

Allocating group tables: <span class="token keyword">done</span>
Writing inode tables: <span class="token keyword">done</span>
Creating journal <span class="token punctuation">(</span><span class="token number">32768</span> blocks<span class="token punctuation">)</span>: <span class="token keyword">done</span>
Writing superblocks and filesystem accounting information: <span class="token keyword">done</span>

Continue with <span class="token function">reboot</span> <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>:y
INFO<span class="token punctuation">[</span>0288<span class="token punctuation">]</span> Rebooting
INFO<span class="token punctuation">[</span>0288<span class="token punctuation">]</span> Setting <span class="token function">reboot</span> <span class="token function">timeout</span> to <span class="token number">60</span> <span class="token punctuation">(</span>rancher.shutdown_timeout <span class="token builtin class-name">set</span> to <span class="token number">60</span><span class="token punctuation">)</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>^<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Setting <span class="token function">reboot</span> <span class="token function">timeout</span> to <span class="token number">60</span> <span class="token punctuation">(</span>rancher.shutdown_timeout <span class="token builtin class-name">set</span> to <span class="token number">60</span><span class="token punctuation">)</span>
.<span class="token operator">=</span>.<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /docker <span class="token builtin class-name">:</span> 3d39a73e4089
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.M<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /open-vm-tools <span class="token builtin class-name">:</span> ccd97f8a7775
:.<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /ntp <span class="token builtin class-name">:</span> acf47c78a711
.<span class="token operator">></span>.<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /network <span class="token builtin class-name">:</span> 08be8ef68e27
<span class="token punctuation">..</span><span class="token operator">&lt;</span><span class="token punctuation">..</span><span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /udev <span class="token builtin class-name">:</span> 4986cd58a227
.<span class="token operator">=</span>.<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /syslog <span class="token builtin class-name">:</span> 254137c5e66a
.<span class="token operator">&lt;</span>.<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /acpid <span class="token builtin class-name">:</span> a2ededff859c
<span class="token punctuation">..</span>C<span class="token punctuation">..</span><span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Stopping /system-cron <span class="token builtin class-name">:</span> 899028a78e3a
<span class="token punctuation">..</span>H.<span class="token punctuation">[</span>            <span class="token punctuation">]</span> reboot:info: Console Stopping <span class="token punctuation">[</span>/console<span class="token punctuation">]</span> <span class="token builtin class-name">:</span> 6fc9ef66b43c
Connection to <span class="token number">10.20</span>.172.119 closed by remote host.
Connection to <span class="token number">10.20</span>.172.119 closed.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="内核以及发行版信息-1"><a href="#内核以及发行版信息-1" class="headerlink" title="内核以及发行版信息"></a>内核以及发行版信息</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux rancher <span class="token number">4.14</span>.138-rancher <span class="token comment">#1 SMP Sat Aug 10 11:25:46 UTC 2019 x86_64 GNU/Linux</span>
<span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># cat /etc/os-release</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"RancherOS"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span>v1.5.5
<span class="token assign-left variable">ID</span><span class="token operator">=</span>rancheros
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span>v1.5.5
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"RancherOS v1.5.5"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"http://rancher.com/rancher-os/"</span>
<span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">"https://forums.rancher.com/c/rancher-os"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/rancher/os/issues"</span>
<span class="token assign-left variable">BUILD_ID</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="docker-容器引擎-2"><a href="#docker-容器引擎-2" class="headerlink" title="docker 容器引擎"></a>docker 容器引擎</h3><p>在 RancherOS 中有两套 docker ，一套是用来容器化运行系统服务的，包括用户空间的 docker ，而另一套 docker 就是用户空间的 docker</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">root@rancher rancher</span><span class="token punctuation">]</span></span># docker info
Client:
 Debug Mode: false

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 0
 Server Version: 19.03.5
 Storage Driver: overlay2
  Backing Filesystem: tmpfs
  Supports d_type: true
  Native Overlay Diff: true
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339
 runc version: 3e425f80a8c931f88e6d94a8c831b9d5aa481657
 init version: fec3683
 Security Options:
  seccomp
   Profile: default
 Kernel Version: 4.14.138-rancher
 Operating System: RancherOS v1.5.5
 OSType: linux
 Architecture: x86_64
 CPUs: 4
 Total Memory: 3.855GiB
 Name: rancher
 ID: 2256:3I2G:WFHC:ZRTL:CKG6:GXD6:3RDL:645J:CD4J:GKJ7:55SG:U32I
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Live Restore Enabled: false
 Product License: Community Engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="rancher-引擎"><a href="#rancher-引擎" class="headerlink" title="rancher 引擎"></a>rancher 引擎</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># du -sh /var/lib/rancher/engine/*</span>
<span class="token number">116</span>.0K  /var/lib/rancher/engine/completion
<span class="token number">33</span>.0M   /var/lib/rancher/engine/containerd
<span class="token number">5</span>.8M    /var/lib/rancher/engine/containerd-shim
<span class="token number">18</span>.0M   /var/lib/rancher/engine/ctr
<span class="token number">62</span>.6M   /var/lib/rancher/engine/docker
<span class="token number">748</span>.0K  /var/lib/rancher/engine/docker-init
<span class="token number">2</span>.7M    /var/lib/rancher/engine/docker-proxy
<span class="token number">68</span>.8M   /var/lib/rancher/engine/dockerd
<span class="token number">8</span>.3M    /var/lib/rancher/engine/runc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="资源占用"><a href="#资源占用" class="headerlink" title="资源占用"></a>资源占用</h3><h4 id="负载-2"><a href="#负载-2" class="headerlink" title="负载"></a>负载</h4><ul>
<li>可以看出 RancherOS 运行着大量的 <code>system-docker-containerd-shim</code> 这是因为它将系服务也都容器化来运行，但奇怪的是无法使用 docker 命令来管理这些服务。</li>
</ul>
<p><img data-src="https://p.k8s.li/20191231143958024.png"></p>
<h4 id="内存-2"><a href="#内存-2" class="headerlink" title="内存"></a>内存</h4><ul>
<li>初始化启动后内存使用了 1224MB😂，要比 CoreOS 和 Photon OS 加起来还多 😂</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>rancher@rancher ~<span class="token punctuation">]</span>$ <span class="token function">free</span> <span class="token parameter variable">-m</span>
             total       used       <span class="token function">free</span>     shared    buffers     cached
Mem:          <span class="token number">3947</span>       <span class="token number">1224</span>       <span class="token number">2722</span>        <span class="token number">993</span>          <span class="token number">0</span>        <span class="token number">993</span>
-/+ buffers/cache:        <span class="token number">231</span>       <span class="token number">3715</span>
Swap:            <span class="token number">0</span>          <span class="token number">0</span>          <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="磁盘-2"><a href="#磁盘-2" class="headerlink" title="磁盘"></a>磁盘</h4><p>由于系统服务是以容器的方式来运行的，而容器内的进程要访问系统文件系统的话就要将这些文件挂载到容器里去，所以会出现这么多的分区情况，不过绝大多数都是容器挂载的数据卷。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># df -h</span>
Filesystem                Size      Used Available Use% Mounted on
overlay                  <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /
tmpfs                     <span class="token number">1</span>.9G         <span class="token number">0</span>      <span class="token number">1</span>.9G   <span class="token number">0</span>% /dev
tmpfs                     <span class="token number">1</span>.9G         <span class="token number">0</span>      <span class="token number">1</span>.9G   <span class="token number">0</span>% /sys/fs/cgroup
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /media
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /opt
none                      <span class="token number">1</span>.9G    <span class="token number">944</span>.0K      <span class="token number">1</span>.9G   <span class="token number">0</span>% /run
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /mnt
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /home
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/resolv.conf
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/logrotate.d
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/lib/firmware
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/sbin/iptables
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/docker
none                      <span class="token number">1</span>.9G    <span class="token number">944</span>.0K      <span class="token number">1</span>.9G   <span class="token number">0</span>% /var/run
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/log
devtmpfs                  <span class="token number">1</span>.9G         <span class="token number">0</span>      <span class="token number">1</span>.9G   <span class="token number">0</span>% /host/dev
shm                      <span class="token number">64</span>.0M         <span class="token number">0</span>     <span class="token number">64</span>.0M   <span class="token number">0</span>% /host/dev/shm
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/selinux
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/hosts
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/lib/modules
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/hostname
shm                      <span class="token number">64</span>.0M         <span class="token number">0</span>     <span class="token number">64</span>.0M   <span class="token number">0</span>% /dev/shm
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/bin/system-docker
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/boot2docker
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/share/ros
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/m-user-docker
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/waagent
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/docker
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/kubelet
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/rancher
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/bin/ros
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /usr/bin/system-docker-runc
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /etc/ssl/certs/ca-certificates.crt.rancher
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/rancher/cache
/dev/sda1                <span class="token number">28</span>.0G      <span class="token number">1</span>.0G     <span class="token number">25</span>.5G   <span class="token number">4</span>% /var/lib/rancher/conf
devtmpfs                  <span class="token number">1</span>.9G         <span class="token number">0</span>      <span class="token number">1</span>.9G   <span class="token number">0</span>% /dev
shm                      <span class="token number">64</span>.0M         <span class="token number">0</span>     <span class="token number">64</span>.0M   <span class="token number">0</span>% /dev/shm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># mount</span>
overlay on / <span class="token builtin class-name">type</span> overlay <span class="token punctuation">(</span>rw,relatime,lowerdir<span class="token operator">=</span>/var/lib/system-docker/overlay2/l/TBWLXSEPWSCBGMNSU37HJXNRO3:/var/lib/system-docker/overlay2/l/DWK2WF5FKFYZTH74WUBGHTRF4V:/var/lib/system-docker/overlay2/l/HDUW6LV2DFEIJPW3IA33YTCNWX:/var/lib/system-docker/overlay2/l/ZDK3KMGDSN5O33AR6XJJF27NFO:/var/lib/system-docker/overlay2/l/TSWFV744M2LUOSPV2N6QHON4NP:/var/lib/system-docker/overlay2/l/QZ3U27554L5LKMJDYP3DC356L7:/var/lib/system-docker/overlay2/l/D6LSXZS2UGAZ7NMKQJKMQVT24P:/var/lib/system-docker/overlay2/l/KHB3OKMEQIL2P34QMHYF3HWTLT,upperdir<span class="token operator">=</span>/var/lib/system-docker/overlay2/fc79b6b6cf5c6d0b34b5abb95a1a19d765c1a00d66d0cff1ef3778d109471522/diff,workdir<span class="token operator">=</span>/var/lib/system-docker/overlay2/fc79b6b6cf5c6d0b34b5abb95a1a19d765c1a00d66d0cff1ef3778d109471522/work<span class="token punctuation">)</span>
proc on /proc <span class="token builtin class-name">type</span> proc <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime<span class="token punctuation">)</span>
tmpfs on /dev <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,nosuid,mode<span class="token operator">=</span><span class="token number">755</span><span class="token punctuation">)</span>
devpts on /dev/pts <span class="token builtin class-name">type</span> devpts <span class="token punctuation">(</span>rw,nosuid,noexec,relatime,gid<span class="token operator">=</span><span class="token number">5</span>,mode<span class="token operator">=</span><span class="token number">620</span>,ptmxmode<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">)</span>
sysfs on /sys <span class="token builtin class-name">type</span> sysfs <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime<span class="token punctuation">)</span>
tmpfs on /sys/fs/cgroup <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,mode<span class="token operator">=</span><span class="token number">755</span><span class="token punctuation">)</span>
none on /sys/fs/cgroup/freezer <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,freezer<span class="token punctuation">)</span>
none on /sys/fs/cgroup/devices <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,devices<span class="token punctuation">)</span>
none on /sys/fs/cgroup/net_cls,net_prio <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,net_cls,net_prio<span class="token punctuation">)</span>
none on /sys/fs/cgroup/perf_event <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,perf_event<span class="token punctuation">)</span>
none on /sys/fs/cgroup/hugetlb <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,hugetlb<span class="token punctuation">)</span>
none on /sys/fs/cgroup/cpuset <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpuset<span class="token punctuation">)</span>
none on /sys/fs/cgroup/cpu,cpuacct <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpu,cpuacct<span class="token punctuation">)</span>
none on /sys/fs/cgroup/blkio <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,blkio<span class="token punctuation">)</span>
none on /sys/fs/cgroup/memory <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,memory<span class="token punctuation">)</span>
none on /sys/fs/cgroup/pids <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,pids<span class="token punctuation">)</span>
mqueue on /dev/mqueue <span class="token builtin class-name">type</span> mqueue <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime<span class="token punctuation">)</span>
/dev/sda1 on /media <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /opt <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
none on /run <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
nsfs on /run/docker/netns/default <span class="token builtin class-name">type</span> nsfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
nsfs on /run/system-docker/netns/default <span class="token builtin class-name">type</span> nsfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
nsfs on /run/system-docker/netns/d15f3e062bb6 <span class="token builtin class-name">type</span> nsfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
/dev/sda1 on /mnt <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /home <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /etc/resolv.conf <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /etc/logrotate.d <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /usr/lib/firmware <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /usr/sbin/iptables <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>ro,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /etc/docker <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
none on /var/run <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
nsfs on /var/run/docker/netns/default <span class="token builtin class-name">type</span> nsfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
nsfs on /var/run/system-docker/netns/default <span class="token builtin class-name">type</span> nsfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
nsfs on /var/run/system-docker/netns/d15f3e062bb6 <span class="token builtin class-name">type</span> nsfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
/dev/sda1 on /var/log <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
devtmpfs on /host/dev <span class="token builtin class-name">type</span> devtmpfs <span class="token punctuation">(</span>rw,relatime,size<span class="token operator">=</span>1949420k,nr_inodes<span class="token operator">=</span><span class="token number">487355</span>,mode<span class="token operator">=</span><span class="token number">755</span><span class="token punctuation">)</span>
none on /host/dev/pts <span class="token builtin class-name">type</span> devpts <span class="token punctuation">(</span>rw,relatime,mode<span class="token operator">=</span><span class="token number">600</span>,ptmxmode<span class="token operator">=</span>000<span class="token punctuation">)</span>
shm on /host/dev/shm <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,size<span class="token operator">=</span>65536k<span class="token punctuation">)</span>
mqueue on /host/dev/mqueue <span class="token builtin class-name">type</span> mqueue <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime<span class="token punctuation">)</span>
/dev/sda1 on /etc/selinux <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /etc/hosts <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /usr/lib/modules <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /etc/hostname <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
shm on /dev/shm <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,size<span class="token operator">=</span>65536k<span class="token punctuation">)</span>
/dev/sda1 on /usr/bin/system-docker <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>ro,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/boot2docker <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /usr/share/ros <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/m-user-docker <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/waagent <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/docker <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/kubelet <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/rancher <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /usr/bin/ros <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>ro,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /usr/bin/system-docker-runc <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>ro,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /etc/ssl/certs/ca-certificates.crt.rancher <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/rancher/cache <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
/dev/sda1 on /var/lib/rancher/conf <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span>
devtmpfs on /dev <span class="token builtin class-name">type</span> devtmpfs <span class="token punctuation">(</span>rw,relatime,size<span class="token operator">=</span>1949420k,nr_inodes<span class="token operator">=</span><span class="token number">487355</span>,mode<span class="token operator">=</span><span class="token number">755</span><span class="token punctuation">)</span>
none on /dev/pts <span class="token builtin class-name">type</span> devpts <span class="token punctuation">(</span>rw,relatime,mode<span class="token operator">=</span><span class="token number">600</span>,ptmxmode<span class="token operator">=</span>000<span class="token punctuation">)</span>
shm on /dev/shm <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,size<span class="token operator">=</span>65536k<span class="token punctuation">)</span>
mqueue on /dev/mqueue <span class="token builtin class-name">type</span> mqueue <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime<span class="token punctuation">)</span>
cgroup on /sys/fs/cgroup/systemd <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,relatime,name<span class="token operator">=</span>systemd<span class="token punctuation">)</span>
none on /sys/fs/selinux <span class="token builtin class-name">type</span> selinuxfs <span class="token punctuation">(</span>ro,relatime<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="系统服务容器化"><a href="#系统服务容器化" class="headerlink" title="系统服务容器化"></a>系统服务容器化</h3><p>通过 top 命令和 ps 命令查看系统运行的进程可以发现以下几个重要的进程</p>
<h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PID  <span class="token environment constant">PPID</span> <span class="token environment constant">USER</span>     STAT   VSZ %VSZ %CPU COMMAND
<span class="token number">1695</span>  <span class="token number">1620</span> root     S     558m  <span class="token number">14</span>%   <span class="token number">0</span>% containerd <span class="token parameter variable">--config</span> /var/run/docker/containerd/containerd.toml --log-level info
<span class="token number">1988</span>  <span class="token number">1922</span> root     S    <span class="token number">11420</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token function">top</span>
   <span class="token number">1</span>     <span class="token number">0</span> root     S    1287m  <span class="token number">32</span>%   <span class="token number">0</span>% system-dockerd --storage-driver overlay2 <span class="token parameter variable">--graph</span> /var/lib/system-docker --config-file /etc/docker/system-docker.json <span class="token parameter variable">--restart</span><span class="token operator">=</span>false <span class="token parameter variable">--group</span> root --userland-proxy<span class="token operator">=</span>false <span class="token parameter variable">--bip</span> <span class="token number">172.18</span>.42.1/16 --log-opt max-file<span class="token operator">=</span><span class="token number">2</span> --log-opt max-size
 <span class="token number">489</span>     <span class="token number">1</span> root     S     833m  <span class="token number">21</span>%   <span class="token number">0</span>% system-docker-containerd <span class="token parameter variable">-l</span> unix:///var/run/system-docker/libcontainerd/system-docker-containerd.sock --metrics-interval<span class="token operator">=</span><span class="token number">0</span> --start-timeout 2m --state-dir /var/run/system-docker/libcontainerd/containerd <span class="token parameter variable">--shim</span> system-docker-contai
<span class="token number">1370</span>  <span class="token number">1353</span> root     S     808m  <span class="token number">20</span>%   <span class="token number">0</span>% respawn <span class="token parameter variable">-f</span> /etc/respawn.conf
<span class="token number">1620</span>  <span class="token number">1415</span> root     S     658m  <span class="token number">16</span>%   <span class="token number">0</span>% dockerd <span class="token parameter variable">--group</span> <span class="token function">docker</span> <span class="token parameter variable">--host</span> unix:///var/run/docker.sock --log-opt max-file<span class="token operator">=</span><span class="token number">2</span> --log-opt max-size<span class="token operator">=</span>25m
<span class="token number">1398</span>   <span class="token number">489</span> root     S     472m  <span class="token number">12</span>%   <span class="token number">0</span>% system-docker-containerd-shim 3d39a73e4089dcbdd144277adb398d3e0d8ba62812a699be7cfeac9598539f6e /var/run/system-docker/libcontainerd/3d39a73e4089dcbdd144277adb398d3e0d8ba62812a699be7cfeac9598539f6e system-docker-runc
<span class="token number">1285</span>   <span class="token number">489</span> root     S     470m  <span class="token number">12</span>%   <span class="token number">0</span>% system-docker-containerd-shim 254137c5e66a7075c2104cca82fa2e6584509170688064fac1147fbfcda2f5c0 /var/run/system-docker/libcontainerd/254137c5e66a7075c2104cca82fa2e6584509170688064fac1147fbfcda2f5c0 system-docker-runc
<span class="token number">1588</span>  <span class="token number">1370</span> root     S     452m  <span class="token number">11</span>%   <span class="token number">0</span>% /usr/bin/autologin rancher:tty1
<span class="token number">1013</span>   <span class="token number">995</span> root     S     452m  <span class="token number">11</span>%   <span class="token number">0</span>% netconf
<span class="token number">1151</span>   <span class="token number">489</span> root     S     406m  <span class="token number">10</span>%   <span class="token number">0</span>% system-docker-containerd-shim ccd97f8a77756dcc4ae21c935dcaf35aa8f02399e9ca87811a5f4ec1d5d6d1a3 /var/run/system-docker/libcontainerd/ccd97f8a77756dcc4ae21c935dcaf35aa8f02399e9ca87811a5f4ec1d5d6d1a3 system-docker-runc
 <span class="token number">995</span>   <span class="token number">489</span> root     S     398m  <span class="token number">10</span>%   <span class="token number">0</span>% system-docker-containerd-shim 08be8ef68e27d7e3b8f9d2a62914f9b581545ed96d65a751b487e7814f2bc795 /var/run/system-docker/libcontainerd/08be8ef68e27d7e3b8f9d2a62914f9b581545ed96d65a751b487e7814f2bc795 system-docker-runc
 <span class="token number">784</span>   <span class="token number">489</span> root     S     335m   <span class="token number">8</span>%   <span class="token number">0</span>% system-docker-containerd-shim 899028a78e3a3baa42ad1e3042d49f23e9fe2d6cce8b824850aaca4270d681fd /var/run/system-docker/libcontainerd/899028a78e3a3baa42ad1e3042d49f23e9fe2d6cce8b824850aaca4270d681fd system-docker-runc
 <span class="token number">803</span>   <span class="token number">489</span> root     S     335m   <span class="token number">8</span>%   <span class="token number">0</span>% system-docker-containerd-shim a2ededff859cc3d7c1a6342eb5d92606d4da605433d03abc92cc5f6503d53c6f /var/run/system-docker/libcontainerd/a2ededff859cc3d7c1a6342eb5d92606d4da605433d03abc92cc5f6503d53c6f system-docker-runc
<span class="token number">1076</span>   <span class="token number">489</span> root     S     334m   <span class="token number">8</span>%   <span class="token number">0</span>% system-docker-containerd-shim acf47c78a71194f1ef094302846855c777ef84fe613eb1ac1cc5f7ac868d618c /var/run/system-docker/libcontainerd/acf47c78a71194f1ef094302846855c777ef84fe613eb1ac1cc5f7ac868d618c system-docker-runc
 <span class="token number">956</span>   <span class="token number">489</span> root     S     280m   <span class="token number">7</span>%   <span class="token number">0</span>% system-docker-containerd-shim 4986cd58a227547af8e4867da067cf9f066062536268bf025466f88b4b38d9c3 /var/run/system-docker/libcontainerd/4986cd58a227547af8e4867da067cf9f066062536268bf025466f88b4b38d9c3 system-docker-runc
<span class="token number">1353</span>   <span class="token number">489</span> root     S     270m   <span class="token number">7</span>%   <span class="token number">0</span>% system-docker-containerd-shim 6fc9ef66b43c9902e23cea7cfdd78b8b5842df2b981d8d7899eacb3b063294fd /var/run/system-docker/libcontainerd/6fc9ef66b43c9902e23cea7cfdd78b8b5842df2b981d8d7899eacb3b063294fd system-docker-runc
<span class="token number">1311</span>  <span class="token number">1285</span> root     S     238m   <span class="token number">6</span>%   <span class="token number">0</span>% rsyslogd <span class="token parameter variable">-n</span>
<span class="token number">1168</span>  <span class="token number">1151</span> root     S     146m   <span class="token number">4</span>%   <span class="token number">0</span>% /usr/bin/vmtoolsd
<span class="token number">1415</span>  <span class="token number">1398</span> root     S     122m   <span class="token number">3</span>%   <span class="token number">0</span>% system-docker-runc <span class="token builtin class-name">exec</span> -- 6fc9ef66b43c9902e23cea7cfdd78b8b5842df2b981d8d7899eacb3b063294fd <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin <span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>rancher <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/ ros docker-init <span class="token parameter variable">--group</span> <span class="token function">docker</span> <span class="token parameter variable">--host</span> unix:
 <span class="token number">907</span>   <span class="token number">784</span> root     S     109m   <span class="token number">3</span>%   <span class="token number">0</span>% container-crontab
<span class="token number">1105</span>  <span class="token number">1076</span> root     S    <span class="token number">94084</span>   <span class="token number">2</span>%   <span class="token number">0</span>% ntpd <span class="token parameter variable">--nofork</span> <span class="token parameter variable">-g</span>
 <span class="token number">973</span>   <span class="token number">956</span> root     S    <span class="token number">22544</span>   <span class="token number">1</span>%   <span class="token number">0</span>% udevd
<span class="token number">1890</span>  <span class="token number">1888</span> rancher  S    <span class="token number">22448</span>   <span class="token number">1</span>%   <span class="token number">0</span>% sshd: rancher@pts/0
<span class="token number">1586</span>  <span class="token number">1370</span> root     S    <span class="token number">22096</span>   <span class="token number">1</span>%   <span class="token number">0</span>% /usr/sbin/sshd <span class="token parameter variable">-D</span>
<span class="token number">1888</span>  <span class="token number">1586</span> root     S    <span class="token number">22096</span>   <span class="token number">1</span>%   <span class="token number">0</span>% sshd: rancher <span class="token punctuation">[</span>priv<span class="token punctuation">]</span>
<span class="token number">1989</span>  <span class="token number">1586</span> root     S    <span class="token number">22096</span>   <span class="token number">1</span>%   <span class="token number">0</span>% sshd: rancher <span class="token punctuation">[</span>priv<span class="token punctuation">]</span>
<span class="token number">1991</span>  <span class="token number">1989</span> rancher  S    <span class="token number">22096</span>   <span class="token number">1</span>%   <span class="token number">0</span>% sshd: rancher@pts/1
<span class="token number">1922</span>  <span class="token number">1891</span> root     S    <span class="token number">16244</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token function">bash</span>
<span class="token number">1641</span>  <span class="token number">1588</span> rancher  S    <span class="token number">16116</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token parameter variable">-bash</span>
<span class="token number">1885</span>  <span class="token number">1641</span> root     S    <span class="token number">16116</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token function">bash</span>
<span class="token number">1891</span>  <span class="token number">1890</span> rancher  S    <span class="token number">16116</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token parameter variable">-bash</span>
<span class="token number">1992</span>  <span class="token number">1991</span> rancher  S    <span class="token number">16116</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token parameter variable">-bash</span>
<span class="token number">1997</span>  <span class="token number">1992</span> rancher  R    <span class="token number">11420</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token function">top</span>
<span class="token number">1589</span>  <span class="token number">1370</span> root     S     <span class="token number">6404</span>   <span class="token number">0</span>%   <span class="token number">0</span>% /sbin/agetty <span class="token parameter variable">--noclear</span> tty2 linux
<span class="token number">1591</span>  <span class="token number">1370</span> root     S     <span class="token number">6404</span>   <span class="token number">0</span>%   <span class="token number">0</span>% /sbin/agetty <span class="token parameter variable">--noclear</span> tty3 linux
<span class="token number">1592</span>  <span class="token number">1370</span> root     S     <span class="token number">6404</span>   <span class="token number">0</span>%   <span class="token number">0</span>% /sbin/agetty <span class="token parameter variable">--noclear</span> tty4 linux
<span class="token number">1594</span>  <span class="token number">1370</span> root     S     <span class="token number">6404</span>   <span class="token number">0</span>%   <span class="token number">0</span>% /sbin/agetty <span class="token parameter variable">--noclear</span> tty5 linux
<span class="token number">1595</span>  <span class="token number">1370</span> root     S     <span class="token number">6404</span>   <span class="token number">0</span>%   <span class="token number">0</span>% /sbin/agetty <span class="token parameter variable">--noclear</span> tty6 linux
<span class="token number">1112</span>   <span class="token number">995</span> root     S     <span class="token number">4660</span>   <span class="token number">0</span>%   <span class="token number">0</span>% dhcpcd <span class="token parameter variable">-MA4</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">force_hostname</span><span class="token operator">=</span>true <span class="token parameter variable">--timeout</span> <span class="token number">10</span> <span class="token parameter variable">-w</span> <span class="token parameter variable">--debug</span> eth0
 <span class="token number">850</span>   <span class="token number">803</span> root     S     <span class="token number">4276</span>   <span class="token number">0</span>%   <span class="token number">0</span>% /usr/sbin/acpid <span class="token parameter variable">-f</span>
 <span class="token number">477</span>     <span class="token number">1</span> root     Z        <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>ros<span class="token punctuation">]</span>
  <span class="token number">49</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/1:1<span class="token punctuation">]</span>
   <span class="token number">8</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>rcu_sched<span class="token punctuation">]</span>
  <span class="token number">33</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/0:1<span class="token punctuation">]</span>
   <span class="token number">7</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>ksoftirqd/0<span class="token punctuation">]</span>
  <span class="token number">39</span>     <span class="token number">2</span> root     SWN      <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>khugepaged<span class="token punctuation">]</span>
<span class="token number">1317</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/3:2<span class="token punctuation">]</span>
  <span class="token number">48</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/u8:1<span class="token punctuation">]</span>
  <span class="token number">76</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>scsi_eh_1<span class="token punctuation">]</span>
<span class="token number">1244</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/2:2<span class="token punctuation">]</span>
   <span class="token number">2</span>     <span class="token number">0</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kthreadd<span class="token punctuation">]</span>
   <span class="token number">4</span>     <span class="token number">2</span> root     IW<span class="token operator">&lt;</span>      <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/0:0H<span class="token punctuation">]</span>
   <span class="token number">6</span>     <span class="token number">2</span> root     IW<span class="token operator">&lt;</span>      <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>mm_percpu_wq<span class="token punctuation">]</span>
   <span class="token number">9</span>     <span class="token number">2</span> root     IW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>rcu_bh<span class="token punctuation">]</span>
  <span class="token number">10</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>migration/0<span class="token punctuation">]</span>
  <span class="token number">11</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>watchdog/0<span class="token punctuation">]</span>
  <span class="token number">12</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>cpuhp/0<span class="token punctuation">]</span>
  <span class="token number">13</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>cpuhp/1<span class="token punctuation">]</span>
  <span class="token number">14</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>watchdog/1<span class="token punctuation">]</span>
  <span class="token number">15</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>migration/1<span class="token punctuation">]</span>
  <span class="token number">16</span>     <span class="token number">2</span> root     SW       <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>ksoftirqd/1<span class="token punctuation">]</span>
  <span class="token number">18</span>     <span class="token number">2</span> root     IW<span class="token operator">&lt;</span>      <span class="token number">0</span>   <span class="token number">0</span>%   <span class="token number">0</span>% <span class="token punctuation">[</span>kworker/1:0H<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ros"><a href="#ros" class="headerlink" title="ros"></a>ros</h3><blockquote>
<p>A system service is a container that can be run in either System Docker or Docker. Rancher provides services that are already available in RancherOS by adding them to the <a target="_blank" rel="noopener" href="https://github.com/rancher/os-services">os-services repo</a>. Anything in the <code>index.yml</code> file from the repository for the tagged release will be an available system service when using the <code>ros service list</code> command.</p>
</blockquote>
<p>RancherOS 移除了 systemd ，取而代之的是使用 ros 来管理系统服务。而相应的系统服务也是采用 docker 的方式来运行，包括用户空间的 docker 也是采用 docker 的方式来运行。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># ros</span>
NAME:
   ros - Control and configure RancherOS
built: <span class="token string">'2019-12-30T09:16:00Z'</span>

USAGE:
   ros <span class="token punctuation">[</span>global options<span class="token punctuation">]</span> <span class="token builtin class-name">command</span> <span class="token punctuation">[</span>command options<span class="token punctuation">]</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

VERSION:
   v1.5.5

AUTHOR<span class="token punctuation">(</span>S<span class="token punctuation">)</span>:
   Rancher Labs, Inc.

COMMANDS:
     config, c   configure settings
     console     manage <span class="token function">which</span> console container is used
     engine      manage <span class="token function">which</span> Docker engine is used
     service, s
     os          operating system upgrade/downgrade
     tls         setup tls configuration
     <span class="token function">install</span>     <span class="token function">install</span> RancherOS to disk
     help, h     Shows a list of commands or <span class="token builtin class-name">help</span> <span class="token keyword">for</span> one <span class="token builtin class-name">command</span>

GLOBAL OPTIONS:
   --help, <span class="token parameter variable">-h</span>     show <span class="token builtin class-name">help</span>
   --version, <span class="token parameter variable">-v</span>  print the version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="系统进程"><a href="#系统进程" class="headerlink" title="系统进程"></a>系统进程</h3><ul>
<li>可以看到，使用 <code>ros service ps</code> 命令来查看正在运行的系统服务，这些服务都是以容器的方式来运行的。比如用户空间里的 <code>user-docker</code> 、<code>syslog</code> 、<code>udevd</code>   等等都是以容器的方式来运行的，而不是以传统进程服务来运行的。包括我们安装 RancherOS 到磁盘的时候  <code>starting installer container for rancher/os-installer:latest (new)</code> 这个安装程序也是由容器的方式来运行的，把磁盘设备和 <code>cloud-init</code> 配置文件一并挂载到容器中。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rancher rancher<span class="token punctuation">]</span><span class="token comment"># ros service ps</span>
Name                    Command                                                            State                     Ports
<span class="token function">docker</span>                  ros user-docker                                                    Up <span class="token number">9</span> minutes
<span class="token function">logrotate</span>               /usr/bin/entrypoint.sh /usr/sbin/logrotate <span class="token parameter variable">-v</span> /etc/logrotate.conf  Created
system-cron             container-crontab                                                  Up <span class="token number">9</span> minutes
container-data-volumes  /usr/bin/ros entrypoint <span class="token builtin class-name">echo</span>                                       Created
console                 /usr/bin/ros entrypoint ros console-init                           Up <span class="token number">9</span> minutes
system-volumes          /usr/bin/ros entrypoint <span class="token builtin class-name">echo</span>                                       Created
ntp                     /usr/bin/ros entrypoint /bin/start_ntp.sh                          Up <span class="token number">9</span> minutes
subscriber              /usr/bin/ros entrypoint os-subscriber                              Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> minutes ago
syslog                  /usr/bin/entrypoint.sh rsyslogd <span class="token parameter variable">-n</span>                                 Up <span class="token number">9</span> minutes
media-volumes           /usr/bin/ros entrypoint <span class="token builtin class-name">echo</span>                                       Created
preload-user-images     /usr/bin/ros entrypoint ros preload-images                         Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">9</span> minutes ago
udev                    /usr/bin/ros entrypoint udevd                                      Up <span class="token number">9</span> minutes
udev-cold               /usr/bin/ros entrypoint ros udev-settle                            Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">9</span> minutes ago
network                 /usr/bin/ros entrypoint netconf                                    Up <span class="token number">9</span> minutes
open-vm-tools           /usr/bin/ros entrypoint /usr/bin/vmtoolsd                          Up <span class="token number">9</span> minutes
acpid                   /usr/bin/ros entrypoint /usr/sbin/acpid <span class="token parameter variable">-f</span>                         Up <span class="token number">9</span> minutes
command-volumes         /usr/bin/ros entrypoint <span class="token builtin class-name">echo</span>                                       Created
cloud-init-execute      /usr/bin/ros entrypoint cloud-init-execute -pre-console            Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">9</span> minutes ago
user-volumes            /usr/bin/ros entrypoint <span class="token builtin class-name">echo</span>                                       Created
all-volumes             /usr/bin/ros entrypoint <span class="token builtin class-name">echo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="包管理器"><a href="#包管理器" class="headerlink" title="包管理器"></a>包管理器</h3><p>和 CoreOS 一样，RancherOS 也没得相应的包管理器 😂，都是采用容器来运行所需的服务，使用 <code>ros</code> 命令来管理相应的服务。如果想要运行一个服务的话，需要使用 ros 来创建相应的容器来运行才可以。而使用 ros 来创建服务</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>文章写的太仓促了，感觉这些容器优化行操作系统都值得玩一玩得，尤其是 RancherOS 这种将 systemc 取代掉使用 docker 来管理系统服务得牛皮技术，值得研究一哈。因为时间有限，所以就没有详细地展开来将，就等到 2020 年吧 😂。祝大家 2020 年元旦快乐，新的一年里……省略千字祝福 😝</p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/%E5%AE%B9%E5%99%A8/" rel="tag"># 容器</a>
              <a href="/tags/kubernees/" rel="tag"># kubernees</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/pc-e5v3-e3v3-amd2600.html" rel="prev" title="台式机装机方案">
                  <i class="fa fa-chevron-left"></i> 台式机装机方案
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019-reading-notes.html" rel="next" title="2019 年读书笔记和思考">
                  2019 年读书笔记和思考 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">26:46</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
