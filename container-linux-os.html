<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.k8s.li').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>
  <meta name="description" content="更新日志 2019-12-31 初稿，可能完成不了，等到来年了😂 2020-01-01  容器优化型操作系统？GKE 的  Container-Optimized OSGoogle 家的  GKE  中的每个节点都是使用 Container-Optimized OS 来运行工作负载，不过仅仅是针对 GCE 来进行优化的，可能在 OpenStack 或者 vSphere 上运行不起来，(瞎猜😂">
<meta property="og:type" content="article">
<meta property="og:title" content="Container Linux OS 从入坑到爬出来😂">
<meta property="og:url" content="https://blog.k8s.li/container-linux-os.html">
<meta property="og:site_name" content="木子">
<meta property="og:description" content="更新日志 2019-12-31 初稿，可能完成不了，等到来年了😂 2020-01-01  容器优化型操作系统？GKE 的  Container-Optimized OSGoogle 家的  GKE  中的每个节点都是使用 Container-Optimized OS 来运行工作负载，不过仅仅是针对 GCE 来进行优化的，可能在 OpenStack 或者 vSphere 上运行不起来，(瞎猜😂">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20191231163325900.png">
<meta property="og:image" content="https://p.k8s.li/20191231163400135.png">
<meta property="og:image" content="https://p.k8s.li/rancheroshowitworks.png">
<meta property="og:image" content="https://p.k8s.li/20191231105906355.png">
<meta property="og:image" content="https://p.k8s.li/20191231110111943.png">
<meta property="og:image" content="https://p.k8s.li/20191231110153113.png">
<meta property="og:image" content="https://p.k8s.li/20191231110231422.png">
<meta property="og:image" content="https://p.k8s.li/20191231110339494.png">
<meta property="og:image" content="https://p.k8s.li/20191231110531238.png">
<meta property="og:image" content="https://p.k8s.li/20191231111131193.png">
<meta property="og:image" content="https://p.k8s.li/20191231113306435.png">
<meta property="og:image" content="https://p.k8s.li/20191231125441199.png">
<meta property="og:image" content="https://p.k8s.li/20191231133509428.png">
<meta property="og:image" content="https://p.k8s.li/20191231135348120.png">
<meta property="og:image" content="https://p.k8s.li/20191231142454934.png">
<meta property="og:image" content="https://p.k8s.li/20191231143958024.png">
<meta property="article:published_time" content="2019-12-30T16:00:00.000Z">
<meta property="article:modified_time" content="2021-05-30T14:38:18.408Z">
<meta property="article:author" content="木子">
<meta property="article:tag" content="容器">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="kubernees">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20191231163325900.png">
<link rel="canonical" href="https://blog.k8s.li/container-linux-os.html">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
  <title>Container Linux OS 从入坑到爬出来😂 | 木子</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
<link rel="alternate" href="/atom.xml" title="木子" type="application/atom+xml">
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">
    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">木子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>
  </li>
        <li class="menu-item menu-item-books">
    <a href="/booklist.html" rel="section"><i class="fa fa-fw fa-book"></i>Books</a>
  </li>
        <li class="menu-item menu-item-kindle">
    <a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
  </li>
        <li class="menu-item menu-item-friend">
    <a href="/link/" rel="section"><i class="fa fa-fw fa-link"></i>Friend</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>
  </li>
  </ul>
</nav>
</div>
    </header>
  <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
  <div class="posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/container-linux-os.html">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blog.k8s.li/avatar.png">
      <meta itemprop="name" content="木子">
      <meta itemprop="description" content="">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          Container Linux OS 从入坑到爬出来😂
        </h2>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="创建时间：2019-12-31 2019-12-31T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2019-12-31T00:00:00+08:00">2019-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-30 2021-05-30T22:38:18+08:00" itemprop="dateModified" datetime="2021-05-30T22:38:18+08:00">2021-05-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>
            </span>
  <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    <a title="disqus" href="/container-linux-os.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="container-linux-os.html" itemprop="commentCount"></span>
    </a>
  </span>
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>38k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:03</span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><ul>
<li>2019-12-31 初稿，可能完成不了，等到来年了😂</li>
<li>2020-01-01</li>
</ul>
<h2 id="容器优化型操作系统？"><a href="#容器优化型操作系统？" class="headerlink" title="容器优化型操作系统？"></a>容器优化型操作系统？</h2><h3 id="GKE-的-Container-Optimized-OS"><a href="#GKE-的-Container-Optimized-OS" class="headerlink" title="GKE 的  Container-Optimized OS"></a>GKE 的  <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a></h3><p>Google 家的  GKE  中的每个节点都是使用 <a href="https://cloud.google.com/container-optimized-os/docs/" target="_blank" rel="noopener">Container-Optimized OS</a> 来运行工作负载，不过仅仅是针对 GCE 来进行优化的，可能在 OpenStack 或者 vSphere 上运行不起来，(瞎猜😂</p>
<blockquote>
<p>Container-Optimized OS 是适用于 <a href="https://cloud.google.com/compute" target="_blank" rel="noopener">Compute Engine</a> 虚拟机的操作系统映像，专为运行 Docker 容器而优化。借助 Container-Optimized OS，您可以快速、高效、安全地在  Google Cloud Platform 上启动 Docker 容器。Container-Optimized OS 由 Google  维护，基于 <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a> 开放源代码项目。</p>
</blockquote>
<h3 id="CoreOS-Container-Linux"><a href="#CoreOS-Container-Linux" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h3><p>个人认为 CoreOS 的 CoreOS Container Linux 要比 Container-Optimized OS 和 Photon OS 要更加专业，尤其是针对容器来讲， CoreOS 就是专门用来运行容器的，它没有像 yum 或 apt 这样的包管理器来安装软件，在 CoreOS 中你不需要安装软件，因为所有的应用程序都要使用 docker 来打包。</p>
<blockquote>
<p>额外提一句，CoreOS 是一个团队，现如今已经被 Red Hat® 收购了，而 Red Hat® 已经被 IBM 收购了，按照关系来讲而 CoreOS 应该是 IBM 的孙子吧🙃。而 CoreOS Container Linux 仅仅是他们维护项目的其中一个，CoreOS 开源的项目还有：</p>
<ul>
<li>etcd：</li>
<li>Clair:</li>
<li>dex：</li>
<li>Prometheus：</li>
<li>flannel：</li>
</ul>
</blockquote>
<p>在 Linux 世界里有大量的发行版可以做为服务器系统使用, 但是这些系统大多部署复杂, 更新系统更是困难重重. 这些都是 CoreOS 试图解决的问题。</p>
<h4 id="特点如下"><a href="#特点如下" class="headerlink" title="特点如下"></a>特点如下</h4><ul>
<li>最小化的操作系统： 占用内存很少，比典型的服务器版本 Linux 少占 40%的内存。</li>
<li>易于升级： CoreOS 采用双系统分区（主动分区/被动分区）设计而不是采用传统的通过升级包来升级系统，这使得每次升级更加快速，可靠和易于回滚。</li>
<li>集成 Docker： CoreOS 默认集成 Docker 并作了很好的支持和优化，省去用户安装，配置，优化 Docker 的时间，极大地方便了用户。</li>
<li>易于集群化： CoreOS 本身提供了大型 Docker 容器集群的整体解决方案，通过内置的 fleet 工具在多台系统中部署容器并进行集群化管理。同时通过提供 Discovery Service，便于动态部署和管理集群，解决方案比较成熟。</li>
<li>自动化的大规模部署： CoreOS 自身提供的解决方案能够自动地大规模批量部署并操作系统，极大地减少用户工作量。</li>
<li>使用 systemd 做为系统服务管理工具，性能比较好，systemd 有现代化的日志功能，同时采用 socket 式与 D-Bus 总线式激活服务.</li>
</ul>
<h3 id="Photon-OS"><a href="#Photon-OS" class="headerlink" title="Photon OS"></a>Photon OS</h3><h4 id="官方宣传册"><a href="#官方宣传册" class="headerlink" title="官方宣传册"></a>官方宣传册</h4><p>PPT 做的不错呦😂</p>
<p><img src="https://p.k8s.li/20191231163325900.png" alt=""></p>
<p><img src="https://p.k8s.li/20191231163400135.png" alt=""></p>
<p>剽窃一段 VMware 官方的<a href="https://vmware.github.io/photon/" target="_blank" rel="noopener">文档</a>介绍：</p>
<blockquote>
<p>Project Photon OS™ is an open source, minimal Linux container host  that is optimized for cloud-native applications, cloud platforms, and  VMware infrastructure. Photon OS 3.0 introduces ARM64 support, installer improvements and updated packages. We invite partners, customers, and  community members to collaborate on using Photon OS to run  high-performance virtual machines and containerized applications.</p>
<ul>
<li><strong>Optimized for VMware vSphere®</strong>: The Linux kernel is tuned for performance when Photon OS runs on vSphere.</li>
<li><strong>Support for containers</strong>: Photon OS includes the Docker daemon and works with container orchestration frameworks, such as Mesos and Kubernetes.</li>
<li><strong>Efficient lifecycle management</strong>: Photon OS is easy to manage, patch, and update.</li>
<li><strong>Security hardened</strong>: The kernel and other aspects of the operating system are built with an emphasis on security.</li>
</ul>
<p>For more information, see the <a href="https://vmware.github.io/photon/assets/files/photon-os-datasheet.pdf" target="_blank" rel="noopener">datasheet</a>.</p>
<p>Track our progress in earning the Linux Foundation’s Core Infrastructure Initiative’s Best Practices Badge.</p>
</blockquote>
<p>可以看出 Photon OS™ 是针对 VMware vSphere® 虚拟化平台进行内核优化的容器专用操作系统，就和 CoreOS 一样。十分适合专门用来运行容器，当作 Kubernetes 集群中的工作负载来使用。</p>
<h3 id="RancherOS"><a href="#RancherOS" class="headerlink" title="RancherOS"></a>RancherOS</h3><p>剽窃一段官方的<a href="https://rancher.com/docs/os/v1.x/en/" target="_blank" rel="noopener">介绍</a>：</p>
<blockquote>
<p>RancherOS is the smallest, easiest way to run Docker in production. Every process in RancherOS is a container managed by Docker. This includes system services such as <code>udev</code> and <code>syslog</code>. Because it only includes the services necessary to run Docker, RancherOS is significantly smaller than most traditional operating systems. By removing unnecessary libraries and services, requirements for security patches and other maintenance are also reduced. This is possible because, with Docker, users typically package all necessary libraries into their containers.</p>
<p>Another way in which RancherOS is designed specifically for running Docker is that it always runs the latest version of Docker. This allows users to take advantage of the latest Docker capabilities and bug fixes.</p>
<p>Like other minimalist Linux distributions, RancherOS boots incredibly quickly. Starting Docker containers is nearly instant, similar to starting any other process. This speed is ideal for organizations adopting microservices and autoscaling.</p>
<p>Docker is an open-source platform designed for developers, system admins, and DevOps. It is used to build, ship, and run containers, using a simple and powerful command line interface (CLI). To get started with Docker, please visit the <a href="https://docs.docker.com/engine/userguide/" target="_blank" rel="noopener">Docker user guide</a>.</p>
</blockquote>
<p>RancherOS 是 Rancher 团队所维护的开源项目，也是对标 CoreOS 一样，专门用来运行容器，并且可以运行在生产环境（至少官方做了这么样的承诺，咱也没在生产用过，不好说。在 RancherOS 中所有的进程（包括系统所有的服务，比如 udev 和 syslog）都是用 docker 来管理，这一点要比 CoreOS 更加激进一些，而 CoreOS 还是使用传统 Linux 发行版中的 systemd 来管理系统中的服务。通过移除传统 Linux 发行版中不必要的服务和库来最小化系统，使他专注单一的功能，即运行 docker 容器。</p>
<blockquote>
<p>Everything in RancherOS is a Docker container. We accomplish this by launching two instances of Docker. One is what we call <strong>System Docker</strong> and is the first process on the system. All other system services, like <code>ntpd</code>, <code>syslog</code>, and <code>console</code>, are running in Docker containers. System Docker replaces traditional init systems like <code>systemd</code> and is used to launch <a href="https://rancher.com/docs/os/v1.x/en/installation/system-services/adding-system-services/" target="_blank" rel="noopener">additional system services</a>.</p>
<p>System Docker runs a special container called <strong>Docker</strong>, which is another Docker daemon responsible for managing all of the user’s containers. Any containers that you launch as a user from the console will run inside this Docker. This creates isolation from the System Docker containers and ensures that normal user commands don’t impact system services.</p>
<p>We created this separation not only for the security benefits, but also to make sure that commands like <code>docker rm -f $(docker ps -qa)</code> don’t delete the entire OS.</p>
</blockquote>
<p><code>Everything in RancherOS is a Docker container.</code> 感觉这个要比 CoreOS 更加容器化，甚至使用 docker 取代了 systemd 来管理系统的各种服务。系统启动后运行两个 docker 服务进程，一个是系统 docker ，在此之上在运行系统服务容器，和用户层面的 docker 。不过看一下下面的这张图你就会明白。总的来讲 RancherOS 是使用 docker 来管理整个系统的服务的，包括用户层面的 docker 。</p>
<p><img src="https://p.k8s.li/rancheroshowitworks.png" alt=""></p>
<h2 id="安装体验"><a href="#安装体验" class="headerlink" title="安装体验"></a>安装体验</h2><p>咱的虚拟化平台是 VMware vSphere ，因为硬件服务器大多数都是 Dell 的，而  Dell  是 VMware 母公司，对于我司这种传统企业来讲使用 VMware vSphere 这种用户 UI 友好的虚拟化无疑是最好的选择，哈哈😂。其他虚拟化平台比如 OpenStack 安装步骤会有所不同。</p>
<h3 id="Container-Optimized-OS"><a href="#Container-Optimized-OS" class="headerlink" title="Container-Optimized OS"></a>Container-Optimized OS</h3><p>因为仅仅是针对 GCE 进行优化的系统，传统的虚拟化比如 KVM 、 ESXi 可能用不了。另外还需要拿 <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a>  的源码来编译镜像，没有现成的  ISO 或者 OVA 虚拟机模板可用，咱就不折腾了。毕竟硬件资源有限，现场编译一个 <a href="https://www.chromium.org/chromium-os" target="_blank" rel="noopener">Chromium OS</a>  也需要十几个小时😥</p>
<h2 id="Photon-OS-1"><a href="#Photon-OS-1" class="headerlink" title="Photon OS"></a>Photon OS</h2><p>可以现成编译一个 ISO 镜像，也可以使用官方已经编译好的 ISO 镜像或者 OVA 虚拟机模板。不过也支持常见的公有云，比如 Amazon AMI 、Google GCE Image、Azure VHD。甚至还有 Raspberry Pi3 Image 树莓派3😂</p>
<h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a><a href="https://vmware.github.io/photon/assets/files/html/3.0/photon_installation/" target="_blank" rel="noopener">官方文档</a></h3><p>官方的安装文档中都给出了各种环境的安装方式，选择自己的环境按照文档一步一步来就行，不过在此注意以下几点。</p>
<h3 id="安装镜像"><a href="#安装镜像" class="headerlink" title="安装镜像"></a>安装镜像</h3><ul>
<li><h4 id="ISO"><a href="#ISO" class="headerlink" title="ISO"></a><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">ISO</a></h4></li>
</ul>
<p>通用的方案，适用于各种环境，无论是虚拟机还是物理机，由于咱使用的是 VMware vSphere 虚拟化，咱就使用 OVA 格式，因为后者对 vSphere 进行了优化。对于 VMware 用户来讲最好使用 OVA 格式来进行安装。</p>
<ul>
<li><h4 id="OVA"><a href="#OVA" class="headerlink" title="OVA"></a><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">OVA</a></h4></li>
</ul>
<blockquote>
<p>Pre-installed minimal environment, customized for VMware hypervisor  environments. These customizations include a highly sanitized and  optimized kernel to give improved boot and runtime performance for  containers and Linux applications. Since an OVA is a complete virtual  machine definition, we’ve made available a Photon OS OVA that has  virtual hardware version 11; this will allow for compatibility with  several versions of VMware platforms or allow for the latest and  greatest virtual hardware enhancements.</p>
</blockquote>
<p>根据官方文档所描述的 OVA 虚拟机模板是针对  VMware hypervisor  虚拟化环境进行优化定制的。</p>
<ul>
<li><h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5></li>
<li><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Amazon Machine Image</a></p>
</li>
<li><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Google Compute Engine image</a></p>
</li>
<li><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Azure VHD</a></p>
</li>
<li><p><a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS" target="_blank" rel="noopener">Raspberry Pi3</a></p>
</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>下载好 OVA 虚拟机模板后，登录到 ESXi 或者 vCenter 中直接使用 OVA 创建虚拟机模板即可，对于 <code>VMware® Workstation 1x Pro</code>  可以直接将 OVA 导入成为虚拟机来运行。</p>
<h4 id="1-导入-OVA-虚拟机模板"><a href="#1-导入-OVA-虚拟机模板" class="headerlink" title="1. 导入 OVA 虚拟机模板"></a>1. 导入 OVA 虚拟机模板</h4><p><img src="https://p.k8s.li/20191231105906355.png" alt=""></p>
<h4 id="2-添加-OVA-虚拟机模板"><a href="#2-添加-OVA-虚拟机模板" class="headerlink" title="2.添加 OVA 虚拟机模板"></a>2.添加 OVA 虚拟机模板</h4><p><img src="https://p.k8s.li/20191231110111943.png" alt=""></p>
<h4 id="3-选择存储"><a href="#3-选择存储" class="headerlink" title="3. 选择存储"></a>3. 选择存储</h4><p><img src="https://p.k8s.li/20191231110153113.png" alt=""></p>
<h4 id="4-同意许可协议"><a href="#4-同意许可协议" class="headerlink" title="4. 同意许可协议"></a>4. 同意许可协议</h4><p><img src="https://p.k8s.li/20191231110231422.png" alt=""></p>
<h4 id="5-部署选项"><a href="#5-部署选项" class="headerlink" title="5.部署选项"></a>5.部署选项</h4><ul>
<li>选择好网络</li>
<li>磁盘置备的方式：精简就是使用到的时候再对磁盘进行制令。厚置备就是创建虚拟机的时候对磁盘进行置零，性能会好一些。</li>
</ul>
<p><img src="https://p.k8s.li/20191231110339494.png" alt=""></p>
<h4 id="6-即将完成"><a href="#6-即将完成" class="headerlink" title="6. 即将完成"></a>6. 即将完成</h4><p><img src="https://p.k8s.li/20191231110531238.png" alt=""></p>
<h3 id="系统启动"><a href="#系统启动" class="headerlink" title="系统启动"></a>系统启动</h3><p><img src="https://p.k8s.li/20191231111131193.png" alt=""></p>
<p>初始用户名是 <code>root</code> ，密码是 <code>changeme</code> ，输入完密码之后会强制要求你更改密码，在输入一次 <code>changeme</code> 之后输入两次修改的密码即可。</p>
<p>登录到系统之后使用 <code>ip addr</code> 命令查看由默认的 DHCP 获取到的方式来查看 IP，然后编辑 sshd_config 配置文件允许 root 登录。不得不说 ESXi 的 Web 控制台实在是太难用了，还是 ssh 上去使用吧。</p>
<ul>
<li><code>vi /etc/ssh/sshd_config</code> 把 <code>PermitRootLogin</code> 配置项修改为 <code>yes</code> 即可</li>
<li>重启 sshd 服务 <code>systemctl restart sshd</code></li>
</ul>
<h3 id="内核"><a href="#内核" class="headerlink" title="内核"></a>内核</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Linux  4.19.79-1.ph3-esx <span class="comment">#1-photon SMP Tue Oct 22 23:53:27 UTC 2019 x86_64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line">root@photon-machine [ ~ ]<span class="comment"># cat /etc/os-release</span></span><br><span class="line">NAME=<span class="string">"VMware Photon OS"</span></span><br><span class="line">VERSION=<span class="string">"3.0"</span></span><br><span class="line">ID=photon</span><br><span class="line">VERSION_ID=3.0</span><br><span class="line">PRETTY_NAME=<span class="string">"VMware Photon OS/Linux"</span></span><br><span class="line">ANSI_COLOR=<span class="string">"1;34"</span></span><br><span class="line">HOME_URL=<span class="string">"https://vmware.github.io/photon/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://github.com/vmware/photon/issues"</span></span><br></pre></td></tr></table></figure>
<p>目前的内核版本是 4.19.79 ，比 CentOS 7 系那种五年前的 3.18 内核高到不知道哪里去了。不过个人认为，对于容器虚拟化这种依赖于内核特性的技术来讲还是要选择高一点的版本比较好。像 CentOS 那种五年前的 3.18 版本，那时候容器所依赖的很多内核特性在这些版本上还不够成熟。从使用来讲，或外的公有云像 GKE 、AKS、AKE 等都是使用的 4.14 内核版本以上。</p>
<p>4.19 版本有个小问题，就是如果 kube-proxy 使用 IPVS 的话，需要开启相应的内核模块，主要依赖的内核模块有以下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br></pre></td></tr></table></figure>
<p>在 4.19 版本之后 nf_conntrack_ipv4 内核模块替换成了 nf_conntrack ，参看 <a href="https://github.com/coreos/bugs/issues/2518" target="_blank" rel="noopener">coreos/bugs#2518</a></p>
<h3 id="资源占用情况"><a href="#资源占用情况" class="headerlink" title="资源占用情况"></a>资源占用情况</h3><h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><ul>
<li>系统初始化启动之后内存仅仅使用了 45Mi</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi        45Mi       1.8Gi       0.0Ki        93Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure>
<ul>
<li>启动 docker 进程之后的占用情况，也仅仅 109Mi</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          2.0Gi       109Mi       1.6Gi       0.0Ki       238Mi       1.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure>
<h4 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h4><p>使用 OVA 虚拟机模板启动后的虚拟机，磁盘仅仅占用了 515MB ，确实是相当轻量化，这还是包含了 docker。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        16G  515M   15G   4% /</span><br><span class="line">devtmpfs        998M     0  998M   0% /dev</span><br><span class="line">tmpfs          1000M     0 1000M   0% /dev/shm</span><br><span class="line">tmpfs          1000M  532K  999M   1% /run</span><br><span class="line">tmpfs          1000M     0 1000M   0% /sys/fs/cgroup</span><br><span class="line">tmpfs          1000M     0 1000M   0% /tmp</span><br><span class="line">/dev/sda2        10M  2.2M  7.9M  22% /boot/efi</span><br><span class="line">tmpfs           200M     0  200M   0% /run/user/0</span><br></pre></td></tr></table></figure>
<h4 id="负载"><a href="#负载" class="headerlink" title="负载"></a>负载</h4><p><img src="https://p.k8s.li/20191231113306435.png" alt=""></p>
<h3 id="进程和服务"><a href="#进程和服务" class="headerlink" title="进程和服务"></a>进程和服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">● photon-machine</span><br><span class="line">    State: running</span><br><span class="line">     Jobs: 0 queued</span><br><span class="line">   Failed: 0 units</span><br><span class="line">    Since: Tue 2019-12-31 13:53:18 UTC; 11min ago</span><br><span class="line">   CGroup: /</span><br><span class="line">           ├─user.slice</span><br><span class="line">           │ └─user-0.slice</span><br><span class="line">           │   ├─session-c1.scope</span><br><span class="line">           │   │ ├─363 /bin/login -p --</span><br><span class="line">           │   │ └─396 -bash</span><br><span class="line">           │   ├─session-c2.scope</span><br><span class="line">           │   │ ├─408 sshd: root@pts/0</span><br><span class="line">           │   │ ├─415 -bash</span><br><span class="line">           │   │ └─560 systemctl status</span><br><span class="line">           │   └─user@0.service</span><br><span class="line">           │     └─init.scope</span><br><span class="line">           │       ├─388 /lib/systemd/systemd --user</span><br><span class="line">           │       └─389 (sd-pam)</span><br><span class="line">           ├─init.scope</span><br><span class="line">           │ └─1 /lib/systemd/systemd</span><br><span class="line">           └─system.slice</span><br><span class="line">             ├─systemd-networkd.service</span><br><span class="line">             │ └─255 /lib/systemd/systemd-networkd</span><br><span class="line">             ├─systemd-udevd.service</span><br><span class="line">             │ └─125 /lib/systemd/systemd-udevd</span><br><span class="line">             ├─vgauthd.service</span><br><span class="line">             │ └─197 /usr/bin/VGAuthService -s</span><br><span class="line">             ├─docker.service</span><br><span class="line">             │ ├─430 /usr/bin/dockerd</span><br><span class="line">             │ └─437 docker-containerd --config /var/run/docker/containerd/containerd.toml</span><br><span class="line">             ├─systemd-journald.service</span><br><span class="line">             │ └─100 /lib/systemd/systemd-journald</span><br><span class="line">             ├─sshd.service</span><br><span class="line">             │ └─361 /usr/sbin/sshd -D</span><br><span class="line">             ├─vmtoolsd.service</span><br><span class="line">             │ └─94 /usr/bin/vmtoolsd</span><br><span class="line">             ├─systemd-resolved.service</span><br><span class="line">             │ └─257 /lib/systemd/systemd-resolved</span><br><span class="line">             ├─dbus.service</span><br><span class="line">             │ └─198 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span><br><span class="line">             ├─systemd-timesyncd.service</span><br><span class="line">             │ └─167 /lib/systemd/systemd-timesyncd</span><br><span class="line">             └─systemd-logind.service</span><br><span class="line">               └─195 /lib/systemd/systemd-logind</span><br></pre></td></tr></table></figure>
<h3 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h3><p>Photon OS 默认的包管理工具是 tdnf ，不过也支持 yum ，两者使用方式有细微的差别，使用的也是相同的软件包源，而且对于国内用户来讲，软件包源在国外服务器上（<a href="https://dl.bintray.com/vmware/），速度感人，肉眼可见" target="_blank" rel="noopener">https://dl.bintray.com/vmware/），速度感人，肉眼可见</a> KB/s 级别的速度。你懂的，操他奶奶的 GFW，尼玛死了😡，搞网络封锁耽误这人搬砖。安装速度慢得一批，单单下载 50 MB 的软件包就下不下来，不得不用上我那台透明代理的旁路网关。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@photon-OS [ ~ ]<span class="comment"># tdnf upgrade</span></span><br><span class="line"></span><br><span class="line">Installing:</span><br><span class="line">runc                x86_64  1.0.0.rc9-1.ph3   photon-updates     10.24M 10736757</span><br><span class="line">containerd          x86_64  1.2.10-1.ph3      photon-updates     76.25M 79950751</span><br><span class="line">docker-engine       x86_64  18.09.9-1.ph3     photon-updates     91.29M 95721322</span><br><span class="line">docker-cli          x86_64  18.09.9-1.ph3     photon-updates     72.76M 76299393</span><br><span class="line"></span><br><span class="line">Total installed size: 250.54M 262708223</span><br><span class="line"></span><br><span class="line">Upgrading:</span><br><span class="line">sqlite-libs         x86_64  3.27.2-6.ph3      photon-updates      1.08M 1129424</span><br><span class="line">python3-setuptools  noarch  3.7.5-1.ph3       photon-updates      1.61M 1692186</span><br><span class="line">python3-xml         x86_64  3.7.5-1.ph3       photon-updates    333.69k 341698</span><br><span class="line">python3-libs        x86_64  3.7.5-1.ph3       photon-updates     22.88M 23990697</span><br><span class="line">python3             x86_64  3.7.5-1.ph3       photon-updates      2.90M 3044206</span><br><span class="line">openssl             x86_64  1.0.2t-2.ph3      photon-updates      4.53M 4750710</span><br><span class="line">openssh-server      x86_64  7.8p1-6.ph3       photon-updates    904.54k 926254</span><br><span class="line">openssh-clients     x86_64  7.8p1-6.ph3       photon-updates      3.65M 3831266</span><br><span class="line">openssh             x86_64  7.8p1-6.ph3       photon-updates        0.00b 0</span><br><span class="line">linux-esx           x86_64  4.19.87-1.ph3     photon-updates     12.67M 13284780</span><br><span class="line">libarchive          x86_64  3.3.3-4.ph3       photon-updates    804.34k 823648</span><br><span class="line">e2fsprogs-libs      x86_64  1.44.3-4.ph3      photon-updates     74.62k 76416</span><br><span class="line">e2fsprogs           x86_64  1.44.3-4.ph3      photon-updates      1.88M 1972142</span><br><span class="line">docker              x86_64  18.09.9-1.ph3     photon-updates        0.00b 0</span><br><span class="line">dhcp-libs           x86_64  4.3.5-7.ph3       photon-updates    264.25k 270588</span><br><span class="line">dhcp-client         x86_64  4.3.5-7.ph3       photon-updates      2.52M 2642853</span><br><span class="line"></span><br><span class="line">Total installed size:  56.05M 58776868</span><br><span class="line">Is this ok [y/N]:y</span><br><span class="line"></span><br><span class="line">Downloading:</span><br><span class="line">docker-engine                           302192      1%</span><br><span class="line"></span><br><span class="line">docker-engine                           515184      2%</span><br><span class="line">docker-engine                           523376      2%</span><br><span class="line">docker-engine                          4234352     15%</span><br><span class="line">docker-engine                         23477360     84%</span><br><span class="line"></span><br><span class="line">docker-engine                         23477360     84%</span><br></pre></td></tr></table></figure>
<ul>
<li>56.05M / 58776868B 大小的文件，下载了一上午都没搞完……气的我想掀桌子、砸键盘、摔鼠标😑</li>
</ul>
<p>不过可以根据官方的编译文档，把整个软件包源编译出来 ，放在本地使用，然后添加本的 yum 源码即可。</p>
<h3 id="docker-容器引擎"><a href="#docker-容器引擎" class="headerlink" title="docker 容器引擎"></a>docker 容器引擎</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">root@photon-machine [ ~ ]# docker info</span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 18.06.2-ce</span><br><span class="line">Storage Driver: overlay2</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Supports d_type: true</span><br><span class="line"> Native Overlay Diff: true</span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins:</span><br><span class="line"> Volume: local</span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line"> Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: docker-init</span><br><span class="line">containerd version: 468a545b9edcd5932818eb9de8e72413e616e86e</span><br><span class="line">runc version: a592beb5bc4c4092b1b1bac971afed27687340c5 (expected: 69663f0bd4b60df09991c08812a60108003fa340)</span><br><span class="line">init version: fec3683</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.19.79-1.ph3-esx</span><br><span class="line">Operating System: VMware Photon OS/Linux</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 1.951GiB</span><br><span class="line">Name: photon-machine</span><br><span class="line">ID: N53E:2APV:XYZX:QFPE:GGZU:7567:XBFB:M4VQ:F5HZ:XPRK:W33H:QYMI</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): false</span><br><span class="line">Debug Mode (server): false</span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Labels:</span><br><span class="line">Experimental: false</span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: false</span><br></pre></td></tr></table></figure>
<h3 id="使用体验"><a href="#使用体验" class="headerlink" title="使用体验"></a>使用体验</h3><p>总体来讲，除了安装软件速度极慢之外，使用起来和普通的 Linux 发行版无多大差别，系统资源占用比传统的 Linux 发行版要低的多。即便是运行了 docker 进程后系统内存也仅仅占用 100 Mb 左右，而磁盘占用才 500MB 算是比较轻量化的。至于性能方面，目前我还是找不到可以测试对比的方案。</p>
<p>较传统的 Linux 发行版，精简了大量不必要的服务和软件，甚至连 tar 命令都没有……。如果把它当作 kubenetes 工作负载 Node 节点来使用，需要注意的是，kube-proxy 依赖的一些工具并没有安装上。我使用 kubeadm 将该节点加入到集群当中的时候就提示缺少以下几个工具： <code>ipset socat ethtool ebtables</code> ，这些对于 IPVS 都是需要的。最好使用 tdnf 一并安装上，并且开启相应的 IPVS 内核模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tdnf install ipset socat ethtool ebtables tar -y</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack</span><br></pre></td></tr></table></figure>
<p>虽然经过了 3 个版本的更新迭代，但 Photon OS 用于生产环境还需要进行稳定性测试，它不如 CoreOS 那样已经在大规模集群中得到的实践，目前用 Photon OS 的企业我目前还未见到过。而 CoreOS</p>
<blockquote>
<p>“作为 Linux 以及开源软件的支持者，我们相信与 CoreOS  这样的开源社区创新先锋合作是非常重要的。我们希望通过这样的合作来为云平台用户带来更多、更灵活的选择。” 微软 Azure 的首席技术官 Mark Russinovich 提到， “CoreOS Linux  与高性能、大规模的微软云相结合，无疑将会促进各种应用服务的创新、以及全球团队的协作。”</p>
</blockquote>
<blockquote>
<p>“我们已经在上千台物理机上成功部署并运行了 CoreOS  Linux。无论从操作系统的安装、升级，还是从容器的管理和应用部署上，她给我们带来了前所未有的体验！对于光音网络这种飞速发展的互联网公司来说，CoreOS 为我们平台的建设提供了有力的技术保障！在使用 CoreOS 的这两年中，我们不再去担心操作系统、Docker 以及 Kubernetes  的兼容性、版本升级以及稳定性，这使得我们可以更专注于应用、业务层上的管理和研发。”  光音网络技术负责人王鹏说，“我们的平台不仅可以跑在自己的物理机上，而且还可以轻松地部署到 AWS 及阿里云上，CoreOS  在这方面功不可没。我们现在很高兴地得知 CoreOS 将强势登陆中国市场，我们对于更好的技术支持和服务无比期待！”</p>
<p>此处引用 CoreOS <a href="https://coreos.com/blog/coreos-linux-available-in-china.html" target="_blank" rel="noopener">官网博客</a></p>
</blockquote>
<p>CoreOS 的稳定性以及生产实践已经相当成熟了，那么接下来就介绍 CoreOS 的使用体验。</p>
<h2 id="CoreOS-Container-Linux-1"><a href="#CoreOS-Container-Linux-1" class="headerlink" title="CoreOS Container Linux"></a>CoreOS Container Linux</h2><p>CoreOS 使用用来创建一套大规模的集群环境，单独使用的意义并不大。而且对于我司的 VMware vSphere 并没有进行优化。所以就按照裸金属部署的方式来安装体验。</p>
<h3 id="官方文档-1"><a href="#官方文档-1" class="headerlink" title="官方文档"></a><a href="http://coreos.com/os/docs/latest/" target="_blank" rel="noopener">官方文档</a></h3><h4 id="Cloud-Providers"><a href="#Cloud-Providers" class="headerlink" title="Cloud Providers"></a>Cloud Providers</h4><p>适用于公有云</p>
<ul>
<li><a href="http://coreos.com/os/docs/latest/booting-on-ec2.html" target="_blank" rel="noopener">Amazon EC2</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-digitalocean.html" target="_blank" rel="noopener">DigitalOcean</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-google-compute-engine.html" target="_blank" rel="noopener">Google Compute Engine</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-azure.html" target="_blank" rel="noopener">Microsoft Azure</a><a href="http://coreos.com/os/docs/latest/booting-with-qemu.html" target="_blank" rel="noopener">QEMU</a></li>
</ul>
<h4 id="Bare-Metal"><a href="#Bare-Metal" class="headerlink" title="Bare Metal"></a>Bare Metal</h4><p>适用于物理机</p>
<ul>
<li><a href="http://coreos.com/matchbox/" target="_blank" rel="noopener">Using Matchbox</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-with-ipxe.html" target="_blank" rel="noopener">Booting with iPXE</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-with-pxe.html" target="_blank" rel="noopener">Booting with PXE</a></li>
<li><a href="http://coreos.com/os/docs/latest/installing-to-disk.html" target="_blank" rel="noopener">Installing to Disk</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-with-iso.html" target="_blank" rel="noopener">Booting from ISO</a></li>
<li><a href="http://coreos.com/os/docs/latest/root-filesystem-placement.html" target="_blank" rel="noopener">Root filesystem placement</a></li>
</ul>
<h4 id="Community-Platforms"><a href="#Community-Platforms" class="headerlink" title="Community Platforms"></a>Community Platforms</h4><p>社区提供支持的</p>
<p>These <a href="http://coreos.com/os/docs/latest/community-platforms.html" target="_blank" rel="noopener">platforms and providers</a> offer support and documentation for running Container Linux.</p>
<ul>
<li><a href="http://coreos.com/os/docs/latest/booting-on-cloudstack.html" target="_blank" rel="noopener">CloudStack</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-eucalyptus.html" target="_blank" rel="noopener">Eucalyptus</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-with-libvirt.html" target="_blank" rel="noopener">libvirt</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-openstack.html" target="_blank" rel="noopener">OpenStack</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-vagrant.html" target="_blank" rel="noopener">Vagrant</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-virtualbox.html" target="_blank" rel="noopener">VirtualBox</a></li>
<li><a href="http://coreos.com/os/docs/latest/booting-on-vmware.html" target="_blank" rel="noopener">VMware</a></li>
</ul>
<h3 id="安装镜像-OVA"><a href="#安装镜像-OVA" class="headerlink" title="安装镜像 OVA"></a>安装镜像 <a href="https://stable.release.core-os.net/amd64-usr/current/coreos_production_vmware_ova.ova" target="_blank" rel="noopener">OVA</a></h3><p>下载下来 OVA 虚拟机模板 <a href="https://stable.release.core-os.net/amd64-usr/current/coreos_production_vmware_ova.ova" target="_blank" rel="noopener">OVA</a></p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>和 Photon OS 安装步骤一样，在 ESXi 上导入 OVA 虚拟机模板即可，不过需要在最后一步配置好 OS ，包括主机名、配置文件数配置文件 url、加密的配置文件等等，根据自身需求配好即可。可以参照官方<a href="https://coreos.com/os/docs/latest/clc-examples.html" target="_blank" rel="noopener">配置文件的文档</a> 。这一步是必须要做的，不然没有 ssh 公钥和密码你是无法登录到系统中的。</p>
<p>注意，官方给了两种配置文件合适，一个是 yaml 一个是 json ，不过在这里要使用</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"ignition"</span>: &#123;</span><br><span class="line">    <span class="attr">"config"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"timeouts"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"2.1.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"networkd"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"passwd"</span>: &#123;</span><br><span class="line">    <span class="attr">"users"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"core"</span>,</span><br><span class="line">        <span class="attr">"passwordHash"</span>: <span class="string">"$6$43y3tkl..."</span>,</span><br><span class="line">        <span class="attr">"sshAuthorizedKeys"</span>: [</span><br><span class="line">          <span class="string">"key1"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"storage"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"systemd"</span>: &#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>password_hash</code> 可以通过 openssl 命令来生成，把生成的一整串内容填写到上面，包括后面那个点<code>.</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">╭─@debian ~</span><br><span class="line">╰─$ openssl passwd -1</span><br><span class="line">Password:</span><br><span class="line">Verifying - Password:</span><br><span class="line"><span class="variable">$1</span><span class="variable">$nCzW8953</span><span class="variable">$un</span>/JUMJDE2588l7Y6KkP.</span><br></pre></td></tr></table></figure>
<ul>
<li><code>ssh_authorized_keys</code> 通过 ssh-keygen 生成，生成的公钥填写在上面。</li>
</ul>
<p>配置完成之后就把整个内容复制粘贴到第二个框框 <code>CoreOS config data</code> 里</p>
<h4 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h4><p><img src="https://p.k8s.li/20191231125441199.png" alt=""></p>
<h3 id="系统启动-1"><a href="#系统启动-1" class="headerlink" title="系统启动"></a>系统启动</h3><p>可能是 coreos config 配置文件没有配好，而导致启动后输入设置的密码提示错误😥，僵硬，只能通过修改 grub 启动参数来跳过了。</p>
<ul>
<li>1.打开 CoreOS 虚拟机电源，并打开控制台。</li>
<li>2.当 Boot Loader 提示出现的时候，按下 e 键来编辑 GRUB 菜单。选择第一个 coreos default 编辑。</li>
<li>3.添加 <code>coreos.autologin</code> 作为启动参数，并 Ctrl-x 或 F10 重启。这将使控制台跳过登录提示并直接进入用户 core 的 shell。</li>
<li><img src="https://p.k8s.li/20191231133509428.png" alt=""></li>
<li>启动进入系统之后输入 <code>sudo passwd</code> 来修改 root 密码。然后切换到 root 用户下 <code>passwd core</code> 修改 core 这个用户的密码。修改之后就可以通过 ssh 登录啦😂，比 Photon OS 要折腾一番呀。不过啊，使用 OVA 部署最好结合 could-init 来设置虚拟机的 ssh 密钥，网络，主机名等参数。</li>
</ul>
<h3 id="资源占用情况-1"><a href="#资源占用情况-1" class="headerlink" title="资源占用情况"></a>资源占用情况</h3><h5 id="内存-1"><a href="#内存-1" class="headerlink" title="内存"></a>内存</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">core@localhost ~ $ free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:          961Mi       177Mi       398Mi       199Mi       385Mi       445Mi</span><br><span class="line">Swap:            0B          0B          0B</span><br></pre></td></tr></table></figure>
<h4 id="磁盘-1"><a href="#磁盘-1" class="headerlink" title="磁盘"></a>磁盘</h4><p>CoreOS 的磁盘分区和 Photon OS 略有不同</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">core@localhost ~ $ df -h</span><br><span class="line">Filesystem       Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs         460M     0  460M   0% /dev</span><br><span class="line">tmpfs            481M     0  481M   0% /dev/shm</span><br><span class="line">tmpfs            481M  484K  481M   1% /run</span><br><span class="line">tmpfs            481M     0  481M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda9        6.0G   60M  5.6G   2% /</span><br><span class="line">/dev/mapper/usr  985M  854M   80M  92% /usr</span><br><span class="line">none             481M  200M  282M  42% /run/torcx/unpack</span><br><span class="line">tmpfs            481M     0  481M   0% /media</span><br><span class="line">tmpfs            481M     0  481M   0% /tmp</span><br><span class="line">/dev/sda6        108M  7.9M   92M   8% /usr/share/oem</span><br><span class="line">/dev/sda1        127M   54M   73M  43% /boot</span><br><span class="line">tmpfs             97M     0   97M   0% /run/user/500</span><br></pre></td></tr></table></figure>
<h3 id="内核以及发行版信息"><a href="#内核以及发行版信息" class="headerlink" title="内核以及发行版信息"></a>内核以及发行版信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Linux localhost 4.19.86-coreos <span class="comment">#1 SMP Mon Dec 2 20:13:38 -00 2019 x86_64 Intel(R) Core(TM) i5-4590 CPU @ 3.30GHz GenuineIntel GNU/Linux</span></span><br><span class="line"></span><br><span class="line">core@localhost ~ $ cat /etc/os-release</span><br><span class="line">NAME=<span class="string">"Container Linux by CoreOS"</span></span><br><span class="line">ID=coreos</span><br><span class="line">VERSION=2303.3.0</span><br><span class="line">VERSION_ID=2303.3.0</span><br><span class="line">BUILD_ID=2019-12-02-2049</span><br><span class="line">PRETTY_NAME=<span class="string">"Container Linux by CoreOS 2303.3.0 (Rhyolite)"</span></span><br><span class="line">ANSI_COLOR=<span class="string">"38;5;75"</span></span><br><span class="line">HOME_URL=<span class="string">"https://coreos.com/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://issues.coreos.com"</span></span><br><span class="line">COREOS_BOARD=<span class="string">"amd64-usr"</span></span><br></pre></td></tr></table></figure>
<h3 id="docker-容器引擎-1"><a href="#docker-容器引擎-1" class="headerlink" title="docker 容器引擎"></a>docker 容器引擎</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">core@localhost ~ $ docker info</span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 18.06.3-ce</span><br><span class="line">Storage Driver: overlay2</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Supports d_type: true</span><br><span class="line"> Native Overlay Diff: true</span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins:</span><br><span class="line"> Volume: local</span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line"> Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: docker-init</span><br><span class="line">containerd version: 468a545b9edcd5932818eb9de8e72413e616e86e</span><br><span class="line">runc version: a592beb5bc4c4092b1b1bac971afed27687340c5</span><br><span class="line">init version: fec3683b971d9c3ef73f284f176672c44b448662</span><br><span class="line">Security Options:</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line"> selinux</span><br><span class="line">Kernel Version: 4.19.86-coreos</span><br><span class="line">Operating System: Container Linux by CoreOS 2303.3.0 (Rhyolite)</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 2</span><br><span class="line">Total Memory: 961.7MiB</span><br><span class="line">Name: localhost</span><br><span class="line">ID: VUKA:LDLW:WECP:IZKO:A6ED:IKIN:6C3V:VRIL:S4ND:SCII:66EH:GDYP</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): false</span><br><span class="line">Debug Mode (server): false</span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Labels:</span><br><span class="line">Experimental: false</span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: false</span><br></pre></td></tr></table></figure>
<h3 id="负载-1"><a href="#负载-1" class="headerlink" title="负载"></a>负载</h3><p><img src="https://p.k8s.li/20191231135348120.png" alt=""></p>
<h3 id="进程和服务-1"><a href="#进程和服务-1" class="headerlink" title="进程和服务"></a>进程和服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">● localhost</span><br><span class="line">    State: running</span><br><span class="line">     Jobs: 0 queued</span><br><span class="line">   Failed: 0 units</span><br><span class="line">    Since: Tue 2019-12-31 13:38:05 UTC; 7h left</span><br><span class="line">   CGroup: /</span><br><span class="line">           ├─user.slice</span><br><span class="line">           │ └─user-500.slice</span><br><span class="line">           │   ├─user@500.service</span><br><span class="line">           │   │ └─init.scope</span><br><span class="line">           │   │   ├─725 /usr/lib/systemd/systemd --user</span><br><span class="line">           │   │   └─726 (sd-pam)</span><br><span class="line">           │   ├─session-2.scope</span><br><span class="line">           │   │ ├─768 sshd: core [priv]</span><br><span class="line">           │   │ ├─781 sshd: core@pts/0</span><br><span class="line">           │   │ ├─782 -bash</span><br><span class="line">           │   │ └─978 systemctl status</span><br><span class="line">           │   └─session-1.scope</span><br><span class="line">           │     ├─713 /bin/login -f</span><br><span class="line">           │     ├─731 -bash</span><br><span class="line">           │     ├─762 su</span><br><span class="line">           │     ├─763 bash</span><br><span class="line">           │     ├─770 su core</span><br><span class="line">           │     ├─771 bash</span><br><span class="line">           │     ├─775 su</span><br><span class="line">           │     └─776 bash</span><br><span class="line">           ├─init.scope</span><br><span class="line">           │ └─1 /usr/lib/systemd/systemd --switched-root --system --deserialize 16</span><br><span class="line">           └─system.slice</span><br><span class="line">             ├─locksmithd.service</span><br><span class="line">             │ └─718 /usr/lib/locksmith/locksmithd</span><br><span class="line">             ├─containerd.service</span><br><span class="line">             │ └─800 /run/torcx/bin/containerd --config /run/torcx/unpack/docker/usr/share/containerd/config.toml</span><br><span class="line">             ├─systemd-networkd.service</span><br><span class="line">             │ └─584 /usr/lib/systemd/systemd-networkd</span><br><span class="line">             ├─systemd-udevd.service</span><br><span class="line">             │ └─583 /usr/lib/systemd/systemd-udevd</span><br><span class="line">             ├─docker.service</span><br><span class="line">             │ └─802 /run/torcx/bin/dockerd --host=fd:// --containerd=/var/run/docker/libcontainerd/docker-containerd.sock --selinux-enabled=<span class="literal">true</span></span><br><span class="line">             ├─update-engine.service</span><br><span class="line">             │ └─663 /usr/sbin/update_engine -foreground -logtostderr</span><br><span class="line">             ├─systemd-journald.service</span><br><span class="line">             │ └─553 /usr/lib/systemd/systemd-journald</span><br><span class="line">             ├─systemd-resolved.service</span><br><span class="line">             │ └─635 /usr/lib/systemd/systemd-resolved</span><br><span class="line">             ├─dbus.service</span><br><span class="line">             │ └─674 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation</span><br><span class="line">             ├─systemd-timesyncd.service</span><br><span class="line">             │ └─634 /usr/lib/systemd/systemd-timesyncd</span><br><span class="line">             └─systemd-logind.service</span><br><span class="line">               └─672 /usr/lib/systemd/systemd-logind</span><br></pre></td></tr></table></figure>
<h3 id="包管理工具-1"><a href="#包管理工具-1" class="headerlink" title="包管理工具"></a>包管理工具</h3><p><strong>没得😂</strong>，你没看错，确实如此，在 CoreOS 上没有你可以用的包管理器，不像 PhotonOS 那样有个 tdnf/yum 让你爽一把😂。在 CoreOS 一切皆容器。可以看一下 <code>stackexchange.com</code> 这个答案😂：</p>
<blockquote>
<p>To do this on a CoreOS box, following the hints from the <a href="https://coreos.com/os/docs/latest/install-debugging-tools.html" target="_blank" rel="noopener">guide here</a>:</p>
<ol>
<li>Boot up the CoreOS box and connect as the <code>core</code> user</li>
<li>Run the <code>/bin/toolbox</code> command to enter the stock Fedora container.</li>
<li>Install any software you need. To install nano in this case, it would be as simple as doing a <code>dnf -y install nano</code> (dnf has replaced yum)</li>
<li>Use nano to edit files. “But wait – I’m in a container!” Don’t worry – the host’s file system is mounted at <code>/media/root</code> when inside the container. So just save a sample text file at <code>/media/root/home/core/test.txt</code>, then <code>exit</code> the container, and finally go list the files in <code>/home/core</code>. Notice your test.txt file?</li>
</ol>
<p>If any part of this is too cryptic or confusing, please ask follow up questions. :-)</p>
</blockquote>
<p>官方推荐使用 <a href="https://github.com/coreos" target="_blank" rel="noopener">coreos</a>/<strong><a href="https://github.com/coreos/toolbox" target="_blank" rel="noopener">toolbox</a></strong> 来安装所需要的软件，这个工具以后再详细讲解一下吧。</p>
<h3 id="使用体验-1"><a href="#使用体验-1" class="headerlink" title="使用体验"></a>使用体验</h3><p>安装过程要出于安全考虑比 Photon OS 多于个步骤来登录到系统，目前我还没有找到启动的时候添加 ssh 密钥的办法。总的来讲，再 CoreOS 里一切皆容器运行所需要的服务，这种里面要先进的多。下面的 RancherOS 更是将一切皆容器贯彻到底，甚至将 systemd 取代掉，使用 docker 来管理系统服务。</p>
<h2 id="RancherOS-1"><a href="#RancherOS-1" class="headerlink" title="RancherOS"></a>RancherOS</h2><p>目前 RancherOS 的版本是 v1.5.5</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Linux 4.14.138</span><br><span class="line">Buildroot: 2018.02.11</span><br><span class="line">Docker docker-19.03.5 by default</span><br><span class="line">RPi64: Linux 4.14.114</span><br><span class="line">Console:</span><br><span class="line">Alpine: 3.10</span><br><span class="line">CentOS: 7.7.1908</span><br><span class="line">Debian: stretch</span><br><span class="line">Fedora: 31</span><br><span class="line">Ubuntu: bionic</span><br></pre></td></tr></table></figure>
<h3 id="官方文档-2"><a href="#官方文档-2" class="headerlink" title="官方文档"></a><a href="https://rancher.com/docs/os/v1.x/en/" target="_blank" rel="noopener">官方文档</a></h3><p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/" target="_blank" rel="noopener">安装文档</a></p>
<h4 id="Cloud-云平台"><a href="#Cloud-云平台" class="headerlink" title="Cloud 云平台"></a>Cloud 云平台</h4><p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/aws" target="_blank" rel="noopener">Amazon EC2</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/gce" target="_blank" rel="noopener">Google Compute Engine</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/do" target="_blank" rel="noopener">DigitalOcean</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/azure" target="_blank" rel="noopener">Azure</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/openstack" target="_blank" rel="noopener">OpenStack</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/vmware-esxi" target="_blank" rel="noopener">VMware ESXi</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/cloud/aliyun" target="_blank" rel="noopener">Aliyun</a></p>
<h4 id="Bare-Metal-amp-Virtual-Servers-裸金属"><a href="#Bare-Metal-amp-Virtual-Servers-裸金属" class="headerlink" title="Bare Metal &amp; Virtual Servers 裸金属"></a>Bare Metal &amp; Virtual Servers 裸金属</h4><p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/server/pxe" target="_blank" rel="noopener">PXE</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/server/install-to-disk" target="_blank" rel="noopener">Install to Hard Disk</a></p>
<p><a href="https://rancher.com/docs/os/v1.x/en/installation/running-rancheros/server/raspberry-pi" target="_blank" rel="noopener">Raspberry Pi</a></p>
<h3 id="安装镜像-1"><a href="#安装镜像-1" class="headerlink" title="安装镜像"></a><a href="https://github.com/rancher/os/releases/" target="_blank" rel="noopener">安装镜像</a></h3><p>RancherOS 将各个平台的安装镜像都放在了 GitHub <a href="https://github.com/rancher/os/releases/" target="_blank" rel="noopener">release</a> 页面上。对于 VMware 用户就使用 <a href="https://github.com/rancher/os/releases/download/v1.5.5/rancheros-vmware.iso" target="_blank" rel="noopener">rancheros-vmware.iso</a> 这个镜像即可。没得 OVA 虚拟机模板只能手动搓一个啦。下载完成之后将这个镜像上传到 vSphere 的数据存储中，按照创建常规虚拟机的方式来创建虚拟机。</p>
<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><p><img src="https://p.k8s.li/20191231142454934.png" alt=""></p>
<p>使用 ISO 启动之后进入得是一个 liveCD 型得系统，并没有安装虚拟机得磁盘当中，我们需要将 RancherOS 安装到磁盘上。提前准备好 cloud-init 的配置文件，只需要执行 <code>ros install -c cloud-config.yml -d /dev/sda</code> 命令就行啦。-d 参数后面跟着安装到的磁盘。</p>
<p>不过需要像 CoreOS 那样准备给一个 <code>cloud-config.yml</code> 配置文件，将我们得 ssh 公钥和用户密码填写到里面，不过 <code>cloud-config</code> 能配置得选项非常多，在此就不赘述了，等抽空专门写一篇博客来讲讲 cloud-init 的使用。（又挖坑😂，不知何时能填上🙃</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># ros install -c cloud-config.yml -d /dev/sda</span></span><br><span class="line">INFO[0000] No install <span class="built_in">type</span> specified...defaulting to generic</span><br><span class="line">Installing from rancher/os:v1.5.5</span><br><span class="line">Continue [y/N]: y</span><br><span class="line">INFO[0002] start !isoinstallerloaded</span><br><span class="line">INFO[0002] trying to load /bootiso/rancheros/installer.tar.gz</span><br><span class="line">69b8396f5d61: Loading layer [==================================================&gt;]  11.89MB/11.89MB</span><br><span class="line">cae31a9aae74: Loading layer [==================================================&gt;]  1.645MB/1.645MB</span><br><span class="line">78885fd6d98c: Loading layer [==================================================&gt;]  1.536kB/1.536kB</span><br><span class="line">51228f31b9ce: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">d8162179e708: Loading layer [==================================================&gt;]   2.56kB/2.56kB</span><br><span class="line">3ee208751cd2: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">Loaded image: rancher/os-installer:latest</span><br><span class="line">INFO[0002] Loaded images from /bootiso/rancheros/installer.tar.gz</span><br><span class="line">INFO[0002] starting installer container <span class="keyword">for</span> rancher/os-installer:latest (new)</span><br><span class="line">Installing from rancher/os-installer:latest</span><br><span class="line">mke2fs 1.45.2 (27-May-2019)</span><br><span class="line">64-bit filesystem support is not enabled.  The larger fields afforded by this feature <span class="built_in">enable</span> full-strength checksumming.  Pass -O 64bit to rectify.</span><br><span class="line">Creating filesystem with 7863808 4k blocks and 7864320 inodes</span><br><span class="line">Filesystem UUID: fe29cb27-b4ac-4c75-a12d-895ea7e52af9</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</span><br><span class="line">        4096000</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span></span><br><span class="line">Writing inode tables: <span class="keyword">done</span></span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">Continue with reboot [y/N]:y</span><br><span class="line">INFO[0288] Rebooting</span><br><span class="line">INFO[0288] Setting reboot timeout to 60 (rancher.shutdown_timeout <span class="built_in">set</span> to 60)</span><br><span class="line">....^[            ] reboot:info: Setting reboot timeout to 60 (rancher.shutdown_timeout <span class="built_in">set</span> to 60)</span><br><span class="line">.=.[            ] reboot:info: Stopping /docker : 3d39a73e4089</span><br><span class="line">...........M..........[            ] reboot:info: Stopping /open-vm-tools : ccd97f8a7775</span><br><span class="line">:.[            ] reboot:info: Stopping /ntp : acf47c78a711</span><br><span class="line">.&gt;.[            ] reboot:info: Stopping /network : 08be8ef68e27</span><br><span class="line">..&lt;..[            ] reboot:info: Stopping /udev : 4986cd58a227</span><br><span class="line">.=.[            ] reboot:info: Stopping /syslog : 254137c5e66a</span><br><span class="line">.&lt;.[            ] reboot:info: Stopping /acpid : a2ededff859c</span><br><span class="line">..C..[            ] reboot:info: Stopping /system-cron : 899028a78e3a</span><br><span class="line">..H.[            ] reboot:info: Console Stopping [/console] : 6fc9ef66b43c</span><br><span class="line">Connection to 10.20.172.119 closed by remote host.</span><br><span class="line">Connection to 10.20.172.119 closed.</span><br></pre></td></tr></table></figure>
<h3 id="内核以及发行版信息-1"><a href="#内核以及发行版信息-1" class="headerlink" title="内核以及发行版信息"></a>内核以及发行版信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># uname -a</span></span><br><span class="line">Linux rancher 4.14.138-rancher <span class="comment">#1 SMP Sat Aug 10 11:25:46 UTC 2019 x86_64 GNU/Linux</span></span><br><span class="line">[root@rancher rancher]<span class="comment"># cat /etc/os-release</span></span><br><span class="line">NAME=<span class="string">"RancherOS"</span></span><br><span class="line">VERSION=v1.5.5</span><br><span class="line">ID=rancheros</span><br><span class="line">ID_LIKE=</span><br><span class="line">VERSION_ID=v1.5.5</span><br><span class="line">PRETTY_NAME=<span class="string">"RancherOS v1.5.5"</span></span><br><span class="line">HOME_URL=<span class="string">"http://rancher.com/rancher-os/"</span></span><br><span class="line">SUPPORT_URL=<span class="string">"https://forums.rancher.com/c/rancher-os"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://github.com/rancher/os/issues"</span></span><br><span class="line">BUILD_ID=</span><br></pre></td></tr></table></figure>
<h3 id="docker-容器引擎-2"><a href="#docker-容器引擎-2" class="headerlink" title="docker 容器引擎"></a>docker 容器引擎</h3><p>在 RancherOS 中有两套 docker ，一套是用来容器化运行系统服务的，包括用户空间的 docker ，而另一套 docker 就是用户空间的 docker</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@rancher rancher]</span><span class="comment"># docker info</span></span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.5</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: tmpfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc version: 3e425f80a8c931f88e6d94a8c831b9d5aa481657</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.14.138-rancher</span><br><span class="line"> Operating System: RancherOS v1.5.5</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 4</span><br><span class="line"> Total Memory: 3.855GiB</span><br><span class="line"> Name: rancher</span><br><span class="line"> ID: 2256:3I2G:WFHC:ZRTL:CKG6:GXD6:3RDL:645J:CD4J:GKJ7:55SG:U32I</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"> Product License: Community Engine</span><br></pre></td></tr></table></figure>
<h3 id="rancher-引擎"><a href="#rancher-引擎" class="headerlink" title="rancher 引擎"></a>rancher 引擎</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># du -sh /var/lib/rancher/engine/*</span></span><br><span class="line">116.0K  /var/lib/rancher/engine/completion</span><br><span class="line">33.0M   /var/lib/rancher/engine/containerd</span><br><span class="line">5.8M    /var/lib/rancher/engine/containerd-shim</span><br><span class="line">18.0M   /var/lib/rancher/engine/ctr</span><br><span class="line">62.6M   /var/lib/rancher/engine/docker</span><br><span class="line">748.0K  /var/lib/rancher/engine/docker-init</span><br><span class="line">2.7M    /var/lib/rancher/engine/docker-proxy</span><br><span class="line">68.8M   /var/lib/rancher/engine/dockerd</span><br><span class="line">8.3M    /var/lib/rancher/engine/runc</span><br></pre></td></tr></table></figure>
<h3 id="资源占用"><a href="#资源占用" class="headerlink" title="资源占用"></a>资源占用</h3><h4 id="负载-2"><a href="#负载-2" class="headerlink" title="负载"></a>负载</h4><ul>
<li>可以看出 RancherOS 运行着大量的 <code>system-docker-containerd-shim</code> 这是因为它将系服务也都容器化来运行，但奇怪的是无法使用 docker 命令来管理这些服务。</li>
</ul>
<p><img src="https://p.k8s.li/20191231143958024.png" alt=""></p>
<h4 id="内存-2"><a href="#内存-2" class="headerlink" title="内存"></a>内存</h4><ul>
<li>初始化启动后内存使用了 1224MB😂，要比 CoreOS 和 Photon OS 加起来还多😂</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[rancher@rancher ~]$ free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          3947       1224       2722        993          0        993</span><br><span class="line">-/+ buffers/cache:        231       3715</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure>
<h4 id="磁盘-2"><a href="#磁盘-2" class="headerlink" title="磁盘"></a>磁盘</h4><p>由于系统服务是以容器的方式来运行的，而容器内的进程要访问系统文件系统的话就要将这些文件挂载到容器里去，所以会出现这么多的分区情况，不过绝大多数都是容器挂载的数据卷。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># df -h</span></span><br><span class="line">Filesystem                Size      Used Available Use% Mounted on</span><br><span class="line">overlay                  28.0G      1.0G     25.5G   4% /</span><br><span class="line">tmpfs                     1.9G         0      1.9G   0% /dev</span><br><span class="line">tmpfs                     1.9G         0      1.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /media</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /opt</span><br><span class="line">none                      1.9G    944.0K      1.9G   0% /run</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /mnt</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /home</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/resolv.conf</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/logrotate.d</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/lib/firmware</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/sbin/iptables</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/docker</span><br><span class="line">none                      1.9G    944.0K      1.9G   0% /var/run</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/<span class="built_in">log</span></span><br><span class="line">devtmpfs                  1.9G         0      1.9G   0% /host/dev</span><br><span class="line">shm                      64.0M         0     64.0M   0% /host/dev/shm</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/selinux</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/hosts</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/lib/modules</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/hostname</span><br><span class="line">shm                      64.0M         0     64.0M   0% /dev/shm</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/bin/system-docker</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/boot2docker</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/share/ros</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/m-user-docker</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/waagent</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/docker</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/kubelet</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/rancher</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/bin/ros</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /usr/bin/system-docker-runc</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /etc/ssl/certs/ca-certificates.crt.rancher</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/rancher/cache</span><br><span class="line">/dev/sda1                28.0G      1.0G     25.5G   4% /var/lib/rancher/conf</span><br><span class="line">devtmpfs                  1.9G         0      1.9G   0% /dev</span><br><span class="line">shm                      64.0M         0     64.0M   0% /dev/shm</span><br></pre></td></tr></table></figure>
<h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># mount</span></span><br><span class="line">overlay on / <span class="built_in">type</span> overlay (rw,relatime,lowerdir=/var/lib/system-docker/overlay2/l/TBWLXSEPWSCBGMNSU37HJXNRO3:/var/lib/system-docker/overlay2/l/DWK2WF5FKFYZTH74WUBGHTRF4V:/var/lib/system-docker/overlay2/l/HDUW6LV2DFEIJPW3IA33YTCNWX:/var/lib/system-docker/overlay2/l/ZDK3KMGDSN5O33AR6XJJF27NFO:/var/lib/system-docker/overlay2/l/TSWFV744M2LUOSPV2N6QHON4NP:/var/lib/system-docker/overlay2/l/QZ3U27554L5LKMJDYP3DC356L7:/var/lib/system-docker/overlay2/l/D6LSXZS2UGAZ7NMKQJKMQVT24P:/var/lib/system-docker/overlay2/l/KHB3OKMEQIL2P34QMHYF3HWTLT,upperdir=/var/lib/system-docker/overlay2/fc79b6b6cf5c6d0b34b5abb95a1a19d765c1a00d66d0cff1ef3778d109471522/diff,workdir=/var/lib/system-docker/overlay2/fc79b6b6cf5c6d0b34b5abb95a1a19d765c1a00d66d0cff1ef3778d109471522/work)</span><br><span class="line">proc on /proc <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">tmpfs on /dev <span class="built_in">type</span> tmpfs (rw,nosuid,mode=755)</span><br><span class="line">devpts on /dev/pts <span class="built_in">type</span> devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=666)</span><br><span class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">tmpfs on /sys/fs/cgroup <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,noexec,relatime,mode=755)</span><br><span class="line">none on /sys/fs/cgroup/freezer <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,freezer)</span><br><span class="line">none on /sys/fs/cgroup/devices <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,devices)</span><br><span class="line">none on /sys/fs/cgroup/net_cls,net_prio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio)</span><br><span class="line">none on /sys/fs/cgroup/perf_event <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)</span><br><span class="line">none on /sys/fs/cgroup/hugetlb <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)</span><br><span class="line">none on /sys/fs/cgroup/cpuset <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)</span><br><span class="line">none on /sys/fs/cgroup/cpu,cpuacct <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct)</span><br><span class="line">none on /sys/fs/cgroup/blkio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,blkio)</span><br><span class="line">none on /sys/fs/cgroup/memory <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,memory)</span><br><span class="line">none on /sys/fs/cgroup/pids <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,pids)</span><br><span class="line">mqueue on /dev/mqueue <span class="built_in">type</span> mqueue (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">/dev/sda1 on /media <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /opt <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">none on /run <span class="built_in">type</span> tmpfs (rw,relatime)</span><br><span class="line">nsfs on /run/docker/netns/default <span class="built_in">type</span> nsfs (rw)</span><br><span class="line">nsfs on /run/system-docker/netns/default <span class="built_in">type</span> nsfs (rw)</span><br><span class="line">nsfs on /run/system-docker/netns/d15f3e062bb6 <span class="built_in">type</span> nsfs (rw)</span><br><span class="line">/dev/sda1 on /mnt <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /home <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /etc/resolv.conf <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /etc/logrotate.d <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /usr/lib/firmware <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /usr/sbin/iptables <span class="built_in">type</span> ext4 (ro,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /etc/docker <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">none on /var/run <span class="built_in">type</span> tmpfs (rw,relatime)</span><br><span class="line">nsfs on /var/run/docker/netns/default <span class="built_in">type</span> nsfs (rw)</span><br><span class="line">nsfs on /var/run/system-docker/netns/default <span class="built_in">type</span> nsfs (rw)</span><br><span class="line">nsfs on /var/run/system-docker/netns/d15f3e062bb6 <span class="built_in">type</span> nsfs (rw)</span><br><span class="line">/dev/sda1 on /var/<span class="built_in">log</span> <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">devtmpfs on /host/dev <span class="built_in">type</span> devtmpfs (rw,relatime,size=1949420k,nr_inodes=487355,mode=755)</span><br><span class="line">none on /host/dev/pts <span class="built_in">type</span> devpts (rw,relatime,mode=600,ptmxmode=000)</span><br><span class="line">shm on /host/dev/shm <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,noexec,relatime,size=65536k)</span><br><span class="line">mqueue on /host/dev/mqueue <span class="built_in">type</span> mqueue (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">/dev/sda1 on /etc/selinux <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /etc/hosts <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /usr/lib/modules <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /etc/hostname <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">shm on /dev/shm <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,noexec,relatime,size=65536k)</span><br><span class="line">/dev/sda1 on /usr/bin/system-docker <span class="built_in">type</span> ext4 (ro,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/boot2docker <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /usr/share/ros <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/m-user-docker <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/waagent <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/docker <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/kubelet <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/rancher <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /usr/bin/ros <span class="built_in">type</span> ext4 (ro,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /usr/bin/system-docker-runc <span class="built_in">type</span> ext4 (ro,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /etc/ssl/certs/ca-certificates.crt.rancher <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/rancher/cache <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">/dev/sda1 on /var/lib/rancher/conf <span class="built_in">type</span> ext4 (rw,relatime,data=ordered)</span><br><span class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,relatime,size=1949420k,nr_inodes=487355,mode=755)</span><br><span class="line">none on /dev/pts <span class="built_in">type</span> devpts (rw,relatime,mode=600,ptmxmode=000)</span><br><span class="line">shm on /dev/shm <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,noexec,relatime,size=65536k)</span><br><span class="line">mqueue on /dev/mqueue <span class="built_in">type</span> mqueue (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">cgroup on /sys/fs/cgroup/systemd <span class="built_in">type</span> cgroup (rw,relatime,name=systemd)</span><br><span class="line">none on /sys/fs/selinux <span class="built_in">type</span> selinuxfs (ro,relatime)</span><br></pre></td></tr></table></figure>
<h3 id="系统服务容器化"><a href="#系统服务容器化" class="headerlink" title="系统服务容器化"></a>系统服务容器化</h3><p>通过 top 命令和 ps 命令查看系统运行的进程可以发现以下几个重要的进程</p>
<h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">1695  1620 root     S     558m  14%   0% containerd --config /var/run/docker/containerd/containerd.toml --<span class="built_in">log</span>-level info</span><br><span class="line">1988  1922 root     S    11420   0%   0% top</span><br><span class="line">   1     0 root     S    1287m  32%   0% system-dockerd --storage-driver overlay2 --graph /var/lib/system-docker --config-file /etc/docker/system-docker.json --restart=<span class="literal">false</span> --group root --userland-proxy=<span class="literal">false</span> --bip 172.18.42.1/16 --<span class="built_in">log</span>-opt max-file=2 --<span class="built_in">log</span>-opt max-size</span><br><span class="line"> 489     1 root     S     833m  21%   0% system-docker-containerd -l unix:///var/run/system-docker/libcontainerd/system-docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state-dir /var/run/system-docker/libcontainerd/containerd --shim system-docker-contai</span><br><span class="line">1370  1353 root     S     808m  20%   0% respawn -f /etc/respawn.conf</span><br><span class="line">1620  1415 root     S     658m  16%   0% dockerd --group docker --host unix:///var/run/docker.sock --<span class="built_in">log</span>-opt max-file=2 --<span class="built_in">log</span>-opt max-size=25m</span><br><span class="line">1398   489 root     S     472m  12%   0% system-docker-containerd-shim 3d39a73e4089dcbdd144277adb398d3e0d8ba62812a699be7cfeac9598539f6e /var/run/system-docker/libcontainerd/3d39a73e4089dcbdd144277adb398d3e0d8ba62812a699be7cfeac9598539f6e system-docker-runc</span><br><span class="line">1285   489 root     S     470m  12%   0% system-docker-containerd-shim 254137c5e66a7075c2104cca82fa2e6584509170688064fac1147fbfcda2f5c0 /var/run/system-docker/libcontainerd/254137c5e66a7075c2104cca82fa2e6584509170688064fac1147fbfcda2f5c0 system-docker-runc</span><br><span class="line">1588  1370 root     S     452m  11%   0% /usr/bin/autologin rancher:tty1</span><br><span class="line">1013   995 root     S     452m  11%   0% netconf</span><br><span class="line">1151   489 root     S     406m  10%   0% system-docker-containerd-shim ccd97f8a77756dcc4ae21c935dcaf35aa8f02399e9ca87811a5f4ec1d5d6d1a3 /var/run/system-docker/libcontainerd/ccd97f8a77756dcc4ae21c935dcaf35aa8f02399e9ca87811a5f4ec1d5d6d1a3 system-docker-runc</span><br><span class="line"> 995   489 root     S     398m  10%   0% system-docker-containerd-shim 08be8ef68e27d7e3b8f9d2a62914f9b581545ed96d65a751b487e7814f2bc795 /var/run/system-docker/libcontainerd/08be8ef68e27d7e3b8f9d2a62914f9b581545ed96d65a751b487e7814f2bc795 system-docker-runc</span><br><span class="line"> 784   489 root     S     335m   8%   0% system-docker-containerd-shim 899028a78e3a3baa42ad1e3042d49f23e9fe2d6cce8b824850aaca4270d681fd /var/run/system-docker/libcontainerd/899028a78e3a3baa42ad1e3042d49f23e9fe2d6cce8b824850aaca4270d681fd system-docker-runc</span><br><span class="line"> 803   489 root     S     335m   8%   0% system-docker-containerd-shim a2ededff859cc3d7c1a6342eb5d92606d4da605433d03abc92cc5f6503d53c6f /var/run/system-docker/libcontainerd/a2ededff859cc3d7c1a6342eb5d92606d4da605433d03abc92cc5f6503d53c6f system-docker-runc</span><br><span class="line">1076   489 root     S     334m   8%   0% system-docker-containerd-shim acf47c78a71194f1ef094302846855c777ef84fe613eb1ac1cc5f7ac868d618c /var/run/system-docker/libcontainerd/acf47c78a71194f1ef094302846855c777ef84fe613eb1ac1cc5f7ac868d618c system-docker-runc</span><br><span class="line"> 956   489 root     S     280m   7%   0% system-docker-containerd-shim 4986cd58a227547af8e4867da067cf9f066062536268bf025466f88b4b38d9c3 /var/run/system-docker/libcontainerd/4986cd58a227547af8e4867da067cf9f066062536268bf025466f88b4b38d9c3 system-docker-runc</span><br><span class="line">1353   489 root     S     270m   7%   0% system-docker-containerd-shim 6fc9ef66b43c9902e23cea7cfdd78b8b5842df2b981d8d7899eacb3b063294fd /var/run/system-docker/libcontainerd/6fc9ef66b43c9902e23cea7cfdd78b8b5842df2b981d8d7899eacb3b063294fd system-docker-runc</span><br><span class="line">1311  1285 root     S     238m   6%   0% rsyslogd -n</span><br><span class="line">1168  1151 root     S     146m   4%   0% /usr/bin/vmtoolsd</span><br><span class="line">1415  1398 root     S     122m   3%   0% system-docker-runc <span class="built_in">exec</span> -- 6fc9ef66b43c9902e23cea7cfdd78b8b5842df2b981d8d7899eacb3b063294fd env PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=rancher HOME=/ ros docker-init --group docker --host unix:</span><br><span class="line"> 907   784 root     S     109m   3%   0% container-crontab</span><br><span class="line">1105  1076 root     S    94084   2%   0% ntpd --nofork -g</span><br><span class="line"> 973   956 root     S    22544   1%   0% udevd</span><br><span class="line">1890  1888 rancher  S    22448   1%   0% sshd: rancher@pts/0</span><br><span class="line">1586  1370 root     S    22096   1%   0% /usr/sbin/sshd -D</span><br><span class="line">1888  1586 root     S    22096   1%   0% sshd: rancher [priv]</span><br><span class="line">1989  1586 root     S    22096   1%   0% sshd: rancher [priv]</span><br><span class="line">1991  1989 rancher  S    22096   1%   0% sshd: rancher@pts/1</span><br><span class="line">1922  1891 root     S    16244   0%   0% bash</span><br><span class="line">1641  1588 rancher  S    16116   0%   0% -bash</span><br><span class="line">1885  1641 root     S    16116   0%   0% bash</span><br><span class="line">1891  1890 rancher  S    16116   0%   0% -bash</span><br><span class="line">1992  1991 rancher  S    16116   0%   0% -bash</span><br><span class="line">1997  1992 rancher  R    11420   0%   0% top</span><br><span class="line">1589  1370 root     S     6404   0%   0% /sbin/agetty --noclear tty2 linux</span><br><span class="line">1591  1370 root     S     6404   0%   0% /sbin/agetty --noclear tty3 linux</span><br><span class="line">1592  1370 root     S     6404   0%   0% /sbin/agetty --noclear tty4 linux</span><br><span class="line">1594  1370 root     S     6404   0%   0% /sbin/agetty --noclear tty5 linux</span><br><span class="line">1595  1370 root     S     6404   0%   0% /sbin/agetty --noclear tty6 linux</span><br><span class="line">1112   995 root     S     4660   0%   0% dhcpcd -MA4 -e force_hostname=<span class="literal">true</span> --timeout 10 -w --debug eth0</span><br><span class="line"> 850   803 root     S     4276   0%   0% /usr/sbin/acpid -f</span><br><span class="line"> 477     1 root     Z        0   0%   0% [ros]</span><br><span class="line">  49     2 root     IW       0   0%   0% [kworker/1:1]</span><br><span class="line">   8     2 root     IW       0   0%   0% [rcu_sched]</span><br><span class="line">  33     2 root     IW       0   0%   0% [kworker/0:1]</span><br><span class="line">   7     2 root     SW       0   0%   0% [ksoftirqd/0]</span><br><span class="line">  39     2 root     SWN      0   0%   0% [khugepaged]</span><br><span class="line">1317     2 root     IW       0   0%   0% [kworker/3:2]</span><br><span class="line">  48     2 root     IW       0   0%   0% [kworker/u8:1]</span><br><span class="line">  76     2 root     SW       0   0%   0% [scsi_eh_1]</span><br><span class="line">1244     2 root     IW       0   0%   0% [kworker/2:2]</span><br><span class="line">   2     0 root     SW       0   0%   0% [kthreadd]</span><br><span class="line">   4     2 root     IW&lt;      0   0%   0% [kworker/0:0H]</span><br><span class="line">   6     2 root     IW&lt;      0   0%   0% [mm_percpu_wq]</span><br><span class="line">   9     2 root     IW       0   0%   0% [rcu_bh]</span><br><span class="line">  10     2 root     SW       0   0%   0% [migration/0]</span><br><span class="line">  11     2 root     SW       0   0%   0% [watchdog/0]</span><br><span class="line">  12     2 root     SW       0   0%   0% [cpuhp/0]</span><br><span class="line">  13     2 root     SW       0   0%   0% [cpuhp/1]</span><br><span class="line">  14     2 root     SW       0   0%   0% [watchdog/1]</span><br><span class="line">  15     2 root     SW       0   0%   0% [migration/1]</span><br><span class="line">  16     2 root     SW       0   0%   0% [ksoftirqd/1]</span><br><span class="line">  18     2 root     IW&lt;      0   0%   0% [kworker/1:0H]</span><br></pre></td></tr></table></figure>
<h3 id="ros"><a href="#ros" class="headerlink" title="ros"></a>ros</h3><blockquote>
<p>A system service is a container that can be run in either System Docker or Docker. Rancher provides services that are already available in RancherOS by adding them to the <a href="https://github.com/rancher/os-services" target="_blank" rel="noopener">os-services repo</a>. Anything in the <code>index.yml</code> file from the repository for the tagged release will be an available system service when using the <code>ros service list</code> command.</p>
</blockquote>
<p>RancherOS 移除了 systemd ，取而代之的是使用 ros 来管理系统服务。而相应的系统服务也是采用 docker 的方式来运行，包括用户空间的 docker 也是采用 docker 的方式来运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># ros</span></span><br><span class="line">NAME:</span><br><span class="line">   ros - Control and configure RancherOS</span><br><span class="line">built: <span class="string">'2019-12-30T09:16:00Z'</span></span><br><span class="line"></span><br><span class="line">USAGE:</span><br><span class="line">   ros [global options] <span class="built_in">command</span> [<span class="built_in">command</span> options] [arguments...]</span><br><span class="line"></span><br><span class="line">VERSION:</span><br><span class="line">   v1.5.5</span><br><span class="line"></span><br><span class="line">AUTHOR(S):</span><br><span class="line">   Rancher Labs, Inc.</span><br><span class="line"></span><br><span class="line">COMMANDS:</span><br><span class="line">     config, c   configure settings</span><br><span class="line">     console     manage <span class="built_in">which</span> console container is used</span><br><span class="line">     engine      manage <span class="built_in">which</span> Docker engine is used</span><br><span class="line">     service, s</span><br><span class="line">     os          operating system upgrade/downgrade</span><br><span class="line">     tls         setup tls configuration</span><br><span class="line">     install     install RancherOS to disk</span><br><span class="line">     <span class="built_in">help</span>, h     Shows a list of commands or <span class="built_in">help</span> <span class="keyword">for</span> one <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">GLOBAL OPTIONS:</span><br><span class="line">   --<span class="built_in">help</span>, -h     show <span class="built_in">help</span></span><br><span class="line">   --version, -v  <span class="built_in">print</span> the version</span><br></pre></td></tr></table></figure>
<h3 id="系统进程"><a href="#系统进程" class="headerlink" title="系统进程"></a>系统进程</h3><ul>
<li>可以看到，使用 <code>ros service ps</code> 命令来查看正在运行的系统服务，这些服务都是以容器的方式来运行的。比如用户空间里的 <code>user-docker</code> 、<code>syslog</code> 、<code>udevd</code>   等等都是以容器的方式来运行的，而不是以传统进程服务来运行的。包括我们安装 RancherOS 到磁盘的时候  <code>starting installer container for rancher/os-installer:latest (new)</code> 这个安装程序也是由容器的方式来运行的，把磁盘设备和 <code>cloud-init</code> 配置文件一并挂载到容器中。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@rancher rancher]<span class="comment"># ros service ps</span></span><br><span class="line">Name                    Command                                                            State                     Ports</span><br><span class="line">docker                  ros user-docker                                                    Up 9 minutes</span><br><span class="line">logrotate               /usr/bin/entrypoint.sh /usr/sbin/logrotate -v /etc/logrotate.conf  Created</span><br><span class="line">system-cron             container-crontab                                                  Up 9 minutes</span><br><span class="line">container-data-volumes  /usr/bin/ros entrypoint <span class="built_in">echo</span>                                       Created</span><br><span class="line">console                 /usr/bin/ros entrypoint ros console-init                           Up 9 minutes</span><br><span class="line">system-volumes          /usr/bin/ros entrypoint <span class="built_in">echo</span>                                       Created</span><br><span class="line">ntp                     /usr/bin/ros entrypoint /bin/start_ntp.sh                          Up 9 minutes</span><br><span class="line">subscriber              /usr/bin/ros entrypoint os-subscriber                              Exited (0) 2 minutes ago</span><br><span class="line">syslog                  /usr/bin/entrypoint.sh rsyslogd -n                                 Up 9 minutes</span><br><span class="line">media-volumes           /usr/bin/ros entrypoint <span class="built_in">echo</span>                                       Created</span><br><span class="line">preload-user-images     /usr/bin/ros entrypoint ros preload-images                         Exited (0) 9 minutes ago</span><br><span class="line">udev                    /usr/bin/ros entrypoint udevd                                      Up 9 minutes</span><br><span class="line">udev-cold               /usr/bin/ros entrypoint ros udev-settle                            Exited (0) 9 minutes ago</span><br><span class="line">network                 /usr/bin/ros entrypoint netconf                                    Up 9 minutes</span><br><span class="line">open-vm-tools           /usr/bin/ros entrypoint /usr/bin/vmtoolsd                          Up 9 minutes</span><br><span class="line">acpid                   /usr/bin/ros entrypoint /usr/sbin/acpid -f                         Up 9 minutes</span><br><span class="line"><span class="built_in">command</span>-volumes         /usr/bin/ros entrypoint <span class="built_in">echo</span>                                       Created</span><br><span class="line">cloud-init-execute      /usr/bin/ros entrypoint cloud-init-execute -pre-console            Exited (0) 9 minutes ago</span><br><span class="line">user-volumes            /usr/bin/ros entrypoint <span class="built_in">echo</span>                                       Created</span><br><span class="line">all-volumes             /usr/bin/ros entrypoint <span class="built_in">echo</span></span><br></pre></td></tr></table></figure>
<h3 id="包管理器"><a href="#包管理器" class="headerlink" title="包管理器"></a>包管理器</h3><p>和 CoreOS 一样，RancherOS 也没得相应的包管理器😂，都是采用容器来运行所需的服务，使用 <code>ros</code> 命令来管理相应的服务。如果想要运行一个服务的话，需要使用 ros 来创建相应的容器来运行才可以。而使用 ros 来创建服务</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>文章写的太仓促了，感觉这些容器优化行操作系统都值得玩一玩得，尤其是 RancherOS 这种将 systemc 取代掉使用 docker 来管理系统服务得牛皮技术，值得研究一哈。因为时间有限，所以就没有详细地展开来将，就等到 2020 年吧😂。祝大家 2020 年元旦快乐，新的一年里……省略千字祝福😝</p>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AE%B9%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> 容器</a>
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
              <a href="/tags/docker/" rel="tag"><i class="fa fa-tag"></i> docker</a>
              <a href="/tags/kubernees/" rel="tag"><i class="fa fa-tag"></i> kubernees</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019-reading-notes.html" rel="prev" title="2019 年读书笔记和思考">
      <i class="fa fa-chevron-left"></i> 2019 年读书笔记和思考
    </a></div>
      <div class="post-nav-item">
    <a href="/2019-review.html" rel="next" title="2019 review">
      2019 review <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
  </div>
          </div>
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#更新日志"><span class="nav-number">1.</span> <span class="nav-text">更新日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器优化型操作系统？"><span class="nav-number">2.</span> <span class="nav-text">容器优化型操作系统？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GKE-的-Container-Optimized-OS"><span class="nav-number">2.1.</span> <span class="nav-text">GKE 的  Container-Optimized OS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CoreOS-Container-Linux"><span class="nav-number">2.2.</span> <span class="nav-text">CoreOS Container Linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Photon-OS"><span class="nav-number">2.3.</span> <span class="nav-text">Photon OS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RancherOS"><span class="nav-number">2.4.</span> <span class="nav-text">RancherOS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装体验"><span class="nav-number">3.</span> <span class="nav-text">安装体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Container-Optimized-OS"><span class="nav-number">3.1.</span> <span class="nav-text">Container-Optimized OS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Photon-OS-1"><span class="nav-number">4.</span> <span class="nav-text">Photon OS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#官方文档"><span class="nav-number">4.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装镜像"><span class="nav-number">4.2.</span> <span class="nav-text">安装镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">4.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统启动"><span class="nav-number">4.4.</span> <span class="nav-text">系统启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内核"><span class="nav-number">4.5.</span> <span class="nav-text">内核</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资源占用情况"><span class="nav-number">4.6.</span> <span class="nav-text">资源占用情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程和服务"><span class="nav-number">4.7.</span> <span class="nav-text">进程和服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#包管理工具"><span class="nav-number">4.8.</span> <span class="nav-text">包管理工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-容器引擎"><span class="nav-number">4.9.</span> <span class="nav-text">docker 容器引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用体验"><span class="nav-number">4.10.</span> <span class="nav-text">使用体验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CoreOS-Container-Linux-1"><span class="nav-number">5.</span> <span class="nav-text">CoreOS Container Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#官方文档-1"><span class="nav-number">5.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装镜像-OVA"><span class="nav-number">5.2.</span> <span class="nav-text">安装镜像 OVA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-1"><span class="nav-number">5.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统启动-1"><span class="nav-number">5.4.</span> <span class="nav-text">系统启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资源占用情况-1"><span class="nav-number">5.5.</span> <span class="nav-text">资源占用情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内核以及发行版信息"><span class="nav-number">5.6.</span> <span class="nav-text">内核以及发行版信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-容器引擎-1"><span class="nav-number">5.7.</span> <span class="nav-text">docker 容器引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#负载-1"><span class="nav-number">5.8.</span> <span class="nav-text">负载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程和服务-1"><span class="nav-number">5.9.</span> <span class="nav-text">进程和服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#包管理工具-1"><span class="nav-number">5.10.</span> <span class="nav-text">包管理工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用体验-1"><span class="nav-number">5.11.</span> <span class="nav-text">使用体验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RancherOS-1"><span class="nav-number">6.</span> <span class="nav-text">RancherOS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#官方文档-2"><span class="nav-number">6.1.</span> <span class="nav-text">官方文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装镜像-1"><span class="nav-number">6.2.</span> <span class="nav-text">安装镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-2"><span class="nav-number">6.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内核以及发行版信息-1"><span class="nav-number">6.4.</span> <span class="nav-text">内核以及发行版信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-容器引擎-2"><span class="nav-number">6.5.</span> <span class="nav-text">docker 容器引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rancher-引擎"><span class="nav-number">6.6.</span> <span class="nav-text">rancher 引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资源占用"><span class="nav-number">6.7.</span> <span class="nav-text">资源占用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统服务容器化"><span class="nav-number">6.8.</span> <span class="nav-text">系统服务容器化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ros"><span class="nav-number">6.9.</span> <span class="nav-text">ros</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统进程"><span class="nav-number">6.10.</span> <span class="nav-text">系统进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#包管理器"><span class="nav-number">6.11.</span> <span class="nav-text">包管理器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结束"><span class="nav-number">7.</span> <span class="nav-text">结束</span></a></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="木子"
      src="https://blog.k8s.li/avatar.png">
  <p class="site-author-name" itemprop="name">木子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail → mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://kindle.502.li/" title="Kindle → https:&#x2F;&#x2F;kindle.502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tg.k8s.li/" title="Channel → https:&#x2F;&#x2F;tg.k8s.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i>Channel</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">木子</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">39:50</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
      </div>
    </footer>
  </div>
  <script src="/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.k8s.li/container-linux-os.html",
            identifier: "container-linux-os.html",
            title: "Container Linux OS 从入坑到爬出来😂"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://muzi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>
</body>
</html>
