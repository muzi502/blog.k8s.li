<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="rgba(0,0,0,0)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="rgba(0,0,0,0)">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.k8s.li","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æ›´æ–° 2020-04-21ï¼šæ¨èé£Ÿç”¨  Telegram-Channel-Mirror è¿›è¡Œåä»£ telegram é¢‘é“  ä¸€æ¬¡å¶é‡æ˜¨å¤©åœ¨å’±çš„ è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼ æ”¶åˆ°äº† ChrAlpha å¤§ä½¬çš„å›å¤ï¼Œå’±å°±æ‹œè®¿äº†ä¸€ä¸‹å¤§ä½¬çš„åšå®¢ ğŸ˜‚ï¼Œæ— æ„é—´å‘ç° Cloudflare Worder å…è´¹æ­å»ºé•œåƒç«™ è¿™ç¯‡åšå®¢ã€‚äºæ˜¯å‘ï¼Œå’±ä¹Ÿæƒ³ç€èƒ½ä¸èƒ½ç©ä¸€ç©è¿™ä¸ª Workers ã€‚è™½ç„¶ä¹‹å‰å¬è¯´è¿‡">
<meta property="og:type" content="blog">
<meta property="og:title" content="ä½¿ç”¨ CloudFlare WorkersÂ æ­å»º telegram é¢‘é“é•œåƒç«™">
<meta property="og:url" content="https://blog.k8s.li/cloudflare-worker-build-mirror-website.html">
<meta property="og:site_name" content="Reimu&#39;s blog">
<meta property="og:description" content="æ›´æ–° 2020-04-21ï¼šæ¨èé£Ÿç”¨  Telegram-Channel-Mirror è¿›è¡Œåä»£ telegram é¢‘é“  ä¸€æ¬¡å¶é‡æ˜¨å¤©åœ¨å’±çš„ è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼ æ”¶åˆ°äº† ChrAlpha å¤§ä½¬çš„å›å¤ï¼Œå’±å°±æ‹œè®¿äº†ä¸€ä¸‹å¤§ä½¬çš„åšå®¢ ğŸ˜‚ï¼Œæ— æ„é—´å‘ç° Cloudflare Worder å…è´¹æ­å»ºé•œåƒç«™ è¿™ç¯‡åšå®¢ã€‚äºæ˜¯å‘ï¼Œå’±ä¹Ÿæƒ³ç€èƒ½ä¸èƒ½ç©ä¸€ç©è¿™ä¸ª Workers ã€‚è™½ç„¶ä¹‹å‰å¬è¯´è¿‡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.k8s.li/20200326184802562.png">
<meta property="og:image" content="https://p.k8s.li/20200326190914520.png">
<meta property="og:image" content="https://p.k8s.li/20200326191340166.png">
<meta property="og:image" content="https://p.k8s.li/20200326191435923.png">
<meta property="og:image" content="https://p.k8s.li/20200326193643610.png">
<meta property="og:image" content="https://p.k8s.li/20200327003346742.png">
<meta property="article:published_time" content="2020-03-25T16:00:00.000Z">
<meta property="article:modified_time" content="2020-04-20T16:00:00.000Z">
<meta property="article:author" content="Reimu">
<meta property="article:tag" content="GFW">
<meta property="article:tag" content="CloudFlare">
<meta property="article:tag" content="telegram">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.k8s.li/20200326184802562.png">


<link rel="canonical" href="https://blog.k8s.li/cloudflare-worker-build-mirror-website.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.k8s.li/cloudflare-worker-build-mirror-website.html","path":"cloudflare-worker-build-mirror-website.html","title":"ä½¿ç”¨ CloudFlare WorkersÂ æ­å»º telegram é¢‘é“é•œåƒç«™"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä½¿ç”¨ CloudFlare WorkersÂ æ­å»º telegram é¢‘é“é•œåƒç«™ | Reimu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Reimu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Reimu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-books"><a href="https://reading.k8s.li/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-kindle"><a href="https://kindle.502.li/" rel="noopener" target="_blank"><i class="fa fa-swatchbook fa-fw"></i>Kindle</a></li><li class="menu-item menu-item-friend"><a href="/friends.html" rel="section"><i class="fa fa-link fa-fw"></i>Friend</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0"><span class="nav-number">1.</span> <span class="nav-text">æ›´æ–°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E6%AC%A1%E5%81%B6%E9%81%87"><span class="nav-number">2.</span> <span class="nav-text">ä¸€æ¬¡å¶é‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9D%E9%80%80%E4%B8%89%E4%B8%80%E8%BF%9E"><span class="nav-number">3.</span> <span class="nav-text">åŠé€€ä¸‰ä¸€è¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA-Worker"><span class="nav-number">4.</span> <span class="nav-text">æ–°å»º Worker</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%B9%E8%BF%9B"><span class="nav-number">4.1.</span> <span class="nav-text">æ”¹è¿›</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D"><span class="nav-number">5.</span> <span class="nav-text">è‡ªå®šä¹‰åŸŸå</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%9B%BF%E6%8D%A2"><span class="nav-number">6.</span> <span class="nav-text">æ–‡æœ¬æ›¿æ¢</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E9%94%81%E6%9B%B4%E5%A4%9A%E5%A5%BD%E7%8E%A9%E5%84%BF%E7%9A%84-%F0%9F%98%8B"><span class="nav-number">7.</span> <span class="nav-text">è§£é”æ›´å¤šå¥½ç©å„¿çš„ ğŸ˜‹</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Reimu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Reimu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">115</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">147</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/muzi502" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;muzi502" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:blog@502.li" title="E-Mail â†’ mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/muzi_ii" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/muzi_ii" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;muzi_ii" rel="noopener" target="_blank"><i class="fa-brands fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa-solid fa-square-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.k8s.li/cloudflare-worker-build-mirror-website.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Reimu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reimu's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ä½¿ç”¨ CloudFlare WorkersÂ æ­å»º telegram é¢‘é“é•œåƒç«™ | Reimu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä½¿ç”¨ CloudFlare WorkersÂ æ­å»º telegram é¢‘é“é•œåƒç«™
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2020-03-26 2020-03-26T00:00:00+08:00" itemprop="dateCreated datePublished" datetime="2020-03-26T00:00:00+08:00">2020-03-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-04-21 2020-04-21T00:00:00+08:00" itemprop="dateModified" datetime="2020-04-21T00:00:00+08:00">2020-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/cloudflare-worker-build-mirror-website.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="cloudflare-worker-build-mirror-website.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>10 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><ul>
<li>2020-04-21ï¼šæ¨èé£Ÿç”¨  <a target="_blank" rel="noopener" href="https://github.com/idealclover/Telegram-Channel-Mirror">Telegram-Channel-Mirror</a> è¿›è¡Œåä»£ telegram é¢‘é“</li>
</ul>
<h2 id="ä¸€æ¬¡å¶é‡"><a href="#ä¸€æ¬¡å¶é‡" class="headerlink" title="ä¸€æ¬¡å¶é‡"></a>ä¸€æ¬¡å¶é‡</h2><p>æ˜¨å¤©åœ¨å’±çš„ <a href="https://blog.k8s.li/oh-my-webpsh.html">è®©å›¾ç‰‡é£èµ·æ¥ oh-my-webp.sh ï¼</a> æ”¶åˆ°äº† <a target="_blank" rel="noopener" href="https://ichr.me/">ChrAlpha</a> å¤§ä½¬çš„å›å¤ï¼Œå’±å°±æ‹œè®¿äº†ä¸€ä¸‹å¤§ä½¬çš„åšå®¢ ğŸ˜‚ï¼Œæ— æ„é—´å‘ç° <a target="_blank" rel="noopener" href="https://blog.ichr.me/post/cloudflare-worker-build-mirror-website/">Cloudflare Worder å…è´¹æ­å»ºé•œåƒç«™</a> è¿™ç¯‡åšå®¢ã€‚äºæ˜¯å‘ï¼Œå’±ä¹Ÿæƒ³ç€èƒ½ä¸èƒ½ç©ä¸€ç©è¿™ä¸ª Workers ã€‚è™½ç„¶ä¹‹å‰å¬è¯´è¿‡æœ‰ç”¨ Workers åšå¾ˆå¤šå¥½ç©çš„äº‹å„¿ï¼Œæ¯”å¦‚åŠ é€Ÿç½‘ç«™ã€ä»£ç† Google é•œåƒç«™ä»€ä¹ˆçš„ã€‚ä¸è¿‡è¿™äº›å¯¹äºå’±æ¥è¯´ä¸æ˜¯å¾ˆåˆšéœ€å°±æ²¡æœ‰æŠ˜è…¾ã€‚åˆšå¥½å’±çš„ telegram ç”µæŠ¥é¢‘é“ <a target="_blank" rel="noopener" href="https://t.me/rss_kubernetes">RSS Kubernetes</a> äººä¹Ÿæ¯”è¾ƒå¤šäº†ï¼Œä¸ºäº†æé«˜ä¸€ç‚¹å½±å“åŠ›ï¼Œå’±å°±æƒ³ç€èƒ½ä¸èƒ½æŠŠé¢‘é“çš„é¢„è§ˆç•Œé¢ <a target="_blank" rel="noopener" href="https://t.me/s/rss_kubernetes">t.me&#x2F;s&#x2F;rss_kubernetes</a> åä»£åˆ°å’±åŸŸåä¸Šã€‚è™½ç„¶ä¹‹å‰å°è¯•ä½¿ç”¨ nginx è¿›è¡Œåä»£ï¼Œä½†æ˜¯æ•ˆæœä¸å°½äººæ„ï¼Œäºæ˜¯å½“æ—¶å°±å¼ƒå‘äº†ã€‚åœ¨æ˜¥èŠ‚çš„æ—¶å€™å’±ä¹Ÿçœ‹åˆ°è¿‡æœ‰äººåä»£ <a target="_blank" rel="noopener" href="https://t.me/nCoV2019">2019-nCoV ç–«æƒ…å®æ—¶æ’­æŠ¥ ğŸ…¥</a> ï¼Œæ¯”å¦‚ <a target="_blank" rel="noopener" href="https://2019ncov.ga/">2019ncov.ga</a>ï¼Œä¸è¿‡å½“æ—¶é‚£ä¸ªé¡¹ç›®æŠ˜è…¾èµ·æ¥ä¹Ÿæ˜¯å¾ˆéº»çƒ¦ï¼Œå’±è¿™ç§èœé¸¡è¿˜æ˜¯æºœäº†æºœäº† ğŸ˜‚ã€‚ç›´åˆ°ä»Šå¤©çœ‹åˆ° <a target="_blank" rel="noopener" href="https://blog.ichr.me/post/cloudflare-worker-build-mirror-website/">Cloudflare Worder å…è´¹æ­å»ºé•œåƒç«™</a> è¿™ç¯‡åšå®¢åå°±å¿ƒè¡€æ¥æ½®ï¼Œå°±æä¸€æå§ ğŸ˜‚</p>
<h2 id="åŠé€€ä¸‰ä¸€è¿"><a href="#åŠé€€ä¸‰ä¸€è¿" class="headerlink" title="åŠé€€ä¸‰ä¸€è¿"></a>åŠé€€<del>ä¸‰</del>ä¸€è¿</h2><p>é¦–å…ˆä½ è¦æœ‰ä¸ª Cloudflare è´¦æˆ·ï¼Œè¿™æ˜¯å¿…é¡»çš„ã€‚å…³äº Cloudflare çš„æ³¨å†Œå’±å°±ä¸å¤šè¯´å•¦ï¼Œä¸è¿‡å’±å€’æ˜¯å»ºè®®å¤§å®¶ä¼™æŠŠåŸŸåçš„ DNS è§£ææ”¾åˆ° Cloudflare ä¸Šæ¥ï¼Œå¥½å¤„å¤šå¤šï¼šæœ‰æŠŠ https å°ç»¿é”ã€å…è´¹çš„ <del>åŠ é€Ÿ</del> å‡é€Ÿ CDN ï¼ˆå¢™å†…ï¼‰ã€åŸŸåè®¿é—®ç»Ÿè®¡ç­‰ç­‰å¯ç©æ€§æ¯”è¾ƒé«˜ ğŸ˜‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Cloudflare çš„ Worker ä¸€å¤© 10 ä¸‡æ¬¡å…è´¹é¢åº¦ï¼Œä¹Ÿå¤Ÿå’±å–ä¸€å£¶çš„å•¦ï¼Œä¸ç”¨æ‹…å¿ƒä¸å¤Ÿç”¨ã€‚</p>
<h2 id="æ–°å»º-Worker"><a href="#æ–°å»º-Worker" class="headerlink" title="æ–°å»º Worker"></a>æ–°å»º Worker</h2><p>ç™»å½•åˆ° <a target="_blank" rel="noopener" href="https://dash.cloudflare.com/">Cloudflare</a> çš„<del>å¤§ç›˜</del>é¢æ¿ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ <code>Menu</code> â€”-&gt; <code>Workers</code> è¿›å…¥åˆ° Workers é¡µé¢ã€‚æ–°æ³¨å†Œçš„ç”¨æˆ·ä¼šæç¤ºè®¾ç½®ä¸€ä¸ª <code>workers.dev</code> é¡¶çº§åŸŸåä¸‹çš„äºŒçº§å­åŸŸåï¼Œè¿™ä¸ªå­åŸŸåè®¾ç½®å¥½ä¹‹åæ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œä¹‹åä½ æ–°åˆ›å»ºçš„ Worker å°±ä¼šä½¿ä»¥è¿™ä¸ªåŸŸåè€ŒäºŒçº§å­åŸŸåå¼€å§‹çš„ï¼Œç±»ä¼¼äº  <code>WorkerName.yousetdomain.workers.dev</code> ã€‚<code>yousetdomain</code> å°±æ˜¯ä½ è¦è®¾ç½®çš„äºŒçº§å­åŸŸåï¼Œ<code>WorkerName</code> å¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯éšæœºç”Ÿæˆçš„ã€‚ä¹Ÿå¯ä»¥ç»™è‡ªå·±çš„åŸŸåæ·»åŠ ä¸€æ¡ CNAME åˆ° <code>WorkerName.yousetdomain.workers.dev</code> ï¼Œè¿™æ ·ä½¿ç”¨è‡ªå·±çš„åŸŸåå°±å¯ä»¥è®¿é—®åˆ° <code>Worker</code> äº†ã€‚</p>
<p>è®¾ç½®å¥½äºŒçº§å­åŸŸåä¹‹åé€‰æ‹© free å¥—é¤è®¡åˆ’ï¼Œç„¶åè¿›å…¥åˆ° Worker ç®¡ç†ç•Œé¢ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Worker</code>  ç„¶ååœ¨ <code>Script</code> è¾“å…¥æ¡†é‡Œå¡«å…¥ä»¥ä¸‹ä»£ç ã€‚<strong>ä¿—è¯è¯´ä»£ç å†™å¾—å¥½ï¼ŒåŒè¡ŒæŠ„åˆ°è€</strong>ï¼Œå’±çš„ <code>worker.js</code> ä»£ç æ˜¯å‚è€ƒè‡ª <a target="_blank" rel="noopener" href="https://github.com/Siujoeng-Lau/Workers-Proxy">Workers-Proxy</a> ï¼Œä¸è¿‡å’±å»æ‰äº†ä¸€äº›æ— å…³ç´§è¦çš„ä»£ç ï¼ŒåŸä»£ç æ˜¯åŠ å…¥äº†è¾¨åˆ«ç§»åŠ¨è®¾å¤‡é€‚é…åŸŸåã€å±è”½æŸäº› IP å’Œå›½å®¶çš„åŠŸèƒ½ã€‚å¯¹äºå’±çš„ telegram é¢‘é“é•œåƒç«™æ¥è¯´ï¼Œè¿™éƒ½æ˜¯å¤šä½™çš„ï¼Œäºæ˜¯å°±å»æ‰äº†ã€‚</p>
<p><img data-src="https://p.k8s.li/20200326184802562.png"></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Website you intended to retrieve for users.</span>
<span class="token keyword">const</span> upstream_me <span class="token operator">=</span> <span class="token string">'t.me'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> upstream_org <span class="token operator">=</span> <span class="token string">'telegram.org'</span><span class="token punctuation">;</span>

<span class="token comment">// Custom pathname for the upstream website.</span>
<span class="token keyword">const</span> upstream_path <span class="token operator">=</span> <span class="token string">'/s/rss_kubernetes'</span><span class="token punctuation">;</span>

<span class="token comment">// Whether to use HTTPS protocol for upstream address.</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Replace texts.</span>
<span class="token keyword">const</span> replace_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">$upstream</span><span class="token operator">:</span> <span class="token string">'$custom_domain'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetchAndApply</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchAndApply</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> url_hostname <span class="token operator">=</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>https <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    url<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">'https:'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    url<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">'http:'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">var</span> upstream_domain <span class="token operator">=</span> upstream_me<span class="token punctuation">;</span>

  <span class="token comment">// Check telegram.org</span>
  <span class="token keyword">let</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    upstream_domain <span class="token operator">=</span> upstream_org<span class="token punctuation">;</span>
    url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/static'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> upstream_path<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> upstream_path <span class="token operator">+</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  url<span class="token punctuation">.</span>host <span class="token operator">=</span> upstream_domain<span class="token punctuation">;</span>

  <span class="token keyword">let</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
  <span class="token keyword">let</span> request_headers <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
  <span class="token keyword">let</span> new_request_headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>request_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>

  new_request_headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Host'</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  new_request_headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Referer'</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> original_response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> method<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> new_request_headers
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> response_headers <span class="token operator">=</span> original_response<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
  <span class="token keyword">let</span> status <span class="token operator">=</span> original_response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>

  response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>original_response<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    status<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> response_headers
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Modify it.</span>
  <span class="token keyword">let</span> modified <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
    <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">telegram.org</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'tg.k8s.li/static'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Return modified response.</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>modified<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> response<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
    <span class="token literal-property property">statusText</span><span class="token operator">:</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> response<span class="token punctuation">.</span>headers
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåƒ <code>t.me</code> åŸŸåä¸‹çš„ç«™ç‚¹ï¼Œæ¯”å¦‚æˆ‘çš„ <code>https://t.me/s/rss_kubernetes</code> ï¼Œå®ƒçš„ js å’Œ css æ ·å¼æ–‡ä»¶æ˜¯ä½¿ç”¨çš„ telegram.org åŸŸåã€‚<del>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ <code>replace_dict</code> é‚£é‡Œå®šä¹‰å¥½æ›¿æ¢çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œ</del>å°†  <code>https://t.me/s/rss_kubernetes</code> é¡µé¢é‡Œçš„  <code>telegram.org</code> åŒæ ·è¿›è¡Œåä»£æ‰è¡Œï¼Œè¿™éœ€è¦ä¸º telegram å»ºä¸€ä¸ªå•ç‹¬çš„ Worker ğŸ˜‘ã€‚è¿™ä¹Ÿæ˜¯è¯„è®ºåŒº  <a target="_blank" rel="noopener" href="https://ichr.me/">ChrAlpha</a> å°ä¼™ä¼´æåˆ°çš„åŠæ³•ã€‚</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html">ubuntu@blog:~$ curl https://t.me/s/rss_kubernetes | grep "&lt;script src="
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  141k  100  141k    0     0  85287      0  0:00:01  0:00:01 --:--:-- 85237
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.org/js/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.org/js/jquery-ui.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.org/js/widget-frame.js?29<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.org/js/telegram-web.js?8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¿®æ”¹ä¸‹å¤„ä»£ç ä¸ºï¼Œå°† <code>https://t.me/s/rss_kubernetes</code> é¡µé¢é‡Œçš„  <code>telegram.org</code> åŒæ ·è¿›è¡Œä¸€æ¬¡åä»£ã€‚è¿™æ ·è®¿é—®åˆ° <code>https://t.me/s/rss_kubernetes</code> é¡µé¢æ—¶ï¼ŒæŠŠçš„ telegram.org æ›¿æ¢ä¸ºå¦ä¸€ä¸ª Worker çš„åŸŸåï¼Œæ¯”å¦‚æˆ‘çš„ <code>telegram.k8srss.workers.dev</code>  ã€‚ä¸è¿‡åƒé¢‘é“é‡Œçš„å›¾ç‰‡ã€æ–‡ä»¶ã€è§†é¢‘ç­‰èµ„æº telegram æ˜¯ä½¿ç”¨çš„ CDN ï¼Œè€Œä¸”æœ‰å¥½å‡ ä¸ªåŸŸåâ€¦â€¦è¿™ç‚¹å¾ˆåƒµç¡¬ï¼Œæš‚æ—¶æ‰¾ä¸åˆ°åˆé€‚çš„åŠæ³•ã€‚è²Œä¼¼ä¸€ä¸ª Worker åªèƒ½åä»£ä¸€ä¸ªåŸŸåï¼Ÿå¦‚æœæ±æœ‰åˆé€‚çš„åŠæ³•ï¼Œæ¬¢è¿ä¸å’±äº¤æµï¼Œå’±æ„Ÿæ¿€ä¸å°½ ğŸ˜‹</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> modified <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">telegram.org</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"telegram.k8srss.workers.dev"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿™æ ·å†ä½¿ç”¨ curl è®¿é—®æµ‹è¯•ä¸€ä¸‹ï¼ŒåŸæ¥çš„ telegram.org å·²ç»å…¨éƒ¨æ›¿æ¢æˆ telegram.k8srss.workers.dev äº† ğŸ˜‚ã€‚ç°åœ¨å¢™å†…ç”¨æˆ·ä¹Ÿå¯ä»¥æ— ç—›è®¿é—®å•¦ã€‚åœ¨æ­¤æ„Ÿè°¢  <a target="_blank" rel="noopener" href="https://ichr.me/">ChrAlpha</a>  å°ä¼™ä¼´ ğŸ˜‚ æå‡ºå®è´µçš„å»ºè®®ã€‚</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.k8srss.workers.dev/js/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.k8srss.workers.dev/js/jquery-ui.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.k8srss.workers.dev/js/widget-frame.js?29<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//telegram.k8srss.workers.dev/js/telegram-web.js?8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- page generated in 121.26ms --></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™ä¸ªæ–‡æœ¬æ›¿æ¢åŠŸèƒ½å¾ˆå¥½ç©å„¿ï¼Œåœ¨ Cloudflare å®˜æ–¹çš„åšå®¢é‡Œè¿˜æœ‰ä¸ª demo <a target="_blank" rel="noopener" href="https://cloudflareworkers.com/#c62c6c0002cb236166b794c440870cca:https://blog.cloudflare.com/introducing-cloudflare-workers">introducing-cloudflare-workers</a> ã€‚ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½å’±æœ‰è§£é”äº†ä¸€ä¸ªç©å…·ï¼Œç¨åå†è®² ğŸ˜‚ã€‚</p>
<blockquote>
<p>Here is a worker which performs a site-wide search-and-replace, replacing the word â€œWorkerâ€ with â€œMinionâ€. <a target="_blank" rel="noopener" href="https://cloudflareworkers.com/#c62c6c0002cb236166b794c440870cca:https://blog.cloudflare.com/introducing-cloudflare-workers">Try it out on this blog post.</a></p>
</blockquote>
<p><del>å‰½çªƒ</del>ä¿®æ”¹å¥½ä»£ç ä¹‹åç‚¹å‡»å·¦ä¸‹è§’çš„ <code>Save and Deploy</code> ç„¶å Preview çœ‹çœ‹é¡µé¢æ˜¯å¦æ˜¾ç¤ºæ­£å¸¸ï¼Œå¦‚æœæ˜¾ç¤ºæ­£å¸¸æ­å–œä½ æˆåŠŸå•¦ã€‚</p>
<p><img data-src="https://p.k8s.li/20200326190914520.png"></p>
<p>å¦‚æœä½ æƒ³ä½¿ç”¨è¿™ç§åŠæ³•åä»£å…¶ä»–é¢‘é“ï¼Œåªéœ€è¦æŠŠ <code>const upstream_path = &#39;/s/rss_kubernetes&#39;</code> åçš„  rss_kubernetes æ›¿æ¢ä¸ºä½ æƒ³è¦ä»£ç†çš„ telegram é¢‘é“ username å³å¯ã€‚ä¹‹æ‰€ä»¥åŠ ä¸Š <code>upstream_path</code>  è€Œä¸åä»£æ•´ä¸ª <code>t.me</code> æ˜¯ä¸ºäº†é˜²æ­¢åˆ«äººæ»¥ç”¨ï¼Œæ¯•ç«Ÿ 10W æ¬¡ä¸ç»è–… ğŸ˜‚</p>
<h3 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h3><p>å‘¨å››æ™šä¸Šç¡è§‰å‰åœ¨æ¨ç‰¹ä¸Šå‘äº†ä¸ªæ¨æ–‡ï¼Œå‘å¤§å®¶è¯·æ•™äº†ä¸€ä¸‹ä¹‹å‰ä¸€ä¸ª Worker é‡Œåªèƒ½åä»£ä¸€ä¸ªåŸŸåçš„é—®é¢˜ã€‚ç¬¬äºŒå¤© <a target="_blank" rel="noopener" href="https://twitter.com/Echowxsy">@Echowxsy</a> å°±å›å¤å’±äº†ï¼Œè€Œä¸”è¿˜ç‰¹æ„æ³¨å†Œäº† CouldFare è´¦å·ä½¿ç”¨ Workers å¸®å’±æµ‹è¯•äº†ä¸€ä¸‹ã€‚åœ¨æ­¤éå¸¸æ„Ÿè°¢ <a target="_blank" rel="noopener" href="https://twitter.com/Echowxsy">@Echowxsy</a>  å¸®å’±ã€‚æŒ‰ç…§  <a target="_blank" rel="noopener" href="https://twitter.com/Echowxsy">@Echowxsy</a> å°ä¼™ä¼´æ‰€è¯´çš„ï¼š</p>
<blockquote>
<p>æˆ‘æ²¡ç”¨è¿‡ CloudFlareï¼Œä¸è¿‡æˆ‘çœ‹äº†ä¸€ä¸‹ä½ çš„ blogï¼Œè²Œä¼¼å¯ä»¥ç”¨ä¸¤ä¸ª upstream å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ åœ¨ modified é‚£é‡Œæ›¿æ¢ä¸ºå½“å‰ worker çš„åœ°å€ï¼Œç„¶ååœ¨åé¢åŠ ä¸Šä¸€ä¸ªä¸ä¼šé‡å¤çš„è·¯å¾„ï¼Œä¾‹å¦‚ xxxã€‚ ç„¶ååœ¨ fetchAndApply é‡Œé¢åˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¯·æ±‚çš„ pathname&#x3D;&#x2F;xxxï¼Œä½¿ç”¨ upstream2ï¼Œå¦åˆ™ä½¿ç”¨ upstream1ã€‚ ç†è®ºä¸Šæ˜¯å¯ä»¥å®ç°çš„ã€‚</p>
<p>å°±æ˜¯ä¸€ä¸ª Workers å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä»–å®é™…ä¸Šå°±æ˜¯ Node.js ä»£ç ã€‚ ç„¶åè¿™é‡Œæ˜¯å°† <a target="_blank" rel="noopener" href="https://t.co/wTGzY4U6sD?amp=1">http://telegram.org/xxxx</a> æ˜ å°„åˆ° <a target="_blank" rel="noopener" href="https://t.co/yQwEY2mzCP?amp=1">http://tg.k8s.li/static/xxxx</a> ã€‚ ç„¶ååœ¨ Workers é‡Œé¢åˆ¤æ–­ï¼Œå¦‚æœæœ‰ <code>/static</code> åˆ™ä» <a target="_blank" rel="noopener" href="https://t.co/VYm4zCfwPr?amp=1">http://telegram.org</a> è·å–ï¼Œå¦åˆ™ä» <a target="_blank" rel="noopener" href="https://t.co/N4Ahg0VLN1?amp=1">http://t.me</a> è·å–ã€‚</p>
</blockquote>
<p><code>æ­¤å¤„å¼•ç”¨</code> <a target="_blank" rel="noopener" href="https://twitter.com/Echowxsy">@Echowxsy</a> çš„ <a target="_blank" rel="noopener" href="https://twitter.com/Echowxsy/status/1243407321989967874">æ¨æ–‡</a></p>
<p>Woerker é¦–å…ˆæˆ‘ä»¬è·å–å®Œè¦åä»£çš„ <code>https://t.me/s/rss_kubernetes </code> é¡µé¢ html æºç ï¼Œç„¶åä½¿ç”¨ replace å‡½æ•°æŠŠ telegram.org ä»¥åŠ cdn[1-5].telesco.pe ç­‰åŸŸåè¿›è¡Œæ›¿æ¢ï¼Œæ›¿æ¢ä¸º &#x2F;static ã€&#x2F;cdn[1-5] ç­‰ä¸åŒçš„ url è·¯å¾„ã€‚ç„¶åå°†ä¿®æ”¹åçš„ html é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å®¢æˆ·ç«¯åœ¨è¯·æ±‚ <code>/static</code>  æ—¶ Worker å°±ä¼šå» <a target="_blank" rel="noopener" href="https://t.co/VYm4zCfwPr?amp=1">http://telegram.org</a> è·å–ç›¸åº”çš„èµ„æºè¿”å›ç»™ç”¨æˆ·ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ª Worker åä»£å¤šä¸ªåŸŸåéªšæ“ä½œã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> upstream_me <span class="token operator">=</span> <span class="token string">'t.me'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> upstream_org <span class="token operator">=</span> <span class="token string">'telegram.org'</span><span class="token punctuation">;</span>

<span class="token comment">// Custom pathname for the upstream website.</span>
<span class="token keyword">const</span> upstream_path <span class="token operator">=</span> <span class="token string">'/s/rss_kubernetes'</span><span class="token punctuation">;</span>

<span class="token comment">// Whether to use HTTPS protocol for upstream address.</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Replace texts.</span>
<span class="token keyword">const</span> replace_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">$upstream</span><span class="token operator">:</span> <span class="token string">'$custom_domain'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetchAndApply</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchAndApply</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> url_hostname <span class="token operator">=</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>https <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    url<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">'https:'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    url<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">'http:'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">var</span> upstream_domain <span class="token operator">=</span> upstream_me<span class="token punctuation">;</span>

  <span class="token comment">// Check telegram.org</span>
  <span class="token keyword">let</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    upstream_domain <span class="token operator">=</span> upstream_org<span class="token punctuation">;</span>
    url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/static'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> upstream_path<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> upstream_path <span class="token operator">+</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  url<span class="token punctuation">.</span>host <span class="token operator">=</span> upstream_domain<span class="token punctuation">;</span>

  <span class="token keyword">let</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
  <span class="token keyword">let</span> request_headers <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
  <span class="token keyword">let</span> new_request_headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>request_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>

  new_request_headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Host'</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  new_request_headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Referer'</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> original_response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> method<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> new_request_headers
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> original_response_clone <span class="token operator">=</span> original_response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> response_headers <span class="token operator">=</span> original_response<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
  <span class="token keyword">let</span> new_response_headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>response_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> status <span class="token operator">=</span> original_response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>

  response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>original_response_clone<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    status<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> new_response_headers
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Modify it.</span>
  <span class="token keyword">let</span> modified <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">telegram.org</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">'tg.k8s.li/static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Return modified response.</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>modified<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> response<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
    <span class="token literal-property property">statusText</span><span class="token operator">:</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> response<span class="token punctuation">.</span>headers
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="è‡ªå®šä¹‰åŸŸå"><a href="#è‡ªå®šä¹‰åŸŸå" class="headerlink" title="è‡ªå®šä¹‰åŸŸå"></a>è‡ªå®šä¹‰åŸŸå</h2><p>å›åˆ° Workers çš„ç®¡ç†é¡µé¢ï¼Œç‚¹å‡» <code>rename</code> å³å¯ä¿®æ”¹ Worker çš„ä¸‰çº§å­åŸŸåã€‚ä¸è¿‡å’±è¿˜æ˜¯ä¸å¤ªå–œæ¬¢ <code>WorkerName.yousetdomain.workers.dev</code> è¿™ä¹ˆé•¿çš„åŸŸåï¼Œæƒ³ä½¿ç”¨å’±è‡ªå·±çš„äºŒçº§å­åŸŸåè®¿é—®ã€‚</p>
<p>é¦–å…ˆå›åˆ°åŸŸåç®¡ç†çš„é¡µé¢ï¼Œè¿›å…¥åˆ°è‡ªå·±åŸŸåé¡¶éƒ¨é‚£ä¸€æ é‡Œçš„ <code>Workers</code> ï¼Œåœ¨é‚£é‡Œæ·»åŠ ç›¸åº”çš„è·¯ç”±å³å¯ã€‚</p>
<p><img data-src="https://p.k8s.li/20200326191340166.png"></p>
<p>ç‚¹å‡» <code>Add Route</code> ï¼Œåœ¨ Route é‚£ä¸€æ è¾“å…¥å¥½è‡ªå·±çš„åŸŸåï¼Œæ³¨æ„æœ€åçš„ <code>/*</code> ä¹Ÿè¦åŠ ä¸Šï¼Œç„¶å Worker é€‰æ‹©åˆšåˆšåˆ›å»ºçš„é‚£ä¸ªå³å¯ã€‚æ¥ç€å†æ·»åŠ  <code>CNAME</code> è®°å½•åˆ°è‡ªå·±çš„ <code>WorkerName.yousetdomain.workers.dev</code> ï¼Œè¿™æ ·å°±èƒ½ä½¿ç”¨è‡ªå·±çš„åŸŸåè®¿é—®å•¦ ğŸ˜‹</p>
<p><img data-src="https://p.k8s.li/20200326191435923.png"></p>
<h2 id="æ–‡æœ¬æ›¿æ¢"><a href="#æ–‡æœ¬æ›¿æ¢" class="headerlink" title="æ–‡æœ¬æ›¿æ¢"></a>æ–‡æœ¬æ›¿æ¢</h2><p>å‰æ–‡æåˆ°çš„æ–‡æœ¬æ›¿æ¢åŠŸèƒ½å¸®å’±è§£å†³äº†ä¸€ä¸ªå°é—®é¢˜ã€‚å’±å‹é“¾å…³æ³¨çš„ä¸€ä¸ªåšå®¢ <a target="_blank" rel="noopener" href="https://chanshiyu.com/#/">chanshiyu.com</a> æ²¡æœ‰æä¾› RSS ï¼Œä»–æ˜¯å°†åšå®¢å†…å®¹æ”¾åœ¨ GitHub issue ä¸Šï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ RSSHUB æ¥è®¢é˜… GitHub çš„ issue æ¥è·å–åšå®¢çš„æ›´æ–°ã€‚ä½† RSSHUB è·å–çš„æ˜¯ GitHub issue çš„é“¾æ¥è€ŒéåŸåšå®¢çš„é“¾æ¥ï¼Œäºæ˜¯å’±æƒ³äº†æƒ³å°±ç”¨ <code>Worker</code> è¿›è¡Œæ›¿æ¢ä¸å¾—äº†ã€‚</p>
<p>é€šè¿‡ RSSHUB è·å–åˆ°çš„ RSS æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rss</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>atom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2005/Atom<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>channel</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>
<span class="token cdata">&lt;![CDATA[ chanshiyucx/blog Issues ]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span><span class="token punctuation">></span></span>https://github.com/chanshiyucx/blog/issues<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>link</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">atom:</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://rsshub.app/github/issue/chanshiyucx/blog<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>self<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>application/rss+xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>
<span class="token cdata">&lt;![CDATA[
chanshiyucx/blog Issues - Made with love by RSSHub(https://github.com/DIYgod/RSSHub)
]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generator</span><span class="token punctuation">></span></span>RSSHub<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generator</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>webMaster</span><span class="token punctuation">></span></span>i@diygod.me (DIYgod)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>webMaster</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>language</span><span class="token punctuation">></span></span>zh-cn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>language</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lastBuildDate</span><span class="token punctuation">></span></span>Thu, 26 Mar 2020 11:00:06 GMT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lastBuildDate</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ttl</span><span class="token punctuation">></span></span>60<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ttl</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>
<span class="token cdata">&lt;![CDATA[ Telegram ç”µæŠ¥æœºå™¨äºº ]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>
<span class="token cdata">&lt;![CDATA[
]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pubDate</span><span class="token punctuation">></span></span>Wed, 25 Mar 2020 03:54:04 GMT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pubDate</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>guid</span> <span class="token attr-name">isPermaLink</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>https://github.com/chanshiyucx/blog/issues/108<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>guid</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span><span class="token punctuation">></span></span>https://github.com/chanshiyucx/blog/issues/108<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>link</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å…¶ä¸­çš„ <code>&lt;guid isPermaLink=&quot;false&quot;&gt;</code> å’Œ <code>&lt;link&gt;</code> ä¸­çš„é“¾æ¥ github.com&#x2F;chanshiyucx&#x2F;blog&#x2F;issues&#x2F; æ›¿æ¢ä¸º chanshiyu.com&#x2F;#&#x2F;post&#x2F; å³å¯ã€‚äºæ˜¯è¿˜æ˜¯åŒæ ·çš„æ–¹æ³•æ–°å»ºä¸€ä¸ª Workerï¼Œç„¶åä¿®æ”¹ä¸€ä¸‹ <code>worker.js</code> çš„ä»£ç å°±å¯ä»¥å•¦ã€‚</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Website you intended to retrieve for users.</span>
<span class="token keyword">const</span> upstream <span class="token operator">=</span> <span class="token string">'rsshub.app'</span>

<span class="token comment">// Custom pathname for the upstream website.</span>
<span class="token keyword">const</span> upstream_path <span class="token operator">=</span> <span class="token string">'/github/issue/chanshiyucx/blog'</span>

<span class="token comment">// Whether to use HTTPS protocol for upstream address.</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">fetchAndApply</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchAndApply</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> url_hostname <span class="token operator">=</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>https <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        url<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">'https:'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        url<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">'http:'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">var</span> upstream_domain <span class="token operator">=</span> upstream<span class="token punctuation">;</span>
    url<span class="token punctuation">.</span>host <span class="token operator">=</span> upstream_domain<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> upstream_path<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> upstream_path <span class="token operator">+</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">let</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
    <span class="token keyword">let</span> request_headers <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
    <span class="token keyword">let</span> new_request_headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>request_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>

    new_request_headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Host'</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    new_request_headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Referer'</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> original_response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> method<span class="token punctuation">,</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> new_request_headers
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> original_response_clone <span class="token operator">=</span> original_response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> original_text <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> response_headers <span class="token operator">=</span> original_response<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
    <span class="token keyword">let</span> new_response_headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>response_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> status <span class="token operator">=</span> original_response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>

    <span class="token keyword">const</span> content_type <span class="token operator">=</span> new_response_headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>content_type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'text/html'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> content_type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        original_text <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">replace_response_text</span><span class="token punctuation">(</span>original_response_clone<span class="token punctuation">,</span> upstream_domain<span class="token punctuation">,</span> url_hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        original_text <span class="token operator">=</span> original_response_clone<span class="token punctuation">.</span>body
    <span class="token punctuation">&#125;</span>

    response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>original_text<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        status<span class="token punctuation">,</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> new_response_headers
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Modify it.</span>
    <span class="token keyword">let</span> modified <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">github.com\/chanshiyucx\/blog\/issues\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"chanshiyu.com\/#\/post\/"</span><span class="token punctuation">)</span>

<span class="token comment">// Return modified response.</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>modified<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">status</span><span class="token operator">:</span> response<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
        <span class="token literal-property property">statusText</span><span class="token operator">:</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">,</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> response<span class="token punctuation">.</span>headers
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>éƒ¨ç½²å¥½ Worker ä¹‹åå°±å¯ä»¥ä½¿ç”¨ RSS æ¥è®¢é˜…å•¦ ğŸ˜‹</p>
<p><img data-src="https://p.k8s.li/20200326193643610.png"></p>
<h2 id="è§£é”æ›´å¤šå¥½ç©å„¿çš„-ğŸ˜‹"><a href="#è§£é”æ›´å¤šå¥½ç©å„¿çš„-ğŸ˜‹" class="headerlink" title="è§£é”æ›´å¤šå¥½ç©å„¿çš„ ğŸ˜‹"></a>è§£é”æ›´å¤šå¥½ç©å„¿çš„ ğŸ˜‹</h2><p>å…³äº Cloudflare çš„ Workers è¿˜æœ‰æ›´å¤šå¥½ç©çš„ç­‰å¾…ä½ å»å‘ç°ï¼Œå’±å°±æ¨èä¸€ä¸‹å•¦ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.ichr.me/post/cloudflare-worker-build-mirror-website/">Cloudflare Worker å…è´¹æ­å»ºé•œåƒç«™</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.cloudflare.com/zh/cloudflare-workers-unleashed-zh/">ä»ç°åœ¨èµ·ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨ Cloudflare ä¸Šä½¿ç”¨ Workers è¿è¡Œ JavaScriptï¼</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.cloudflare.com/zh/just-write-code-improving-developer-experience-for-cloudflare-workers-zh/">å°½æƒ…ç¼–å†™ä»£ç å§ï¼šæ”¹å–„å¼€å‘äººå‘˜ä½¿ç”¨ Cloudflare Workers çš„ä½“éªŒ</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.skk.moe/post/cloudflare-workers-cfga">ä½¿ç”¨ Cloudflare Workers åŠ é€Ÿ Google Analytics</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.meow.page/2019/09/24/free-personal-image-hosting-with-backblaze-b2-and-cloudflare-workers">ä½¿ç”¨ Backblaze B2 å’Œ Cloudflare Workers æ­å»ºå¯ä»¥è‡ªå®šä¹‰åŸŸåçš„å…è´¹å›¾åºŠ</a></li>
<li><a target="_blank" rel="noopener" href="https://free.com.tw/cloudflare-workers-wordpress/">ä½¿ç”¨ Cloudflare Workers æé«˜ WordPress é€Ÿåº¦å’Œæ•ˆèƒ½æ•™å­¸</a></li>
<li><a target="_blank" rel="noopener" href="https://yojigen.tech/archives/post19/">ä½¿ç”¨ Cloudflare Workers åå¸¦ P ç«™å›¾ç‰‡</a></li>
</ul>
<p>æœ€åå®£ä¼ ä¸€ä¸‹å’±çš„ <a target="_blank" rel="noopener" href="https://t.me/rss_kubernetes">@rss_kubernetes</a> é¢‘é“ï¼Œå›½å†…ç”¨æˆ·å¯ä»¥è®¿é—® <a target="_blank" rel="noopener" href="https://tg.k8s.li/">tg.k8s.li</a>ï¼Œå¦‚æœä½ å¯¹ docker ã€K8sã€äº‘åŸç”Ÿç­‰æ„Ÿå…´è¶£ï¼Œå°±åˆ°å’±ç¢—é‡Œæ¥å§ ğŸ˜‚ã€‚ä¸è®¢é˜…å’±çš„é¢‘é“ä¹Ÿå¯ä»¥é€šè¿‡å’±çš„ <a target="_blank" rel="noopener" href="https://tg.k8s.li/">tg.k8s.li</a> é•œåƒç«™æ¥æŸ¥çœ‹ RSS æ¨é€ä¿¡æ¯ã€‚</p>
<p><img data-src="https://p.k8s.li/20200327003346742.png"></p>
<p>GitHub page åˆè¢«å¢™ä¸€æ³¢ï¼Œrsshub.app ä¹Ÿè¢«å¢™æ‰äº†ã€‚å¢™è¶Šæ¥è¶Šé«˜äº†ï¼Œè¿™ä¸ªç¤¾ä¼šä¹Ÿæ¥è¶Šå¯ç¬‘äº†â€¦â€¦ä¸çŸ¥é“æœªæ¥çš„äº’è”ç½‘ä¼šå˜æˆä»€ä¹ˆæ ·å­ï¼Œä½†æˆ‘ä»¬ä½œä¸ºä¸€åªå±æ°‘èƒ½åšçš„å°±æ˜¯<strong>ä¸ä¸ºå¢™æ·»ç –åŠ ç“¦ï¼Œä¸ä¸ºææƒä¸“åˆ¶ç‹¬è£æš´æ”¿å”±èµæ­Œ</strong>ã€‚æœ€åä¸€å¼ è‡ªå·±åˆ¶ä½œ kindle ç”µå­ä¹¦æ—¶å–œæ¬¢ä½¿ç”¨çš„å°é¢å›¾ç‰‡é€ç»™å¤§å®¶ã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/GFW/" rel="tag"># GFW</a>
              <a href="/tags/CloudFlare/" rel="tag"># CloudFlare</a>
              <a href="/tags/telegram/" rel="tag"># telegram</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/systemd.html" rel="prev" title="Linux çš„å°ä¼™ä¼´ systemd è¯¦è§£">
                  <i class="fa fa-chevron-left"></i> Linux çš„å°ä¼™ä¼´ systemd è¯¦è§£
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/spring-reading-note.html" rel="next" title="æ˜¥å­£è¯»ä¹¦ç¬”è®°">
                  æ˜¥å­£è¯»ä¹¦ç¬”è®° <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reimu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">25:36</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>


  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"muzi","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
